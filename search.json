[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Marc-Aurèle Rivière",
    "section": "",
    "text": "Cognitive Neuroscientist with a keen interest in Perception, Spatial Cognition, and Human-Machine Interfaces.\nI’m a recovering academic who worked on several projects at the intersection between Cognitive Neurosciences and Biomedical Engineering. Those projects aimed to develop and evaluate wearable assistive devices for Visually Impaired People (VIP), providing them with a non-visual experience of their surroundings through a clever use of :Computer Vision and Augmented Reality, within the :Sensory Substitution framework.\nI have since retrained as a Data Scientist with a fondness for Bayesian methods and an unhealthy obsession with the R ecosystem and its community. I also dabble in more generic programming languages such as Java, C# (Unity), and Javascript.\n\n\n\n\n\n\n\n\n\n\nI use this website to gather information on the various projects I have worked on, my publications and scientific communications, as well as some blog posts (which mainly pertain to R and statistics). I also maintain an up-to-date resumé."
  },
  {
    "objectID": "content/posts/climbing/index.html#stan-setup",
    "href": "content/posts/climbing/index.html#stan-setup",
    "title": "Bayesian Rock Climbing Rankings",
    "section": "Stan setup",
    "text": "Stan setup\n\nInstalling CmdStancmdstanr::check_cmdstan_toolchain(fix = TRUE, quiet = TRUE)\n\ncpp_opts <- list(\n  stan_threads = TRUE\n  , STAN_CPP_OPTIMS = TRUE\n  , STAN_NO_RANGE_CHECKS = TRUE # WARN: remove this if you haven't tested the model\n  , PRECOMPILED_HEADERS = TRUE\n  , CXXFLAGS_OPTIM = \"-march=native -mtune=native\"\n  , CXXFLAGS_OPTIM_TBB = \"-mtune=native -march=native\"\n  , CXXFLAGS_OPTIM_SUNDIALS = \"-mtune=native -march=native\"\n)\n\ncmdstanr::install_cmdstan(cpp_options = cpp_opts, quiet = TRUE)\n\n\n\nLoading CmdStan (if already installed)highest_cmdstan_version <- fs::dir_ls(config$cmdstan_path) |> fs::path_file() |> \n  keep(\\(e) str_detect(e, \"cmdstan-\")) |> \n  bind(x, str_split(x, '-', simplify = TRUE)[,2]) |> \n  reduce(\\(x, y) ifelse(utils::compareVersion(x, y) == 1, x, y))\n\nset_cmdstan_path(glue::glue(\"{config$cmdstan_path}cmdstan-{highest_cmdstan_version}\"))\n\n\n\nSetting up knitr’s engine for CmdStan## Inspired by: https://mpopov.com/blog/2020/07/30/replacing-the-knitr-engine-for-stan/\n\n## Note: We could haved use cmdstanr::register_knitr_engine(), \n##       but it wouldn't include compiler optimizations & multi-threading by default\n\nknitr::knit_engines$set(\n  cmdstan = function(options) {\n    output_var <- options$output.var\n    if (!is.character(output_var) || length(output_var) != 1L) {\n      stop(\n        \"The chunk option output.var must be a character string \",\n        \"providing a name for the returned `CmdStanModel` object.\"\n      )\n    }\n    if (options$eval) {\n      if (options$cache) {\n        cache_path <- options$cache.path\n        if (length(cache_path) == 0L || is.na(cache_path) || cache_path == \"NA\") {\n          cache_path <- \"\"\n        }\n        dir <- paste0(cache_path, options$label)\n      } else {\n        dir <- tempdir()\n      }\n      file <- cmdstanr::write_stan_file(options$code, dir = dir, force_overwrite = TRUE)\n      mod <- cmdstanr::cmdstan_model(\n        stan_file = file, \n        cpp_options = list(\n          stan_threads = TRUE\n          , STAN_CPP_OPTIMS = TRUE\n          , STAN_NO_RANGE_CHECKS = TRUE # The model was already tested\n          , PRECOMPILED_HEADERS = TRUE\n          # , CXXFLAGS_OPTIM = \"-march=native -mtune=native\"\n          , CXXFLAGS_OPTIM_TBB = \"-mtune=native -march=native\"\n          , CXXFLAGS_OPTIM_SUNDIALS = \"-mtune=native -march=native\"\n        ),\n        stanc_options = list(\"Oexperimental\"),\n        force_recompile = TRUE\n      )\n      assign(output_var, mod, envir = knitr::knit_global())\n    }\n    options$engine <- \"stan\"\n    code <- paste(options$code, collapse = \"\\n\")\n    knitr::engine_output(options, code, '')\n  }\n)\n\n\n\n\n\n\n\n\n\nExpand for Session Info\n\n\n\n\n\n\n\n─ Session info ───────────────────────────────────────────────────────────────\n setting        value\n version        R version 4.2.1 (2022-06-23)\n os             Ubuntu 20.04.4 LTS\n system         x86_64, linux-gnu\n ui             X11\n language       (EN)\n collate        C.UTF-8\n ctype          C.UTF-8\n tz             Europe/Paris\n date           2022-10-17\n pandoc         2.19.2\n Quarto         1.2.207\n Stan (CmdStan) 2.30.1\n\n─ Packages ───────────────────────────────────────────────────────────────────\n ! package    * version       date (UTC) lib source\n P bayesplot  * 1.9.0         2022-03-10 [?] CRAN (R 4.2.0)\n P cmdstanr   * 0.5.3         2022-10-12 [?] Github (stan-dev/cmdstanr@cdd62a0)\n P crayon     * 1.5.2         2022-09-29 [?] CRAN (R 4.2.1)\n P data.table * 1.14.5        2022-10-12 [?] Github (Rdatatable/data.table@052f8da)\n P DBI        * 1.1.3         2022-06-18 [?] CRAN (R 4.2.0)\n P dbplyr     * 2.2.1.9000    2022-10-12 [?] Github (Tidyverse/dbplyr@5ce71b7)\n P dplyr      * 1.0.99.9000   2022-10-12 [?] Github (Tidyverse/dplyr@34981f9)\n P dtplyr     * 1.2.2         2022-08-20 [?] CRAN (R 4.2.1)\n P duckdb     * 0.5.1         2022-09-20 [?] CRAN (R 4.2.1)\n P ggplot2    * 3.3.6         2022-05-03 [?] CRAN (R 4.2.0)\n P ggridges   * 0.5.4         2022-09-26 [?] CRAN (R 4.2.1)\n P gt         * 0.7.0         2022-08-25 [?] CRAN (R 4.2.1)\n P gtExtras   * 0.4.3         2022-10-08 [?] Github (jthomasmock/gtExtras@2b53a12)\n P here       * 1.0.1         2020-12-13 [?] CRAN (R 4.2.0)\n P lubridate  * 1.8.0         2021-10-07 [?] CRAN (R 4.2.0)\n P patchwork  * 1.1.2         2022-08-19 [?] CRAN (R 4.2.1)\n P pipebind   * 0.1.1         2022-08-10 [?] CRAN (R 4.2.0)\n P posterior  * 1.3.1         2022-09-06 [?] CRAN (R 4.2.1)\n P purrr      * 0.9000.0.9000 2022-10-13 [?] Github (Tidyverse/purrr@af857c2)\n P RSQLite    * 2.2.18        2022-10-04 [?] CRAN (R 4.2.1)\n P stringr    * 1.4.1         2022-08-20 [?] CRAN (R 4.2.1)\n P tidyr      * 1.2.1         2022-09-08 [?] CRAN (R 4.2.1)\n\n [1] /home/mar/Dev/Projects/R/ma-riviere.me/renv/library/R-4.2/x86_64-pc-linux-gnu\n [2] /home/mar/Dev/Projects/R/ma-riviere.me/renv/sandbox/R-4.2/x86_64-pc-linux-gnu/9a444a72\n\n P ── Loaded and on-disk path mismatch.\n\n──────────────────────────────────────────────────────────────────────────────"
  },
  {
    "objectID": "content/posts/climbing/index.html#extracting-the-data-from-sql",
    "href": "content/posts/climbing/index.html#extracting-the-data-from-sql",
    "title": "Bayesian Rock Climbing Rankings",
    "section": "\n1.1 Extracting the data from SQL",
    "text": "1.1 Extracting the data from SQL\nConnecting to the .sqlite DB:\n\nsqlite_con <- dbConnect(SQLite(), dbname = sqlite_path)\n\nMoving the sqlite content to a new instance of DuckDB (which I prefer working with):\n\nduck_con <- dbConnect(duckdb(), dbdir = duckdb_path)\n\nwalk(\n  c(\"ascent\", \"grade\", \"method\"), # Tables I need\n  \\(x) dbWriteTable(duck_con, x, dbReadTable(sqlite_con, x), overwrite = TRUE)\n)\n\ndbDisconnect(sqlite_con, shutdown = TRUE)\n\n\n\ndbplyr\nSQL\n\n\n\n\n\n\n\n\n\nNote\n\n\n\ndbplyr automatically translates dplyr code into SQL\n\n\n\n(reduce(\n    list(\n      (tbl(duck_con, \"ascent\") # 1\n        |> filter(country %like% \"USA\") \n        |> mutate(route_id = str_c(\n            str_replace_all(crag, ' ', '_'), \"__\", \n            str_replace_all(name, ' ', '_'), \"__\", \n            if_else(climb_type == 1, 'boulder', 'rope')\n          )\n        ) \n        |> select(user_id, route_id, climb_type, grade_id, method_id, ascent_date = date)\n      ),\n      tbl(duck_con, \"grade\") |> select(grade_id = id, usa_routes, usa_boulders), # 2\n      tbl(duck_con, \"method\") |> select(method_id = id, method_name = name) # 3\n    ),\n    \\(acc, i) left_join(acc, i)\n  )\n  |> select(-grade_id, -method_id)\n  |> compute(\"climb_dbp\")\n)\n\n\nTime difference of 0.7625 secs\n\n\n\n\nSELECT\n  ascent.user_id\n  , REPLACE(ascent.crag, ' ', '_')\n      || '__' || REPLACE(ascent.name, ' ', '_')\n      || '__' || CASE WHEN ascent.climb_type = 1 THEN 'boulder' ELSE 'rope' END\n      AS route_id\n  , ascent.climb_type as climb_type\n  , ascent.date AS ascent_date\n  , grade.usa_routes\n  , grade.usa_boulders\n  , method.name AS method_name\nFROM ascent\nJOIN grade ON grade.id = ascent.grade_id\nJOIN method ON method.id = ascent.method_id\nWHERE ascent.country = 'USA'\n\n\nTime difference of 0.1013 secs\n\n\n\n\n\ndata.frame [658,822 x 7]\n\n\n\nuser_id\n\n\nroute_id\n\n\nclimb_type\n\n\nascent_date\n\n\nusa_routes\n\n\nusa_boulders\n\n\nmethod_name\n\n\n\n\n\n4 019\n\n\nLogan_Canyon__Man_and_Woman__rope\n\n\n0\n\n\n1 114 898 400\n\n\n5.13a\n\n\nV10\n\n\nRedpoint\n\n\n\n\n3 584\n\n\nSandrock__Tales_From_The_Hard_Side__rope\n\n\n0\n\n\n1 115 071 200\n\n\n5.12b\n\n\nV8\n\n\nFlash\n\n\n\n\n3 584\n\n\nSandrock_Standard_Route(Alternate_start)__rope\n\n\n0\n\n\n1 115 071 200\n\n\n5.9\n\n\nV2\n\n\nOnsight\n\n\n\n\n8 693\n\n\nRed_River_Gorge__ghetto_methods__boulder\n\n\n1\n\n\n1 051 740 000\n\n\n5.13a\n\n\nV10\n\n\nRedpoint\n\n\n\n\n8 693\n\n\nBlowing_Rock__Flagyl__boulder\n\n\n1\n\n\n1 079 305 200\n\n\n5.13a\n\n\nV10\n\n\nRedpoint\n\n\n\n\n8 693\n\n\nRumbling_bald__dime_ten__boulder\n\n\n1\n\n\n1 075 590 000\n\n\n5.13a\n\n\nV10\n\n\nRedpoint\n\n\n\n\n8 693\n\n\nGrandmother__left_out__boulder\n\n\n1\n\n\n1 078 095 600\n\n\n5.12c\n\n\nV8/9\n\n\nRedpoint\n\n\n\n\n8 693\n\n\nGrandmother__Zen_Master__boulder\n\n\n1\n\n\n1 078 095 600\n\n\n5.12c\n\n\nV8/9\n\n\nFlash\n\n\n\n\n8 693\n\n\nGrandmother__hot_rods_sister__boulder\n\n\n1\n\n\n1 078 095 600\n\n\n5.12c\n\n\nV8/9\n\n\nRedpoint\n\n\n\n\n8 693\n\n\nBlowing_Rock__tendon_sandwich_sit__boulder\n\n\n1\n\n\n1 075 590 000\n\n\n5.12c\n\n\nV8/9\n\n\nRedpoint\n\n\n\n\n3 661\n\n\nRiggins__Sharma_Arete__boulder\n\n\n1\n\n\n1 114 898 400\n\n\n5.12b\n\n\nV8\n\n\nRedpoint\n\n\n\n\n3 661\n\n\nRiggins__Gecko__boulder\n\n\n1\n\n\n1 114 898 400\n\n\n5.11d\n\n\nV6\n\n\nFlash\n\n\n\n\n3 661\n\n\nRiggins__Gecko_Killer__boulder\n\n\n1\n\n\n1 114 898 400\n\n\n5.12c\n\n\nV8/9\n\n\nRedpoint\n\n\n\n\n3 661\n\n\nRiggins__Slap_Happy__boulder\n\n\n1\n\n\n1 114 898 400\n\n\n5.12b\n\n\nV8\n\n\nRedpoint\n\n\n\n\n8 400\n\n\nCastle_Rock__Beak_Reverse__boulder\n\n\n1\n\n\n1 114 984 800\n\n\n5.10c\n\n\nV4\n\n\nRedpoint\n\n\n\n\n\n[ omitted 658,807 entries ]"
  },
  {
    "objectID": "content/posts/climbing/index.html#processing",
    "href": "content/posts/climbing/index.html#processing",
    "title": "Bayesian Rock Climbing Rankings",
    "section": "\n1.2 Processing",
    "text": "1.2 Processing\n\nroute_ratings <- c(\n  str_c(\"5.\", 1:9), \n  map(str_c(\"5.\", 10:15), \\(x) str_c(x, letters[1:4])) |> unlist()\n)\n\nbouldering_grades <- c(str_c(\"V\", 0:20))\n\n## Mode for non-numerical data\nmode <- \\(x) levels(x)[which.max(tabulate(match(x, levels(x))))]\n\n\n\n\n\n\n\nNote\n\n\n\nComparing data.table, dplyr, and dtplyr:\n\n\n\n\ndata.table\ndtplyr\ndbplyr\n\n\n\n\nthreshold_ascents_dtclimb_dt <- setDT(climb_df) |> setkey(route_id, user_id)\n\nthreshold_ascents_dt <- function(old, lim = 20) {\n  new <- old[, if(.N >= lim) .SD, by = user_id][, if(.N >= lim) .SD, by = route_id]\n  \n  if (nrow(old) != nrow(new)) threshold_ascents_dt(new, lim)\n  else return(new)\n}\n\n\n\nclimb_dt2 <- climb_dt[\n    climb_dt[, .I[which.min(ascent_date)], by = .(user_id, route_id)]$V1\n  ][, let(\n      ascent_date = as_datetime(ascent_date),\n      usa_boulders = factor(usa_boulders, levels = bouldering_grades),\n      usa_routes = factor(usa_routes, levels = route_ratings),\n      label = as.integer(method_name %chin% c(\"Onsight\", \"Flash\"))\n    )\n  ][, let(route_rating = mode(usa_routes), bouldering_grade = mode(usa_boulders)),\n      by = route_id\n  ]\n\ndt_clean <- threshold_ascents_dt(climb_dt2)[\n    , route_idx := frank(route_id, ties.method = \"dense\")\n  ][, user_idx := frank(user_id, ties.method = \"dense\")\n  ][order(user_idx), -c(\"usa_routes\", \"usa_boulders\", \"method_name\")]\n\n\n\nTime difference of 6.242 secs\n\n\n\n\n\n\n\n\n\n\nNote\n\n\n\ndtplyr automatically translates dplyr code into data.table\n\n\n\nthreshold_ascents_dtpthreshold_ascents_dtp <- function(old, lim = 20, collect = TRUE) {\n  if (collect) old <- collect(old)\n  new <- old |> lazy_dt() |> \n    group_by(user_id) |> filter(n() >= lim) |> ungroup() |> \n    group_by(route_id) |> filter(n() >= lim) |> ungroup()\n  \n  if (collect) new <- collect(new)\n  \n  if (nrow(collect(old)) != nrow(collect(new))) threshold_ascents_dtp(new, lim)\n  else return(lazy_dt(new))\n}\n\n\n\n(lazy_dt(climb_df)\n  |> group_by(user_id, route_id)\n  |> slice(which.min(ascent_date))\n  |> ungroup()\n  |> mutate(\n    ascent_date = as_datetime(ascent_date),\n    usa_boulders = factor(usa_boulders, levels = bouldering_grades),\n    usa_routes = factor(usa_routes, levels = route_ratings)\n  )\n  |> group_by(route_id) \n  |> mutate(\n    route_rating = mode(usa_routes), \n    bouldering_grade = mode(usa_boulders)\n  ) \n  |> ungroup()\n  |> mutate(label = as.integer(method_name %in% c(\"Onsight\", \"Flash\")))\n  |> select(-c(usa_routes, usa_boulders, method_name))\n  |> threshold_ascents_dtp()\n  |> mutate(route_idx = dense_rank(route_id))\n  |> mutate(user_idx = dense_rank(user_id))\n  |> as.data.table()\n)\n\n\n\nTime difference of 10.3 secs\n\n\n\n\n\n\n\n\n\n\nNote\n\n\n\ndbplyr automatically translates dplyr code into SQL\n\n\n\nthreshold_ascents_dbpdb_create_index(duck_con, \"climb_dbp\", \"route_id\")\ndb_create_index(duck_con, \"climb_dbp\", \"user_id\")\n\nthreshold_ascents_dbp <- function(old, lim = 20, collect = TRUE) {\n  if(collect) old <- collect(old)\n  new <- old |> \n    group_by(user_id) |> filter(n() >= lim) |> ungroup() |> \n    group_by(route_id) |> filter(n() >= lim) |> ungroup()\n  \n  if (nrow(collect(old)) != nrow(collect(new))) threshold_ascents_dbp(new, lim)\n  else if (collect) {\n    copy_to(duck_con, new, name = \"dbp_temp\")\n    return(tbl(duck_con, \"dbp_temp\"))\n  }\n  else return(new)\n}\n\n\nSince DuckDB doesn’t have a mode function, we need to find another way to obtain the most common route_rating and bouldering_grade for each route_id. I do this by creating a reference table for each unique route_id for each of the two ratings, and then update the original data’s rows based on them.\n\n(tbl(duck_con, \"climb_dbp\")\n  |> select(route_id, route_rating = usa_routes)\n  |> filter(route_rating %in% route_ratings)\n  |> group_by(route_id)\n  |> count(route_rating)\n  |> slice_max(n, with_ties = FALSE, na_rm = TRUE)\n  |> ungroup()\n  |> select(-n)\n  |> compute(\"dbp_rr\")\n)\n\n(tbl(duck_con, \"climb_dbp\")\n  |> select(route_id, bouldering_grade = usa_boulders)\n  |> filter(bouldering_grade %in% bouldering_grades)\n  |> group_by(route_id)\n  |> count(bouldering_grade)\n  |> slice_max(n, with_ties = FALSE, na_rm = TRUE)\n  |> ungroup()\n  |> select(-n)\n  |> compute(\"dbp_bg\")\n)\n\n\n(tbl(duck_con, \"climb_dbp\")\n  |> rename(route_rating = usa_routes, bouldering_grade = usa_boulders)\n  |> mutate(label = as.integer(method_name %in% c(\"Onsight\", \"Flash\")))\n  |> select(-method_name)\n  |> group_by(user_id, route_id)\n  |> slice_min(ascent_date, with_ties = FALSE)\n  |> ungroup()\n  |> mutate(route_rating = NA, bouldering_grade = NA)\n  |> rows_patch(tbl(duck_con, \"dbp_rr\"), by = \"route_id\", unmatched = \"ignore\")\n  |> rows_patch(tbl(duck_con, \"dbp_bg\"), by = \"route_id\", unmatched = \"ignore\")\n  |> threshold_ascents_dbp()\n  |> mutate(\n    route_idx = dense_rank(route_id),\n    user_idx = dense_rank(user_id),\n    ascent_date = to_timestamp(ascent_date)\n  )\n  |> compute(\"dbp_clean\")\n)\n\n\n\nTime difference of 4.544 secs\n\n\n\n\n\n\n\ndata.table [232,887 x 9]\n\n\n\nroute_id\n\n\nuser_id\n\n\nclimb_type\n\n\nascent_date\n\n\nlabel\n\n\nroute_rating\n\n\nbouldering_grade\n\n\nroute_idx\n\n\nuser_idx\n\n\n\n\n\nObed__Jungle_Jane__rope\n\n\n4\n\n\n0\n\n\n2006-11-18 23:00:00\n\n\n1\n\n\n5.12a\n\n\nV7\n\n\n2 459\n\n\n1\n\n\n\n\nRed_River_Gorge__Chainsaw_Massacre__rope\n\n\n4\n\n\n0\n\n\n2006-11-23 23:00:00\n\n\n1\n\n\n5.12a\n\n\nV7\n\n\n2 787\n\n\n1\n\n\n\n\nRed_River_Gorge__Gung_Ho__rope\n\n\n4\n\n\n0\n\n\n2006-11-20 23:00:00\n\n\n1\n\n\n5.12b\n\n\nV8\n\n\n2 870\n\n\n1\n\n\n\n\nRed_River_Gorge__Kick_Me_In_The_Jimmie__rope\n\n\n4\n\n\n0\n\n\n2006-11-23 23:00:00\n\n\n1\n\n\n5.12a\n\n\nV7\n\n\n2 910\n\n\n1\n\n\n\n\nRed_River_Gorge__Reliquary__rope\n\n\n4\n\n\n0\n\n\n2006-11-20 23:00:00\n\n\n1\n\n\n5.12b\n\n\nV8\n\n\n3 007\n\n\n1\n\n\n\n\nRed_River_Gorge__Tuna_Town__rope\n\n\n4\n\n\n0\n\n\n2006-11-23 23:00:00\n\n\n0\n\n\n5.12d\n\n\nV9\n\n\n3 128\n\n\n1\n\n\n\n\nRed_River_Gorge__Wild_Gift__rope\n\n\n4\n\n\n0\n\n\n2006-11-21 23:00:00\n\n\n0\n\n\n5.12c\n\n\nV9\n\n\n3 150\n\n\n1\n\n\n\n\nRed_Rocks__Yaak_Crack__rope\n\n\n4\n\n\n0\n\n\n2006-12-09 23:00:00\n\n\n1\n\n\n5.11d\n\n\nV6\n\n\n3 359\n\n\n1\n\n\n\n\nObed__Solstice__rope\n\n\n4\n\n\n0\n\n\n2006-02-28 23:00:00\n\n\n1\n\n\n5.12a\n\n\nV7\n\n\n2 482\n\n\n1\n\n\n\n\nObed__Rage__rope\n\n\n4\n\n\n0\n\n\n2006-02-28 23:00:00\n\n\n0\n\n\n5.12c\n\n\nV9\n\n\n2 475\n\n\n1\n\n\n\n\nObed__Tierrany__rope\n\n\n4\n\n\n0\n\n\n2006-11-18 23:00:00\n\n\n1\n\n\n5.12a\n\n\nV7\n\n\n2 495\n\n\n1\n\n\n\n\nRed_River_Gorge__Tuskan_Raider__rope\n\n\n4\n\n\n0\n\n\n2006-11-24 23:00:00\n\n\n0\n\n\n5.12d\n\n\nV9\n\n\n3 129\n\n\n1\n\n\n\n\nRed_River_Gorge__Blue_Eyed_Honkey_Jesus__rope\n\n\n4\n\n\n0\n\n\n2006-11-28 23:00:00\n\n\n0\n\n\n5.12c\n\n\nV8\n\n\n2 759\n\n\n1\n\n\n\n\nRed_Rocks__Keep_your_Powder_dry__rope\n\n\n4\n\n\n0\n\n\n2006-12-13 23:00:00\n\n\n1\n\n\n5.12b\n\n\nV8\n\n\n3 243\n\n\n1\n\n\n\n\nMt_Potasi__Moment_of_Clarity__rope\n\n\n4\n\n\n0\n\n\n2006-12-19 23:00:00\n\n\n1\n\n\n5.12a\n\n\nV7\n\n\n2 258\n\n\n1\n\n\n\n\n\n[ omitted 232,872 entries ]"
  },
  {
    "objectID": "content/posts/climbing/index.html#stan-code",
    "href": "content/posts/climbing/index.html#stan-code",
    "title": "Bayesian Rock Climbing Rankings",
    "section": "\n2.1 Stan code",
    "text": "2.1 Stan code\n\n\n\n\n\n\nNote\n\n\n\nUpdated Stan code using within-chain parallelization\n\n\n\nfunctions {\n  array[] int sequence(int start, int end) {\n    array[end - start + 1] int seq;\n    for (n in 1 : num_elements(seq)) {\n      seq[n] = n + start - 1;\n    }\n    return seq;\n  }\n\n  // Compute partial sums of the log-likelihood\n  real partial_log_lik_lpmf(array[] int seq, int start, int end,\n                            data array[] int labels, real mean_ability,\n                            data array[] int users, vector user_ability,\n                            data array[] int routes, vector route_difficulty) {\n    real ptarget = 0;\n    int N = end - start + 1;\n\n    vector[N] mu = mean_ability + rep_vector(0.0, N);\n    for (n in 1 : N) {\n      int nn = n + start - 1;\n      mu[n] += user_ability[users[nn]] - route_difficulty[routes[nn]];\n    }\n    ptarget += bernoulli_logit_lpmf(labels[start : end] | mu);\n    return ptarget;\n  }\n}\ndata {\n  int<lower=1> num_ascents;\n  int<lower=1> num_users;\n  int<lower=1> num_routes;\n  array[num_ascents] int<lower=1, upper=num_users> users;\n  array[num_ascents] int<lower=1, upper=num_routes> routes;\n  array[num_ascents] int<lower=0, upper=1> labels;\n\n  int grainsize;\n}\ntransformed data {\n  array[num_ascents] int seq = sequence(1, num_ascents);\n}\nparameters {\n  real mean_ability;\n  vector[num_users] user_ability;\n  vector[num_routes] route_difficulty;\n}\nmodel {\n  user_ability ~ std_normal();\n  route_difficulty ~ std_normal();\n  mean_ability ~ std_normal();\n\n  target += reduce_sum(\n    partial_log_lik_lpmf, seq, grainsize, \n    labels, mean_ability, users, user_ability, routes, route_difficulty\n  );\n}"
  },
  {
    "objectID": "content/posts/climbing/index.html#stan-data",
    "href": "content/posts/climbing/index.html#stan-data",
    "title": "Bayesian Rock Climbing Rankings",
    "section": "\n2.2 Stan data",
    "text": "2.2 Stan data\n\nstan_data <- list(\n  num_ascents = nrow(dt_clean),\n  num_users = n_distinct(dt_clean$user_id),\n  num_routes = n_distinct(dt_clean$route_id),\n  routes = pull(dt_clean, route_idx),\n  users = pull(dt_clean, user_idx),\n  labels = pull(dt_clean, label) |> as.integer(),\n  grainsize = max(100, nrow(dt_clean) / 50)\n)\n\n\n\nList of 7\n $ num_ascents: int 232887\n $ num_users  : int 2977\n $ num_routes : int 4288\n $ routes     : int [1:232887] 2459 2787 2870 2910 3007 3128 3150 3359 2482 2475 ...\n $ users      : int [1:232887] 1 1 1 1 1 1 1 1 1 1 ...\n $ labels     : int [1:232887] 1 1 1 1 1 0 0 1 1 0 ...\n $ grainsize  : num 4658"
  },
  {
    "objectID": "content/posts/climbing/index.html#model-fit",
    "href": "content/posts/climbing/index.html#model-fit",
    "title": "Bayesian Rock Climbing Rankings",
    "section": "\n2.3 Model fit",
    "text": "2.3 Model fit\n\n\n\n\nmod_stan <- mod_stan_exe$sample(\n  data = stan_data, seed = 666,\n  iter_warmup = 500, iter_sampling = 1000, refresh = 0,\n  chains = 6, parallel_chains = 6, threads_per_chain = 5\n)\n\n\n\n\n\n\n\nNote\n\n\n\n\n\n\nSampling takes ~4.89 minutes on my CPU (Ryzen 5950X, 16 Cores/32 Threads), on WSL2 (Ubuntu 20.04)\n\ndata.table [6 x 2]\n\n\n\nChain\n\n\nTime\n\n\n\n\n\n1\n\n\n284.245s (~4.74 minutes)\n\n\n\n\n2\n\n\n297.297s (~4.95 minutes)\n\n\n\n\n3\n\n\n294.22s (~4.9 minutes)\n\n\n\n\n4\n\n\n289.123s (~4.82 minutes)\n\n\n\n\n5\n\n\n295.178s (~4.92 minutes)\n\n\n\n\n6\n\n\n299.366s (~4.99 minutes)"
  },
  {
    "objectID": "content/posts/climbing/index.html#posterior-data",
    "href": "content/posts/climbing/index.html#posterior-data",
    "title": "Bayesian Rock Climbing Rankings",
    "section": "\n4.1 Posterior data",
    "text": "4.1 Posterior data\nGetting our Posterior Predictions (subset of 500 draws per route) into long format:\n\n\n\n\n\n\nNote\n\n\n\nComparing data.table and dplyr (using the rvar format from posterior):\n\n\n\n\ndata.table\ndtplyr\ndbplyr\ndplyr\n\n\n\n\ndraws_df <- mod_stan$draws(variables = \"route_difficulty\")\n\nunique(dt_clean[, .(route_idx, bouldering_grade, route_rating, climb_type)], by = \"route_idx\")[\n  as.data.table(subset_draws(\n    draws_df, \"route_difficulty\", regex = TRUE, \n    draw = sample.int(ndraws(draws_df), size = 500)\n  ))[, .(route_difficulty = list(value)), by = variable\n  ][, let(route_idx = as.integer(str_extract(variable, \"\\\\d{1,4}\")), variable = NULL)],\n  on = \"route_idx\", nomatch = NULL\n][, let(\n  bouldering_grade = factor(bouldering_grade, levels = bouldering_grades), \n  route_rating = factor(route_rating, levels = route_ratings)\n)][order(route_idx)] -> pp_dt\n\n\nAlternative syntaxdraws_dt <- (mod_stan$draws(variables = \"route_difficulty\")\n  |> bind(x, subset_draws(\n      draws_df, \"route_difficulty\", regex = TRUE, \n      draw = sample.int(ndraws(draws_df), size = 500)\n    )\n  )\n  |> as.data.table()\n  |> DT(, .(route_difficulty = list(value)), by = variable)\n  |> DT(, let(route_idx = as.integer(str_extract(variable, \"\\\\d{1,4}\")), variable = NULL))\n)\n\n(dt_clean[, .(route_idx, bouldering_grade, route_rating, climb_type)] \n  |> unique(by = \"route_idx\")\n  |> DT(draws_dt, on = \"route_idx\", nomatch = NULL)\n  |> DT(, let(\n      bouldering_grade = factor(bouldering_grade, levels = bouldering_grades),\n      route_rating = factor(route_rating, levels = route_ratings)\n    )\n  )\n  |> DT(order(route_idx))\n)\n\n\n\ndata.table [4,288 x 5]\n\n\n\nroute_idx\n\n\nbouldering_grade\n\n\nroute_rating\n\n\nclimb_type\n\n\nroute_difficulty\n\n\n\n\n\n1\n\n\nV7\n\n\n5.12a\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n2\n\n\nV7\n\n\n5.12a\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n3\n\n\nV5\n\n\n5.11a\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n4\n\n\nV7\n\n\n5.12a\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n5\n\n\nV4\n\n\n5.10c\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n6\n\n\nV5\n\n\n5.11a\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n7\n\n\nV9\n\n\n5.12d\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n8\n\n\nV3\n\n\n5.10a\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n9\n\n\nV9\n\n\n5.12d\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n10\n\n\nV8\n\n\n5.12c\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n11\n\n\nV5\n\n\n5.11a\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n12\n\n\nV5\n\n\n5.11a\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n13\n\n\nV3\n\n\n5.10a\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n14\n\n\nV6\n\n\n5.11d\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n15\n\n\nV5\n\n\n5.11b\n\n\n0\n\n\n<numeric [500]>\n\n\n\n\n\n[ omitted 4,273 entries ]\n\n\nTime difference of 2.01 secs\n\n\n\n\ndraws_df <- mod_stan$draws(variables = \"route_difficulty\")\n\npp_dtp <- (lazy_dt(dt_clean)\n  |> select(route_idx, bouldering_grade, route_rating, climb_type)\n  |> distinct(route_idx, .keep_all = TRUE)\n  |> inner_join(\n      subset_draws(\n        draws_df, \"route_difficulty\", regex = TRUE, \n        draw = sample.int(ndraws(draws_df), size = 500)\n      ) \n      |> lazy_dt()\n      |> group_by(variable)\n      |> summarize(route_difficulty = list(value))\n      |> ungroup()\n      |> mutate(route_idx = as.integer(str_extract(variable, \"\\\\d{1,4}\")))\n      |> select(-variable),\n    by = \"route_idx\"\n  )\n  |> mutate(\n      bouldering_grade = factor(bouldering_grade, levels = bouldering_grades),\n      route_rating = factor(route_rating, levels = route_ratings)\n  )\n  |> arrange(route_idx)\n  |> as.data.table()\n)\n\n\ndata.table [4,288 x 5]\n\n\n\nroute_idx\n\n\nbouldering_grade\n\n\nroute_rating\n\n\nclimb_type\n\n\nroute_difficulty\n\n\n\n\n\n1\n\n\nV7\n\n\n5.12a\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n2\n\n\nV7\n\n\n5.12a\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n3\n\n\nV5\n\n\n5.11a\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n4\n\n\nV7\n\n\n5.12a\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n5\n\n\nV4\n\n\n5.10c\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n6\n\n\nV5\n\n\n5.11a\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n7\n\n\nV9\n\n\n5.12d\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n8\n\n\nV3\n\n\n5.10a\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n9\n\n\nV9\n\n\n5.12d\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n10\n\n\nV8\n\n\n5.12c\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n11\n\n\nV5\n\n\n5.11a\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n12\n\n\nV5\n\n\n5.11a\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n13\n\n\nV3\n\n\n5.10a\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n14\n\n\nV6\n\n\n5.11d\n\n\n1\n\n\n<numeric [500]>\n\n\n\n\n15\n\n\nV5\n\n\n5.11b\n\n\n0\n\n\n<numeric [500]>\n\n\n\n\n\n[ omitted 4,273 entries ]\n\n\nTime difference of 0.3131 secs\n\n\n\n\ndb_create_index(duck_con, \"dbp_clean\", \"route_idx\")\n\n(mod_stan$draws(variables = \"route_difficulty\") \n  |> bind(x, subset_draws(\n    x, \"route_difficulty\", regex = TRUE, \n    draw = sample.int(ndraws(x), size = 500)) \n  ) \n  |> as_draws_df()\n  |> as.data.frame()\n  |> pivot_longer(everything(), names_to = \"route_idx\", names_pattern = \".*\\\\[(\\\\d{1,4})\\\\]\")\n  |> copy_to(duck_con, df = _, \"draws\", overwrite = TRUE)\n)\n\n(tbl(duck_con, \"dbp_clean\")\n  |> select(route_idx, bouldering_grade, route_rating, climb_type)\n  |> distinct(route_idx, .keep_all = TRUE)\n  |> inner_join(tbl(duck_con, \"draws\"), by = \"route_idx\")\n  |> arrange(route_idx)\n  |> compute(\"pp_dbp\")\n)\n\n\ndata.frame [4,288 x 5]\n\n\n\nroute_idx\n\n\nbouldering_grade\n\n\nroute_rating\n\n\nclimb_type\n\n\nroute_difficulty\n\n\n\n\n\n4 178\n\n\nV7\n\n\n5.12a\n\n\n0\n\n\n<numeric [500]>\n\n\n\n\n4 179\n\n\nNA\n\n\n5.11b\n\n\n0\n\n\n<numeric [500]>\n\n\n\n\n4 180\n\n\nNA\n\n\n5.11b\n\n\n0\n\n\n<numeric [500]>\n\n\n\n\n4 181\n\n\nV8\n\n\n5.12b\n\n\n0\n\n\n<numeric [500]>\n\n\n\n\n4 182\n\n\nV7\n\n\n5.12a\n\n\n0\n\n\n<numeric [500]>\n\n\n\n\n4 183\n\n\nV3\n\n\n5.10a\n\n\n0\n\n\n<numeric [500]>\n\n\n\n\n4 184\n\n\nV5\n\n\n5.11a\n\n\n0\n\n\n<numeric [500]>\n\n\n\n\n4 185\n\n\nV8\n\n\n5.12b\n\n\n0\n\n\n<numeric [500]>\n\n\n\n\n4 186\n\n\nV7\n\n\n5.12a\n\n\n0\n\n\n<numeric [500]>\n\n\n\n\n4 187\n\n\nV8\n\n\n5.12b\n\n\n0\n\n\n<numeric [500]>\n\n\n\n\n4 188\n\n\nV3\n\n\n5.10a\n\n\n0\n\n\n<numeric [500]>\n\n\n\n\n4 189\n\n\nV7\n\n\n5.12a\n\n\n0\n\n\n<numeric [500]>\n\n\n\n\n4 190\n\n\nV10\n\n\n5.13a\n\n\n0\n\n\n<numeric [500]>\n\n\n\n\n4 191\n\n\nV3\n\n\n5.10b\n\n\n0\n\n\n<numeric [500]>\n\n\n\n\n4 192\n\n\nV4\n\n\n5.10d\n\n\n0\n\n\n<numeric [500]>\n\n\n\n\n\n[ omitted 4,273 entries ]\n\n\n\n\n\n\nTime difference of 1.852 secs\n\n\n\n\nWith dplyr, we can use the rvar format to encapsulate the samples from the model, which drastically reduces the size of the samples’ data.frame\n\npp_df <- (inner_join(\n    as.data.frame(dt_clean) |> \n      select(route_idx, bouldering_grade, route_rating, climb_type) |> \n      distinct(route_idx, .keep_all = TRUE),\n    tidybayes::spread_rvars(mod_stan, route_difficulty[route_idx], ndraws = 500),\n    by = \"route_idx\"\n  )\n  |> mutate(\n    bouldering_grade = factor(bouldering_grade, levels = bouldering_grades), \n    route_rating = factor(route_rating, levels = route_ratings)\n  )\n  |> arrange(route_idx)\n)\n\n\ndata.frame [4,288 x 5]\n\n\n\nroute_idx\n\n\nbouldering_grade\n\n\nroute_rating\n\n\nclimb_type\n\n\nroute_difficulty\n\n\n\n\n\n1\n\n\nV7\n\n\n5.12a\n\n\n1\n\n\n<rvar [1 x NA]>\n\n\n\n\n2\n\n\nV7\n\n\n5.12a\n\n\n1\n\n\n<rvar [1 x NA]>\n\n\n\n\n3\n\n\nV5\n\n\n5.11a\n\n\n1\n\n\n<rvar [1 x NA]>\n\n\n\n\n4\n\n\nV7\n\n\n5.12a\n\n\n1\n\n\n<rvar [1 x NA]>\n\n\n\n\n5\n\n\nV4\n\n\n5.10c\n\n\n1\n\n\n<rvar [1 x NA]>\n\n\n\n\n6\n\n\nV5\n\n\n5.11a\n\n\n1\n\n\n<rvar [1 x NA]>\n\n\n\n\n7\n\n\nV9\n\n\n5.12d\n\n\n1\n\n\n<rvar [1 x NA]>\n\n\n\n\n8\n\n\nV3\n\n\n5.10a\n\n\n1\n\n\n<rvar [1 x NA]>\n\n\n\n\n9\n\n\nV9\n\n\n5.12d\n\n\n1\n\n\n<rvar [1 x NA]>\n\n\n\n\n10\n\n\nV8\n\n\n5.12c\n\n\n1\n\n\n<rvar [1 x NA]>\n\n\n\n\n11\n\n\nV5\n\n\n5.11a\n\n\n1\n\n\n<rvar [1 x NA]>\n\n\n\n\n12\n\n\nV5\n\n\n5.11a\n\n\n1\n\n\n<rvar [1 x NA]>\n\n\n\n\n13\n\n\nV3\n\n\n5.10a\n\n\n1\n\n\n<rvar [1 x NA]>\n\n\n\n\n14\n\n\nV6\n\n\n5.11d\n\n\n1\n\n\n<rvar [1 x NA]>\n\n\n\n\n15\n\n\nV5\n\n\n5.11b\n\n\n0\n\n\n<rvar [1 x NA]>\n\n\n\n\n\n[ omitted 4,273 entries ]\n\n\nTime difference of 1.05 secs"
  },
  {
    "objectID": "content/posts/climbing/index.html#posterior-plots",
    "href": "content/posts/climbing/index.html#posterior-plots",
    "title": "Bayesian Rock Climbing Rankings",
    "section": "\n4.2 Posterior plots:",
    "text": "4.2 Posterior plots:\n\nPlot coderidgeline_plot <- function(dat, var) {\n  if (class(dat[, route_difficulty]) == \"list\")\n    dat <- dat[, .(route_difficulty = unlist(route_difficulty)), by = setdiff(names(dat), 'route_difficulty')]\n  \n  ggplot(dat, aes_string(y = var)) +\n  ggridges::geom_density_ridges(\n    aes_string(x = \"route_difficulty\", fill = var), \n    alpha = 0.5, scale = 2.5, color = \"grey30\"\n  ) +\n  geom_vline(xintercept = 0, linetype = \"dashed\", color = \"grey50\") +\n  labs(x = str_to_title(str_replace_all(var, \"_\", \" \")), y = \"\") +\n  scale_y_discrete(position = \"right\") +\n  theme(legend.position = \"none\", axis.line.y = element_blank())\n}\n\n\nRoute Rating:\n\nridgeline_plot(pp_dt[climb_type == 0], \"route_rating\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nBouldering Grade:\n\nridgeline_plot(pp_dt[climb_type == 1 & bouldering_grade != \"V0\"], \"bouldering_grade\")"
  },
  {
    "objectID": "content/posts/data.table/index.html#arrange-order",
    "href": "content/posts/data.table/index.html#arrange-order",
    "title": "Tidyverse <-> data.table",
    "section": "\n1.1 Arrange / Order",
    "text": "1.1 Arrange / Order\n\n1.1.1 Basic ordering\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |> arrange(desc(cyl))\ndata.frame [32 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n10.4\n\n\n8\n\n\n460\n\n\n215\n\n\n3\n\n\n5.424\n\n\n17.82\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.7\n\n\n8\n\n\n440\n\n\n230\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n15.5\n\n\n8\n\n\n318\n\n\n150\n\n\n2.76\n\n\n3.52\n\n\n16.87\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n15.2\n\n\n8\n\n\n304\n\n\n150\n\n\n3.15\n\n\n3.435\n\n\n17.3\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n15.8\n\n\n8\n\n\n351\n\n\n264\n\n\n4.22\n\n\n3.17\n\n\n14.5\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n15\n\n\n8\n\n\n301\n\n\n335\n\n\n3.54\n\n\n3.57\n\n\n14.6\n\n\n0\n\n\n1\n\n\n5\n\n\n8\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\nmtcars |> arrange(desc(cyl), gear)\ndata.frame [32 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n10.4\n\n\n8\n\n\n460\n\n\n215\n\n\n3\n\n\n5.424\n\n\n17.82\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.7\n\n\n8\n\n\n440\n\n\n230\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n15.5\n\n\n8\n\n\n318\n\n\n150\n\n\n2.76\n\n\n3.52\n\n\n16.87\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n15.2\n\n\n8\n\n\n304\n\n\n150\n\n\n3.15\n\n\n3.435\n\n\n17.3\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n15.8\n\n\n8\n\n\n351\n\n\n264\n\n\n4.22\n\n\n3.17\n\n\n14.5\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n15\n\n\n8\n\n\n301\n\n\n335\n\n\n3.54\n\n\n3.57\n\n\n14.6\n\n\n0\n\n\n1\n\n\n5\n\n\n8\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nMT[order(-cyl)]\ndata.table [32 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n10.4\n\n\n8\n\n\n460\n\n\n215\n\n\n3\n\n\n5.424\n\n\n17.82\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.7\n\n\n8\n\n\n440\n\n\n230\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n15.5\n\n\n8\n\n\n318\n\n\n150\n\n\n2.76\n\n\n3.52\n\n\n16.87\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n15.2\n\n\n8\n\n\n304\n\n\n150\n\n\n3.15\n\n\n3.435\n\n\n17.3\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n15.8\n\n\n8\n\n\n351\n\n\n264\n\n\n4.22\n\n\n3.17\n\n\n14.5\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n15\n\n\n8\n\n\n301\n\n\n335\n\n\n3.54\n\n\n3.57\n\n\n14.6\n\n\n0\n\n\n1\n\n\n5\n\n\n8\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\nMT[order(-cyl, gear)]\ndata.table [32 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n10.4\n\n\n8\n\n\n460\n\n\n215\n\n\n3\n\n\n5.424\n\n\n17.82\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.7\n\n\n8\n\n\n440\n\n\n230\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n15.5\n\n\n8\n\n\n318\n\n\n150\n\n\n2.76\n\n\n3.52\n\n\n16.87\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n15.2\n\n\n8\n\n\n304\n\n\n150\n\n\n3.15\n\n\n3.435\n\n\n17.3\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n15.8\n\n\n8\n\n\n351\n\n\n264\n\n\n4.22\n\n\n3.17\n\n\n14.5\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n15\n\n\n8\n\n\n301\n\n\n335\n\n\n3.54\n\n\n3.57\n\n\n14.6\n\n\n0\n\n\n1\n\n\n5\n\n\n8\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\nAlternativesMT[fsort(cyl, decreasing = TRUE)]\n\nsetorder(MT, -cyl, gear)[]\n\nsetorderv(MT, c(\"cyl\", \"gear\"), c(-1 ,1))[]\n\n\nOrdering on a character column\n\nIRIS[chorder(Species)]\ndata.table [150 x 5]\n\n\n\nSepal.Length\n\n\nSepal.Width\n\n\nPetal.Length\n\n\nPetal.Width\n\n\nSpecies\n\n\n\n\n\n5.1\n\n\n3.5\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.7\n\n\n3.2\n\n\n1.3\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.1\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5\n\n\n3.6\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.9\n\n\n1.7\n\n\n0.4\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.4\n\n\n1.4\n\n\n0.3\n\n\nsetosa\n\n\n\n\n5\n\n\n3.4\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.4\n\n\n2.9\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3.1\n\n\n1.5\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.7\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3.4\n\n\n1.6\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3\n\n\n1.4\n\n\n0.1\n\n\nsetosa\n\n\n\n\n4.3\n\n\n3\n\n\n1.1\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.8\n\n\n4\n\n\n1.2\n\n\n0.2\n\n\nsetosa\n\n\n\n\n\n[ omitted 135 entries ]\n\n\n\n\n\n\n\n\n1.1.2 Ordering with keys\n\nKeys physically reorders the dataset within the RAM (by reference)\n\nNo memory is used for sorting (other than marking which columns is the key)\n\n\n\nThe dataset is marked with an attribute “sorted”\n\nThe dataset is always sorted in ascending order, with NA first\n\nUsing keyby instead of by when grouping will set the grouping factors as keys\n\n\n\n\n\n\n\nTip\n\n\n\nSee this SO post for more information on keys.\n\n\n\nsetkey(MT, cyl, gear)\n\nsetkeyv(MT, c(\"cyl\", \"gear\"))\n\nMT\ndata.table [32 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21.5\n\n\n4\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n32.4\n\n\n4\n\n\n78.7\n\n\n66\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n30.4\n\n\n4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n33.9\n\n\n4\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n27.3\n\n\n4\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nTo see over which keys (if any) the dataset is currently ordered:\n\nhaskey(MT)\n[1] TRUE\nkey(MT)\n[1] “cyl” “gear”\n\n\n\n\n\n\n\nWarning\n\n\n\nUnless our task involves repeated subsetting on the same column, the speed gain from key-based subsetting could effectively be nullified by the time needed to reorder the data in RAM, especially for large datasets.\n\n\n\n1.1.3 Ordering with (secondary) indices\n\n\nsetindex creates an index for the provided columns, but doesn’t physically reorder the dataset in RAM.\n\nIt computes the ordering vector of the dataset’s rows according to the provided columns in an additional attribute called index\n\n\n\n\n\n\nsetindex(MT, cyl, gear)\n\nsetindexv(MT, c(\"cyl\", \"gear\"))\n\nMT\ndata.table [32 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nWe can see the additional index attribute added to the data.table:\n\nnames(attributes(MT))\n\n[1] \"names\"             \"row.names\"         \"class\"            \n[4] \".internal.selfref\" \"index\"            \n\n\nWe can get the currently used indices with:\n\nindices(MT)\n[1] “cyl__gear”\n\nAdding a new index doesn’t remove a previously existing one:\n\nsetindex(MT, hp)\n\nindices(MT)\n[1] “cyl__gear” “hp”\n\nWe can thus use indices to pre-compute the ordering for the columns (or combinations of columns) that we will be using to group or subset by frequently !"
  },
  {
    "objectID": "content/posts/data.table/index.html#subset-filter",
    "href": "content/posts/data.table/index.html#subset-filter",
    "title": "Tidyverse <-> data.table",
    "section": "\n1.2 Subset / Filter",
    "text": "1.2 Subset / Filter\n\n\n\n\n1.2.1 Basic filtering\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |> filter(cyl >= 6 & disp < 180)\ndata.frame [5 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n19.7\n\n\n6\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n\n\n\n\niris |> filter(Species %in% c(\"setosa\"))\ndata.frame [50 x 5]\n\n\n\nSepal.Length\n\n\nSepal.Width\n\n\nPetal.Length\n\n\nPetal.Width\n\n\nSpecies\n\n\n\n\n\n5.1\n\n\n3.5\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.7\n\n\n3.2\n\n\n1.3\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.1\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5\n\n\n3.6\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.9\n\n\n1.7\n\n\n0.4\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.4\n\n\n1.4\n\n\n0.3\n\n\nsetosa\n\n\n\n\n5\n\n\n3.4\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.4\n\n\n2.9\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3.1\n\n\n1.5\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.7\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3.4\n\n\n1.6\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3\n\n\n1.4\n\n\n0.1\n\n\nsetosa\n\n\n\n\n4.3\n\n\n3\n\n\n1.1\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.8\n\n\n4\n\n\n1.2\n\n\n0.2\n\n\nsetosa\n\n\n\n\n\n[ omitted 35 entries ]\n\n\n\n\n\n\n\nMT[cyl >= 6 & disp < 180]\ndata.table [5 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n19.7\n\n\n6\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n\n\n\n\nIRIS[Species %chin% c(\"setosa\")]\ndata.table [50 x 5]\n\n\n\nSepal.Length\n\n\nSepal.Width\n\n\nPetal.Length\n\n\nPetal.Width\n\n\nSpecies\n\n\n\n\n\n5.1\n\n\n3.5\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.7\n\n\n3.2\n\n\n1.3\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.1\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5\n\n\n3.6\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.9\n\n\n1.7\n\n\n0.4\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.4\n\n\n1.4\n\n\n0.3\n\n\nsetosa\n\n\n\n\n5\n\n\n3.4\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.4\n\n\n2.9\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3.1\n\n\n1.5\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.7\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3.4\n\n\n1.6\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3\n\n\n1.4\n\n\n0.1\n\n\nsetosa\n\n\n\n\n4.3\n\n\n3\n\n\n1.1\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.8\n\n\n4\n\n\n1.2\n\n\n0.2\n\n\nsetosa\n\n\n\n\n\n[ omitted 35 entries ]\n\n\n\n\nFor non-regex character filtering, use %chin% (which is a character-optimized version of %in%)\n\n\n\n\n1.2.2 Filter based on a range\n\nmtcars |> filter(between(disp, 200, 300))\ndata.frame [5 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n\n\nMT[disp %between% c(200, 300)]\ndata.table [5 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n\n\n1.2.3 Filter with a pattern\n\nmtcars |> filter(str_detect(disp, \"^\\\\d{3}\\\\.\"))\ndata.frame [9 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n21.5\n\n\n4\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n\n\nMT[disp %like% \"^\\\\d{3}\\\\.\"]\ndata.table [9 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n21.5\n\n\n4\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n\n\nVariantsIRIS[Species %flike% \"set\"] # Fixed (not regex)\n\nIRIS[Species %ilike% \"Set\"] # Ignore case\n\nIRIS[Species %plike% \"(?=set)\"] # Perl-like regex\n\n\n\n1.2.4 Filter on row number (slicing)\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |> slice(1) # slice_head(n = 1)\ndata.frame [1 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n\nmtcars |> slice(n()) # slice_tail(n = 1)\ndata.frame [1 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\nSlice a random sample of rows:\n\nmtcars |> slice_sample(n = 5)\ndata.frame [5 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n15.5\n\n\n8\n\n\n318\n\n\n150\n\n\n2.76\n\n\n3.52\n\n\n16.87\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n15.8\n\n\n8\n\n\n351\n\n\n264\n\n\n4.22\n\n\n3.17\n\n\n14.5\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n\n\n\n\nMT[1]\ndata.table [1 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n\nMT[.N]\ndata.table [1 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\nSlice a random sample of rows:\n\nMT[sample(.N, 5)]\ndata.table [5 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n15.5\n\n\n8\n\n\n318\n\n\n150\n\n\n2.76\n\n\n3.52\n\n\n16.87\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n27.3\n\n\n4\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n32.4\n\n\n4\n\n\n78.7\n\n\n66\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n\n\n\n\n1.2.5 Filter distinct/unique rows\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |> distinct(mpg, hp, .keep_all = TRUE)\ndata.frame [31 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n10.4\n\n\n8\n\n\n460\n\n\n215\n\n\n3\n\n\n5.424\n\n\n17.82\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 16 entries ]\n\n\n\n\nNumber of unique rows/values\n\nn_distinct(mtcars$gear)\n[1] 3\n\n\n\n\nunique(MT, by = c(\"mpg\", \"hp\")) # cols = other_cols_to_keep\ndata.table [31 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n10.4\n\n\n8\n\n\n460\n\n\n215\n\n\n3\n\n\n5.424\n\n\n17.82\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 16 entries ]\n\n\n\n\nNumber of unique rows/values\n\nuniqueN(MT, by = \"gear\")\n[1] 3\n\n\n\n\n\n1.2.6 Filter by keys\nWhen keys or indices are defined, we can filter based on them, which is often a lot faster.\n\n\n\n\n\n\nTip\n\n\n\nWe do not even need to specify the column name we are filtering on: the values will be attributed to the keys in order.\n\n\n\nsetkey(MT, cyl)\n\nMT[.(6)] # Equivalent to MT[cyl == 6]\ndata.table [7 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n19.7\n\n\n6\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n\n\n\n\nsetkey(MT, cyl, gear)\n\nMT[.(6, 4)] # Equivalent to MT[cyl == 6 & gear == 4]\ndata.table [4 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n\n\n1.2.7 Filter by indices\nTo filter by indices, we can use the on argument, which creates a temporary secondary index on the fly (if it doesn’t already exist).\n\nIRIS[\"setosa\", on = \"Species\"]\ndata.table [50 x 5]\n\n\n\nSepal.Length\n\n\nSepal.Width\n\n\nPetal.Length\n\n\nPetal.Width\n\n\nSpecies\n\n\n\n\n\n5.1\n\n\n3.5\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.7\n\n\n3.2\n\n\n1.3\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.1\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5\n\n\n3.6\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.9\n\n\n1.7\n\n\n0.4\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.4\n\n\n1.4\n\n\n0.3\n\n\nsetosa\n\n\n\n\n5\n\n\n3.4\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.4\n\n\n2.9\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3.1\n\n\n1.5\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.7\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3.4\n\n\n1.6\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3\n\n\n1.4\n\n\n0.1\n\n\nsetosa\n\n\n\n\n4.3\n\n\n3\n\n\n1.1\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.8\n\n\n4\n\n\n1.2\n\n\n0.2\n\n\nsetosa\n\n\n\n\n\n[ omitted 35 entries ]\n\n\n\n\nSince the time to compute the secondary indices is quite small, we don’t have to use setindex, unless the task involves repeated subsetting on the same columns.\n\n\n\n\n\n\nTip\n\n\n\nWhen using on with multiple values, the nomatch = NULL argument avoids creating combinations that do not exist in the original data (i.e. for cyl == 5 here)\n\n\n\nMT[.(4:6, 4), on = c(\"cyl\", \"gear\"), nomatch = NULL]\ndata.table [12 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n32.4\n\n\n4\n\n\n78.7\n\n\n66\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n30.4\n\n\n4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n33.9\n\n\n4\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n27.3\n\n\n4\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n\n\n1.2.8 Filtering on multiple columns\nFiltering with one function taking multiple columns:\n\nf_dat <- \\(d) with(d, gear > cyl) # Function taking the data and comparing fix columns\n\nf_dyn <- \\(x, y) x > y # Function taking dynamic columns and comparing them\n\n\ncols <- c(\"gear\", \"cyl\")\n\n\n\nTidyverse\ndata.table\n\n\n\nManually:\n\nmtcars |> filter(f_dyn(gear, cyl))\ndata.frame [2 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n\nDynamically:\nTaking column names:\n\nmtcars |> filter(f_dyn(!!!syms(cols)))\ndata.frame [2 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n\nTaking the data:\n\nmtcars |> filter(f_dat(cur_data()))\ndata.frame [2 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n\n\n\nManually:\n\nMT[f_dyn(gear, cyl),]\ndata.table [2 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n\nDynamically:\nTaking column names:\n\nMT[do.call(f_dyn, args), env = list(args = as.list(cols))] # exec(f_dyn, !!!args)\ndata.table [2 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n\nTaking the data:\n\nMT[f_dat(MT),] # Can't use .SD in i\ndata.table [2 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n\nIn two steps:\n\n\n\n\n\n\nNote\n\n\n\nWe can’t use .SD in the i clause of a data.table, but we can bypass that constraint by doing the operation in two steps:\n- Obtaining a vector stating if each row of the table matches or not the conditions\n- Filtering the original table based on the vector\n\n\n\nMT[MT[, f_dat(.SD)]]\ndata.table [2 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n\n\n\n\nCombining multiple filtering functions:\nThis function filters rows that have 2 or more non-zero decimals, and we’re going to call it on multiple columns:\n\ndecp <- \\(x) str_length(str_remove(as.character(abs(x)), \".*\\\\.\")) >= 2\n\n\ncols <- c(\"drat\", \"wt\", \"qsec\")\n\n\n\nTidyverse\ndata.table\n\n\n\nManually:\n\nmtcars |> filter(decp(drat) & decp(wt) & decp(qsec))\ndata.frame [13 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.7\n\n\n8\n\n\n440\n\n\n230\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n30.4\n\n\n4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n15.5\n\n\n8\n\n\n318\n\n\n150\n\n\n2.76\n\n\n3.52\n\n\n16.87\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n\nDynamically:\n\nmtcars |> filter(if_all(cols, decp))\ndata.frame [13 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.7\n\n\n8\n\n\n440\n\n\n230\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n30.4\n\n\n4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n15.5\n\n\n8\n\n\n318\n\n\n150\n\n\n2.76\n\n\n3.52\n\n\n16.87\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n\n\n\nManually:\n\nMT[decp(drat) & decp(wt) & decp(qsec), ]\ndata.table [13 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.7\n\n\n8\n\n\n440\n\n\n230\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n15.5\n\n\n8\n\n\n318\n\n\n150\n\n\n2.76\n\n\n3.52\n\n\n16.87\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n\nDynamically:\n\nMT[Reduce(`&`, lapply(mget(cols), decp)), ]\ndata.table [13 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.7\n\n\n8\n\n\n440\n\n\n230\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n15.5\n\n\n8\n\n\n318\n\n\n150\n\n\n2.76\n\n\n3.52\n\n\n16.87\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n\n\nAlternativesMT[Reduce(`&`, lapply(MT[, ..cols], decp)), ]\n\nMT[Reduce(`&`, lapply(v1, decp)), env = list(v1 = as.list(cols))]\n\n\nIn two steps:\n\nMT[MT[, Reduce(`&`, lapply(.SD, decp)), .SDcols = cols]]\ndata.table [13 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.7\n\n\n8\n\n\n440\n\n\n230\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n15.5\n\n\n8\n\n\n318\n\n\n150\n\n\n2.76\n\n\n3.52\n\n\n16.87\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2"
  },
  {
    "objectID": "content/posts/data.table/index.html#rename",
    "href": "content/posts/data.table/index.html#rename",
    "title": "Tidyverse <-> data.table",
    "section": "\n1.3 Rename",
    "text": "1.3 Rename\n\n\n\n\n\n\n\n\n\nNote\n\n\n\nsetnames changes column names in-place\n\n\n\n\nTidyverse\ndata.table\n\n\n\nManually:\n\nmtcars |> rename(CYL = cyl, MPG = mpg)\ndata.frame [32 x 11]\n\n\n\nMPG\n\n\nCYL\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nDynamically:\n\nmtcars |> rename_with(\\(c) toupper(c), .cols = matches(\"^d\"))\ndata.frame [32 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\nDISP\n\n\nhp\n\n\nDRAT\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\nManually:\n\nsetnames(copy(MT), c(\"cyl\", \"mpg\"), c(\"CYL\", \"MPG\"))[]\ndata.table [32 x 11]\n\n\n\nMPG\n\n\nCYL\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nDynamically:\n\nsetnames(copy(MT), grep(\"^d\", colnames(MT)), toupper)[]\ndata.table [32 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\nDISP\n\n\nhp\n\n\nDRAT\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]"
  },
  {
    "objectID": "content/posts/data.table/index.html#select",
    "href": "content/posts/data.table/index.html#select",
    "title": "Tidyverse <-> data.table",
    "section": "\n1.4 Select",
    "text": "1.4 Select\n\n\n\n\n1.4.1 Basic selection\n\n\nTidyverse\ndata.table\n\n\n\n\nMT |> select(matches(\"cyl|disp\"))\ndata.table [32 x 2]\n\n\n\ncyl\n\n\ndisp\n\n\n\n\n\n6\n\n\n160\n\n\n\n\n6\n\n\n160\n\n\n\n\n4\n\n\n108\n\n\n\n\n6\n\n\n258\n\n\n\n\n8\n\n\n360\n\n\n\n\n6\n\n\n225\n\n\n\n\n8\n\n\n360\n\n\n\n\n4\n\n\n146.7\n\n\n\n\n4\n\n\n140.8\n\n\n\n\n6\n\n\n167.6\n\n\n\n\n6\n\n\n167.6\n\n\n\n\n8\n\n\n275.8\n\n\n\n\n8\n\n\n275.8\n\n\n\n\n8\n\n\n275.8\n\n\n\n\n8\n\n\n472\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\nRemove a column:\n\nmtcars |> select(!cyl) # select(-cyl)\ndata.frame [32 x 10]\n\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nMT[, .(mpg, disp)]\ndata.table [32 x 2]\n\n\n\nmpg\n\n\ndisp\n\n\n\n\n\n21\n\n\n160\n\n\n\n\n21\n\n\n160\n\n\n\n\n22.8\n\n\n108\n\n\n\n\n21.4\n\n\n258\n\n\n\n\n18.7\n\n\n360\n\n\n\n\n18.1\n\n\n225\n\n\n\n\n14.3\n\n\n360\n\n\n\n\n24.4\n\n\n146.7\n\n\n\n\n22.8\n\n\n140.8\n\n\n\n\n19.2\n\n\n167.6\n\n\n\n\n17.8\n\n\n167.6\n\n\n\n\n16.4\n\n\n275.8\n\n\n\n\n17.3\n\n\n275.8\n\n\n\n\n15.2\n\n\n275.8\n\n\n\n\n10.4\n\n\n472\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\nAlternativesMT[ , .SD, .SDcols = c(\"mpg\", \"disp\")]\n\nMT[, .SD, .SDcols = patterns(\"mpg|disp\")]\n\n\nRemove a column:\n\nMT[, !\"cyl\"] # MT[, -\"cyl\"]\ndata.table [32 x 10]\n\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nIn-place:\n\ncopy(MT)[, cyl := NULL][]\ndata.table [32 x 10]\n\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\nTidyverse\ndata.table\n\n\n\nSelect & Extract:\n\nmtcars |> pull(disp)\n\n [1] 160.0 160.0 108.0 258.0 360.0 225.0 360.0 146.7 140.8 167.6 167.6 275.8\n[13] 275.8 275.8 472.0 460.0 440.0  78.7  75.7  71.1 120.1 318.0 304.0 350.0\n[25] 400.0  79.0 120.3  95.1 351.0 145.0 301.0 121.0\n\n\nSelect & Rename:\n\nmtcars |> select(dispp = disp)\ndata.frame [32 x 1]\n\n\n\ndispp\n\n\n\n\n\n160\n\n\n\n\n160\n\n\n\n\n108\n\n\n\n\n258\n\n\n\n\n360\n\n\n\n\n225\n\n\n\n\n360\n\n\n\n\n146.7\n\n\n\n\n140.8\n\n\n\n\n167.6\n\n\n\n\n167.6\n\n\n\n\n275.8\n\n\n\n\n275.8\n\n\n\n\n275.8\n\n\n\n\n472\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\nSelect & Extrac:\n\nMT[, disp]\n\n [1] 160.0 160.0 108.0 258.0 360.0 225.0 360.0 146.7 140.8 167.6 167.6 275.8\n[13] 275.8 275.8 472.0 460.0 440.0  78.7  75.7  71.1 120.1 318.0 304.0 350.0\n[25] 400.0  79.0 120.3  95.1 351.0 145.0 301.0 121.0\n\n\nSelect & Rename:\n\nMT[, .(dispp = disp)]\ndata.table [32 x 1]\n\n\n\ndispp\n\n\n\n\n\n160\n\n\n\n\n160\n\n\n\n\n108\n\n\n\n\n258\n\n\n\n\n360\n\n\n\n\n225\n\n\n\n\n360\n\n\n\n\n146.7\n\n\n\n\n140.8\n\n\n\n\n167.6\n\n\n\n\n167.6\n\n\n\n\n275.8\n\n\n\n\n275.8\n\n\n\n\n275.8\n\n\n\n\n472\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n1.4.2 Dynamic selection\nBy name:\n\ncols <- c(\"cyl\", \"disp\")\n\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |> select(all_of(cols)) # select(!!cols)\ndata.frame [32 x 2]\n\n\n\ncyl\n\n\ndisp\n\n\n\n\n\n6\n\n\n160\n\n\n\n\n6\n\n\n160\n\n\n\n\n4\n\n\n108\n\n\n\n\n6\n\n\n258\n\n\n\n\n8\n\n\n360\n\n\n\n\n6\n\n\n225\n\n\n\n\n8\n\n\n360\n\n\n\n\n4\n\n\n146.7\n\n\n\n\n4\n\n\n140.8\n\n\n\n\n6\n\n\n167.6\n\n\n\n\n6\n\n\n167.6\n\n\n\n\n8\n\n\n275.8\n\n\n\n\n8\n\n\n275.8\n\n\n\n\n8\n\n\n275.8\n\n\n\n\n8\n\n\n472\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\nRemoving a column:\n\nmtcars |> select(!{{cols}}) # select(-matches(cols))\ndata.frame [32 x 9]\n\n\n\nmpg\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nMT[, ..cols]\ndata.table [32 x 2]\n\n\n\ncyl\n\n\ndisp\n\n\n\n\n\n6\n\n\n160\n\n\n\n\n6\n\n\n160\n\n\n\n\n4\n\n\n108\n\n\n\n\n6\n\n\n258\n\n\n\n\n8\n\n\n360\n\n\n\n\n6\n\n\n225\n\n\n\n\n8\n\n\n360\n\n\n\n\n4\n\n\n146.7\n\n\n\n\n4\n\n\n140.8\n\n\n\n\n6\n\n\n167.6\n\n\n\n\n6\n\n\n167.6\n\n\n\n\n8\n\n\n275.8\n\n\n\n\n8\n\n\n275.8\n\n\n\n\n8\n\n\n275.8\n\n\n\n\n8\n\n\n472\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\nAlternativesMT[, mget(cols)] # Retired\n\nMT[, cols, with = FALSE] # Retired\n\nMT[, .SD, .SDcols = cols]\n\nMT[, j, env = list(j = as.list(cols))]\n\n\nRemoving a column:\n\nMT[, !..cols]\ndata.table [32 x 9]\n\n\n\nmpg\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\nAlternativesMT[, .SD, .SDcols = !cols]\n\nMT[, -j, env = list(j = I(cols))]\n\n\nIn-place:\n\ncopy(MT)[, (cols) := NULL][]\ndata.table [32 x 9]\n\n\n\nmpg\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nBy pattern:\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |> select(-matches(\"^d\"))\ndata.frame [32 x 9]\n\n\n\nmpg\n\n\ncyl\n\n\nhp\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n110\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n110\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n93\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n110\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n175\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n105\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n245\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n62\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n95\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n123\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n123\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n180\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n180\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n180\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n205\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\nmtcars |> select(where(\\(x) all(x != 0))) # Only keep columns where no value == 0\ndata.frame [32 x 9]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nMT[, .SD, .SDcols = !patterns(\"^d\")]\ndata.table [32 x 9]\n\n\n\nmpg\n\n\ncyl\n\n\nhp\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n110\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n110\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n93\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n110\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n175\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n105\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n245\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n62\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n95\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n123\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n123\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n180\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n180\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n180\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n205\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\nMT[, .SD, .SDcols = \\(x) all(x != 0)] # Only keep columns where no value == 0\ndata.table [32 x 9]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\nAlternativescopy(MT)[, grep(\"^d\", colnames(MT)) := NULL][] # In place (column deletion)\n\nMT[, MT[, sapply(.SD, \\(x) all(x != 0))], with = FALSE]\n\n\n\n\n\nBy column type:\n\niris |> select(where(\\(x) !is.numeric(x)))\ndata.frame [150 x 1]\n\n\n\nSpecies\n\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\n\n[ omitted 135 entries ]\n\n\n\n\n\nIRIS[, .SD, .SDcols = !is.numeric]\ndata.table [150 x 1]\n\n\n\nSpecies\n\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\n\n[ omitted 135 entries ]"
  },
  {
    "objectID": "content/posts/data.table/index.html#mutate-transmute",
    "href": "content/posts/data.table/index.html#mutate-transmute",
    "title": "Tidyverse <-> data.table",
    "section": "\n1.5 Mutate / Transmute",
    "text": "1.5 Mutate / Transmute\n\n\n\ndata.table can mutate in 2 ways:\n- Using = creates a new DT with the new columns only (like dplyr::transmute)\n- Using := (or let) modifies the current dt in place (like dplyr::mutate)\nThe function modifying a column should be the same size as the original column (or group).\nIf only one value is provided with :=, it will be recycled to the whole column/group.\nIf the number of values provided is smaller than the original column/group:\n- With := or let, an error will be raised, asking to manually specify how to recycle the values.\n- With =, it will behave like dplyr::summarize (if a grouping has been specified).\n\n1.5.1 Basic transmute\nOnly keeping the transformed columns.\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |> transmute(cyl = cyl * 2)\ndata.frame [32 x 1]\n\n\n\ncyl\n\n\n\n\n\n12\n\n\n\n\n12\n\n\n\n\n8\n\n\n\n\n12\n\n\n\n\n16\n\n\n\n\n12\n\n\n\n\n16\n\n\n\n\n8\n\n\n\n\n8\n\n\n\n\n12\n\n\n\n\n12\n\n\n\n\n16\n\n\n\n\n16\n\n\n\n\n16\n\n\n\n\n16\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nMT[, .(cyl = cyl * 2)]\ndata.table [32 x 1]\n\n\n\ncyl\n\n\n\n\n\n12\n\n\n\n\n12\n\n\n\n\n8\n\n\n\n\n12\n\n\n\n\n16\n\n\n\n\n12\n\n\n\n\n16\n\n\n\n\n8\n\n\n\n\n8\n\n\n\n\n12\n\n\n\n\n12\n\n\n\n\n16\n\n\n\n\n16\n\n\n\n\n16\n\n\n\n\n16\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nTransmute & Extract:\n\nMT[, (cyl = cyl * 2)]\n\n [1] 12 12  8 12 16 12 16  8  8 12 12 16 16 16 16 16 16  8  8  8  8 16 16 16 16\n[26]  8  8  8 16 12 16  8\n\n\n\n\n\n\n1.5.2 Basic mutate\nModifies the transformed column in-place and keeps every other column as-is.\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |> mutate(cyl = 200)\ndata.frame [32 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n200\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n200\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n200\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n200\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n200\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n200\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n200\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n200\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n200\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n200\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n200\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n200\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n200\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n200\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n200\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\nmtcars |> mutate(cyl = 200, gear = 5)\ndata.frame [32 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n200\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n21\n\n\n200\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n22.8\n\n\n200\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n5\n\n\n1\n\n\n\n\n21.4\n\n\n200\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n5\n\n\n1\n\n\n\n\n18.7\n\n\n200\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n5\n\n\n2\n\n\n\n\n18.1\n\n\n200\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n5\n\n\n1\n\n\n\n\n14.3\n\n\n200\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n5\n\n\n4\n\n\n\n\n24.4\n\n\n200\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n5\n\n\n2\n\n\n\n\n22.8\n\n\n200\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n5\n\n\n2\n\n\n\n\n19.2\n\n\n200\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n5\n\n\n4\n\n\n\n\n17.8\n\n\n200\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n5\n\n\n4\n\n\n\n\n16.4\n\n\n200\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n5\n\n\n3\n\n\n\n\n17.3\n\n\n200\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n5\n\n\n3\n\n\n\n\n15.2\n\n\n200\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n5\n\n\n3\n\n\n\n\n10.4\n\n\n200\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n5\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\nmtcars |> mutate(mean_cyl = mean(cyl, na.rm = TRUE))\ndata.frame [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmean_cyl\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n6.188\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n6.188\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n6.188\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n6.188\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n6.188\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n6.188\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n6.188\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n6.188\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n6.188\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n6.188\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n6.188\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n6.188\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n6.188\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n6.188\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n6.188\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\nmtcars |> mutate(gear_plus = lead(gear))\ndata.frame [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\ngear_plus\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n3\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n3\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n3\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n3\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n3\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n3\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\ncopy(MT)[, cyl := 200][]\ndata.table [32 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n200\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n200\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n200\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n200\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n200\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n200\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n200\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n200\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n200\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n200\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n200\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n200\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n200\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n200\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n200\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\ncopy(MT)[, let(cyl = 200, gear = 5)][]\ndata.table [32 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n200\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n21\n\n\n200\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n22.8\n\n\n200\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n5\n\n\n1\n\n\n\n\n21.4\n\n\n200\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n5\n\n\n1\n\n\n\n\n18.7\n\n\n200\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n5\n\n\n2\n\n\n\n\n18.1\n\n\n200\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n5\n\n\n1\n\n\n\n\n14.3\n\n\n200\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n5\n\n\n4\n\n\n\n\n24.4\n\n\n200\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n5\n\n\n2\n\n\n\n\n22.8\n\n\n200\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n5\n\n\n2\n\n\n\n\n19.2\n\n\n200\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n5\n\n\n4\n\n\n\n\n17.8\n\n\n200\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n5\n\n\n4\n\n\n\n\n16.4\n\n\n200\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n5\n\n\n3\n\n\n\n\n17.3\n\n\n200\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n5\n\n\n3\n\n\n\n\n15.2\n\n\n200\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n5\n\n\n3\n\n\n\n\n10.4\n\n\n200\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n5\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\nAlternativescopy(MT)[, `:=`(cyl = 200, gear = 5)][]\n\ncopy(MT)[, c(\"cyl\", \"gear\") := .(200, 5)][]\n\n\n\ncopy(MT)[, mean_cyl := mean(cyl, na.rm = TRUE)][]\ndata.table [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmean_cyl\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n6.188\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n6.188\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n6.188\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n6.188\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n6.188\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n6.188\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n6.188\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n6.188\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n6.188\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n6.188\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n6.188\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n6.188\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n6.188\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n6.188\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n6.188\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\ncopy(MT)[, gearplus := shift(gear, 1, type = \"lead\")][] # lead, lag, cyclic\ndata.table [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\ngearplus\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n3\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n3\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n3\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n3\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n3\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n3\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n1.5.3 Dynamic trans/mutate\n\nLHS <- \"mean_mpg\"\nRHS <- \"mpg\"\n\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |> mutate({{LHS}} := mean(mpg))\ndata.frame [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmean_mpg\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n20.091\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n20.091\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\nmtcars |> mutate(\"{LHS}\" := mean(.data[[RHS]]))\ndata.frame [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmean_mpg\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n20.091\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n20.091\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n\n[ omitted 17 entries ]\n\n\nmtcars |> mutate({{LHS}} := mean(cur_data()[[RHS]]))\ndata.frame [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmean_mpg\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n20.091\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n20.091\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\ncopy(MT)[, (LHS) := mean(mpg)][] # (LHS) <=> c(LHS)\ndata.table [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmean_mpg\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n20.091\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n20.091\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n\n[ omitted 17 entries ]\n\n\ncopy(MT)[, j := mean(mpg), env = list(j = LHS)][]\ndata.table [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmean_mpg\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n20.091\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n20.091\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\ncopy(MT)[, c(LHS) := mean(get(RHS))][]\ndata.table [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmean_mpg\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n20.091\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n20.091\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n\n[ omitted 17 entries ]\n\n\ncopy(MT)[, x := mean(y), env = list(x = LHS, y = RHS)][]\ndata.table [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmean_mpg\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n20.091\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n20.091\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n1.5.4 Conditional trans/mutate\n\n\nTidyverse\ndata.table\n\n\n\nMutate everything based on multiple conditions:\nOne condition:\n\nmtcars |> mutate(Size = if_else(cyl >= 6, \"BIG\", \"small\", missing = \"Unk\"))\ndata.frame [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nSize\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\nsmall\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\nBIG\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\nBIG\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\nBIG\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\nBIG\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\nsmall\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\nsmall\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nBIG\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nBIG\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nBIG\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\nBIG\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nNested conditions:\n\nmtcars |> mutate(Size = case_when(\n  cyl %between% c(2,4) ~ \"small\",\n  cyl %between% c(4,8) ~ \"BIG\",\n  .default = \"Unk\"\n))\ndata.frame [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nSize\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\nsmall\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\nBIG\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\nBIG\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\nBIG\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\nBIG\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\nsmall\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\nsmall\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nBIG\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nBIG\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nBIG\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\nBIG\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nMutate only rows meeting conditions:\n\nmtcars |> mutate(BIG = case_when(am == 1 ~ cyl >= 6))\ndata.frame [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nBIG\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\nTRUE\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\nTRUE\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\nFALSE\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\nNA\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\nNA\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\nNA\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\nNA\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\nNA\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\nNA\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\nNA\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\nNA\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nNA\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nNA\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nNA\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\nNA\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\nMutate everything based on multiple conditions:\nOne condition:\n\ncopy(MT)[, Size := fifelse(cyl >= 6, \"BIG\", \"small\", na = \"Unk\")][]\ndata.table [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nSize\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\nsmall\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\nBIG\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\nBIG\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\nBIG\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\nBIG\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\nsmall\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\nsmall\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nBIG\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nBIG\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nBIG\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\nBIG\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nNested conditions:\n\ncopy(MT)[, Size := fcase(\n  cyl %between% c(2,4), \"small\", \n  cyl %between% c(4,8), \"BIG\",\n  default = \"Unk\"\n)][]\ndata.table [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nSize\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\nsmall\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\nBIG\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\nBIG\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\nBIG\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\nBIG\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\nsmall\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\nsmall\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nBIG\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nBIG\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nBIG\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\nBIG\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nMutate only rows meeting conditions:\n\ncopy(MT)[am == 1, BIG := cyl >= 6][]\ndata.table [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nBIG\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\nTRUE\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\nTRUE\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\nFALSE\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\nNA\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\nNA\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\nNA\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\nNA\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\nNA\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\nNA\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\nNA\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\nNA\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nNA\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nNA\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nNA\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\nNA\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n1.5.5 Complex trans/mutate\n\n1.5.5.1 Column-wise operations\n\nnew <- c(\"min_mpg\", \"min_disp\")\nold <- c(\"mpg\", \"disp\")\n\nApply one function to multiple columns:\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |> mutate(across(c(\"mpg\", \"disp\"), min, .names = \"min_{col}\"))\ndata.frame [32 x 13]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmin_mpg\n\n\nmin_disp\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\nAs a transmute:\n\nmtcars |> transmute(across(c(\"mpg\", \"disp\"), min, .names = \"min_{col}\"))\ndata.frame [32 x 2]\n\n\n\nmin_mpg\n\n\nmin_disp\n\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\nDynamically:\n\nmtcars |> mutate(across(all_of(old), min, .names = \"min_{col}\"))\ndata.frame [32 x 13]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmin_mpg\n\n\nmin_disp\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\ncopy(MT)[\n    , c(\"min_mpg\", \"min_disp\") := lapply(.SD, min), .SDcols = c(\"mpg\", \"disp\")\n  ][]\ndata.table [32 x 13]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmin_mpg\n\n\nmin_disp\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\ncopy(MT)[, c(\"min_mpg\", \"min_disp\") := lapply(.(mpg, disp), min)][]\n\nAs a transmute:\nA second step is needed to add min_ before the names:\n\n(MT[, lapply(.SD[, .(mpg, disp)], min)] |> \n   bind(d, setnames(d, names(d), \\(x) paste0(\"min_\", x)))\n)[]\ndata.table [1 x 2]\n\n\n\nmin_mpg\n\n\nmin_disp\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\nDynamically:\n\ncopy(MT)[, c(new) := lapply(mget(old), min)][]\ndata.table [32 x 13]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmin_mpg\n\n\nmin_disp\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\ncopy(MT)[, c(new) := lapply(x, min), env = list(x = as.list(old))][]\n\n\n\n\nApply multiple functions to one or multiple column:\n\ncol <- \"mpg\"\ncols <- c(\"mpg\", \"disp\")\n\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |> mutate(min_mpg = min(mpg), max_mpg = max(mpg))\ndata.frame [32 x 13]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmin_mpg\n\n\nmax_mpg\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n\n[ omitted 17 entries ]\n\n\nmtcars |> mutate(across(mpg, list(min = min, max = max), .names = \"{fn}_{col}\"))\ndata.frame [32 x 13]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmin_mpg\n\n\nmax_mpg\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\nMultiple columns:\n\nmtcars |> mutate(\n    across(matches(\"mpg|disp\"), list(min = min, max = max), .names = \"{fn}_{col}\")\n  )\ndata.frame [32 x 15]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmin_mpg\n\n\nmax_mpg\n\n\nmin_disp\n\n\nmax_disp\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\nmtcars |> mutate(\n    across(cols, list(min = \\(x) min(x), max = \\(x) max(x)), .names = \"{fn}_{col}\")\n  )\ndata.frame [32 x 15]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmin_mpg\n\n\nmax_mpg\n\n\nmin_disp\n\n\nmax_disp\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\ncopy(MT)[, let(min_mpg = min(mpg), max_mpg = max(mpg))][]\ndata.table [32 x 13]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmin_mpg\n\n\nmax_mpg\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n\n[ omitted 17 entries ]\n\n\ncopy(MT)[, c(\"min_mpg\", \"max_mpg\") := .(min(mpg), max(mpg))][]\ndata.table [32 x 13]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmin_mpg\n\n\nmax_mpg\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\nAlternativescopy(MT)[, c(\"min_mpg\", \"max_mpg\") := \n           lapply(.(mpg), \\(x) list(min(x), max(x))) |> do.call(rbind, args = _)\n        ][]\n\ncopy(MT)[, c(\"min_mpg\", \"max_mpg\") := \n           lapply(.(get(col)), \\(x) list(min(x), max(x))) |> unlist(recursive = F)\n        ][]\n\n\nMultiple columns:\n\ncopy(MT)[, c(\"min_mpg\", \"min_disp\", \"max_mpg\", \"max_disp\") := \n           lapply(.SD, \\(x) list(min(x), max(x))) |> do.call(rbind, args = _), \n         .SDcols = cols][]\ndata.table [32 x 15]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmin_mpg\n\n\nmin_disp\n\n\nmax_mpg\n\n\nmax_disp\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\ncopy(MT)[, outer(c(\"min\", \"max\"), cols, str_c, sep = \"_\") |> t() |> as.vector() := \n           lapply(.SD, \\(x) list(min(x), max(x))) |> do.call(rbind, args = _), \n         .SDcols = cols][]\ndata.table [32 x 15]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmin_mpg\n\n\nmin_disp\n\n\nmax_mpg\n\n\nmax_disp\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n1.5.5.2 Row-wise operations\nApply one function to multiple columns (row-wise):\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |> rowwise() |> mutate(rsum = sum(c_across(where(is.numeric)))) |> ungroup()\ndata.frame [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nrsum\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n328.98\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n329.795\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n259.58\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n426.135\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n590.31\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n385.54\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n656.92\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n270.98\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n299.57\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n350.46\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n349.66\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n510.74\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n511.5\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n509.85\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n728.56\n\n\n\n\n\n[ omitted 17 entries ]\n\n\nmtcars |> mutate(rsum = pmap_dbl(across(where(is.numeric)), \\(...) sum(c(...))))\ndata.frame [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nrsum\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n328.98\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n329.795\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n259.58\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n426.135\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n590.31\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n385.54\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n656.92\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n270.98\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n299.57\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n350.46\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n349.66\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n510.74\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n511.5\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n509.85\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n728.56\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nHybrid base R-Tidyverse:\n\nmtcars |> mutate(rsum = apply(across(where(is.numeric)), 1, sum))\ndata.frame [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nrsum\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n328.98\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n329.795\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n259.58\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n426.135\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n590.31\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n385.54\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n656.92\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n270.98\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n299.57\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n350.46\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n349.66\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n510.74\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n511.5\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n509.85\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n728.56\n\n\n\n\n\n[ omitted 17 entries ]\n\n\nmtcars |> mutate(rsum = rowSums(across(where(is.numeric))))\ndata.frame [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nrsum\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n328.98\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n329.795\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n259.58\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n426.135\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n590.31\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n385.54\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n656.92\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n270.98\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n299.57\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n350.46\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n349.66\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n510.74\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n511.5\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n509.85\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n728.56\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\ncopy(MT)[, rsum := rowSums(.SD), .SDcols = is.numeric][]\ndata.table [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nrsum\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n328.98\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n329.795\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n259.58\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n426.135\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n590.31\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n385.54\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n656.92\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n270.98\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n299.57\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n350.46\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n349.66\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n510.74\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n511.5\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n509.85\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n728.56\n\n\n\n\n\n[ omitted 17 entries ]\n\n\ncopy(MT)[, rsum := apply(.SD, 1, sum), .SDcols = is.numeric][]\ndata.table [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nrsum\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n328.98\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n329.795\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n259.58\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n426.135\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n590.31\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n385.54\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n656.92\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n270.98\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n299.57\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n350.46\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n349.66\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n510.74\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n511.5\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n509.85\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n728.56\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nApply multiple functions to multiple columns (row-wise)\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |> mutate(\n  pmap_dfr(\n    across(where(is.numeric)), \n    \\(...) c(...) |> bind(x, list(mean = mean(x), sum = sum(x)))\n  )\n)\ndata.frame [32 x 13]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmean\n\n\nsum\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n29.907\n\n\n328.98\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n29.981\n\n\n329.795\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n23.598\n\n\n259.58\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n38.74\n\n\n426.135\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n53.665\n\n\n590.31\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n35.049\n\n\n385.54\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n59.72\n\n\n656.92\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n24.635\n\n\n270.98\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n27.234\n\n\n299.57\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n31.86\n\n\n350.46\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n31.787\n\n\n349.66\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n46.431\n\n\n510.74\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n46.5\n\n\n511.5\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n46.35\n\n\n509.85\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n66.233\n\n\n728.56\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nHybrid base R-Tidyverse:\n\nmtcars |> mutate(\n  apply(across(where(is.numeric)), 1, \\(x) list(mean = mean(x), sum = sum(x))) |> \n    bind_rows()\n)\ndata.frame [32 x 13]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmean\n\n\nsum\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n29.907\n\n\n328.98\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n29.981\n\n\n329.795\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n23.598\n\n\n259.58\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n38.74\n\n\n426.135\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n53.665\n\n\n590.31\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n35.049\n\n\n385.54\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n59.72\n\n\n656.92\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n24.635\n\n\n270.98\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n27.234\n\n\n299.57\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n31.86\n\n\n350.46\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n31.787\n\n\n349.66\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n46.431\n\n\n510.74\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n46.5\n\n\n511.5\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n46.35\n\n\n509.85\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n66.233\n\n\n728.56\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\ncopy(MT)[, c(\"rmean\", \"rsum\") := \n           apply(.SD, 1, \\(x) list(mean(x), sum(x))) |> rbindlist(), \n         .SDcols = is.numeric][]\ndata.table [32 x 13]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nrmean\n\n\nrsum\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n29.907\n\n\n328.98\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n29.981\n\n\n329.795\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n23.598\n\n\n259.58\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n38.74\n\n\n426.135\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n53.665\n\n\n590.31\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n35.049\n\n\n385.54\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n59.72\n\n\n656.92\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n24.635\n\n\n270.98\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n27.234\n\n\n299.57\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n31.86\n\n\n350.46\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n31.787\n\n\n349.66\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n46.431\n\n\n510.74\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n46.5\n\n\n511.5\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n46.35\n\n\n509.85\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n66.233\n\n\n728.56\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nApply an anonymous function inside the DT:\n\nMT[, {\n    print(summary(mpg))\n    x <- cyl + gear\n    .(RN = 1:.N, CG = x)\n  }\n]\nMin. 1st Qu. Median Mean 3rd Qu. Max. 10.40 15.43 19.20 20.09 22.80 33.90\ndata.table [32 x 2]\n\n\n\nRN\n\n\nCG\n\n\n\n\n\n1\n\n\n10\n\n\n\n\n2\n\n\n10\n\n\n\n\n3\n\n\n8\n\n\n\n\n4\n\n\n9\n\n\n\n\n5\n\n\n11\n\n\n\n\n6\n\n\n9\n\n\n\n\n7\n\n\n11\n\n\n\n\n8\n\n\n8\n\n\n\n\n9\n\n\n8\n\n\n\n\n10\n\n\n10\n\n\n\n\n11\n\n\n10\n\n\n\n\n12\n\n\n11\n\n\n\n\n13\n\n\n11\n\n\n\n\n14\n\n\n11\n\n\n\n\n15\n\n\n11\n\n\n\n\n\n[ omitted 17 entries ]"
  },
  {
    "objectID": "content/posts/data.table/index.html#group-aggregate",
    "href": "content/posts/data.table/index.html#group-aggregate",
    "title": "Tidyverse <-> data.table",
    "section": "\n1.6 Group / Aggregate",
    "text": "1.6 Group / Aggregate\n\n\n\n\n\n\n\n\n\nNote\n\n\n\nThe examples listed apply a grouping but do nothing (using .SD to simply keep all columns as is)\n\n\n\ncols <- c(\"cyl\", \"disp\")\ncols_missing <- c(\"cyl\", \"disp\", \"missing_col\")\n\n\n1.6.1 Basic grouping\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |> group_by(cyl, gear)\ndata.frame [32 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nDynamic grouping:\n\nmtcars |> group_by(across(all_of(cols)))\ndata.frame [32 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nUse any_of if you expect some columns to be missing in the data.\n\nmtcars |> group_by(across(any_of(cols_missing)))\ndata.frame [32 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nMT[, .SD, by = .(cyl, gear)]\ndata.table [32 x 11]\n\n\n\ncyl\n\n\ngear\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ncarb\n\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n\n\n6\n\n\n4\n\n\n19.2\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n\n\n6\n\n\n4\n\n\n17.8\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n32.4\n\n\n78.7\n\n\n66\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n30.4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n33.9\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n27.3\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n21.4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n2\n\n\n\n\n6\n\n\n3\n\n\n21.4\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n6\n\n\n3\n\n\n18.1\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n8\n\n\n3\n\n\n18.7\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n2\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nDynamic grouping:\n\nMT[, .SD, by = cols]\ndata.table [32 x 11]\n\n\n\ncyl\n\n\ndisp\n\n\nmpg\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n6\n\n\n160\n\n\n21\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n6\n\n\n160\n\n\n21\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n4\n\n\n108\n\n\n22.8\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n6\n\n\n258\n\n\n21.4\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n8\n\n\n360\n\n\n18.7\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n8\n\n\n360\n\n\n14.3\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n6\n\n\n225\n\n\n18.1\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n4\n\n\n146.7\n\n\n24.4\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n140.8\n\n\n22.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n6\n\n\n167.6\n\n\n19.2\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n6\n\n\n167.6\n\n\n17.8\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n8\n\n\n275.8\n\n\n16.4\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n8\n\n\n275.8\n\n\n17.3\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n8\n\n\n275.8\n\n\n15.2\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n8\n\n\n472\n\n\n10.4\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nTo handle potentially missing columns:\n\nMT[, .SD, by = intersect(cols_missing, colnames(MT))]\ndata.table [32 x 11]\n\n\n\ncyl\n\n\ndisp\n\n\nmpg\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n6\n\n\n160\n\n\n21\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n6\n\n\n160\n\n\n21\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n4\n\n\n108\n\n\n22.8\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n6\n\n\n258\n\n\n21.4\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n8\n\n\n360\n\n\n18.7\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n8\n\n\n360\n\n\n14.3\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n6\n\n\n225\n\n\n18.1\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n4\n\n\n146.7\n\n\n24.4\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n140.8\n\n\n22.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n6\n\n\n167.6\n\n\n19.2\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n6\n\n\n167.6\n\n\n17.8\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n8\n\n\n275.8\n\n\n16.4\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n8\n\n\n275.8\n\n\n17.3\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n8\n\n\n275.8\n\n\n15.2\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n8\n\n\n472\n\n\n10.4\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n1.6.2 Current group info\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |> \n  group_by(cyl) |> \n  summarize(plot(gear, mpg, main = paste(\"Cyl:\", cur_group()))) -> void\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nmtcars |> \n  group_by(cyl) |> \n  group_walk(\\(d, g) with(d, plot(gear, mpg, main = paste(\"Cyl:\", g$cyl))))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nUse the .BY argument to get the current group name:\n\nMT[, with(.SD, plot(gear, mpg, main = paste(\"Cyl:\", .BY))), by = cyl] -> void"
  },
  {
    "objectID": "content/posts/data.table/index.html#row-numbers-indices",
    "href": "content/posts/data.table/index.html#row-numbers-indices",
    "title": "Tidyverse <-> data.table",
    "section": "\n1.7 Row numbers & indices",
    "text": "1.7 Row numbers & indices\n\n\n\n\n1.7.1 Adding row or group indices\n.I: Row indices.N: Number of rows\n.GRP: Group indices.NGRP: Number of groups\nAdding rows indices:\n\nmtcars |> mutate(I = row_number())\ndata.frame [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nI\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n1\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n3\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n4\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n5\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n6\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n7\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n8\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n9\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n11\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n12\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n13\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n14\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n15\n\n\n\n\n\n[ omitted 17 entries ]\n\n\ncopy(MT)[ , I := .I][]\ndata.table [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nI\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n1\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n3\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n4\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n5\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n6\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n7\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n8\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n9\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n11\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n12\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n13\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n14\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n15\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nAdding group indices:\n\n\nTidyverse\ndata.table\n\n\n\nAdding group indices (same index for each group):\n\nmtcars |> group_by(cyl) |> summarize(GRP = cur_group_id())\ndata.frame [3 x 2]\n\n\n\ncyl\n\n\nGRP\n\n\n\n\n\n4\n\n\n1\n\n\n\n\n6\n\n\n2\n\n\n\n\n8\n\n\n3\n\n\n\n\n\nMutate instead of summarize:\n\nmtcars |> arrange(cyl) |> group_by(cyl) |> mutate(GRP = cur_group_id())\ndata.frame [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nGRP\n\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n1\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n1\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n1\n\n\n\n\n32.4\n\n\n4\n\n\n78.7\n\n\n66\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n1\n\n\n\n\n30.4\n\n\n4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n1\n\n\n\n\n33.9\n\n\n4\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n1\n\n\n\n\n21.5\n\n\n4\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n1\n\n\n\n\n27.3\n\n\n4\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n1\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n1\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n1\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n1\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n2\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n2\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n2\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nAdding row numbers within each group:\n\nmtcars |> group_by(gear) |> mutate(I_GRP = row_number())\ndata.frame [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nI_GRP\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n1\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n3\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n3\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n5\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n6\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n7\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n5\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n6\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n7\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n8\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\nAdding group indices (same index for each group):\n\nMT[, .GRP, by = cyl]\ndata.table [3 x 2]\n\n\n\ncyl\n\n\nGRP\n\n\n\n\n\n6\n\n\n1\n\n\n\n\n4\n\n\n2\n\n\n\n\n8\n\n\n3\n\n\n\n\n\nMutate instead of summarize:\n\ncopy(MT)[, GRP := .GRP, keyby = cyl][]\ndata.table [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nGRP\n\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n1\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n1\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n1\n\n\n\n\n32.4\n\n\n4\n\n\n78.7\n\n\n66\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n1\n\n\n\n\n30.4\n\n\n4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n1\n\n\n\n\n33.9\n\n\n4\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n1\n\n\n\n\n21.5\n\n\n4\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n1\n\n\n\n\n27.3\n\n\n4\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n1\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n1\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n1\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n1\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n2\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n2\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n2\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nAdding row numbers within each group:\n\ncopy(MT)[, I_GRP := 1:.N, by = gear][]\ndata.table [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nI_GRP\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n1\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n3\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n3\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n5\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n6\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n7\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n5\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n6\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n7\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n8\n\n\n\n\n\n[ omitted 17 entries ]\n\n\ncopy(MT)[, I_GRP := rowid(gear)][]\ndata.table [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nI_GRP\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n1\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n3\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n3\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n5\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n6\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n7\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n5\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n6\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n7\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n8\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n1.7.2 Filtering based on row numbers (slicing)\nExtracting a specific row:\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |> dplyr::first()\ndata.frame [1 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\nmtcars |> dplyr::last()\ndata.frame [1 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\nmtcars |> dplyr::nth(5)\ndata.frame [1 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n\n\n\nMT[1,] # data.table::first(MT)\ndata.table [1 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\nMT[.N,] # data.table::last(MT)\ndata.table [1 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\nMT[5,]\ndata.table [1 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n\n\n\nSlicing rows:\n\n\nTidyverse\ndata.table\n\n\n\n\ntail(mtcars, 10)\ndata.frame [10 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n15.2\n\n\n8\n\n\n304\n\n\n150\n\n\n3.15\n\n\n3.435\n\n\n17.3\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n27.3\n\n\n4\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n15.8\n\n\n8\n\n\n351\n\n\n264\n\n\n4.22\n\n\n3.17\n\n\n14.5\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n19.7\n\n\n6\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n\n\n15\n\n\n8\n\n\n301\n\n\n335\n\n\n3.54\n\n\n3.57\n\n\n14.6\n\n\n0\n\n\n1\n\n\n5\n\n\n8\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\nmtcars |> slice((n()-9):n())\ndata.frame [10 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n15.2\n\n\n8\n\n\n304\n\n\n150\n\n\n3.15\n\n\n3.435\n\n\n17.3\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n27.3\n\n\n4\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n15.8\n\n\n8\n\n\n351\n\n\n264\n\n\n4.22\n\n\n3.17\n\n\n14.5\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n19.7\n\n\n6\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n\n\n15\n\n\n8\n\n\n301\n\n\n335\n\n\n3.54\n\n\n3.57\n\n\n14.6\n\n\n0\n\n\n1\n\n\n5\n\n\n8\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\nmtcars |> slice_tail(n = 10)\ndata.frame [10 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n15.2\n\n\n8\n\n\n304\n\n\n150\n\n\n3.15\n\n\n3.435\n\n\n17.3\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n27.3\n\n\n4\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n15.8\n\n\n8\n\n\n351\n\n\n264\n\n\n4.22\n\n\n3.17\n\n\n14.5\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n19.7\n\n\n6\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n\n\n15\n\n\n8\n\n\n301\n\n\n335\n\n\n3.54\n\n\n3.57\n\n\n14.6\n\n\n0\n\n\n1\n\n\n5\n\n\n8\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n\n\n\n\ntail(MT, 10)\ndata.table [10 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n15.2\n\n\n8\n\n\n304\n\n\n150\n\n\n3.15\n\n\n3.435\n\n\n17.3\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n27.3\n\n\n4\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n15.8\n\n\n8\n\n\n351\n\n\n264\n\n\n4.22\n\n\n3.17\n\n\n14.5\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n19.7\n\n\n6\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n\n\n15\n\n\n8\n\n\n301\n\n\n335\n\n\n3.54\n\n\n3.57\n\n\n14.6\n\n\n0\n\n\n1\n\n\n5\n\n\n8\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\nMT[(.N-9):.N]\ndata.table [10 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n15.2\n\n\n8\n\n\n304\n\n\n150\n\n\n3.15\n\n\n3.435\n\n\n17.3\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n27.3\n\n\n4\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n15.8\n\n\n8\n\n\n351\n\n\n264\n\n\n4.22\n\n\n3.17\n\n\n14.5\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n19.7\n\n\n6\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n\n\n15\n\n\n8\n\n\n301\n\n\n335\n\n\n3.54\n\n\n3.57\n\n\n14.6\n\n\n0\n\n\n1\n\n\n5\n\n\n8\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\nMT[MT[, .I[(.N-9):.N]]] # Gets the last 10 rows' indices and filters based on them\ndata.table [10 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n15.2\n\n\n8\n\n\n304\n\n\n150\n\n\n3.15\n\n\n3.435\n\n\n17.3\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n27.3\n\n\n4\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n15.8\n\n\n8\n\n\n351\n\n\n264\n\n\n4.22\n\n\n3.17\n\n\n14.5\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n19.7\n\n\n6\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n\n\n15\n\n\n8\n\n\n301\n\n\n335\n\n\n3.54\n\n\n3.57\n\n\n14.6\n\n\n0\n\n\n1\n\n\n5\n\n\n8\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n\n\n\n\nSlicing groups:\n\n\nTidyverse\ndata.table\n\n\n\nRandom sample by group:\n\nmtcars |> group_by(cyl) |> slice_sample(n = 5)\ndata.frame [15 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n33.9\n\n\n4\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n19.7\n\n\n6\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n10.4\n\n\n8\n\n\n460\n\n\n215\n\n\n3\n\n\n5.424\n\n\n17.82\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n15.2\n\n\n8\n\n\n304\n\n\n150\n\n\n3.15\n\n\n3.435\n\n\n17.3\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15\n\n\n8\n\n\n301\n\n\n335\n\n\n3.54\n\n\n3.57\n\n\n14.6\n\n\n0\n\n\n1\n\n\n5\n\n\n8\n\n\n\n\n\nFilter groups by condition:\n\nmtcars |> group_by(cyl) |> filter(n() >= 8)\ndata.frame [25 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n10.4\n\n\n8\n\n\n460\n\n\n215\n\n\n3\n\n\n5.424\n\n\n17.82\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.7\n\n\n8\n\n\n440\n\n\n230\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n32.4\n\n\n4\n\n\n78.7\n\n\n66\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n30.4\n\n\n4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n33.9\n\n\n4\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.5\n\n\n4\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n\n[ omitted 10 entries ]\n\n\nmtcars |> group_by(cyl) |> group_modify(\\(d,g) if (nrow(d) >= 8) d else data.frame())\ndata.frame [25 x 11]\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n4\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n32.4\n\n\n78.7\n\n\n66\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n30.4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n33.9\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n21.5\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n4\n\n\n27.3\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n26\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n4\n\n\n30.4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n4\n\n\n21.4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n8\n\n\n18.7\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n8\n\n\n14.3\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n8\n\n\n16.4\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n8\n\n\n17.3\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n\n[ omitted 10 entries ]\n\n\n\n\n\n\nRandom sample by group:\n\nMT[, .SD[sample(.N, 5)], keyby = cyl]\ndata.table [15 x 11]\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n4\n\n\n21.5\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n4\n\n\n21.4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n26\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n4\n\n\n33.9\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n6\n\n\n21.4\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n6\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n6\n\n\n19.7\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n\n\n6\n\n\n17.8\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n6\n\n\n18.1\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n8\n\n\n19.2\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n8\n\n\n18.7\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n8\n\n\n14.3\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n8\n\n\n15.2\n\n\n304\n\n\n150\n\n\n3.15\n\n\n3.435\n\n\n17.3\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n8\n\n\n15\n\n\n301\n\n\n335\n\n\n3.54\n\n\n3.57\n\n\n14.6\n\n\n0\n\n\n1\n\n\n5\n\n\n8\n\n\n\n\n\nFilter groups by condition:\n\nMT[, if(.N >= 8) .SD, by = cyl]\ndata.table [25 x 11]\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n4\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n32.4\n\n\n78.7\n\n\n66\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n30.4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n33.9\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n21.5\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n4\n\n\n27.3\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n26\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n4\n\n\n30.4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n4\n\n\n21.4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n8\n\n\n18.7\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n8\n\n\n14.3\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n8\n\n\n16.4\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n8\n\n\n17.3\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n\n[ omitted 10 entries ]\n\n\nMT[, .SD[.N >= 8], by = cyl]\ndata.table [25 x 11]\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n4\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n32.4\n\n\n78.7\n\n\n66\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n30.4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n33.9\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n21.5\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n4\n\n\n27.3\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n26\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n4\n\n\n30.4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n4\n\n\n21.4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n8\n\n\n18.7\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n8\n\n\n14.3\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n8\n\n\n16.4\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n8\n\n\n17.3\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n\n[ omitted 10 entries ]\n\n\n\n\n\n\n\n\n1.7.3 Extracting row indices\nGetting the row numbers of specific observations:\n\n\nTidyverse\ndata.table\n\n\n\nRow number of the first and last observation of each group:\n\nmtcars |> group_by(cyl) |> summarize(I = cur_group_rows()[c(1, n())]) |> ungroup()\ndata.frame [6 x 2]\n\n\n\ncyl\n\n\nI\n\n\n\n\n\n4\n\n\n3\n\n\n\n\n4\n\n\n32\n\n\n\n\n6\n\n\n1\n\n\n\n\n6\n\n\n30\n\n\n\n\n8\n\n\n5\n\n\n\n\n8\n\n\n31\n\n\n\n\n\n… while keeping all other columns:\n\nmtcars |> mutate(I = row_number()) |> group_by(cyl) |> slice(c(1, n())) |> ungroup()\ndata.frame [6 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nI\n\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n3\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n32\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n1\n\n\n\n\n19.7\n\n\n6\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n30\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n5\n\n\n\n\n15\n\n\n8\n\n\n301\n\n\n335\n\n\n3.54\n\n\n3.57\n\n\n14.6\n\n\n0\n\n\n1\n\n\n5\n\n\n8\n\n\n31\n\n\n\n\n\n\n\nRow number of the first and last observation of each group:\n\nMT[, .I[c(1, .N)], keyby = cyl]\ndata.table [6 x 2]\n\n\n\ncyl\n\n\nV1\n\n\n\n\n\n4\n\n\n3\n\n\n\n\n4\n\n\n32\n\n\n\n\n6\n\n\n1\n\n\n\n\n6\n\n\n30\n\n\n\n\n8\n\n\n5\n\n\n\n\n8\n\n\n31\n\n\n\n\n\n… while keeping all other columns:\n\ncopy(MT)[, I := .I][, .SD[c(1, .N)], keyby = cyl]\ndata.table [6 x 12]\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nI\n\n\n\n\n\n4\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n3\n\n\n\n\n4\n\n\n21.4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n32\n\n\n\n\n6\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n1\n\n\n\n\n6\n\n\n19.7\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n30\n\n\n\n\n8\n\n\n18.7\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n5\n\n\n\n\n8\n\n\n15\n\n\n301\n\n\n335\n\n\n3.54\n\n\n3.57\n\n\n14.6\n\n\n0\n\n\n1\n\n\n5\n\n\n8\n\n\n31\n\n\n\n\n\n\n\n\nExtracting row indices after filtering:\n\n\n\n\n\n\nImportant\n\n\n\n.I gives the vector of row numbers after any subsetting/filtering has been done\n\n\n\n\nTidyverse\ndata.table\n\n\n\nExtracting row numbers in the original dataset:\n\nmtcars |> mutate(I = row_number()) |> filter(gear == 4) |> pull(I)\n[1] 1 2 3 8 9 10 11 18 19 20 26 32\n\nExtracting row numbers in the new dataset (after filtering):\n\nmtcars |> filter(gear == 4) |> mutate(I = row_number()) |> pull(I)\n[1] 1 2 3 4 5 6 7 8 9 10 11 12\n\n\n\nExtracting row numbers in the original dataset:\n\nMT[, .I[gear == 4]]\n[1] 1 2 3 8 9 10 11 18 19 20 26 32\n\nExtracting row numbers in the new dataset (after filtering):\n\nMT[gear == 4, .I]\n[1] 1 2 3 4 5 6 7 8 9 10 11 12"
  },
  {
    "objectID": "content/posts/data.table/index.html#relocate",
    "href": "content/posts/data.table/index.html#relocate",
    "title": "Tidyverse <-> data.table",
    "section": "\n1.8 Relocate",
    "text": "1.8 Relocate\n\n1.8.1 Basic reordering\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |> group_by(cyl) |> mutate(GRP = cur_group_id(), .before = 1)\ndata.frame [32 x 12]\n\n\n\nGRP\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n2\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n2\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n1\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n2\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n3\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n2\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n3\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n1\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n1\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n2\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n2\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n3\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n3\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n3\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n3\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\nmtcars |> relocate(cyl, .after = last_col())\ndata.frame [32 x 11]\n\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\ncyl\n\n\n\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n6\n\n\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n6\n\n\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n4\n\n\n\n\n21.4\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n6\n\n\n\n\n18.7\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n8\n\n\n\n\n18.1\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n6\n\n\n\n\n14.3\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n8\n\n\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4\n\n\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4\n\n\n\n\n19.2\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n6\n\n\n\n\n17.8\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n6\n\n\n\n\n16.4\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n8\n\n\n\n\n17.3\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n8\n\n\n\n\n15.2\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n8\n\n\n\n\n10.4\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n8\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nsetcolorder(copy(MT)[ , GRP := .GRP, by = cyl], c(\"GRP\"))[]\ndata.table [32 x 12]\n\n\n\nGRP\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n1\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n1\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n2\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n1\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n3\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n1\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n3\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n2\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n2\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n1\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n1\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n3\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n3\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n3\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n3\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\nsetcolorder(copy(MT), c(setdiff(colnames(MT), \"cyl\"), \"cyl\"))[]\ndata.table [32 x 11]\n\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\ncyl\n\n\n\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n6\n\n\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n6\n\n\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n4\n\n\n\n\n21.4\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n6\n\n\n\n\n18.7\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n8\n\n\n\n\n18.1\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n6\n\n\n\n\n14.3\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n8\n\n\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4\n\n\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4\n\n\n\n\n19.2\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n6\n\n\n\n\n17.8\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n6\n\n\n\n\n16.4\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n8\n\n\n\n\n17.3\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n8\n\n\n\n\n15.2\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n8\n\n\n\n\n10.4\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n8\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n1.8.2 Reordering by column names\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |> select(sort(tidyselect::peek_vars()))\ndata.frame [32 x 11]\n\n\n\nam\n\n\ncarb\n\n\ncyl\n\n\ndisp\n\n\ndrat\n\n\ngear\n\n\nhp\n\n\nmpg\n\n\nqsec\n\n\nvs\n\n\nwt\n\n\n\n\n\n1\n\n\n4\n\n\n6\n\n\n160\n\n\n3.9\n\n\n4\n\n\n110\n\n\n21\n\n\n16.46\n\n\n0\n\n\n2.62\n\n\n\n\n1\n\n\n4\n\n\n6\n\n\n160\n\n\n3.9\n\n\n4\n\n\n110\n\n\n21\n\n\n17.02\n\n\n0\n\n\n2.875\n\n\n\n\n1\n\n\n1\n\n\n4\n\n\n108\n\n\n3.85\n\n\n4\n\n\n93\n\n\n22.8\n\n\n18.61\n\n\n1\n\n\n2.32\n\n\n\n\n0\n\n\n1\n\n\n6\n\n\n258\n\n\n3.08\n\n\n3\n\n\n110\n\n\n21.4\n\n\n19.44\n\n\n1\n\n\n3.215\n\n\n\n\n0\n\n\n2\n\n\n8\n\n\n360\n\n\n3.15\n\n\n3\n\n\n175\n\n\n18.7\n\n\n17.02\n\n\n0\n\n\n3.44\n\n\n\n\n0\n\n\n1\n\n\n6\n\n\n225\n\n\n2.76\n\n\n3\n\n\n105\n\n\n18.1\n\n\n20.22\n\n\n1\n\n\n3.46\n\n\n\n\n0\n\n\n4\n\n\n8\n\n\n360\n\n\n3.21\n\n\n3\n\n\n245\n\n\n14.3\n\n\n15.84\n\n\n0\n\n\n3.57\n\n\n\n\n0\n\n\n2\n\n\n4\n\n\n146.7\n\n\n3.69\n\n\n4\n\n\n62\n\n\n24.4\n\n\n20\n\n\n1\n\n\n3.19\n\n\n\n\n0\n\n\n2\n\n\n4\n\n\n140.8\n\n\n3.92\n\n\n4\n\n\n95\n\n\n22.8\n\n\n22.9\n\n\n1\n\n\n3.15\n\n\n\n\n0\n\n\n4\n\n\n6\n\n\n167.6\n\n\n3.92\n\n\n4\n\n\n123\n\n\n19.2\n\n\n18.3\n\n\n1\n\n\n3.44\n\n\n\n\n0\n\n\n4\n\n\n6\n\n\n167.6\n\n\n3.92\n\n\n4\n\n\n123\n\n\n17.8\n\n\n18.9\n\n\n1\n\n\n3.44\n\n\n\n\n0\n\n\n3\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3\n\n\n180\n\n\n16.4\n\n\n17.4\n\n\n0\n\n\n4.07\n\n\n\n\n0\n\n\n3\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3\n\n\n180\n\n\n17.3\n\n\n17.6\n\n\n0\n\n\n3.73\n\n\n\n\n0\n\n\n3\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3\n\n\n180\n\n\n15.2\n\n\n18\n\n\n0\n\n\n3.78\n\n\n\n\n0\n\n\n4\n\n\n8\n\n\n472\n\n\n2.93\n\n\n3\n\n\n205\n\n\n10.4\n\n\n17.98\n\n\n0\n\n\n5.25\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\nmtcars |> select(carb, sort(tidyselect::peek_vars()))\ndata.frame [32 x 11]\n\n\n\ncarb\n\n\nam\n\n\ncyl\n\n\ndisp\n\n\ndrat\n\n\ngear\n\n\nhp\n\n\nmpg\n\n\nqsec\n\n\nvs\n\n\nwt\n\n\n\n\n\n4\n\n\n1\n\n\n6\n\n\n160\n\n\n3.9\n\n\n4\n\n\n110\n\n\n21\n\n\n16.46\n\n\n0\n\n\n2.62\n\n\n\n\n4\n\n\n1\n\n\n6\n\n\n160\n\n\n3.9\n\n\n4\n\n\n110\n\n\n21\n\n\n17.02\n\n\n0\n\n\n2.875\n\n\n\n\n1\n\n\n1\n\n\n4\n\n\n108\n\n\n3.85\n\n\n4\n\n\n93\n\n\n22.8\n\n\n18.61\n\n\n1\n\n\n2.32\n\n\n\n\n1\n\n\n0\n\n\n6\n\n\n258\n\n\n3.08\n\n\n3\n\n\n110\n\n\n21.4\n\n\n19.44\n\n\n1\n\n\n3.215\n\n\n\n\n2\n\n\n0\n\n\n8\n\n\n360\n\n\n3.15\n\n\n3\n\n\n175\n\n\n18.7\n\n\n17.02\n\n\n0\n\n\n3.44\n\n\n\n\n1\n\n\n0\n\n\n6\n\n\n225\n\n\n2.76\n\n\n3\n\n\n105\n\n\n18.1\n\n\n20.22\n\n\n1\n\n\n3.46\n\n\n\n\n4\n\n\n0\n\n\n8\n\n\n360\n\n\n3.21\n\n\n3\n\n\n245\n\n\n14.3\n\n\n15.84\n\n\n0\n\n\n3.57\n\n\n\n\n2\n\n\n0\n\n\n4\n\n\n146.7\n\n\n3.69\n\n\n4\n\n\n62\n\n\n24.4\n\n\n20\n\n\n1\n\n\n3.19\n\n\n\n\n2\n\n\n0\n\n\n4\n\n\n140.8\n\n\n3.92\n\n\n4\n\n\n95\n\n\n22.8\n\n\n22.9\n\n\n1\n\n\n3.15\n\n\n\n\n4\n\n\n0\n\n\n6\n\n\n167.6\n\n\n3.92\n\n\n4\n\n\n123\n\n\n19.2\n\n\n18.3\n\n\n1\n\n\n3.44\n\n\n\n\n4\n\n\n0\n\n\n6\n\n\n167.6\n\n\n3.92\n\n\n4\n\n\n123\n\n\n17.8\n\n\n18.9\n\n\n1\n\n\n3.44\n\n\n\n\n3\n\n\n0\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3\n\n\n180\n\n\n16.4\n\n\n17.4\n\n\n0\n\n\n4.07\n\n\n\n\n3\n\n\n0\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3\n\n\n180\n\n\n17.3\n\n\n17.6\n\n\n0\n\n\n3.73\n\n\n\n\n3\n\n\n0\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3\n\n\n180\n\n\n15.2\n\n\n18\n\n\n0\n\n\n3.78\n\n\n\n\n4\n\n\n0\n\n\n8\n\n\n472\n\n\n2.93\n\n\n3\n\n\n205\n\n\n10.4\n\n\n17.98\n\n\n0\n\n\n5.25\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nsetcolorder(copy(MT), sort(colnames(MT)))[]\ndata.table [32 x 11]\n\n\n\nam\n\n\ncarb\n\n\ncyl\n\n\ndisp\n\n\ndrat\n\n\ngear\n\n\nhp\n\n\nmpg\n\n\nqsec\n\n\nvs\n\n\nwt\n\n\n\n\n\n1\n\n\n4\n\n\n6\n\n\n160\n\n\n3.9\n\n\n4\n\n\n110\n\n\n21\n\n\n16.46\n\n\n0\n\n\n2.62\n\n\n\n\n1\n\n\n4\n\n\n6\n\n\n160\n\n\n3.9\n\n\n4\n\n\n110\n\n\n21\n\n\n17.02\n\n\n0\n\n\n2.875\n\n\n\n\n1\n\n\n1\n\n\n4\n\n\n108\n\n\n3.85\n\n\n4\n\n\n93\n\n\n22.8\n\n\n18.61\n\n\n1\n\n\n2.32\n\n\n\n\n0\n\n\n1\n\n\n6\n\n\n258\n\n\n3.08\n\n\n3\n\n\n110\n\n\n21.4\n\n\n19.44\n\n\n1\n\n\n3.215\n\n\n\n\n0\n\n\n2\n\n\n8\n\n\n360\n\n\n3.15\n\n\n3\n\n\n175\n\n\n18.7\n\n\n17.02\n\n\n0\n\n\n3.44\n\n\n\n\n0\n\n\n1\n\n\n6\n\n\n225\n\n\n2.76\n\n\n3\n\n\n105\n\n\n18.1\n\n\n20.22\n\n\n1\n\n\n3.46\n\n\n\n\n0\n\n\n4\n\n\n8\n\n\n360\n\n\n3.21\n\n\n3\n\n\n245\n\n\n14.3\n\n\n15.84\n\n\n0\n\n\n3.57\n\n\n\n\n0\n\n\n2\n\n\n4\n\n\n146.7\n\n\n3.69\n\n\n4\n\n\n62\n\n\n24.4\n\n\n20\n\n\n1\n\n\n3.19\n\n\n\n\n0\n\n\n2\n\n\n4\n\n\n140.8\n\n\n3.92\n\n\n4\n\n\n95\n\n\n22.8\n\n\n22.9\n\n\n1\n\n\n3.15\n\n\n\n\n0\n\n\n4\n\n\n6\n\n\n167.6\n\n\n3.92\n\n\n4\n\n\n123\n\n\n19.2\n\n\n18.3\n\n\n1\n\n\n3.44\n\n\n\n\n0\n\n\n4\n\n\n6\n\n\n167.6\n\n\n3.92\n\n\n4\n\n\n123\n\n\n17.8\n\n\n18.9\n\n\n1\n\n\n3.44\n\n\n\n\n0\n\n\n3\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3\n\n\n180\n\n\n16.4\n\n\n17.4\n\n\n0\n\n\n4.07\n\n\n\n\n0\n\n\n3\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3\n\n\n180\n\n\n17.3\n\n\n17.6\n\n\n0\n\n\n3.73\n\n\n\n\n0\n\n\n3\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3\n\n\n180\n\n\n15.2\n\n\n18\n\n\n0\n\n\n3.78\n\n\n\n\n0\n\n\n4\n\n\n8\n\n\n472\n\n\n2.93\n\n\n3\n\n\n205\n\n\n10.4\n\n\n17.98\n\n\n0\n\n\n5.25\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\nsetcolorder(copy(MT), c(\"carb\", sort(setdiff(colnames(MT), \"carb\"))))[]\ndata.table [32 x 11]\n\n\n\ncarb\n\n\nam\n\n\ncyl\n\n\ndisp\n\n\ndrat\n\n\ngear\n\n\nhp\n\n\nmpg\n\n\nqsec\n\n\nvs\n\n\nwt\n\n\n\n\n\n4\n\n\n1\n\n\n6\n\n\n160\n\n\n3.9\n\n\n4\n\n\n110\n\n\n21\n\n\n16.46\n\n\n0\n\n\n2.62\n\n\n\n\n4\n\n\n1\n\n\n6\n\n\n160\n\n\n3.9\n\n\n4\n\n\n110\n\n\n21\n\n\n17.02\n\n\n0\n\n\n2.875\n\n\n\n\n1\n\n\n1\n\n\n4\n\n\n108\n\n\n3.85\n\n\n4\n\n\n93\n\n\n22.8\n\n\n18.61\n\n\n1\n\n\n2.32\n\n\n\n\n1\n\n\n0\n\n\n6\n\n\n258\n\n\n3.08\n\n\n3\n\n\n110\n\n\n21.4\n\n\n19.44\n\n\n1\n\n\n3.215\n\n\n\n\n2\n\n\n0\n\n\n8\n\n\n360\n\n\n3.15\n\n\n3\n\n\n175\n\n\n18.7\n\n\n17.02\n\n\n0\n\n\n3.44\n\n\n\n\n1\n\n\n0\n\n\n6\n\n\n225\n\n\n2.76\n\n\n3\n\n\n105\n\n\n18.1\n\n\n20.22\n\n\n1\n\n\n3.46\n\n\n\n\n4\n\n\n0\n\n\n8\n\n\n360\n\n\n3.21\n\n\n3\n\n\n245\n\n\n14.3\n\n\n15.84\n\n\n0\n\n\n3.57\n\n\n\n\n2\n\n\n0\n\n\n4\n\n\n146.7\n\n\n3.69\n\n\n4\n\n\n62\n\n\n24.4\n\n\n20\n\n\n1\n\n\n3.19\n\n\n\n\n2\n\n\n0\n\n\n4\n\n\n140.8\n\n\n3.92\n\n\n4\n\n\n95\n\n\n22.8\n\n\n22.9\n\n\n1\n\n\n3.15\n\n\n\n\n4\n\n\n0\n\n\n6\n\n\n167.6\n\n\n3.92\n\n\n4\n\n\n123\n\n\n19.2\n\n\n18.3\n\n\n1\n\n\n3.44\n\n\n\n\n4\n\n\n0\n\n\n6\n\n\n167.6\n\n\n3.92\n\n\n4\n\n\n123\n\n\n17.8\n\n\n18.9\n\n\n1\n\n\n3.44\n\n\n\n\n3\n\n\n0\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3\n\n\n180\n\n\n16.4\n\n\n17.4\n\n\n0\n\n\n4.07\n\n\n\n\n3\n\n\n0\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3\n\n\n180\n\n\n17.3\n\n\n17.6\n\n\n0\n\n\n3.73\n\n\n\n\n3\n\n\n0\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3\n\n\n180\n\n\n15.2\n\n\n18\n\n\n0\n\n\n3.78\n\n\n\n\n4\n\n\n0\n\n\n8\n\n\n472\n\n\n2.93\n\n\n3\n\n\n205\n\n\n10.4\n\n\n17.98\n\n\n0\n\n\n5.25\n\n\n\n\n\n[ omitted 17 entries ]"
  },
  {
    "objectID": "content/posts/data.table/index.html#summarize",
    "href": "content/posts/data.table/index.html#summarize",
    "title": "Tidyverse <-> data.table",
    "section": "\n1.9 Summarize:",
    "text": "1.9 Summarize:\n\n\n\nWith data.table, one needs to use the = operator to summarize. It takes a function that returns a list of values smaller than the original column (or group) size. By default, it will only keep the modified columns (like a transmute).\n\n1.9.1 Basic summary\n\nmtcars |> summarize(mean_cyl = mean(cyl))\ndata.frame [1 x 1]\n\n\n\nmean_cyl\n\n\n\n\n6.188\n\n\n\n\n\nMT[, .(mean_cyl = mean(cyl))]\ndata.table [1 x 1]\n\n\n\nmean_cyl\n\n\n\n\n6.188\n\n\n\n\n\n1.9.2 Grouped summary\n\n\nTidyverse\ndata.table\n\n\n\nBy default, dplyr::summarize will arrange the result by the grouping factor:\n\nmtcars |> group_by(cyl) |> summarize(N = n())\ndata.frame [3 x 2]\n\n\n\ncyl\n\n\nN\n\n\n\n\n\n4\n\n\n11\n\n\n\n\n6\n\n\n7\n\n\n\n\n8\n\n\n14\n\n\n\n\n\n\n\nBy default, data.table keeps the order the groups originally appear in:\n\nMT[, .N, by = cyl]\ndata.table [3 x 2]\n\n\n\ncyl\n\n\nN\n\n\n\n\n\n6\n\n\n7\n\n\n\n\n4\n\n\n11\n\n\n\n\n8\n\n\n14\n\n\n\n\n\nTo order by the grouping factor, use keyby instead of by:\n\nMT[, .N, keyby = cyl]\ndata.table [3 x 2]\n\n\n\ncyl\n\n\nN\n\n\n\n\n\n4\n\n\n11\n\n\n\n\n6\n\n\n7\n\n\n\n\n8\n\n\n14\n\n\n\n\n\n\n\n\nGrouped on a temporary variable:\n\nmtcars |> group_by(cyl > 6) |> summarize(N = n())\ndata.frame [2 x 2]\n\n\n\ncyl > 6\n\n\nN\n\n\n\n\n\nFALSE\n\n\n18\n\n\n\n\nTRUE\n\n\n14\n\n\n\n\n\n\nMT[, .N, by = .(cyl > 6)]\ndata.table [2 x 2]\n\n\n\ncyl\n\n\nN\n\n\n\n\n\nFALSE\n\n\n18\n\n\n\n\nTRUE\n\n\n14\n\n\n\n\n\n\n1.9.3 Column-wise summary\nApply one function to multiple columns:\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |> group_by(cyl) |> summarize(across(everything(), mean))\ndata.frame [3 x 11]\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n4\n\n\n26.664\n\n\n105.136\n\n\n82.636\n\n\n4.071\n\n\n2.286\n\n\n19.137\n\n\n0.909\n\n\n0.727\n\n\n4.091\n\n\n1.545\n\n\n\n\n6\n\n\n19.743\n\n\n183.314\n\n\n122.286\n\n\n3.586\n\n\n3.117\n\n\n17.977\n\n\n0.571\n\n\n0.429\n\n\n3.857\n\n\n3.429\n\n\n\n\n8\n\n\n15.1\n\n\n353.1\n\n\n209.214\n\n\n3.229\n\n\n3.999\n\n\n16.772\n\n\n0\n\n\n0.143\n\n\n3.286\n\n\n3.5\n\n\n\n\n\nBy column type:\n\nmtcars |> group_by(cyl) |> summarize(across(where(is.double), mean))\ndata.frame [3 x 11]\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n4\n\n\n26.664\n\n\n105.136\n\n\n82.636\n\n\n4.071\n\n\n2.286\n\n\n19.137\n\n\n0.909\n\n\n0.727\n\n\n4.091\n\n\n1.545\n\n\n\n\n6\n\n\n19.743\n\n\n183.314\n\n\n122.286\n\n\n3.586\n\n\n3.117\n\n\n17.977\n\n\n0.571\n\n\n0.429\n\n\n3.857\n\n\n3.429\n\n\n\n\n8\n\n\n15.1\n\n\n353.1\n\n\n209.214\n\n\n3.229\n\n\n3.999\n\n\n16.772\n\n\n0\n\n\n0.143\n\n\n3.286\n\n\n3.5\n\n\n\n\n\nBy matching column names:\n\nmtcars |> group_by(cyl) |> summarize(across(matches(\"^d\"), mean))\ndata.frame [3 x 3]\n\n\n\ncyl\n\n\ndisp\n\n\ndrat\n\n\n\n\n\n4\n\n\n105.136\n\n\n4.071\n\n\n\n\n6\n\n\n183.314\n\n\n3.586\n\n\n\n\n8\n\n\n353.1\n\n\n3.229\n\n\n\n\n\n\n\n\nMT[, lapply(.SD, mean), keyby = cyl]\ndata.table [3 x 11]\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n4\n\n\n26.664\n\n\n105.136\n\n\n82.636\n\n\n4.071\n\n\n2.286\n\n\n19.137\n\n\n0.909\n\n\n0.727\n\n\n4.091\n\n\n1.545\n\n\n\n\n6\n\n\n19.743\n\n\n183.314\n\n\n122.286\n\n\n3.586\n\n\n3.117\n\n\n17.977\n\n\n0.571\n\n\n0.429\n\n\n3.857\n\n\n3.429\n\n\n\n\n8\n\n\n15.1\n\n\n353.1\n\n\n209.214\n\n\n3.229\n\n\n3.999\n\n\n16.772\n\n\n0\n\n\n0.143\n\n\n3.286\n\n\n3.5\n\n\n\n\n\nBy column type:\n\nMT[, lapply(.SD[, -\"cyl\"], mean), keyby = cyl, .SDcols = is.double]\ndata.table [3 x 11]\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n4\n\n\n26.664\n\n\n105.136\n\n\n82.636\n\n\n4.071\n\n\n2.286\n\n\n19.137\n\n\n0.909\n\n\n0.727\n\n\n4.091\n\n\n1.545\n\n\n\n\n6\n\n\n19.743\n\n\n183.314\n\n\n122.286\n\n\n3.586\n\n\n3.117\n\n\n17.977\n\n\n0.571\n\n\n0.429\n\n\n3.857\n\n\n3.429\n\n\n\n\n8\n\n\n15.1\n\n\n353.1\n\n\n209.214\n\n\n3.229\n\n\n3.999\n\n\n16.772\n\n\n0\n\n\n0.143\n\n\n3.286\n\n\n3.5\n\n\n\n\n\nBy matching column names:\n\nMT[, lapply(.SD, mean), keyby = cyl, .SDcols = patterns(\"^d\")]\ndata.table [3 x 3]\n\n\n\ncyl\n\n\ndisp\n\n\ndrat\n\n\n\n\n\n4\n\n\n105.136\n\n\n4.071\n\n\n\n\n6\n\n\n183.314\n\n\n3.586\n\n\n\n\n8\n\n\n353.1\n\n\n3.229\n\n\n\n\n\n\n\n\nApplying multiple functions to one column:\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |> group_by(cyl) |> summarize(mean(mpg), sd(mpg))\ndata.frame [3 x 3]\n\n\n\ncyl\n\n\nmean(mpg)\n\n\nsd(mpg)\n\n\n\n\n\n4\n\n\n26.664\n\n\n4.51\n\n\n\n\n6\n\n\n19.743\n\n\n1.454\n\n\n\n\n8\n\n\n15.1\n\n\n2.56\n\n\n\n\n\n\nmtcars |> group_by(cyl) |> summarize(mean_mpg = mean(mpg), sd_mpg = sd(mpg))\ndata.frame [3 x 3]\n\n\n\ncyl\n\n\nmean_mpg\n\n\nsd_mpg\n\n\n\n\n\n4\n\n\n26.664\n\n\n4.51\n\n\n\n\n6\n\n\n19.743\n\n\n1.454\n\n\n\n\n8\n\n\n15.1\n\n\n2.56\n\n\n\n\n\n\nmtcars |> \n  group_by(cyl) |> \n  summarize(across(mpg, list(mean = mean, sd = sd), .names = \"{fn}\"))\ndata.frame [3 x 3]\n\n\n\ncyl\n\n\nmean\n\n\nsd\n\n\n\n\n\n4\n\n\n26.664\n\n\n4.51\n\n\n\n\n6\n\n\n19.743\n\n\n1.454\n\n\n\n\n8\n\n\n15.1\n\n\n2.56\n\n\n\n\n\n\n\n\nMT[, .(mean(mpg), sd(mpg)), keyby = cyl]\ndata.table [3 x 3]\n\n\n\ncyl\n\n\nV1\n\n\nV2\n\n\n\n\n\n4\n\n\n26.664\n\n\n4.51\n\n\n\n\n6\n\n\n19.743\n\n\n1.454\n\n\n\n\n8\n\n\n15.1\n\n\n2.56\n\n\n\n\n\n\nMT[, .(mean_mpg = mean(mpg), sd_mpg = sd(mpg)), keyby = cyl]\ndata.table [3 x 3]\n\n\n\ncyl\n\n\nmean_mpg\n\n\nsd_mpg\n\n\n\n\n\n4\n\n\n26.664\n\n\n4.51\n\n\n\n\n6\n\n\n19.743\n\n\n1.454\n\n\n\n\n8\n\n\n15.1\n\n\n2.56\n\n\n\n\n\n\nMT[, lapply(.(mpg), \\(x) list(mean(x), sd(x))) |> rbindlist(), keyby = cyl]\ndata.table [3 x 3]\n\n\n\ncyl\n\n\nV1\n\n\nV2\n\n\n\n\n\n4\n\n\n26.664\n\n\n4.51\n\n\n\n\n6\n\n\n19.743\n\n\n1.454\n\n\n\n\n8\n\n\n15.1\n\n\n2.56\n\n\n\n\n\nWith column names:\n\nMT[, \n  lapply(.SD, \\(x) list(mean_mpg = mean(x), sd_mpg = sd(x))) |> rbindlist(), \n  keyby = cyl, .SDcols = \"mpg\"\n]\ndata.table [3 x 3]\n\n\n\ncyl\n\n\nmean_mpg\n\n\nsd_mpg\n\n\n\n\n\n4\n\n\n26.664\n\n\n4.51\n\n\n\n\n6\n\n\n19.743\n\n\n1.454\n\n\n\n\n8\n\n\n15.1\n\n\n2.56\n\n\n\n\n\n\nMT[, \n  lapply(.SD, \\(x) list(mean = mean(x), sd = sd(x))) |> rbindlist(idcol = \"Var\"), \n  keyby = cyl, .SDcols = \"mpg\"\n]\ndata.table [3 x 4]\n\n\n\ncyl\n\n\nVar\n\n\nmean\n\n\nsd\n\n\n\n\n\n4\n\n\nmpg\n\n\n26.664\n\n\n4.51\n\n\n\n\n6\n\n\nmpg\n\n\n19.743\n\n\n1.454\n\n\n\n\n8\n\n\nmpg\n\n\n15.1\n\n\n2.56\n\n\n\n\n\n\n\n\nApply multiple functions to multiple columns:\n\n\n\n\n\n\nNote\n\n\n\nDepending on the output we want (i.e. having the function’s output as columns or rows), we can either provide a list of functions to apply (list_of_fns), or a function returning a list (fn_returning_list).\n\n\n\ncols <- c(\"mpg\", \"hp\")\n\nlist_of_fns <- list(mean = \\(x) mean(x), sd = \\(x) sd(x))\n\nfn_returning_list <- \\(x) list(mean = mean(x), sd = sd(x))\n\n\n\nTidyverse\ndata.table\n\n\n\nOne column per function, one row per variable:\n\nmtcars |> \n  group_by(cyl) |> \n  summarize(map_dfr(across(all_of(cols)), fn_returning_list, .id = \"Var\")) |> \n  ungroup()\ndata.frame [6 x 4]\n\n\n\ncyl\n\n\nVar\n\n\nmean\n\n\nsd\n\n\n\n\n\n4\n\n\nmpg\n\n\n26.664\n\n\n4.51\n\n\n\n\n4\n\n\nhp\n\n\n82.636\n\n\n20.935\n\n\n\n\n6\n\n\nmpg\n\n\n19.743\n\n\n1.454\n\n\n\n\n6\n\n\nhp\n\n\n122.286\n\n\n24.26\n\n\n\n\n8\n\n\nmpg\n\n\n15.1\n\n\n2.56\n\n\n\n\n8\n\n\nhp\n\n\n209.214\n\n\n50.977\n\n\n\n\n\nOne column per variable, one row per function:\n\nmtcars |> \n  group_by(cyl) |> \n  summarize(map_dfr(list_of_fns, \\(f) map(across(all_of(cols)), f), .id = \"Fn\")) |> \n  ungroup()\ndata.frame [6 x 4]\n\n\n\ncyl\n\n\nFn\n\n\nmpg\n\n\nhp\n\n\n\n\n\n4\n\n\nmean\n\n\n26.664\n\n\n82.636\n\n\n\n\n4\n\n\nsd\n\n\n4.51\n\n\n20.935\n\n\n\n\n6\n\n\nmean\n\n\n19.743\n\n\n122.286\n\n\n\n\n6\n\n\nsd\n\n\n1.454\n\n\n24.26\n\n\n\n\n8\n\n\nmean\n\n\n15.1\n\n\n209.214\n\n\n\n\n8\n\n\nsd\n\n\n2.56\n\n\n50.977\n\n\n\n\n\nOne column per function/variable combination:\n\nmtcars |> \n  group_by(cyl) |> \n  summarize(across(all_of(cols), list_of_fns, .names = \"{col}.{fn}\")) |> \n  ungroup()\ndata.frame [3 x 5]\n\n\n\ncyl\n\n\nmpg.mean\n\n\nmpg.sd\n\n\nhp.mean\n\n\nhp.sd\n\n\n\n\n\n4\n\n\n26.664\n\n\n4.51\n\n\n82.636\n\n\n20.935\n\n\n\n\n6\n\n\n19.743\n\n\n1.454\n\n\n122.286\n\n\n24.26\n\n\n\n\n8\n\n\n15.1\n\n\n2.56\n\n\n209.214\n\n\n50.977\n\n\n\n\n\n\n\nOne column per function, one row per variable:\n\nMT[, \n  lapply(.SD, fn_returning_list) |> rbindlist(idcol = \"Var\"), \n  keyby = cyl, .SDcols = cols\n]\ndata.table [6 x 4]\n\n\n\ncyl\n\n\nVar\n\n\nmean\n\n\nsd\n\n\n\n\n\n4\n\n\nmpg\n\n\n26.664\n\n\n4.51\n\n\n\n\n4\n\n\nhp\n\n\n82.636\n\n\n20.935\n\n\n\n\n6\n\n\nmpg\n\n\n19.743\n\n\n1.454\n\n\n\n\n6\n\n\nhp\n\n\n122.286\n\n\n24.26\n\n\n\n\n8\n\n\nmpg\n\n\n15.1\n\n\n2.56\n\n\n\n\n8\n\n\nhp\n\n\n209.214\n\n\n50.977\n\n\n\n\n\nOne column per variable, one row per function:\n\nMT[, \n  lapply(list_of_fns, \\(f) lapply(.SD, f)) |> rbindlist(idcol = \"Fn\"), \n  keyby = cyl, .SDcols = cols\n]\ndata.table [6 x 4]\n\n\n\ncyl\n\n\nFn\n\n\nmpg\n\n\nhp\n\n\n\n\n\n4\n\n\nmean\n\n\n26.664\n\n\n82.636\n\n\n\n\n4\n\n\nsd\n\n\n4.51\n\n\n20.935\n\n\n\n\n6\n\n\nmean\n\n\n19.743\n\n\n122.286\n\n\n\n\n6\n\n\nsd\n\n\n1.454\n\n\n24.26\n\n\n\n\n8\n\n\nmean\n\n\n15.1\n\n\n209.214\n\n\n\n\n8\n\n\nsd\n\n\n2.56\n\n\n50.977\n\n\n\n\n\nOne column per function/variable combination:\n\nMT[, \n  lapply(.SD, fn_returning_list) |> \n    unlist(recursive = FALSE), # do.call(c, args = _)\n  keyby = cyl, .SDcols = cols\n]\ndata.table [3 x 5]\n\n\n\ncyl\n\n\nmpg.mean\n\n\nmpg.sd\n\n\nhp.mean\n\n\nhp.sd\n\n\n\n\n\n4\n\n\n26.664\n\n\n4.51\n\n\n82.636\n\n\n20.935\n\n\n\n\n6\n\n\n19.743\n\n\n1.454\n\n\n122.286\n\n\n24.26\n\n\n\n\n8\n\n\n15.1\n\n\n2.56\n\n\n209.214\n\n\n50.977\n\n\n\n\n\nDifferent column order & naming scheme:\n\nMT[, \n  lapply(list_of_fns, \\(f) lapply(.SD, f)) |> \n    unlist(recursive = FALSE), # do.call(c, args = _)\n  keyby = cyl, .SDcols = cols\n]\ndata.table [3 x 5]\n\n\n\ncyl\n\n\nmean.mpg\n\n\nmean.hp\n\n\nsd.mpg\n\n\nsd.hp\n\n\n\n\n\n4\n\n\n26.664\n\n\n82.636\n\n\n4.51\n\n\n20.935\n\n\n\n\n6\n\n\n19.743\n\n\n122.286\n\n\n1.454\n\n\n24.26\n\n\n\n\n8\n\n\n15.1\n\n\n209.214\n\n\n2.56\n\n\n50.977\n\n\n\n\n\nUsing dcast (see next section):\n\ndcast(MT, cyl ~ ., fun.agg = list_of_fns, value.var = cols) # list(mean, sd)\ndata.table [3 x 5]\n\n\n\ncyl\n\n\nmpg_mean\n\n\nhp_mean\n\n\nmpg_sd\n\n\nhp_sd\n\n\n\n\n\n4\n\n\n26.664\n\n\n82.636\n\n\n4.51\n\n\n20.935\n\n\n\n\n6\n\n\n19.743\n\n\n122.286\n\n\n1.454\n\n\n24.26\n\n\n\n\n8\n\n\n15.1\n\n\n209.214\n\n\n2.56\n\n\n50.977"
  },
  {
    "objectID": "content/posts/data.table/index.html#melt-longer",
    "href": "content/posts/data.table/index.html#melt-longer",
    "title": "Tidyverse <-> data.table",
    "section": "\n2.1 Melt / Longer",
    "text": "2.1 Melt / Longer\nData:\n\n\n\n\nFAM1\ndata.table [5 x 5]\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\n\n\n\n\nFAM2\ndata.table [5 x 8]\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\ngender_child1\n\n\ngender_child2\n\n\ngender_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n1\n\n\n2\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n2\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n2\n\n\n2\n\n\n1\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n2\n\n\n1\n\n\nNA\n\n\n\n\n\nOne group of columns –> single value column\n\nFAM1 |> pivot_longer(cols = matches(\"dob_\"), names_to = \"variable\")\ndata.frame [15 x 4]\n\n\n\nfamily_id\n\n\nage_mother\n\n\nvariable\n\n\nvalue\n\n\n\n\n\n1\n\n\n30\n\n\ndob_child1\n\n\n1998-11-26\n\n\n\n\n1\n\n\n30\n\n\ndob_child2\n\n\n2000-01-29\n\n\n\n\n1\n\n\n30\n\n\ndob_child3\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\ndob_child1\n\n\n1996-06-22\n\n\n\n\n2\n\n\n27\n\n\ndob_child2\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\ndob_child3\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\ndob_child1\n\n\n2002-07-11\n\n\n\n\n3\n\n\n26\n\n\ndob_child2\n\n\n2004-04-05\n\n\n\n\n3\n\n\n26\n\n\ndob_child3\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\ndob_child1\n\n\n2004-10-10\n\n\n\n\n4\n\n\n32\n\n\ndob_child2\n\n\n2009-08-27\n\n\n\n\n4\n\n\n32\n\n\ndob_child3\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\ndob_child1\n\n\n2000-12-05\n\n\n\n\n5\n\n\n29\n\n\ndob_child2\n\n\n2005-02-28\n\n\n\n\n5\n\n\n29\n\n\ndob_child3\n\n\nNA\n\n\n\nFAM1 |> melt(measure.vars = c(\"dob_child1\", \"dob_child2\", \"dob_child3\"))\ndata.table [15 x 4]\n\n\n\nfamily_id\n\n\nage_mother\n\n\nvariable\n\n\nvalue\n\n\n\n\n\n1\n\n\n30\n\n\ndob_child1\n\n\n1998-11-26\n\n\n\n\n2\n\n\n27\n\n\ndob_child1\n\n\n1996-06-22\n\n\n\n\n3\n\n\n26\n\n\ndob_child1\n\n\n2002-07-11\n\n\n\n\n4\n\n\n32\n\n\ndob_child1\n\n\n2004-10-10\n\n\n\n\n5\n\n\n29\n\n\ndob_child1\n\n\n2000-12-05\n\n\n\n\n1\n\n\n30\n\n\ndob_child2\n\n\n2000-01-29\n\n\n\n\n2\n\n\n27\n\n\ndob_child2\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\ndob_child2\n\n\n2004-04-05\n\n\n\n\n4\n\n\n32\n\n\ndob_child2\n\n\n2009-08-27\n\n\n\n\n5\n\n\n29\n\n\ndob_child2\n\n\n2005-02-28\n\n\n\n\n1\n\n\n30\n\n\ndob_child3\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\ndob_child3\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\ndob_child3\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\ndob_child3\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\ndob_child3\n\n\nNA\n\n\n\nFAM1 |> melt(measure.vars = patterns(\"^dob_\"))\ndata.table [15 x 4]\n\n\n\nfamily_id\n\n\nage_mother\n\n\nvariable\n\n\nvalue\n\n\n\n\n\n1\n\n\n30\n\n\ndob_child1\n\n\n1998-11-26\n\n\n\n\n2\n\n\n27\n\n\ndob_child1\n\n\n1996-06-22\n\n\n\n\n3\n\n\n26\n\n\ndob_child1\n\n\n2002-07-11\n\n\n\n\n4\n\n\n32\n\n\ndob_child1\n\n\n2004-10-10\n\n\n\n\n5\n\n\n29\n\n\ndob_child1\n\n\n2000-12-05\n\n\n\n\n1\n\n\n30\n\n\ndob_child2\n\n\n2000-01-29\n\n\n\n\n2\n\n\n27\n\n\ndob_child2\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\ndob_child2\n\n\n2004-04-05\n\n\n\n\n4\n\n\n32\n\n\ndob_child2\n\n\n2009-08-27\n\n\n\n\n5\n\n\n29\n\n\ndob_child2\n\n\n2005-02-28\n\n\n\n\n1\n\n\n30\n\n\ndob_child3\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\ndob_child3\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\ndob_child3\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\ndob_child3\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\ndob_child3\n\n\nNA\n\n\n\n\n\nOne group of columns –> multiple value columns\n\nFAM1 |> melt(measure.vars = patterns(child1 = \"child1$\", child2 = \"child2$|child3$\"))\ndata.table [10 x 5]\n\n\n\nfamily_id\n\n\nage_mother\n\n\nvariable\n\n\nchild1\n\n\nchild2\n\n\n\n\n\n1\n\n\n30\n\n\n1\n\n\n1998-11-26\n\n\n2000-01-29\n\n\n\n\n2\n\n\n27\n\n\n1\n\n\n1996-06-22\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n1\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n\n\n4\n\n\n32\n\n\n1\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n\n\n5\n\n\n29\n\n\n1\n\n\n2000-12-05\n\n\n2005-02-28\n\n\n\n\n1\n\n\n30\n\n\n2\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n2\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2\n\n\nNA\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2\n\n\nNA\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2\n\n\nNA\n\n\nNA\n\n\n\n\n\n\n2.1.1 Merging multiple yes/no columns:\nMelting multiple presence/absence columns into a single variable:\n\n\n\n\nmovies_wide\ndata.frame [3 x 4]\n\n\n\nID\n\n\naction\n\n\nadventure\n\n\nanimation\n\n\n\n\n\n1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n2\n\n\n1\n\n\n1\n\n\n0\n\n\n\n\n3\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n\n\npivot_longer(\n    movies_wide, -ID, names_to = \"Genre\", \n    values_transform = \\(x) ifelse(x == 0, NA, x), values_drop_na = TRUE\n  ) |> select(-value)\ndata.frame [6 x 2]\n\n\n\nID\n\n\nGenre\n\n\n\n\n\n1\n\n\naction\n\n\n\n\n2\n\n\naction\n\n\n\n\n2\n\n\nadventure\n\n\n\n\n3\n\n\naction\n\n\n\n\n3\n\n\nadventure\n\n\n\n\n3\n\n\nanimation\n\n\n\n\n\n\nmelt(MOVIES_WIDE, id.vars = \"ID\", variable.name = \"Genre\")[value != 0][order(ID), -\"value\"]\ndata.table [6 x 2]\n\n\n\nID\n\n\nGenre\n\n\n\n\n\n1\n\n\naction\n\n\n\n\n2\n\n\naction\n\n\n\n\n2\n\n\nadventure\n\n\n\n\n3\n\n\naction\n\n\n\n\n3\n\n\nadventure\n\n\n\n\n3\n\n\nanimation\n\n\n\n\n\n\n2.1.2 Partial pivot:\nMultiple groups of columns –> Multiple value columns\nManually:\n\ncolA <- str_subset(colnames(FAM2), \"^dob\")\ncolB <- str_subset(colnames(FAM2), \"^gender\")\n\nFAM2 |> melt(measure.vars = list(colA, colB), value.name = c(\"dob\", \"gender\"), variable.name = \"child\")\ndata.table [15 x 5]\n\n\n\nfamily_id\n\n\nage_mother\n\n\nchild\n\n\ndob\n\n\ngender\n\n\n\n\n\n1\n\n\n30\n\n\n1\n\n\n1998-11-26\n\n\n1\n\n\n\n\n2\n\n\n27\n\n\n1\n\n\n1996-06-22\n\n\n2\n\n\n\n\n3\n\n\n26\n\n\n1\n\n\n2002-07-11\n\n\n2\n\n\n\n\n4\n\n\n32\n\n\n1\n\n\n2004-10-10\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n1\n\n\n2000-12-05\n\n\n2\n\n\n\n\n1\n\n\n30\n\n\n2\n\n\n2000-01-29\n\n\n2\n\n\n\n\n2\n\n\n27\n\n\n2\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2\n\n\n2004-04-05\n\n\n2\n\n\n\n\n4\n\n\n32\n\n\n2\n\n\n2009-08-27\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n2\n\n\n2005-02-28\n\n\n1\n\n\n\n\n1\n\n\n30\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n3\n\n\n2007-09-02\n\n\n1\n\n\n\n\n4\n\n\n32\n\n\n3\n\n\n2012-07-21\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n\n\nFAM2 |> melt(measure.vars = list(a, b), value.name = c(\"dob\", \"gender\"), variable.name = \"child\") |> \n  substitute2(env = list(a = I(str_subset(colnames(FAM2), \"^dob\")), b = I(str_subset(colnames(FAM2), \"^gender\")))) |> eval()\ndata.table [15 x 5]\n\n\n\nfamily_id\n\n\nage_mother\n\n\nchild\n\n\ndob\n\n\ngender\n\n\n\n\n\n1\n\n\n30\n\n\n1\n\n\n1998-11-26\n\n\n1\n\n\n\n\n2\n\n\n27\n\n\n1\n\n\n1996-06-22\n\n\n2\n\n\n\n\n3\n\n\n26\n\n\n1\n\n\n2002-07-11\n\n\n2\n\n\n\n\n4\n\n\n32\n\n\n1\n\n\n2004-10-10\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n1\n\n\n2000-12-05\n\n\n2\n\n\n\n\n1\n\n\n30\n\n\n2\n\n\n2000-01-29\n\n\n2\n\n\n\n\n2\n\n\n27\n\n\n2\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2\n\n\n2004-04-05\n\n\n2\n\n\n\n\n4\n\n\n32\n\n\n2\n\n\n2009-08-27\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n2\n\n\n2005-02-28\n\n\n1\n\n\n\n\n1\n\n\n30\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n3\n\n\n2007-09-02\n\n\n1\n\n\n\n\n4\n\n\n32\n\n\n3\n\n\n2012-07-21\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n\nUsing .value:\n\n\n\n\n\n\nTip\n\n\n\nUsing the .value special identifier allows to do a “half” pivot: the values that would be listed as rows under .value are instead used as columns.\n\n\n\nFAM2 |> pivot_longer(cols = matches(\"^dob|^gender\"), names_to = c(\".value\", \"child\"), names_sep = \"_child\")\ndata.frame [15 x 5]\n\n\n\nfamily_id\n\n\nage_mother\n\n\nchild\n\n\ndob\n\n\ngender\n\n\n\n\n\n1\n\n\n30\n\n\n1\n\n\n1998-11-26\n\n\n1\n\n\n\n\n1\n\n\n30\n\n\n2\n\n\n2000-01-29\n\n\n2\n\n\n\n\n1\n\n\n30\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1\n\n\n1996-06-22\n\n\n2\n\n\n\n\n2\n\n\n27\n\n\n2\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n1\n\n\n2002-07-11\n\n\n2\n\n\n\n\n3\n\n\n26\n\n\n2\n\n\n2004-04-05\n\n\n2\n\n\n\n\n3\n\n\n26\n\n\n3\n\n\n2007-09-02\n\n\n1\n\n\n\n\n4\n\n\n32\n\n\n1\n\n\n2004-10-10\n\n\n1\n\n\n\n\n4\n\n\n32\n\n\n2\n\n\n2009-08-27\n\n\n1\n\n\n\n\n4\n\n\n32\n\n\n3\n\n\n2012-07-21\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n1\n\n\n2000-12-05\n\n\n2\n\n\n\n\n5\n\n\n29\n\n\n2\n\n\n2005-02-28\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\nFAM2 |> melt(measure.vars = patterns(\"^dob\", \"^gender\"), value.name = c(\"dob\", \"gender\"), variable.name = \"child\")\ndata.table [15 x 5]\n\n\n\nfamily_id\n\n\nage_mother\n\n\nchild\n\n\ndob\n\n\ngender\n\n\n\n\n\n1\n\n\n30\n\n\n1\n\n\n1998-11-26\n\n\n1\n\n\n\n\n2\n\n\n27\n\n\n1\n\n\n1996-06-22\n\n\n2\n\n\n\n\n3\n\n\n26\n\n\n1\n\n\n2002-07-11\n\n\n2\n\n\n\n\n4\n\n\n32\n\n\n1\n\n\n2004-10-10\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n1\n\n\n2000-12-05\n\n\n2\n\n\n\n\n1\n\n\n30\n\n\n2\n\n\n2000-01-29\n\n\n2\n\n\n\n\n2\n\n\n27\n\n\n2\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2\n\n\n2004-04-05\n\n\n2\n\n\n\n\n4\n\n\n32\n\n\n2\n\n\n2009-08-27\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n2\n\n\n2005-02-28\n\n\n1\n\n\n\n\n1\n\n\n30\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n3\n\n\n2007-09-02\n\n\n1\n\n\n\n\n4\n\n\n32\n\n\n3\n\n\n2012-07-21\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n\nUsing measure and value.name:\n\n\n\n\n\n\nWarning\n\n\n\ndata.table only\n\n\n\nFAM2 |> melt(measure.vars = measure(value.name, child = \\(x) as.integer(x), sep = \"_child\"))\ndata.table [15 x 5]\n\n\n\nfamily_id\n\n\nage_mother\n\n\nchild\n\n\ndob\n\n\ngender\n\n\n\n\n\n1\n\n\n30\n\n\n1\n\n\n1998-11-26\n\n\n1\n\n\n\n\n2\n\n\n27\n\n\n1\n\n\n1996-06-22\n\n\n2\n\n\n\n\n3\n\n\n26\n\n\n1\n\n\n2002-07-11\n\n\n2\n\n\n\n\n4\n\n\n32\n\n\n1\n\n\n2004-10-10\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n1\n\n\n2000-12-05\n\n\n2\n\n\n\n\n1\n\n\n30\n\n\n2\n\n\n2000-01-29\n\n\n2\n\n\n\n\n2\n\n\n27\n\n\n2\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2\n\n\n2004-04-05\n\n\n2\n\n\n\n\n4\n\n\n32\n\n\n2\n\n\n2009-08-27\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n2\n\n\n2005-02-28\n\n\n1\n\n\n\n\n1\n\n\n30\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n3\n\n\n2007-09-02\n\n\n1\n\n\n\n\n4\n\n\n32\n\n\n3\n\n\n2012-07-21\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\nFAM2 |> melt(measure.vars = measurev(list(value.name = NULL, child = as.integer), pattern = \"(.*)_child(\\\\d{1})\"))\ndata.table [15 x 5]\n\n\n\nfamily_id\n\n\nage_mother\n\n\nchild\n\n\ndob\n\n\ngender\n\n\n\n\n\n1\n\n\n30\n\n\n1\n\n\n1998-11-26\n\n\n1\n\n\n\n\n2\n\n\n27\n\n\n1\n\n\n1996-06-22\n\n\n2\n\n\n\n\n3\n\n\n26\n\n\n1\n\n\n2002-07-11\n\n\n2\n\n\n\n\n4\n\n\n32\n\n\n1\n\n\n2004-10-10\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n1\n\n\n2000-12-05\n\n\n2\n\n\n\n\n1\n\n\n30\n\n\n2\n\n\n2000-01-29\n\n\n2\n\n\n\n\n2\n\n\n27\n\n\n2\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2\n\n\n2004-04-05\n\n\n2\n\n\n\n\n4\n\n\n32\n\n\n2\n\n\n2009-08-27\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n2\n\n\n2005-02-28\n\n\n1\n\n\n\n\n1\n\n\n30\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n3\n\n\n2007-09-02\n\n\n1\n\n\n\n\n4\n\n\n32\n\n\n3\n\n\n2012-07-21\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n3\n\n\nNA\n\n\nNA"
  },
  {
    "objectID": "content/posts/data.table/index.html#dcast-wider",
    "href": "content/posts/data.table/index.html#dcast-wider",
    "title": "Tidyverse <-> data.table",
    "section": "\n2.2 Dcast / Wider:",
    "text": "2.2 Dcast / Wider:\nGeneral idea:\n- Pivot around the combination of id.vars (LHS of the formula)\n- The measure.vars (RHS of the formula) are the ones whose values become column names\n- The value.var are the ones the values are taken from to fill the new columns\nData:\n\n(FAM1L <- FAM1 |> melt(measure.vars = c(\"dob_child1\", \"dob_child2\", \"dob_child3\")))\ndata.table [15 x 4]\n\n\n\nfamily_id\n\n\nage_mother\n\n\nvariable\n\n\nvalue\n\n\n\n\n\n1\n\n\n30\n\n\ndob_child1\n\n\n1998-11-26\n\n\n\n\n2\n\n\n27\n\n\ndob_child1\n\n\n1996-06-22\n\n\n\n\n3\n\n\n26\n\n\ndob_child1\n\n\n2002-07-11\n\n\n\n\n4\n\n\n32\n\n\ndob_child1\n\n\n2004-10-10\n\n\n\n\n5\n\n\n29\n\n\ndob_child1\n\n\n2000-12-05\n\n\n\n\n1\n\n\n30\n\n\ndob_child2\n\n\n2000-01-29\n\n\n\n\n2\n\n\n27\n\n\ndob_child2\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\ndob_child2\n\n\n2004-04-05\n\n\n\n\n4\n\n\n32\n\n\ndob_child2\n\n\n2009-08-27\n\n\n\n\n5\n\n\n29\n\n\ndob_child2\n\n\n2005-02-28\n\n\n\n\n1\n\n\n30\n\n\ndob_child3\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\ndob_child3\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\ndob_child3\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\ndob_child3\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\ndob_child3\n\n\nNA\n\n\n\n(FAM2L <- FAM2 |> melt(measure.vars = measure(value.name, child = \\(.x) as.integer(.x), sep = \"_child\")))\ndata.table [15 x 5]\n\n\n\nfamily_id\n\n\nage_mother\n\n\nchild\n\n\ndob\n\n\ngender\n\n\n\n\n\n1\n\n\n30\n\n\n1\n\n\n1998-11-26\n\n\n1\n\n\n\n\n2\n\n\n27\n\n\n1\n\n\n1996-06-22\n\n\n2\n\n\n\n\n3\n\n\n26\n\n\n1\n\n\n2002-07-11\n\n\n2\n\n\n\n\n4\n\n\n32\n\n\n1\n\n\n2004-10-10\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n1\n\n\n2000-12-05\n\n\n2\n\n\n\n\n1\n\n\n30\n\n\n2\n\n\n2000-01-29\n\n\n2\n\n\n\n\n2\n\n\n27\n\n\n2\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2\n\n\n2004-04-05\n\n\n2\n\n\n\n\n4\n\n\n32\n\n\n2\n\n\n2009-08-27\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n2\n\n\n2005-02-28\n\n\n1\n\n\n\n\n1\n\n\n30\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n3\n\n\n2007-09-02\n\n\n1\n\n\n\n\n4\n\n\n32\n\n\n3\n\n\n2012-07-21\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n\nBasic pivot wider:\n\nFAM1L |> pivot_wider(id_cols = c(\"family_id\", \"age_mother\"), names_from = \"variable\")\ndata.frame [5 x 5]\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\nFAM1L |> dcast(family_id + age_mother ~ variable)\ndata.table [5 x 5]\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\nUsing all the columns as IDs:\n\n\n\n\n\n\nNote\n\n\n\nBy default, id_cols = everything()\n\n\n\nFAM1L |> pivot_wider(names_from = variable)\ndata.frame [5 x 5]\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\n\n\n\n\n\n\nNote\n\n\n\n... => “every unused column”\n\n\n\nFAM1L |> dcast(... ~ variable)\ndata.table [5 x 5]\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\nMultiple value columns –> Multiple groups of columns:\n\nFAM2L |> pivot_wider(\n  id_cols = c(\"family_id\", \"age_mother\"), values_from = c(\"dob\", \"gender\"), \n  names_from = \"child\", names_sep = \"_child\"\n)\ndata.frame [5 x 8]\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\ngender_child1\n\n\ngender_child2\n\n\ngender_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n1\n\n\n2\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n2\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n2\n\n\n2\n\n\n1\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n2\n\n\n1\n\n\nNA\n\n\n\n\n\n\nFAM2L |> dcast(family_id + age_mother ~ child, value.var = c(\"dob\", \"gender\"), sep = \"_child\")\ndata.table [5 x 8]\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\ngender_child1\n\n\ngender_child2\n\n\ngender_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n1\n\n\n2\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n2\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n2\n\n\n2\n\n\n1\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n2\n\n\n1\n\n\nNA\n\n\n\nFAM2L |> dcast(... ~ child, value.var = c(\"dob\", \"gender\"), sep = \"_child\")\ndata.table [5 x 8]\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\ngender_child1\n\n\ngender_child2\n\n\ngender_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n1\n\n\n2\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n2\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n2\n\n\n2\n\n\n1\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n2\n\n\n1\n\n\nNA\n\n\n\n\n\nDynamic names in the formula:\n\nvar_name <- \"variable\"\n\n\nFAM1L |> pivot_wider(id_cols = c(family_id, age_mother), names_from = {{ var_name }})\ndata.frame [5 x 5]\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\n\nFAM1L |> dcast(family_id + age_mother ~ base::get(var_name))\ndata.table [5 x 5]\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\nFAM1L |> dcast(family_id + age_mother ~ v1) |> substitute2(env = list(v1 = var_name)) |> eval()\ndata.table [5 x 5]\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\nMultiple variables:\n\nid_vars <- c(\"family_id\", \"age_mother\")\n\n\nFAM1L |> pivot_wider(id_cols = all_of(id_vars), names_from = variable)\ndata.frame [5 x 5]\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\n\nFAM1L |> dcast(str_c(str_c(id_vars, collapse = \" + \"), \" ~ variable\"))\ndata.table [5 x 5]\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\n\nFAM1L |> dcast(v1 + v2 ~ variable) |> substitute2(env = list(v1 = id_vars[1], v2 = id_vars[2])) |> eval()\ndata.table [5 x 5]\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\n\n2.2.1 Renaming (prefix/suffix) the columns:\n\nFAM1L |> pivot_wider(names_from = variable, values_from = value, names_prefix = \"Attr: \")\ndata.frame [5 x 5]\n\n\n\nfamily_id\n\n\nage_mother\n\n\nAttr: dob_child1\n\n\nAttr: dob_child2\n\n\nAttr: dob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\nFAM1L |> pivot_wider(names_from = variable, values_from = value, names_glue = \"Attr: {variable}\")\ndata.frame [5 x 5]\n\n\n\nfamily_id\n\n\nage_mother\n\n\nAttr: dob_child1\n\n\nAttr: dob_child2\n\n\nAttr: dob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\n\nFAM1L |> dcast(family_id + age_mother ~ paste0(\"Attr: \", variable))\ndata.table [5 x 5]\n\n\n\nfamily_id\n\n\nage_mother\n\n\nAttr: dob_child1\n\n\nAttr: dob_child2\n\n\nAttr: dob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\n\n2.2.2 Unused combinations:\n\n\n\n\n\n\nWarning\n\n\n\nThe logic is inverted between dplyr (keep) and data.table (drop)\n\n\n\nFAM1L |> pivot_wider(names_from = variable, values_from = value, id_expand = TRUE, names_expand = FALSE) # (keep_id, keep_names)\ndata.frame [25 x 5]\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n1\n\n\n26\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n1\n\n\n27\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n1\n\n\n29\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n1\n\n\n32\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n26\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n29\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n30\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n32\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n3\n\n\n27\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n29\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n30\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n32\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n\n[ omitted 10 entries ]\n\n\nFAM1L |> dcast(family_id + age_mother ~ variable, drop = c(F, T)) # (drop_LHS, drop_RHS)\ndata.table [25 x 5]\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n1\n\n\n26\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n1\n\n\n27\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n1\n\n\n29\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n1\n\n\n32\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n26\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n29\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n30\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n32\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n3\n\n\n27\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n29\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n30\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n32\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n\n[ omitted 10 entries ]\n\n\n\n\n\n2.2.3 Subsetting:\n\n\n\n\n\n\nNote\n\n\n\nAFAIK, pivot_wider can’t do this on it’s own.\n\n\n\nFAM1L |> filter(value >= lubridate::ymd(20030101)) |> \n  pivot_wider(id_cols = c(\"family_id\", \"age_mother\"), names_from = \"variable\")\ndata.frame [3 x 5]\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n3\n\n\n26\n\n\nNA\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n5\n\n\n29\n\n\nNA\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\n\nFAM1L |> dcast(family_id + age_mother ~ variable, subset = .(value >= lubridate::ymd(20030101)))\ndata.table [3 x 5]\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n3\n\n\n26\n\n\nNA\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\nNA\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\n\n2.2.4 Aggregating:\nNot specifying the column holding the measure vars (the names) will result in an empty column counting the number of columns that should have been created for all the measures.\n\nFAM1L |> dcast(family_id + age_mother ~ .)\ndata.table [5 x 3]\n\n\n\nfamily_id\n\n\nage_mother\n\n\n.\n\n\n\n\n\n1\n\n\n30\n\n\n3\n\n\n\n\n2\n\n\n27\n\n\n3\n\n\n\n\n3\n\n\n26\n\n\n3\n\n\n\n\n4\n\n\n32\n\n\n3\n\n\n\n\n5\n\n\n29\n\n\n3\n\n\n\n\n\nWe can customize that default behavior using the fun.aggregate argument:\nHere, we count the number of child for each each combination of (family_id + age_mother) -> sum all non-NA value\n\nFAM1L |> pivot_wider(id_cols = c(family_id, age_mother), names_from = variable, values_fn = \\(.x) sum(!is.na(.x))) |>\n  rowwise() |> mutate(child_count = sum(c_across(matches(\"_child\")))) |> ungroup()\ndata.frame [5 x 6]\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\nchild_count\n\n\n\n\n\n1\n\n\n30\n\n\n1\n\n\n1\n\n\n0\n\n\n2\n\n\n\n\n2\n\n\n27\n\n\n1\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n3\n\n\n26\n\n\n1\n\n\n1\n\n\n1\n\n\n3\n\n\n\n\n4\n\n\n32\n\n\n1\n\n\n1\n\n\n1\n\n\n3\n\n\n\n\n5\n\n\n29\n\n\n1\n\n\n1\n\n\n0\n\n\n2\n\n\n\nFAM1L |> pivot_wider(id_cols = c(family_id, age_mother), names_from = variable, values_fn = \\(.x) sum(!is.na(.x))) |>\n  mutate(child_count = apply(select(cur_data(), matches(\"_child\")), 1, \\(r) sum(r)))\ndata.frame [5 x 6]\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\nchild_count\n\n\n\n\n\n1\n\n\n30\n\n\n1\n\n\n1\n\n\n0\n\n\n2\n\n\n\n\n2\n\n\n27\n\n\n1\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n3\n\n\n26\n\n\n1\n\n\n1\n\n\n1\n\n\n3\n\n\n\n\n4\n\n\n32\n\n\n1\n\n\n1\n\n\n1\n\n\n3\n\n\n\n\n5\n\n\n29\n\n\n1\n\n\n1\n\n\n0\n\n\n2\n\n\n\n\n\n\n(FAM1L |> dcast(family_id + age_mother ~ ., fun.agg = \\(.x) sum(!is.na(.x))) |> setnames(\".\", \"child_count\"))\ndata.table [5 x 3]\n\n\n\nfamily_id\n\n\nage_mother\n\n\nchild_count\n\n\n\n\n\n1\n\n\n30\n\n\n2\n\n\n\n\n2\n\n\n27\n\n\n1\n\n\n\n\n3\n\n\n26\n\n\n3\n\n\n\n\n4\n\n\n32\n\n\n3\n\n\n\n\n5\n\n\n29\n\n\n2\n\n\n\n\n\nApplying multiple fun.agg:\nData:\n\n(DTL <- data.table(\n  id1 = sample(5, 20, TRUE), \n  id2 = sample(2, 20, TRUE), \n  group = sample(letters[1:2], 20, TRUE), \n  v1 = runif(20), \n  v2 = 1L)\n)\ndata.table [20 x 5]\n\n\n\nid1\n\n\nid2\n\n\ngroup\n\n\nv1\n\n\nv2\n\n\n\n\n\n2\n\n\n2\n\n\nb\n\n\n0.6\n\n\n1\n\n\n\n\n3\n\n\n1\n\n\nb\n\n\n0.895\n\n\n1\n\n\n\n\n4\n\n\n1\n\n\na\n\n\n0.223\n\n\n1\n\n\n\n\n4\n\n\n2\n\n\nb\n\n\n0.195\n\n\n1\n\n\n\n\n5\n\n\n2\n\n\nb\n\n\n0.693\n\n\n1\n\n\n\n\n3\n\n\n2\n\n\nb\n\n\n0.65\n\n\n1\n\n\n\n\n3\n\n\n2\n\n\nb\n\n\n0.586\n\n\n1\n\n\n\n\n5\n\n\n2\n\n\na\n\n\n0.489\n\n\n1\n\n\n\n\n2\n\n\n2\n\n\nb\n\n\n0.338\n\n\n1\n\n\n\n\n5\n\n\n2\n\n\nb\n\n\n0.294\n\n\n1\n\n\n\n\n2\n\n\n2\n\n\nb\n\n\n0.811\n\n\n1\n\n\n\n\n4\n\n\n1\n\n\na\n\n\n0.71\n\n\n1\n\n\n\n\n5\n\n\n2\n\n\na\n\n\n0.727\n\n\n1\n\n\n\n\n3\n\n\n1\n\n\nb\n\n\n0.348\n\n\n1\n\n\n\n\n3\n\n\n2\n\n\nb\n\n\n0.628\n\n\n1\n\n\n\n\n\n[ omitted 5 entries ]\n\n\n\n\nMultiple fun.agg applied to one variable:\n\nDTL |> dcast(id1 + id2 ~ group, fun.aggregate = list(sum, mean), value.var = \"v1\")\ndata.table [9 x 6]\n\n\n\nid1\n\n\nid2\n\n\nv1_sum_a\n\n\nv1_sum_b\n\n\nv1_mean_a\n\n\nv1_mean_b\n\n\n\n\n\n1\n\n\n2\n\n\n0.888\n\n\n0\n\n\n0.888\n\n\nNaN\n\n\n\n\n2\n\n\n1\n\n\n0\n\n\n0.795\n\n\nNaN\n\n\n0.795\n\n\n\n\n2\n\n\n2\n\n\n0\n\n\n1.919\n\n\nNaN\n\n\n0.48\n\n\n\n\n3\n\n\n1\n\n\n0\n\n\n1.244\n\n\nNaN\n\n\n0.622\n\n\n\n\n3\n\n\n2\n\n\n0\n\n\n1.864\n\n\nNaN\n\n\n0.621\n\n\n\n\n4\n\n\n1\n\n\n0.933\n\n\n0\n\n\n0.466\n\n\nNaN\n\n\n\n\n4\n\n\n2\n\n\n0\n\n\n0.195\n\n\nNaN\n\n\n0.195\n\n\n\n\n5\n\n\n1\n\n\n0.482\n\n\n0\n\n\n0.482\n\n\nNaN\n\n\n\n\n5\n\n\n2\n\n\n1.217\n\n\n1.751\n\n\n0.608\n\n\n0.584\n\n\n\n\n\nMultiple fun.agg to multiple value.var (all combinations):\n\nDTL |> dcast(id1 + id2 ~ group, fun.aggregate = list(sum, mean), value.var = c(\"v1\", \"v2\"))\ndata.table [9 x 10]\n\n\n\nid1\n\n\nid2\n\n\nv1_sum_a\n\n\nv1_sum_b\n\n\nv2_sum_a\n\n\nv2_sum_b\n\n\nv1_mean_a\n\n\nv1_mean_b\n\n\nv2_mean_a\n\n\nv2_mean_b\n\n\n\n\n\n1\n\n\n2\n\n\n0.888\n\n\n0\n\n\n1\n\n\n0\n\n\n0.888\n\n\nNaN\n\n\n1\n\n\nNaN\n\n\n\n\n2\n\n\n1\n\n\n0\n\n\n0.795\n\n\n0\n\n\n1\n\n\nNaN\n\n\n0.795\n\n\nNaN\n\n\n1\n\n\n\n\n2\n\n\n2\n\n\n0\n\n\n1.919\n\n\n0\n\n\n4\n\n\nNaN\n\n\n0.48\n\n\nNaN\n\n\n1\n\n\n\n\n3\n\n\n1\n\n\n0\n\n\n1.244\n\n\n0\n\n\n2\n\n\nNaN\n\n\n0.622\n\n\nNaN\n\n\n1\n\n\n\n\n3\n\n\n2\n\n\n0\n\n\n1.864\n\n\n0\n\n\n3\n\n\nNaN\n\n\n0.621\n\n\nNaN\n\n\n1\n\n\n\n\n4\n\n\n1\n\n\n0.933\n\n\n0\n\n\n2\n\n\n0\n\n\n0.466\n\n\nNaN\n\n\n1\n\n\nNaN\n\n\n\n\n4\n\n\n2\n\n\n0\n\n\n0.195\n\n\n0\n\n\n1\n\n\nNaN\n\n\n0.195\n\n\nNaN\n\n\n1\n\n\n\n\n5\n\n\n1\n\n\n0.482\n\n\n0\n\n\n1\n\n\n0\n\n\n0.482\n\n\nNaN\n\n\n1\n\n\nNaN\n\n\n\n\n5\n\n\n2\n\n\n1.217\n\n\n1.751\n\n\n2\n\n\n3\n\n\n0.608\n\n\n0.584\n\n\n1\n\n\n1\n\n\n\n\n\nMultiple fun.agg and multiple value.var (one-to-one):\nHere, we apply sum to v1 (for both group a & b), and mean to v2 (for both group a & b)\n\nDTL |> dcast(id1 + id2 ~ group, fun.aggregate = list(sum, mean), value.var = list(\"v1\", \"v2\"))\ndata.table [9 x 6]\n\n\n\nid1\n\n\nid2\n\n\nv1_sum_a\n\n\nv1_sum_b\n\n\nv2_mean_a\n\n\nv2_mean_b\n\n\n\n\n\n1\n\n\n2\n\n\n0.888\n\n\n0\n\n\n1\n\n\nNaN\n\n\n\n\n2\n\n\n1\n\n\n0\n\n\n0.795\n\n\nNaN\n\n\n1\n\n\n\n\n2\n\n\n2\n\n\n0\n\n\n1.919\n\n\nNaN\n\n\n1\n\n\n\n\n3\n\n\n1\n\n\n0\n\n\n1.244\n\n\nNaN\n\n\n1\n\n\n\n\n3\n\n\n2\n\n\n0\n\n\n1.864\n\n\nNaN\n\n\n1\n\n\n\n\n4\n\n\n1\n\n\n0.933\n\n\n0\n\n\n1\n\n\nNaN\n\n\n\n\n4\n\n\n2\n\n\n0\n\n\n0.195\n\n\nNaN\n\n\n1\n\n\n\n\n5\n\n\n1\n\n\n0.482\n\n\n0\n\n\n1\n\n\nNaN\n\n\n\n\n5\n\n\n2\n\n\n1.217\n\n\n1.751\n\n\n1\n\n\n1\n\n\n\n\n\n\n2.2.5 One-hot encoding:\nMaking each level of a variable into a presence/absence column:\n\n\n\n\nmovies_long\ndata.frame [6 x 3]\n\n\n\nID\n\n\nGenre\n\n\nOtherCol\n\n\n\n\n\n1\n\n\naction\n\n\n0.807\n\n\n\n\n2\n\n\naction\n\n\n0.019\n\n\n\n\n2\n\n\nadventure\n\n\n0.525\n\n\n\n\n3\n\n\naction\n\n\n0.856\n\n\n\n\n3\n\n\nadventure\n\n\n0.14\n\n\n\n\n3\n\n\nanimation\n\n\n0.424\n\n\n\n\n\n\npivot_wider(\n  movies_long, names_from = \"Genre\", values_from = \"Genre\", \n  values_fn = \\(x) !is.na(x), values_fill = FALSE\n)\ndata.frame [6 x 5]\n\n\n\nID\n\n\nOtherCol\n\n\naction\n\n\nadventure\n\n\nanimation\n\n\n\n\n\n1\n\n\n0.807\n\n\nTRUE\n\n\nFALSE\n\n\nFALSE\n\n\n\n\n2\n\n\n0.019\n\n\nTRUE\n\n\nFALSE\n\n\nFALSE\n\n\n\n\n2\n\n\n0.525\n\n\nFALSE\n\n\nTRUE\n\n\nFALSE\n\n\n\n\n3\n\n\n0.856\n\n\nTRUE\n\n\nFALSE\n\n\nFALSE\n\n\n\n\n3\n\n\n0.14\n\n\nFALSE\n\n\nTRUE\n\n\nFALSE\n\n\n\n\n3\n\n\n0.424\n\n\nFALSE\n\n\nFALSE\n\n\nTRUE\n\n\n\n\n\n\ndcast(\n  MOVIES_LONG, ... ~ Genre, value.var = \"Genre\", \n  fun.agg = \\(x) !is.na(x), fill = FALSE\n)\ndata.table [6 x 5]\n\n\n\nID\n\n\nOtherCol\n\n\naction\n\n\nadventure\n\n\nanimation\n\n\n\n\n\n1\n\n\n0.807\n\n\nTRUE\n\n\nFALSE\n\n\nFALSE\n\n\n\n\n2\n\n\n0.019\n\n\nTRUE\n\n\nFALSE\n\n\nFALSE\n\n\n\n\n2\n\n\n0.525\n\n\nFALSE\n\n\nTRUE\n\n\nFALSE\n\n\n\n\n3\n\n\n0.14\n\n\nFALSE\n\n\nTRUE\n\n\nFALSE\n\n\n\n\n3\n\n\n0.424\n\n\nFALSE\n\n\nFALSE\n\n\nTRUE\n\n\n\n\n3\n\n\n0.856\n\n\nTRUE\n\n\nFALSE\n\n\nFALSE"
  },
  {
    "objectID": "content/posts/data.table/index.html#outer-right-left",
    "href": "content/posts/data.table/index.html#outer-right-left",
    "title": "Tidyverse <-> data.table",
    "section": "\n3.1 Outer (right, left):",
    "text": "3.1 Outer (right, left):\nAppends data of one at the end of the other.\n\n\n\n\n\n\nNote\n\n\n\ndata.table doesn’t do left joins natively\n\n\nSubsetting DT1 by DT2:\n\n\n\n\n\n\nNote\n\n\n\nDT2 (everything) + DT1 (all columns, but only the rows that match those in DT1).\n> Looking up DT1’s rows using DT2 (or DT2’s key, if it has one) as an index.\n\n\nAs a right join:\n\nright_join(DT1, DT2, by = \"ID\") # DT1 into DT2\ndata.table [10 x 5]\n\n\n\nID\n\n\nA\n\n\nB\n\n\nC\n\n\nD\n\n\n\n\n\nE\n\n\n3\n\n\n16\n\n\n2\n\n\n12\n\n\n\n\nF\n\n\n1\n\n\n17\n\n\n3\n\n\n14\n\n\n\n\nG\n\n\n5\n\n\n13\n\n\n2\n\n\n17\n\n\n\n\nH\n\n\n4\n\n\n15\n\n\n5\n\n\n19\n\n\n\n\nI\n\n\n2\n\n\n10\n\n\n3\n\n\n16\n\n\n\n\nJ\n\n\n2\n\n\n18\n\n\n1\n\n\n18\n\n\n\n\nK\n\n\nNA\n\n\nNA\n\n\n3\n\n\n15\n\n\n\n\nL\n\n\nNA\n\n\nNA\n\n\n2\n\n\n13\n\n\n\n\nM\n\n\nNA\n\n\nNA\n\n\n2\n\n\n10\n\n\n\n\nN\n\n\nNA\n\n\nNA\n\n\n3\n\n\n11\n\n\n\nDT1[DT2, on = .(ID)]\ndata.table [10 x 5]\n\n\n\nID\n\n\nA\n\n\nB\n\n\nC\n\n\nD\n\n\n\n\n\nE\n\n\n3\n\n\n16\n\n\n2\n\n\n12\n\n\n\n\nF\n\n\n1\n\n\n17\n\n\n3\n\n\n14\n\n\n\n\nG\n\n\n5\n\n\n13\n\n\n2\n\n\n17\n\n\n\n\nH\n\n\n4\n\n\n15\n\n\n5\n\n\n19\n\n\n\n\nI\n\n\n2\n\n\n10\n\n\n3\n\n\n16\n\n\n\n\nJ\n\n\n2\n\n\n18\n\n\n1\n\n\n18\n\n\n\n\nK\n\n\nNA\n\n\nNA\n\n\n3\n\n\n15\n\n\n\n\nL\n\n\nNA\n\n\nNA\n\n\n2\n\n\n13\n\n\n\n\nM\n\n\nNA\n\n\nNA\n\n\n2\n\n\n10\n\n\n\n\nN\n\n\nNA\n\n\nNA\n\n\n3\n\n\n11\n\n\n\n\n\nAs a left join:\n\n\n\n\n\n\nNote\n\n\n\nNot exactly equivalent to the right join: same columns, but DT2 is first instead of DT1\n\n\n\nleft_join(DT2, DT1, by = \"ID\") # DT1 into DT2\ndata.table [10 x 5]\n\n\n\nID\n\n\nC\n\n\nD\n\n\nA\n\n\nB\n\n\n\n\n\nE\n\n\n2\n\n\n12\n\n\n3\n\n\n16\n\n\n\n\nF\n\n\n3\n\n\n14\n\n\n1\n\n\n17\n\n\n\n\nG\n\n\n2\n\n\n17\n\n\n5\n\n\n13\n\n\n\n\nH\n\n\n5\n\n\n19\n\n\n4\n\n\n15\n\n\n\n\nI\n\n\n3\n\n\n16\n\n\n2\n\n\n10\n\n\n\n\nJ\n\n\n1\n\n\n18\n\n\n2\n\n\n18\n\n\n\n\nK\n\n\n3\n\n\n15\n\n\nNA\n\n\nNA\n\n\n\n\nL\n\n\n2\n\n\n13\n\n\nNA\n\n\nNA\n\n\n\n\nM\n\n\n2\n\n\n10\n\n\nNA\n\n\nNA\n\n\n\n\nN\n\n\n3\n\n\n11\n\n\nNA\n\n\nNA\n\n\n\ncopy(DT2)[DT1, c(\"A\", \"B\") := list(i.A, i.B), on = .(ID)][]\ndata.table [10 x 5]\n\n\n\nID\n\n\nC\n\n\nD\n\n\nA\n\n\nB\n\n\n\n\n\nE\n\n\n2\n\n\n12\n\n\n3\n\n\n16\n\n\n\n\nF\n\n\n3\n\n\n14\n\n\n1\n\n\n17\n\n\n\n\nG\n\n\n2\n\n\n17\n\n\n5\n\n\n13\n\n\n\n\nH\n\n\n5\n\n\n19\n\n\n4\n\n\n15\n\n\n\n\nI\n\n\n3\n\n\n16\n\n\n2\n\n\n10\n\n\n\n\nJ\n\n\n1\n\n\n18\n\n\n2\n\n\n18\n\n\n\n\nK\n\n\n3\n\n\n15\n\n\nNA\n\n\nNA\n\n\n\n\nL\n\n\n2\n\n\n13\n\n\nNA\n\n\nNA\n\n\n\n\nM\n\n\n2\n\n\n10\n\n\nNA\n\n\nNA\n\n\n\n\nN\n\n\n3\n\n\n11\n\n\nNA\n\n\nNA\n\n\n\n\n\nSubsetting DT2 by DT1:\n\n\n\n\n\n\nNote\n\n\n\nDT1 (everything) + DT2 (all columns, but only the rows that match those in DT1).\n> Looking up DT2’s rows using DT1 (or DT1’s key, if it has one) as an index.\n\n\nAs a right join:\n\nright_join(DT2, DT1, by = \"ID\") # DT2 into DT1\ndata.table [10 x 5]\n\n\n\nID\n\n\nC\n\n\nD\n\n\nA\n\n\nB\n\n\n\n\n\nE\n\n\n2\n\n\n12\n\n\n3\n\n\n16\n\n\n\n\nF\n\n\n3\n\n\n14\n\n\n1\n\n\n17\n\n\n\n\nG\n\n\n2\n\n\n17\n\n\n5\n\n\n13\n\n\n\n\nH\n\n\n5\n\n\n19\n\n\n4\n\n\n15\n\n\n\n\nI\n\n\n3\n\n\n16\n\n\n2\n\n\n10\n\n\n\n\nJ\n\n\n1\n\n\n18\n\n\n2\n\n\n18\n\n\n\n\nA\n\n\nNA\n\n\nNA\n\n\n1\n\n\n12\n\n\n\n\nB\n\n\nNA\n\n\nNA\n\n\n3\n\n\n11\n\n\n\n\nC\n\n\nNA\n\n\nNA\n\n\n2\n\n\n19\n\n\n\n\nD\n\n\nNA\n\n\nNA\n\n\n1\n\n\n14\n\n\n\nDT2[DT1, on = .(ID)]\ndata.table [10 x 5]\n\n\n\nID\n\n\nC\n\n\nD\n\n\nA\n\n\nB\n\n\n\n\n\nA\n\n\nNA\n\n\nNA\n\n\n1\n\n\n12\n\n\n\n\nB\n\n\nNA\n\n\nNA\n\n\n3\n\n\n11\n\n\n\n\nC\n\n\nNA\n\n\nNA\n\n\n2\n\n\n19\n\n\n\n\nD\n\n\nNA\n\n\nNA\n\n\n1\n\n\n14\n\n\n\n\nE\n\n\n2\n\n\n12\n\n\n3\n\n\n16\n\n\n\n\nF\n\n\n3\n\n\n14\n\n\n1\n\n\n17\n\n\n\n\nG\n\n\n2\n\n\n17\n\n\n5\n\n\n13\n\n\n\n\nH\n\n\n5\n\n\n19\n\n\n4\n\n\n15\n\n\n\n\nI\n\n\n3\n\n\n16\n\n\n2\n\n\n10\n\n\n\n\nJ\n\n\n1\n\n\n18\n\n\n2\n\n\n18\n\n\n\n\n\nAs a left join:\n\n\n\n\n\n\nNote\n\n\n\nNot exactly equivalent to the right join: same columns, but DT1 is first instead of DT2\n\n\n\nleft_join(DT1, DT2, by = \"ID\") # DT2 into DT1\ndata.table [10 x 5]\n\n\n\nID\n\n\nA\n\n\nB\n\n\nC\n\n\nD\n\n\n\n\n\nA\n\n\n1\n\n\n12\n\n\nNA\n\n\nNA\n\n\n\n\nB\n\n\n3\n\n\n11\n\n\nNA\n\n\nNA\n\n\n\n\nC\n\n\n2\n\n\n19\n\n\nNA\n\n\nNA\n\n\n\n\nD\n\n\n1\n\n\n14\n\n\nNA\n\n\nNA\n\n\n\n\nE\n\n\n3\n\n\n16\n\n\n2\n\n\n12\n\n\n\n\nF\n\n\n1\n\n\n17\n\n\n3\n\n\n14\n\n\n\n\nG\n\n\n5\n\n\n13\n\n\n2\n\n\n17\n\n\n\n\nH\n\n\n4\n\n\n15\n\n\n5\n\n\n19\n\n\n\n\nI\n\n\n2\n\n\n10\n\n\n3\n\n\n16\n\n\n\n\nJ\n\n\n2\n\n\n18\n\n\n1\n\n\n18\n\n\n\ncopy(DT1)[DT2, c(\"C\", \"D\") := list(i.C, i.D), on = .(ID)][]\ndata.table [10 x 5]\n\n\n\nID\n\n\nA\n\n\nB\n\n\nC\n\n\nD\n\n\n\n\n\nA\n\n\n1\n\n\n12\n\n\nNA\n\n\nNA\n\n\n\n\nB\n\n\n3\n\n\n11\n\n\nNA\n\n\nNA\n\n\n\n\nC\n\n\n2\n\n\n19\n\n\nNA\n\n\nNA\n\n\n\n\nD\n\n\n1\n\n\n14\n\n\nNA\n\n\nNA\n\n\n\n\nE\n\n\n3\n\n\n16\n\n\n2\n\n\n12\n\n\n\n\nF\n\n\n1\n\n\n17\n\n\n3\n\n\n14\n\n\n\n\nG\n\n\n5\n\n\n13\n\n\n2\n\n\n17\n\n\n\n\nH\n\n\n4\n\n\n15\n\n\n5\n\n\n19\n\n\n\n\nI\n\n\n2\n\n\n10\n\n\n3\n\n\n16\n\n\n\n\nJ\n\n\n2\n\n\n18\n\n\n1\n\n\n18"
  },
  {
    "objectID": "content/posts/data.table/index.html#full-outer",
    "href": "content/posts/data.table/index.html#full-outer",
    "title": "Tidyverse <-> data.table",
    "section": "\n3.2 Full (outer):",
    "text": "3.2 Full (outer):\n\nfull_join(DT1, DT2, by = \"ID\")\ndata.table [14 x 5]\n\n\n\nID\n\n\nA\n\n\nB\n\n\nC\n\n\nD\n\n\n\n\n\nA\n\n\n1\n\n\n12\n\n\nNA\n\n\nNA\n\n\n\n\nB\n\n\n3\n\n\n11\n\n\nNA\n\n\nNA\n\n\n\n\nC\n\n\n2\n\n\n19\n\n\nNA\n\n\nNA\n\n\n\n\nD\n\n\n1\n\n\n14\n\n\nNA\n\n\nNA\n\n\n\n\nE\n\n\n3\n\n\n16\n\n\n2\n\n\n12\n\n\n\n\nF\n\n\n1\n\n\n17\n\n\n3\n\n\n14\n\n\n\n\nG\n\n\n5\n\n\n13\n\n\n2\n\n\n17\n\n\n\n\nH\n\n\n4\n\n\n15\n\n\n5\n\n\n19\n\n\n\n\nI\n\n\n2\n\n\n10\n\n\n3\n\n\n16\n\n\n\n\nJ\n\n\n2\n\n\n18\n\n\n1\n\n\n18\n\n\n\n\nK\n\n\nNA\n\n\nNA\n\n\n3\n\n\n15\n\n\n\n\nL\n\n\nNA\n\n\nNA\n\n\n2\n\n\n13\n\n\n\n\nM\n\n\nNA\n\n\nNA\n\n\n2\n\n\n10\n\n\n\n\nN\n\n\nNA\n\n\nNA\n\n\n3\n\n\n11\n\n\n\ndata.table::merge.data.table(DT1, DT2, by = \"ID\", all = TRUE)\ndata.table [14 x 5]\n\n\n\nID\n\n\nA\n\n\nB\n\n\nC\n\n\nD\n\n\n\n\n\nA\n\n\n1\n\n\n12\n\n\nNA\n\n\nNA\n\n\n\n\nB\n\n\n3\n\n\n11\n\n\nNA\n\n\nNA\n\n\n\n\nC\n\n\n2\n\n\n19\n\n\nNA\n\n\nNA\n\n\n\n\nD\n\n\n1\n\n\n14\n\n\nNA\n\n\nNA\n\n\n\n\nE\n\n\n3\n\n\n16\n\n\n2\n\n\n12\n\n\n\n\nF\n\n\n1\n\n\n17\n\n\n3\n\n\n14\n\n\n\n\nG\n\n\n5\n\n\n13\n\n\n2\n\n\n17\n\n\n\n\nH\n\n\n4\n\n\n15\n\n\n5\n\n\n19\n\n\n\n\nI\n\n\n2\n\n\n10\n\n\n3\n\n\n16\n\n\n\n\nJ\n\n\n2\n\n\n18\n\n\n1\n\n\n18\n\n\n\n\nK\n\n\nNA\n\n\nNA\n\n\n3\n\n\n15\n\n\n\n\nL\n\n\nNA\n\n\nNA\n\n\n2\n\n\n13\n\n\n\n\nM\n\n\nNA\n\n\nNA\n\n\n2\n\n\n10\n\n\n\n\nN\n\n\nNA\n\n\nNA\n\n\n3\n\n\n11\n\n\n\n\n\nAlternatively:\n\nsetkey(DT1, ID)\nsetkey(DT2, ID)\n\n# Getting the union of the unique keys of both DT\nunique_keys <- union(DT1[, ID], DT2[, ID])\n\nDT1[DT2[unique_keys, on = \"ID\"]]\ndata.table [14 x 5]\n\n\n\nID\n\n\nA\n\n\nB\n\n\nC\n\n\nD\n\n\n\n\n\nA\n\n\n1\n\n\n12\n\n\nNA\n\n\nNA\n\n\n\n\nB\n\n\n3\n\n\n11\n\n\nNA\n\n\nNA\n\n\n\n\nC\n\n\n2\n\n\n19\n\n\nNA\n\n\nNA\n\n\n\n\nD\n\n\n1\n\n\n14\n\n\nNA\n\n\nNA\n\n\n\n\nE\n\n\n3\n\n\n16\n\n\n2\n\n\n12\n\n\n\n\nF\n\n\n1\n\n\n17\n\n\n3\n\n\n14\n\n\n\n\nG\n\n\n5\n\n\n13\n\n\n2\n\n\n17\n\n\n\n\nH\n\n\n4\n\n\n15\n\n\n5\n\n\n19\n\n\n\n\nI\n\n\n2\n\n\n10\n\n\n3\n\n\n16\n\n\n\n\nJ\n\n\n2\n\n\n18\n\n\n1\n\n\n18\n\n\n\n\nK\n\n\nNA\n\n\nNA\n\n\n3\n\n\n15\n\n\n\n\nL\n\n\nNA\n\n\nNA\n\n\n2\n\n\n13\n\n\n\n\nM\n\n\nNA\n\n\nNA\n\n\n2\n\n\n10\n\n\n\n\nN\n\n\nNA\n\n\nNA\n\n\n3\n\n\n11"
  },
  {
    "objectID": "content/posts/data.table/index.html#inner",
    "href": "content/posts/data.table/index.html#inner",
    "title": "Tidyverse <-> data.table",
    "section": "\n3.3 Inner:",
    "text": "3.3 Inner:\nOnly returns the ROWS matching both tables:\n- Inner: rows matching both DT1 and DT2, columns of both (add DT2’s columns to the right)\n- Semi: rows matching both DT1 and DT2, columns of first one\nInner:\n\ninner_join(DT1, DT2, by = \"ID\") \ndata.table [6 x 5]\n\n\n\nID\n\n\nA\n\n\nB\n\n\nC\n\n\nD\n\n\n\n\n\nE\n\n\n3\n\n\n16\n\n\n2\n\n\n12\n\n\n\n\nF\n\n\n1\n\n\n17\n\n\n3\n\n\n14\n\n\n\n\nG\n\n\n5\n\n\n13\n\n\n2\n\n\n17\n\n\n\n\nH\n\n\n4\n\n\n15\n\n\n5\n\n\n19\n\n\n\n\nI\n\n\n2\n\n\n10\n\n\n3\n\n\n16\n\n\n\n\nJ\n\n\n2\n\n\n18\n\n\n1\n\n\n18\n\n\n\nDT1[DT2, on = .(ID), nomatch = NULL]\ndata.table [6 x 5]\n\n\n\nID\n\n\nA\n\n\nB\n\n\nC\n\n\nD\n\n\n\n\n\nE\n\n\n3\n\n\n16\n\n\n2\n\n\n12\n\n\n\n\nF\n\n\n1\n\n\n17\n\n\n3\n\n\n14\n\n\n\n\nG\n\n\n5\n\n\n13\n\n\n2\n\n\n17\n\n\n\n\nH\n\n\n4\n\n\n15\n\n\n5\n\n\n19\n\n\n\n\nI\n\n\n2\n\n\n10\n\n\n3\n\n\n16\n\n\n\n\nJ\n\n\n2\n\n\n18\n\n\n1\n\n\n18\n\n\n\n\n\nSemi:\n\nsemi_join(DT1, DT2, by = \"ID\")\ndata.table [6 x 3]\n\n\n\nID\n\n\nA\n\n\nB\n\n\n\n\n\nE\n\n\n3\n\n\n16\n\n\n\n\nF\n\n\n1\n\n\n17\n\n\n\n\nG\n\n\n5\n\n\n13\n\n\n\n\nH\n\n\n4\n\n\n15\n\n\n\n\nI\n\n\n2\n\n\n10\n\n\n\n\nJ\n\n\n2\n\n\n18\n\n\n\nDT1[na.omit(DT1[DT2, on = .(ID), which = TRUE])]\ndata.table [6 x 3]\n\n\n\nID\n\n\nA\n\n\nB\n\n\n\n\n\nE\n\n\n3\n\n\n16\n\n\n\n\nF\n\n\n1\n\n\n17\n\n\n\n\nG\n\n\n5\n\n\n13\n\n\n\n\nH\n\n\n4\n\n\n15\n\n\n\n\nI\n\n\n2\n\n\n10\n\n\n\n\nJ\n\n\n2\n\n\n18\n\n\n\n\n\n\n\n\n\n\n\nNote\n\n\n\nwhich = TRUE returns the row numbers instead of the rows themselves."
  },
  {
    "objectID": "content/posts/data.table/index.html#anti",
    "href": "content/posts/data.table/index.html#anti",
    "title": "Tidyverse <-> data.table",
    "section": "\n3.4 Anti:",
    "text": "3.4 Anti:\nROWS of DT1 that are NOT in DT2, and only the columns of DT1.\n\nanti_join(DT1, DT2, by = \"ID\")\ndata.table [4 x 3]\n\n\n\nID\n\n\nA\n\n\nB\n\n\n\n\n\nA\n\n\n1\n\n\n12\n\n\n\n\nB\n\n\n3\n\n\n11\n\n\n\n\nC\n\n\n2\n\n\n19\n\n\n\n\nD\n\n\n1\n\n\n14\n\n\n\nDT1[!DT2, on = .(ID)]\ndata.table [4 x 3]\n\n\n\nID\n\n\nA\n\n\nB\n\n\n\n\n\nA\n\n\n1\n\n\n12\n\n\n\n\nB\n\n\n3\n\n\n11\n\n\n\n\nC\n\n\n2\n\n\n19\n\n\n\n\nD\n\n\n1\n\n\n14\n\n\n\n\n\nROWS of DT2 that are NOT in DT1, and only the columns of DT2.\n\nanti_join(DT2, DT1, by = \"ID\")\ndata.table [4 x 3]\n\n\n\nID\n\n\nC\n\n\nD\n\n\n\n\n\nK\n\n\n3\n\n\n15\n\n\n\n\nL\n\n\n2\n\n\n13\n\n\n\n\nM\n\n\n2\n\n\n10\n\n\n\n\nN\n\n\n3\n\n\n11\n\n\n\nDT2[!DT1, on = .(ID)]\ndata.table [4 x 3]\n\n\n\nID\n\n\nC\n\n\nD\n\n\n\n\n\nK\n\n\n3\n\n\n15\n\n\n\n\nL\n\n\n2\n\n\n13\n\n\n\n\nM\n\n\n2\n\n\n10\n\n\n\n\nN\n\n\n3\n\n\n11"
  },
  {
    "objectID": "content/posts/data.table/index.html#non-equi-joins",
    "href": "content/posts/data.table/index.html#non-equi-joins",
    "title": "Tidyverse <-> data.table",
    "section": "\n3.5 Non-equi joins:",
    "text": "3.5 Non-equi joins:\n\n\n\nDT1[DT2, on = .(ID, A <= C)]\ndata.table [10 x 4]\n\n\n\nID\n\n\nA\n\n\nB\n\n\nD\n\n\n\n\n\nE\n\n\n2\n\n\nNA\n\n\n12\n\n\n\n\nF\n\n\n3\n\n\n17\n\n\n14\n\n\n\n\nG\n\n\n2\n\n\nNA\n\n\n17\n\n\n\n\nH\n\n\n5\n\n\n15\n\n\n19\n\n\n\n\nI\n\n\n3\n\n\n10\n\n\n16\n\n\n\n\nJ\n\n\n1\n\n\nNA\n\n\n18\n\n\n\n\nK\n\n\n3\n\n\nNA\n\n\n15\n\n\n\n\nL\n\n\n2\n\n\nNA\n\n\n13\n\n\n\n\nM\n\n\n2\n\n\nNA\n\n\n10\n\n\n\n\nN\n\n\n3\n\n\nNA\n\n\n11"
  },
  {
    "objectID": "content/posts/data.table/index.html#rolling-joins",
    "href": "content/posts/data.table/index.html#rolling-joins",
    "title": "Tidyverse <-> data.table",
    "section": "\n3.6 Rolling joins:",
    "text": "3.6 Rolling joins:\n\nDT1[DT2, on = \"ID\", roll = TRUE]\ndata.table [10 x 5]\n\n\n\nID\n\n\nA\n\n\nB\n\n\nC\n\n\nD\n\n\n\n\n\nE\n\n\n3\n\n\n16\n\n\n2\n\n\n12\n\n\n\n\nF\n\n\n1\n\n\n17\n\n\n3\n\n\n14\n\n\n\n\nG\n\n\n5\n\n\n13\n\n\n2\n\n\n17\n\n\n\n\nH\n\n\n4\n\n\n15\n\n\n5\n\n\n19\n\n\n\n\nI\n\n\n2\n\n\n10\n\n\n3\n\n\n16\n\n\n\n\nJ\n\n\n2\n\n\n18\n\n\n1\n\n\n18\n\n\n\n\nK\n\n\n2\n\n\n18\n\n\n3\n\n\n15\n\n\n\n\nL\n\n\n2\n\n\n18\n\n\n2\n\n\n13\n\n\n\n\nM\n\n\n2\n\n\n18\n\n\n2\n\n\n10\n\n\n\n\nN\n\n\n2\n\n\n18\n\n\n3\n\n\n11\n\n\n\n\n\nInverse the rolling direction:\n\nDT1[DT2, on = \"ID\", roll = -Inf]\ndata.table [10 x 5]\n\n\n\nID\n\n\nA\n\n\nB\n\n\nC\n\n\nD\n\n\n\n\n\nE\n\n\n3\n\n\n16\n\n\n2\n\n\n12\n\n\n\n\nF\n\n\n1\n\n\n17\n\n\n3\n\n\n14\n\n\n\n\nG\n\n\n5\n\n\n13\n\n\n2\n\n\n17\n\n\n\n\nH\n\n\n4\n\n\n15\n\n\n5\n\n\n19\n\n\n\n\nI\n\n\n2\n\n\n10\n\n\n3\n\n\n16\n\n\n\n\nJ\n\n\n2\n\n\n18\n\n\n1\n\n\n18\n\n\n\n\nK\n\n\nNA\n\n\nNA\n\n\n3\n\n\n15\n\n\n\n\nL\n\n\nNA\n\n\nNA\n\n\n2\n\n\n13\n\n\n\n\nM\n\n\nNA\n\n\nNA\n\n\n2\n\n\n10\n\n\n\n\nN\n\n\nNA\n\n\nNA\n\n\n3\n\n\n11\n\n\n\n\n\n\nDT1[DT2, on = \"ID\", rollends = TRUE]\ndata.table [10 x 5]\n\n\n\nID\n\n\nA\n\n\nB\n\n\nC\n\n\nD\n\n\n\n\n\nE\n\n\n3\n\n\n16\n\n\n2\n\n\n12\n\n\n\n\nF\n\n\n1\n\n\n17\n\n\n3\n\n\n14\n\n\n\n\nG\n\n\n5\n\n\n13\n\n\n2\n\n\n17\n\n\n\n\nH\n\n\n4\n\n\n15\n\n\n5\n\n\n19\n\n\n\n\nI\n\n\n2\n\n\n10\n\n\n3\n\n\n16\n\n\n\n\nJ\n\n\n2\n\n\n18\n\n\n1\n\n\n18\n\n\n\n\nK\n\n\nNA\n\n\nNA\n\n\n3\n\n\n15\n\n\n\n\nL\n\n\nNA\n\n\nNA\n\n\n2\n\n\n13\n\n\n\n\nM\n\n\nNA\n\n\nNA\n\n\n2\n\n\n10\n\n\n\n\nN\n\n\nNA\n\n\nNA\n\n\n3\n\n\n11"
  },
  {
    "objectID": "content/posts/data.table/index.html#remove-na",
    "href": "content/posts/data.table/index.html#remove-na",
    "title": "Tidyverse <-> data.table",
    "section": "\n4.1 Remove NA:",
    "text": "4.1 Remove NA:\n\ntidyr::drop_na(IRIS, matches(\"Sepal\"))\ndata.table [150 x 5]\n\n\n\nSepal.Length\n\n\nSepal.Width\n\n\nPetal.Length\n\n\nPetal.Width\n\n\nSpecies\n\n\n\n\n\n5.1\n\n\n3.5\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.7\n\n\n3.2\n\n\n1.3\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.1\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5\n\n\n3.6\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.9\n\n\n1.7\n\n\n0.4\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.4\n\n\n1.4\n\n\n0.3\n\n\nsetosa\n\n\n\n\n5\n\n\n3.4\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.4\n\n\n2.9\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3.1\n\n\n1.5\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.7\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3.4\n\n\n1.6\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3\n\n\n1.4\n\n\n0.1\n\n\nsetosa\n\n\n\n\n4.3\n\n\n3\n\n\n1.1\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.8\n\n\n4\n\n\n1.2\n\n\n0.2\n\n\nsetosa\n\n\n\n\n\n[ omitted 135 entries ]\n\n\n\n\n\nna.omit(IRIS, cols = str_subset(colnames(IRIS), \"Sepal\"))\ndata.table [150 x 5]\n\n\n\nSepal.Length\n\n\nSepal.Width\n\n\nPetal.Length\n\n\nPetal.Width\n\n\nSpecies\n\n\n\n\n\n5.1\n\n\n3.5\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.7\n\n\n3.2\n\n\n1.3\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.1\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5\n\n\n3.6\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.9\n\n\n1.7\n\n\n0.4\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.4\n\n\n1.4\n\n\n0.3\n\n\nsetosa\n\n\n\n\n5\n\n\n3.4\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.4\n\n\n2.9\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3.1\n\n\n1.5\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.7\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3.4\n\n\n1.6\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3\n\n\n1.4\n\n\n0.1\n\n\nsetosa\n\n\n\n\n4.3\n\n\n3\n\n\n1.1\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.8\n\n\n4\n\n\n1.2\n\n\n0.2\n\n\nsetosa\n\n\n\n\n\n[ omitted 135 entries ]"
  },
  {
    "objectID": "content/posts/data.table/index.html#unite",
    "href": "content/posts/data.table/index.html#unite",
    "title": "Tidyverse <-> data.table",
    "section": "\n4.2 Unite:",
    "text": "4.2 Unite:\nCombine multiple columns into a single one:\n\nmtcars |> tidyr::unite(\"x\", gear, carb, sep = \"_\")\ndata.frame [32 x 10]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\nx\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4_4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4_4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4_1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3_1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3_2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3_1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3_4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4_2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4_2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4_4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4_4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3_3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3_3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3_3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3_4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\ncopy(MT)[, x := paste(gear, carb, sep = \"_\")][]\ndata.table [32 x 12]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nx\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n4_4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n4_4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n4_1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n3_1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n3_2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n3_1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n3_4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4_2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4_2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n4_4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n4_4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n3_3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n3_3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n3_3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n3_4\n\n\n\n\n\n[ omitted 17 entries ]"
  },
  {
    "objectID": "content/posts/data.table/index.html#extract-separate",
    "href": "content/posts/data.table/index.html#extract-separate",
    "title": "Tidyverse <-> data.table",
    "section": "\n4.3 Extract / Separate:",
    "text": "4.3 Extract / Separate:\nSeparate a row into multiple columns based on a pattern (extract) or a separator (separate):\n\nMT.ext <- MT[, .(x = str_c(gear, carb, sep = \"_\"))]\n\n\nMT.ext |> tidyr::extract(col = x, into = c(\"a\", \"b\"), regex = \"(.*)_(.*)\", remove = F)\ndata.table [32 x 3]\n\n\n\nx\n\n\na\n\n\nb\n\n\n\n\n\n4_4\n\n\n4\n\n\n4\n\n\n\n\n4_4\n\n\n4\n\n\n4\n\n\n\n\n4_1\n\n\n4\n\n\n1\n\n\n\n\n3_1\n\n\n3\n\n\n1\n\n\n\n\n3_2\n\n\n3\n\n\n2\n\n\n\n\n3_1\n\n\n3\n\n\n1\n\n\n\n\n3_4\n\n\n3\n\n\n4\n\n\n\n\n4_2\n\n\n4\n\n\n2\n\n\n\n\n4_2\n\n\n4\n\n\n2\n\n\n\n\n4_4\n\n\n4\n\n\n4\n\n\n\n\n4_4\n\n\n4\n\n\n4\n\n\n\n\n3_3\n\n\n3\n\n\n3\n\n\n\n\n3_3\n\n\n3\n\n\n3\n\n\n\n\n3_3\n\n\n3\n\n\n3\n\n\n\n\n3_4\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\nMT.ext[, c(\"a\", \"b\") := tstrsplit(x, \"_\", fixed = TRUE)][] \ndata.table [32 x 3]\n\n\n\nx\n\n\na\n\n\nb\n\n\n\n\n\n4_4\n\n\n4\n\n\n4\n\n\n\n\n4_4\n\n\n4\n\n\n4\n\n\n\n\n4_1\n\n\n4\n\n\n1\n\n\n\n\n3_1\n\n\n3\n\n\n1\n\n\n\n\n3_2\n\n\n3\n\n\n2\n\n\n\n\n3_1\n\n\n3\n\n\n1\n\n\n\n\n3_4\n\n\n3\n\n\n4\n\n\n\n\n4_2\n\n\n4\n\n\n2\n\n\n\n\n4_2\n\n\n4\n\n\n2\n\n\n\n\n4_4\n\n\n4\n\n\n4\n\n\n\n\n4_4\n\n\n4\n\n\n4\n\n\n\n\n3_3\n\n\n3\n\n\n3\n\n\n\n\n3_3\n\n\n3\n\n\n3\n\n\n\n\n3_3\n\n\n3\n\n\n3\n\n\n\n\n3_4\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]"
  },
  {
    "objectID": "content/posts/data.table/index.html#separate-rows",
    "href": "content/posts/data.table/index.html#separate-rows",
    "title": "Tidyverse <-> data.table",
    "section": "\n4.4 Separate rows:",
    "text": "4.4 Separate rows:\nSeparate a row into multiple rows based on a separator:\nData\n\n(SP <- data.table(\n  val = c(1,\"2,3\",4), \n  date = as.Date(c(\"2020-01-01\", \"2020-01-02\", \"2020-01-03\"), origin = \"1970-01-01\")\n  )\n)\ndata.table [3 x 2]\n\n\n\nval\n\n\ndate\n\n\n\n\n\n1\n\n\n2020-01-01\n\n\n\n\n2,3\n\n\n2020-01-02\n\n\n\n\n4\n\n\n2020-01-03\n\n\n\n\n\n\nSP |> tidyr::separate_rows(val, sep = \",\", convert = TRUE)\ndata.frame [4 x 2]\n\n\n\nval\n\n\ndate\n\n\n\n\n\n1\n\n\n2020-01-01\n\n\n\n\n2\n\n\n2020-01-02\n\n\n\n\n3\n\n\n2020-01-02\n\n\n\n\n4\n\n\n2020-01-03\n\n\n\n\n\nSolution 1:\n\ncopy(SP)[, c(V1 = strsplit(val, \",\", fixed = TRUE), .SD), by = val][, let(val = V1, V1 = NULL)][]\ndata.table [4 x 2]\n\n\n\nval\n\n\ndate\n\n\n\n\n\n1\n\n\n2020-01-01\n\n\n\n\n2\n\n\n2020-01-02\n\n\n\n\n3\n\n\n2020-01-02\n\n\n\n\n4\n\n\n2020-01-03\n\n\n\n\n\nSolution 2:\n\nSP[, strsplit(val, \",\", fixed = TRUE), by = val][SP, on = \"val\"][, let(val = V1, V1 = NULL)][]\ndata.table [4 x 2]\n\n\n\nval\n\n\ndate\n\n\n\n\n\n1\n\n\n2020-01-01\n\n\n\n\n2\n\n\n2020-01-02\n\n\n\n\n3\n\n\n2020-01-02\n\n\n\n\n4\n\n\n2020-01-03\n\n\n\n\n\nSolution 3:\n(With type conversion)\n\nSP[, unlist(tstrsplit(val, \",\", type.convert = TRUE)), by = val][SP, on = \"val\"][, let(val = V1, V1 = NULL)][]\ndata.table [4 x 2]\n\n\n\nval\n\n\ndate\n\n\n\n\n\n1\n\n\n2020-01-01\n\n\n\n\n2\n\n\n2020-01-02\n\n\n\n\n3\n\n\n2020-01-02\n\n\n\n\n4\n\n\n2020-01-03\n\n\n\n\n\nSolution 4:\n\ncopy(SP)[rep(1:.N, lengths(strsplit(val, \",\")))][, val := strsplit(val, \",\"), by = val][]\ndata.table [4 x 2]\n\n\n\nval\n\n\ndate\n\n\n\n\n\n1\n\n\n2020-01-01\n\n\n\n\n2\n\n\n2020-01-02\n\n\n\n\n3\n\n\n2020-01-02\n\n\n\n\n4\n\n\n2020-01-03\n\n\n\n\n\n\n\n\n(With type conversion)\n\n\n\n\ncopy(SP)[rep(1:.N, lengths(strsplit(val, \",\")))\n       ][, val := strsplit(val, \",\"), by = val\n       ][, val := utils::type.convert(val, as.is = T)][]\ndata.table [4 x 2]\n\n\n\nval\n\n\ndate\n\n\n\n\n\n1\n\n\n2020-01-01\n\n\n\n\n2\n\n\n2020-01-02\n\n\n\n\n3\n\n\n2020-01-02\n\n\n\n\n4\n\n\n2020-01-03"
  },
  {
    "objectID": "content/posts/data.table/index.html#duplicates",
    "href": "content/posts/data.table/index.html#duplicates",
    "title": "Tidyverse <-> data.table",
    "section": "\n4.5 Duplicates:",
    "text": "4.5 Duplicates:\n\n4.5.1 Duplicated rows:\nFinding duplicated rows:\n\nmtcars |> group_by(mpg, hp) |> filter(n() > 1)\ndata.frame [2 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\nMT[, if(.N > 1) .SD, by = .(mpg, hp)]\ndata.table [2 x 11]\n\n\n\nmpg\n\n\nhp\n\n\ncyl\n\n\ndisp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n110\n\n\n6\n\n\n160\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n110\n\n\n6\n\n\n160\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n\nOnly keeping non-duplicated rows:\n\n\n\n\n\n\nNote\n\n\n\nThis is different from distinct/unique, which will keep one of the duplicated rows of each group.\nThis removes all groups which have duplicated rows.\n\n\nSolution 1:\n\nmtcars |> group_by(mpg, hp) |> filter(n() == 1)\ndata.frame [30 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n10.4\n\n\n8\n\n\n460\n\n\n215\n\n\n3\n\n\n5.424\n\n\n17.82\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.7\n\n\n8\n\n\n440\n\n\n230\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 15 entries ]\n\n\nMT[, if(.N == 1) .SD, by = .(mpg, hp)]\ndata.table [30 x 11]\n\n\n\nmpg\n\n\nhp\n\n\ncyl\n\n\ndisp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n22.8\n\n\n93\n\n\n4\n\n\n108\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n110\n\n\n6\n\n\n258\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n175\n\n\n8\n\n\n360\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n105\n\n\n6\n\n\n225\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n245\n\n\n8\n\n\n360\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n62\n\n\n4\n\n\n146.7\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n95\n\n\n4\n\n\n140.8\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n123\n\n\n6\n\n\n167.6\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n123\n\n\n6\n\n\n167.6\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n180\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n180\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n180\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n205\n\n\n8\n\n\n472\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n10.4\n\n\n215\n\n\n8\n\n\n460\n\n\n3\n\n\n5.424\n\n\n17.82\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.7\n\n\n230\n\n\n8\n\n\n440\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 15 entries ]\n\n\n\n\nSolution 2:\nMore convoluted\n\nmtcars |> group_by(mpg, hp) |> filter(n() > 1) |> anti_join(mtcars, y = _)\ndata.frame [30 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n10.4\n\n\n8\n\n\n460\n\n\n215\n\n\n3\n\n\n5.424\n\n\n17.82\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.7\n\n\n8\n\n\n440\n\n\n230\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 15 entries ]\n\n\nMT[!MT[, if(.N > 1) .SD, by = .(mpg, hp)], on = colnames(MT)]\ndata.table [30 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n10.4\n\n\n8\n\n\n460\n\n\n215\n\n\n3\n\n\n5.424\n\n\n17.82\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.7\n\n\n8\n\n\n440\n\n\n230\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 15 entries ]\n\n\nfsetdiff(MT, setcolorder(MT[, if(.N > 1) .SD, by = .(mpg, hp)], colnames(MT)))\ndata.table [30 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n10.4\n\n\n8\n\n\n460\n\n\n215\n\n\n3\n\n\n5.424\n\n\n17.82\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.7\n\n\n8\n\n\n440\n\n\n230\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 15 entries ]\n\n\n\n\n\n4.5.2 Duplicated values (per row):\n\n(DUPED <- data.table(\n    A = c(\"A1\", \"A2\", \"B3\", \"A4\"), \n    B = c(\"B1\", \"B2\", \"B3\", \"B4\"), \n    C = c(\"A1\", \"C2\", \"D3\", \"C4\"), \n    D = c(\"A1\", \"D2\", \"D3\", \"D4\")\n  )\n)\ndata.table [4 x 4]\n\n\n\nA\n\n\nB\n\n\nC\n\n\nD\n\n\n\n\n\nA1\n\n\nB1\n\n\nA1\n\n\nA1\n\n\n\n\nA2\n\n\nB2\n\n\nC2\n\n\nD2\n\n\n\n\nB3\n\n\nB3\n\n\nD3\n\n\nD3\n\n\n\n\nA4\n\n\nB4\n\n\nC4\n\n\nD4\n\n\n\n\n\n\nDUPED |> mutate(Repeats = apply(cur_data(), 1, \\(r) r[which(duplicated(r))] |> unique() |> str_c(collapse = \", \")))\ndata.table [4 x 5]\n\n\n\nA\n\n\nB\n\n\nC\n\n\nD\n\n\nRepeats\n\n\n\n\n\nA1\n\n\nB1\n\n\nA1\n\n\nA1\n\n\nA1\n\n\n\n\nA2\n\n\nB2\n\n\nC2\n\n\nD2\n\n\n\n\n\n\nB3\n\n\nB3\n\n\nD3\n\n\nD3\n\n\nB3, D3\n\n\n\n\nA4\n\n\nB4\n\n\nC4\n\n\nD4\n\n\n\n\n\n\n\n\nDUPED[, Repeats := apply(.SD, 1, \\(r) r[which(duplicated(r))] |> unique() |> str_c(collapse = \", \"))][]\ndata.table [4 x 5]\n\n\n\nA\n\n\nB\n\n\nC\n\n\nD\n\n\nRepeats\n\n\n\n\n\nA1\n\n\nB1\n\n\nA1\n\n\nA1\n\n\nA1\n\n\n\n\nA2\n\n\nB2\n\n\nC2\n\n\nD2\n\n\n\n\n\n\nB3\n\n\nB3\n\n\nD3\n\n\nD3\n\n\nB3, D3\n\n\n\n\nA4\n\n\nB4\n\n\nC4\n\n\nD4\n\n\n\n\n\n\n\nWith duplication counter:\n\ndup_counts <- function(v) {\n  rles <- as.data.table(unclass(rle(v[which(duplicated(v))])))[, lengths := lengths + 1]\n  paste(apply(rles, 1, \\(r) paste0(r[2], \" (\", r[1], \")\")), collapse = \", \")\n}\n\n\nDUPED |> mutate(Repeats = apply(cur_data(), 1, \\(r) dup_counts(r)))\ndata.table [4 x 5]\n\n\n\nA\n\n\nB\n\n\nC\n\n\nD\n\n\nRepeats\n\n\n\n\n\nA1\n\n\nB1\n\n\nA1\n\n\nA1\n\n\nA1 (4)\n\n\n\n\nA2\n\n\nB2\n\n\nC2\n\n\nD2\n\n\n\n\n\n\nB3\n\n\nB3\n\n\nD3\n\n\nD3\n\n\nB3 (2), D3 (2)\n\n\n\n\nA4\n\n\nB4\n\n\nC4\n\n\nD4\n\n\n\n\n\n\n\n\nDUPED[, Repeats := apply(.SD, 1, \\(r) dup_counts(r))][]\ndata.table [4 x 5]\n\n\n\nA\n\n\nB\n\n\nC\n\n\nD\n\n\nRepeats\n\n\n\n\n\nA1\n\n\nB1\n\n\nA1\n\n\nA1\n\n\nA1 (4)\n\n\n\n\nA2\n\n\nB2\n\n\nC2\n\n\nD2\n\n\n\n\n\n\nB3\n\n\nB3\n\n\nD3\n\n\nD3\n\n\nB3 (2), D3 (2)\n\n\n\n\nA4\n\n\nB4\n\n\nC4\n\n\nD4"
  },
  {
    "objectID": "content/posts/data.table/index.html#expand-complete",
    "href": "content/posts/data.table/index.html#expand-complete",
    "title": "Tidyverse <-> data.table",
    "section": "\n4.6 Expand & Complete:",
    "text": "4.6 Expand & Complete:\nHere, we are missing an entry for person B on year 2010, that we want to fill:\n\n(CAR <- data.table(\n    year = c(2010,2011,2012,2013,2014,2015,2011,2012,2013,2014,2015), \n    person = c(\"A\",\"A\",\"A\",\"A\",\"A\",\"A\", \"B\",\"B\",\"B\",\"B\",\"B\"),\n    car = c(\"BMW\", \"BMW\", \"AUDI\", \"AUDI\", \"AUDI\", \"Mercedes\", \"Citroen\",\"Citroen\", \"Citroen\", \"Toyota\", \"Toyota\")\n  )\n)\ndata.table [11 x 3]\n\n\n\nyear\n\n\nperson\n\n\ncar\n\n\n\n\n\n2 010\n\n\nA\n\n\nBMW\n\n\n\n\n2 011\n\n\nA\n\n\nBMW\n\n\n\n\n2 012\n\n\nA\n\n\nAUDI\n\n\n\n\n2 013\n\n\nA\n\n\nAUDI\n\n\n\n\n2 014\n\n\nA\n\n\nAUDI\n\n\n\n\n2 015\n\n\nA\n\n\nMercedes\n\n\n\n\n2 011\n\n\nB\n\n\nCitroen\n\n\n\n\n2 012\n\n\nB\n\n\nCitroen\n\n\n\n\n2 013\n\n\nB\n\n\nCitroen\n\n\n\n\n2 014\n\n\nB\n\n\nToyota\n\n\n\n\n2 015\n\n\nB\n\n\nToyota\n\n\n\n\n\n\n4.6.1 Expand:\n\ntidyr::expand(CAR, person, year)\ndata.frame [12 x 2]\n\n\n\nperson\n\n\nyear\n\n\n\n\n\nA\n\n\n2 010\n\n\n\n\nA\n\n\n2 011\n\n\n\n\nA\n\n\n2 012\n\n\n\n\nA\n\n\n2 013\n\n\n\n\nA\n\n\n2 014\n\n\n\n\nA\n\n\n2 015\n\n\n\n\nB\n\n\n2 010\n\n\n\n\nB\n\n\n2 011\n\n\n\n\nB\n\n\n2 012\n\n\n\n\nB\n\n\n2 013\n\n\n\n\nB\n\n\n2 014\n\n\n\n\nB\n\n\n2 015\n\n\n\n\n\n\nCJ(CAR$person, CAR$year, unique = TRUE)\ndata.table [12 x 2]\n\n\n\nV1\n\n\nV2\n\n\n\n\n\nA\n\n\n2 010\n\n\n\n\nA\n\n\n2 011\n\n\n\n\nA\n\n\n2 012\n\n\n\n\nA\n\n\n2 013\n\n\n\n\nA\n\n\n2 014\n\n\n\n\nA\n\n\n2 015\n\n\n\n\nB\n\n\n2 010\n\n\n\n\nB\n\n\n2 011\n\n\n\n\nB\n\n\n2 012\n\n\n\n\nB\n\n\n2 013\n\n\n\n\nB\n\n\n2 014\n\n\n\n\nB\n\n\n2 015\n\n\n\n\n\n\n4.6.2 Complete:\nJoins the original dataset with the expanded one:\n\nCAR |> tidyr::complete(person, year)\ndata.frame [12 x 3]\n\n\n\nperson\n\n\nyear\n\n\ncar\n\n\n\n\n\nA\n\n\n2 010\n\n\nBMW\n\n\n\n\nA\n\n\n2 011\n\n\nBMW\n\n\n\n\nA\n\n\n2 012\n\n\nAUDI\n\n\n\n\nA\n\n\n2 013\n\n\nAUDI\n\n\n\n\nA\n\n\n2 014\n\n\nAUDI\n\n\n\n\nA\n\n\n2 015\n\n\nMercedes\n\n\n\n\nB\n\n\n2 010\n\n\nNA\n\n\n\n\nB\n\n\n2 011\n\n\nCitroen\n\n\n\n\nB\n\n\n2 012\n\n\nCitroen\n\n\n\n\nB\n\n\n2 013\n\n\nCitroen\n\n\n\n\nB\n\n\n2 014\n\n\nToyota\n\n\n\n\nB\n\n\n2 015\n\n\nToyota\n\n\n\n\n\n\nCAR[CJ(person, year, unique = TRUE), on = .(person, year)]\ndata.table [12 x 3]\n\n\n\nyear\n\n\nperson\n\n\ncar\n\n\n\n\n\n2 010\n\n\nA\n\n\nBMW\n\n\n\n\n2 011\n\n\nA\n\n\nBMW\n\n\n\n\n2 012\n\n\nA\n\n\nAUDI\n\n\n\n\n2 013\n\n\nA\n\n\nAUDI\n\n\n\n\n2 014\n\n\nA\n\n\nAUDI\n\n\n\n\n2 015\n\n\nA\n\n\nMercedes\n\n\n\n\n2 010\n\n\nB\n\n\nNA\n\n\n\n\n2 011\n\n\nB\n\n\nCitroen\n\n\n\n\n2 012\n\n\nB\n\n\nCitroen\n\n\n\n\n2 013\n\n\nB\n\n\nCitroen\n\n\n\n\n2 014\n\n\nB\n\n\nToyota\n\n\n\n\n2 015\n\n\nB\n\n\nToyota"
  },
  {
    "objectID": "content/posts/data.table/index.html#uncount",
    "href": "content/posts/data.table/index.html#uncount",
    "title": "Tidyverse <-> data.table",
    "section": "\n4.7 Uncount:",
    "text": "4.7 Uncount:\nDuplicating aggregated rows to get the un-aggregated version back\nData\n\n\n\n\ncols <- c(\"Mild\", \"Moderate\", \"Severe\")\n\ndat_agg\ndata.frame [10 x 6]\n\n\n\nID\n\n\nSite\n\n\nDomain\n\n\nMild\n\n\nModerate\n\n\nSevere\n\n\n\n\n\n1\n\n\n23\n\n\nA1\n\n\n4\n\n\n0\n\n\n0\n\n\n\n\n2\n\n\n27\n\n\nA1\n\n\n0\n\n\n1\n\n\n1\n\n\n\n\n3\n\n\n28\n\n\nA1\n\n\n0\n\n\n1\n\n\n0\n\n\n\n\n4\n\n\n29\n\n\nA1\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n5\n\n\n31\n\n\nA1\n\n\n0\n\n\n1\n\n\n0\n\n\n\n\n6\n\n\n33\n\n\nA1\n\n\n0\n\n\n1\n\n\n1\n\n\n\n\n7\n\n\n41\n\n\nA1\n\n\n3\n\n\n0\n\n\n1\n\n\n\n\n8\n\n\n48\n\n\nA1\n\n\n0\n\n\n2\n\n\n4\n\n\n\n\n9\n\n\n64\n\n\nA1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n10\n\n\n66\n\n\nA1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n\n\ndat_agg |> \n  tidyr::pivot_longer(cols = cols, names_to = \"Severity\", values_to = \"Count\") |> \n  tidyr::uncount(Count) |> \n  mutate(ID_new = row_number(), .after = \"ID\") |>\n  tidyr::pivot_wider(\n    names_from = \"Severity\", values_from = \"Severity\", \n    values_fn = \\(x) ifelse(is.na(x), 0, 1), values_fill = 0\n  )\ndata.frame [23 x 7]\n\n\n\nID\n\n\nID_new\n\n\nSite\n\n\nDomain\n\n\nMild\n\n\nModerate\n\n\nSevere\n\n\n\n\n\n1\n\n\n1\n\n\n23\n\n\nA1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n1\n\n\n2\n\n\n23\n\n\nA1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n1\n\n\n3\n\n\n23\n\n\nA1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n1\n\n\n4\n\n\n23\n\n\nA1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n2\n\n\n5\n\n\n27\n\n\nA1\n\n\n0\n\n\n1\n\n\n0\n\n\n\n\n2\n\n\n6\n\n\n27\n\n\nA1\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n3\n\n\n7\n\n\n28\n\n\nA1\n\n\n0\n\n\n1\n\n\n0\n\n\n\n\n4\n\n\n8\n\n\n29\n\n\nA1\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n5\n\n\n9\n\n\n31\n\n\nA1\n\n\n0\n\n\n1\n\n\n0\n\n\n\n\n6\n\n\n10\n\n\n33\n\n\nA1\n\n\n0\n\n\n1\n\n\n0\n\n\n\n\n6\n\n\n11\n\n\n33\n\n\nA1\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n7\n\n\n12\n\n\n41\n\n\nA1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n7\n\n\n13\n\n\n41\n\n\nA1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n7\n\n\n14\n\n\n41\n\n\nA1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n7\n\n\n15\n\n\n41\n\n\nA1\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n\n[ omitted 8 entries ]\n\n\n\n\nSolution 1:\n\n(melt(DAT_AGG, measure.vars = cols, variable.name = \"Severity\", value.name = \"Count\")\n  [rep(1:.N, Count)][, ID_new := .I] \n  |> dcast(... ~ Severity, value.var = \"Severity\", fun.agg = \\(x) ifelse(is.na(x), 0, 1), fill = 0)\n  |> DT(, -\"Count\")\n)\ndata.table [23 x 7]\n\n\n\nID\n\n\nSite\n\n\nDomain\n\n\nID_new\n\n\nMild\n\n\nModerate\n\n\nSevere\n\n\n\n\n\n1\n\n\n23\n\n\nA1\n\n\n1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n1\n\n\n23\n\n\nA1\n\n\n2\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n1\n\n\n23\n\n\nA1\n\n\n3\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n1\n\n\n23\n\n\nA1\n\n\n4\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n2\n\n\n27\n\n\nA1\n\n\n10\n\n\n0\n\n\n1\n\n\n0\n\n\n\n\n2\n\n\n27\n\n\nA1\n\n\n16\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n3\n\n\n28\n\n\nA1\n\n\n11\n\n\n0\n\n\n1\n\n\n0\n\n\n\n\n4\n\n\n29\n\n\nA1\n\n\n17\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n5\n\n\n31\n\n\nA1\n\n\n12\n\n\n0\n\n\n1\n\n\n0\n\n\n\n\n6\n\n\n33\n\n\nA1\n\n\n13\n\n\n0\n\n\n1\n\n\n0\n\n\n\n\n6\n\n\n33\n\n\nA1\n\n\n18\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n7\n\n\n41\n\n\nA1\n\n\n19\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n7\n\n\n41\n\n\nA1\n\n\n5\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n7\n\n\n41\n\n\nA1\n\n\n6\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n7\n\n\n41\n\n\nA1\n\n\n7\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n\n[ omitted 8 entries ]\n\n\n\n\nSolution 2:\n\nDAT_AGG[Reduce(`c`, sapply(mget(cols), \\(x) rep(1:.N, x)))\n      ][, (cols) := lapply(.SD, \\(x) ifelse(x > 1, 1, x)), .SDcols = cols\n      ][order(ID)]\ndata.table [23 x 6]\n\n\n\nID\n\n\nSite\n\n\nDomain\n\n\nMild\n\n\nModerate\n\n\nSevere\n\n\n\n\n\n1\n\n\n23\n\n\nA1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n1\n\n\n23\n\n\nA1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n1\n\n\n23\n\n\nA1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n1\n\n\n23\n\n\nA1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n2\n\n\n27\n\n\nA1\n\n\n0\n\n\n1\n\n\n1\n\n\n\n\n2\n\n\n27\n\n\nA1\n\n\n0\n\n\n1\n\n\n1\n\n\n\n\n3\n\n\n28\n\n\nA1\n\n\n0\n\n\n1\n\n\n0\n\n\n\n\n4\n\n\n29\n\n\nA1\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n5\n\n\n31\n\n\nA1\n\n\n0\n\n\n1\n\n\n0\n\n\n\n\n6\n\n\n33\n\n\nA1\n\n\n0\n\n\n1\n\n\n1\n\n\n\n\n6\n\n\n33\n\n\nA1\n\n\n0\n\n\n1\n\n\n1\n\n\n\n\n7\n\n\n41\n\n\nA1\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n7\n\n\n41\n\n\nA1\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n7\n\n\n41\n\n\nA1\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n7\n\n\n41\n\n\nA1\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n\n[ omitted 8 entries ]"
  },
  {
    "objectID": "content/posts/data.table/index.html#list-unlist",
    "href": "content/posts/data.table/index.html#list-unlist",
    "title": "Tidyverse <-> data.table",
    "section": "\n4.8 List / Unlist:",
    "text": "4.8 List / Unlist:\nWhen a column contains a simple vector/list of values (of the same type, without structure)\n\n4.8.1 One listed column:\nSingle ID (grouping) column:\n\n(mtcars_list <- mtcars |> group_by(cyl) |> summarize(mpg = list(mpg)) |> ungroup())\ndata.frame [3 x 2]\n\n\n\ncyl\n\n\nmpg\n\n\n\n\n\n4\n\n\n<numeric [11]>\n\n\n\n\n6\n\n\n<numeric [7]>\n\n\n\n\n8\n\n\n<numeric [14]>\n\n\n\n(MT_LIST <- MT[, .(mpg = .(mpg)), keyby = cyl])\ndata.table [3 x 2]\n\n\n\ncyl\n\n\nmpg\n\n\n\n\n\n4\n\n\n<numeric [11]>\n\n\n\n\n6\n\n\n<numeric [7]>\n\n\n\n\n8\n\n\n<numeric [14]>\n\n\n\n\n\nSolution 1:\n\nmtcars_list |> unnest(mpg)\ndata.frame [32 x 2]\n\n\n\ncyl\n\n\nmpg\n\n\n\n\n\n4\n\n\n22.8\n\n\n\n\n4\n\n\n24.4\n\n\n\n\n4\n\n\n22.8\n\n\n\n\n4\n\n\n32.4\n\n\n\n\n4\n\n\n30.4\n\n\n\n\n4\n\n\n33.9\n\n\n\n\n4\n\n\n21.5\n\n\n\n\n4\n\n\n27.3\n\n\n\n\n4\n\n\n26\n\n\n\n\n4\n\n\n30.4\n\n\n\n\n4\n\n\n21.4\n\n\n\n\n6\n\n\n21\n\n\n\n\n6\n\n\n21\n\n\n\n\n6\n\n\n21.4\n\n\n\n\n6\n\n\n18.1\n\n\n\n\n\n[ omitted 17 entries ]\n\n\nMT_LIST[, .(mpg = unlist(mpg)), keyby = cyl]\ndata.table [32 x 2]\n\n\n\ncyl\n\n\nmpg\n\n\n\n\n\n4\n\n\n22.8\n\n\n\n\n4\n\n\n24.4\n\n\n\n\n4\n\n\n22.8\n\n\n\n\n4\n\n\n32.4\n\n\n\n\n4\n\n\n30.4\n\n\n\n\n4\n\n\n33.9\n\n\n\n\n4\n\n\n21.5\n\n\n\n\n4\n\n\n27.3\n\n\n\n\n4\n\n\n26\n\n\n\n\n4\n\n\n30.4\n\n\n\n\n4\n\n\n21.4\n\n\n\n\n6\n\n\n21\n\n\n\n\n6\n\n\n21\n\n\n\n\n6\n\n\n21.4\n\n\n\n\n6\n\n\n18.1\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nSolution 2:\nBypasses the need of grouping when unlisting by growing the data.table back to its original number of rows before unlisting.\n\nMT_LIST[rep(MT_LIST[, .I], lengths(mpg))][, mpg := unlist(MT_LIST$mpg)][]\ndata.table [32 x 2]\n\n\n\ncyl\n\n\nmpg\n\n\n\n\n\n4\n\n\n22.8\n\n\n\n\n4\n\n\n24.4\n\n\n\n\n4\n\n\n22.8\n\n\n\n\n4\n\n\n32.4\n\n\n\n\n4\n\n\n30.4\n\n\n\n\n4\n\n\n33.9\n\n\n\n\n4\n\n\n21.5\n\n\n\n\n4\n\n\n27.3\n\n\n\n\n4\n\n\n26\n\n\n\n\n4\n\n\n30.4\n\n\n\n\n4\n\n\n21.4\n\n\n\n\n6\n\n\n21\n\n\n\n\n6\n\n\n21\n\n\n\n\n6\n\n\n21.4\n\n\n\n\n6\n\n\n18.1\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nMultiple ID (grouping) columns:\n\n(mtcars_list2 <- mtcars |> group_by(cyl, gear) |> summarize(mpg = list(mpg)) |> ungroup())\ndata.frame [8 x 3]\n\n\n\ncyl\n\n\ngear\n\n\nmpg\n\n\n\n\n\n4\n\n\n3\n\n\n<numeric [1]>\n\n\n\n\n4\n\n\n4\n\n\n<numeric [8]>\n\n\n\n\n4\n\n\n5\n\n\n<numeric [2]>\n\n\n\n\n6\n\n\n3\n\n\n<numeric [2]>\n\n\n\n\n6\n\n\n4\n\n\n<numeric [4]>\n\n\n\n\n6\n\n\n5\n\n\n<numeric [1]>\n\n\n\n\n8\n\n\n3\n\n\n<numeric [12]>\n\n\n\n\n8\n\n\n5\n\n\n<numeric [2]>\n\n\n\n(MT_LIST2 <- MT[, .(mpg = .(mpg)), keyby = .(cyl, gear)])\ndata.table [8 x 3]\n\n\n\ncyl\n\n\ngear\n\n\nmpg\n\n\n\n\n\n4\n\n\n3\n\n\n<numeric [1]>\n\n\n\n\n4\n\n\n4\n\n\n<numeric [8]>\n\n\n\n\n4\n\n\n5\n\n\n<numeric [2]>\n\n\n\n\n6\n\n\n3\n\n\n<numeric [2]>\n\n\n\n\n6\n\n\n4\n\n\n<numeric [4]>\n\n\n\n\n6\n\n\n5\n\n\n<numeric [1]>\n\n\n\n\n8\n\n\n3\n\n\n<numeric [12]>\n\n\n\n\n8\n\n\n5\n\n\n<numeric [2]>\n\n\n\n\n\nSolution 1:\n\nmtcars_list2 |> unnest(mpg) # group_by(cyl, gear) is optional\ndata.frame [32 x 3]\n\n\n\ncyl\n\n\ngear\n\n\nmpg\n\n\n\n\n\n4\n\n\n3\n\n\n21.5\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n\n\n4\n\n\n4\n\n\n24.4\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n\n\n4\n\n\n4\n\n\n32.4\n\n\n\n\n4\n\n\n4\n\n\n30.4\n\n\n\n\n4\n\n\n4\n\n\n33.9\n\n\n\n\n4\n\n\n4\n\n\n27.3\n\n\n\n\n4\n\n\n4\n\n\n21.4\n\n\n\n\n4\n\n\n5\n\n\n26\n\n\n\n\n4\n\n\n5\n\n\n30.4\n\n\n\n\n6\n\n\n3\n\n\n21.4\n\n\n\n\n6\n\n\n3\n\n\n18.1\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n\n\n\n[ omitted 17 entries ]\n\n\nMT_LIST2[, .(mpg = unlist(mpg)), by = setdiff(colnames(MT_LIST2), 'mpg')]\ndata.table [32 x 3]\n\n\n\ncyl\n\n\ngear\n\n\nmpg\n\n\n\n\n\n4\n\n\n3\n\n\n21.5\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n\n\n4\n\n\n4\n\n\n24.4\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n\n\n4\n\n\n4\n\n\n32.4\n\n\n\n\n4\n\n\n4\n\n\n30.4\n\n\n\n\n4\n\n\n4\n\n\n33.9\n\n\n\n\n4\n\n\n4\n\n\n27.3\n\n\n\n\n4\n\n\n4\n\n\n21.4\n\n\n\n\n4\n\n\n5\n\n\n26\n\n\n\n\n4\n\n\n5\n\n\n30.4\n\n\n\n\n6\n\n\n3\n\n\n21.4\n\n\n\n\n6\n\n\n3\n\n\n18.1\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nSolution 2:\nSame as with one grouping column\n\nMT_LIST2[rep(MT_LIST2[, .I], lengths(mpg))][, mpg := unlist(MT_LIST2$mpg)][]\ndata.table [32 x 3]\n\n\n\ncyl\n\n\ngear\n\n\nmpg\n\n\n\n\n\n4\n\n\n3\n\n\n21.5\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n\n\n4\n\n\n4\n\n\n24.4\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n\n\n4\n\n\n4\n\n\n32.4\n\n\n\n\n4\n\n\n4\n\n\n30.4\n\n\n\n\n4\n\n\n4\n\n\n33.9\n\n\n\n\n4\n\n\n4\n\n\n27.3\n\n\n\n\n4\n\n\n4\n\n\n21.4\n\n\n\n\n4\n\n\n5\n\n\n26\n\n\n\n\n4\n\n\n5\n\n\n30.4\n\n\n\n\n6\n\n\n3\n\n\n21.4\n\n\n\n\n6\n\n\n3\n\n\n18.1\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n4.8.2 Multiple listed column:\nCreating the data:\n\n(mtcars_list_mult <- mtcars |> group_by(cyl, gear) |> summarize(across(c(mpg, disp), \\(c) list(c))) |> ungroup())\ndata.frame [8 x 4]\n\n\n\ncyl\n\n\ngear\n\n\nmpg\n\n\ndisp\n\n\n\n\n\n4\n\n\n3\n\n\n<numeric [1]>\n\n\n<numeric [1]>\n\n\n\n\n4\n\n\n4\n\n\n<numeric [8]>\n\n\n<numeric [8]>\n\n\n\n\n4\n\n\n5\n\n\n<numeric [2]>\n\n\n<numeric [2]>\n\n\n\n\n6\n\n\n3\n\n\n<numeric [2]>\n\n\n<numeric [2]>\n\n\n\n\n6\n\n\n4\n\n\n<numeric [4]>\n\n\n<numeric [4]>\n\n\n\n\n6\n\n\n5\n\n\n<numeric [1]>\n\n\n<numeric [1]>\n\n\n\n\n8\n\n\n3\n\n\n<numeric [12]>\n\n\n<numeric [12]>\n\n\n\n\n8\n\n\n5\n\n\n<numeric [2]>\n\n\n<numeric [2]>\n\n\n\n(MT_LIST_MULT <- MT[, lapply(.SD, \\(c) .(c)), keyby = .(cyl, gear), .SDcols = c(\"mpg\", \"disp\")])\ndata.table [8 x 4]\n\n\n\ncyl\n\n\ngear\n\n\nmpg\n\n\ndisp\n\n\n\n\n\n4\n\n\n3\n\n\n<numeric [1]>\n\n\n<numeric [1]>\n\n\n\n\n4\n\n\n4\n\n\n<numeric [8]>\n\n\n<numeric [8]>\n\n\n\n\n4\n\n\n5\n\n\n<numeric [2]>\n\n\n<numeric [2]>\n\n\n\n\n6\n\n\n3\n\n\n<numeric [2]>\n\n\n<numeric [2]>\n\n\n\n\n6\n\n\n4\n\n\n<numeric [4]>\n\n\n<numeric [4]>\n\n\n\n\n6\n\n\n5\n\n\n<numeric [1]>\n\n\n<numeric [1]>\n\n\n\n\n8\n\n\n3\n\n\n<numeric [12]>\n\n\n<numeric [12]>\n\n\n\n\n8\n\n\n5\n\n\n<numeric [2]>\n\n\n<numeric [2]>\n\n\n\n\n\nSolution 1:\n\nmtcars_list_mult |> unnest(c(mpg, disp)) # group_by(cyl, gear) is optional\ndata.frame [32 x 4]\n\n\n\ncyl\n\n\ngear\n\n\nmpg\n\n\ndisp\n\n\n\n\n\n4\n\n\n3\n\n\n21.5\n\n\n120.1\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n108\n\n\n\n\n4\n\n\n4\n\n\n24.4\n\n\n146.7\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n140.8\n\n\n\n\n4\n\n\n4\n\n\n32.4\n\n\n78.7\n\n\n\n\n4\n\n\n4\n\n\n30.4\n\n\n75.7\n\n\n\n\n4\n\n\n4\n\n\n33.9\n\n\n71.1\n\n\n\n\n4\n\n\n4\n\n\n27.3\n\n\n79\n\n\n\n\n4\n\n\n4\n\n\n21.4\n\n\n121\n\n\n\n\n4\n\n\n5\n\n\n26\n\n\n120.3\n\n\n\n\n4\n\n\n5\n\n\n30.4\n\n\n95.1\n\n\n\n\n6\n\n\n3\n\n\n21.4\n\n\n258\n\n\n\n\n6\n\n\n3\n\n\n18.1\n\n\n225\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n160\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n160\n\n\n\n\n\n[ omitted 17 entries ]\n\n\nMT_LIST_MULT[, lapply(.SD, \\(c) unlist(c)), by = setdiff(colnames(MT_LIST_MULT), c(\"mpg\", \"disp\"))]\ndata.table [32 x 4]\n\n\n\ncyl\n\n\ngear\n\n\nmpg\n\n\ndisp\n\n\n\n\n\n4\n\n\n3\n\n\n21.5\n\n\n120.1\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n108\n\n\n\n\n4\n\n\n4\n\n\n24.4\n\n\n146.7\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n140.8\n\n\n\n\n4\n\n\n4\n\n\n32.4\n\n\n78.7\n\n\n\n\n4\n\n\n4\n\n\n30.4\n\n\n75.7\n\n\n\n\n4\n\n\n4\n\n\n33.9\n\n\n71.1\n\n\n\n\n4\n\n\n4\n\n\n27.3\n\n\n79\n\n\n\n\n4\n\n\n4\n\n\n21.4\n\n\n121\n\n\n\n\n4\n\n\n5\n\n\n26\n\n\n120.3\n\n\n\n\n4\n\n\n5\n\n\n30.4\n\n\n95.1\n\n\n\n\n6\n\n\n3\n\n\n21.4\n\n\n258\n\n\n\n\n6\n\n\n3\n\n\n18.1\n\n\n225\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n160\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n160\n\n\n\n\n\n[ omitted 17 entries ]"
  },
  {
    "objectID": "content/posts/data.table/index.html#nest-unnest",
    "href": "content/posts/data.table/index.html#nest-unnest",
    "title": "Tidyverse <-> data.table",
    "section": "\n4.9 Nest / Unnest:",
    "text": "4.9 Nest / Unnest:\nWhen a column contains a data.table/data.frame (with multiple columns, structured)\n\n4.9.1 One nested column:\nNesting\n\n(mtcars_nest <- mtcars |> tidyr::nest(data = -cyl)) # Data is inside a tibble\ndata.frame [3 x 2]\n\n\n\ncyl\n\n\ndata\n\n\n\n\n\n6\n\n\n<tbl_df [7 x 10]>\n\n\n\n\n4\n\n\n<tbl_df [11 x 10]>\n\n\n\n\n8\n\n\n<tbl_df [14 x 10]>\n\n\n\n\n\n\nmtcars_nest <- mtcars |> nest_by(cyl) |> ungroup() # Data is inside a vctrs_list_of\n\n\n(MT_NEST <- MT[, .(data = .(.SD)), keyby = cyl])\ndata.table [3 x 2]\n\n\n\ncyl\n\n\ndata\n\n\n\n\n\n4\n\n\n<data.table [11 x 10]>\n\n\n\n\n6\n\n\n<data.table [7 x 10]>\n\n\n\n\n8\n\n\n<data.table [14 x 10]>\n\n\n\n\n\nUnnesting\n\nmtcars_nest |> unnest(data) |> ungroup()\ndata.frame [32 x 11]\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n6\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n6\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n6\n\n\n21.4\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n6\n\n\n18.1\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n6\n\n\n19.2\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n6\n\n\n17.8\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n6\n\n\n19.7\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n\n\n4\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n32.4\n\n\n78.7\n\n\n66\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n30.4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n33.9\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n21.5\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n4\n\n\n27.3\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n\n[ omitted 17 entries ]\n\n\nMT_NEST[, rbindlist(data), keyby = cyl] # MT_NEST[, do.call(c, data), keyby = cyl]\ndata.table [32 x 11]\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n4\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n32.4\n\n\n78.7\n\n\n66\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n30.4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n33.9\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n21.5\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n4\n\n\n27.3\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n26\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n4\n\n\n30.4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n4\n\n\n21.4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n6\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n6\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n6\n\n\n21.4\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n6\n\n\n18.1\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n4.9.2 Multiple nested column:\nNesting:\n\n(mtcars_nest_mult <- mtcars |> group_by(cyl, gear) |> nest(data1 = c(mpg, hp), data2 = !c(cyl, gear, mpg, hp)) |> ungroup())\ndata.frame [8 x 4]\n\n\n\ncyl\n\n\ngear\n\n\ndata1\n\n\ndata2\n\n\n\n\n\n6\n\n\n4\n\n\n<tbl_df [4 x 2]>\n\n\n<tbl_df [4 x 7]>\n\n\n\n\n4\n\n\n4\n\n\n<tbl_df [8 x 2]>\n\n\n<tbl_df [8 x 7]>\n\n\n\n\n6\n\n\n3\n\n\n<tbl_df [2 x 2]>\n\n\n<tbl_df [2 x 7]>\n\n\n\n\n8\n\n\n3\n\n\n<tbl_df [12 x 2]>\n\n\n<tbl_df [12 x 7]>\n\n\n\n\n4\n\n\n3\n\n\n<tbl_df [1 x 2]>\n\n\n<tbl_df [1 x 7]>\n\n\n\n\n4\n\n\n5\n\n\n<tbl_df [2 x 2]>\n\n\n<tbl_df [2 x 7]>\n\n\n\n\n8\n\n\n5\n\n\n<tbl_df [2 x 2]>\n\n\n<tbl_df [2 x 7]>\n\n\n\n\n6\n\n\n5\n\n\n<tbl_df [1 x 2]>\n\n\n<tbl_df [1 x 7]>\n\n\n\n(MT_NEST_MULT <- MT[, .(data1 = .(.SD[, .(mpg, hp)]), data2 = .(.SD[, !c(\"mpg\", \"hp\")])), keyby = .(cyl, gear)])\ndata.table [8 x 4]\n\n\n\ncyl\n\n\ngear\n\n\ndata1\n\n\ndata2\n\n\n\n\n\n4\n\n\n3\n\n\n<data.table [1 x 2]>\n\n\n<data.table [1 x 7]>\n\n\n\n\n4\n\n\n4\n\n\n<data.table [8 x 2]>\n\n\n<data.table [8 x 7]>\n\n\n\n\n4\n\n\n5\n\n\n<data.table [2 x 2]>\n\n\n<data.table [2 x 7]>\n\n\n\n\n6\n\n\n3\n\n\n<data.table [2 x 2]>\n\n\n<data.table [2 x 7]>\n\n\n\n\n6\n\n\n4\n\n\n<data.table [4 x 2]>\n\n\n<data.table [4 x 7]>\n\n\n\n\n6\n\n\n5\n\n\n<data.table [1 x 2]>\n\n\n<data.table [1 x 7]>\n\n\n\n\n8\n\n\n3\n\n\n<data.table [12 x 2]>\n\n\n<data.table [12 x 7]>\n\n\n\n\n8\n\n\n5\n\n\n<data.table [2 x 2]>\n\n\n<data.table [2 x 7]>\n\n\n\n\n\nUnnesting:\n\nmtcars_nest_mult |> unnest(c(data1, data2)) |> ungroup()\ndata.frame [32 x 11]\n\n\n\ncyl\n\n\ngear\n\n\nmpg\n\n\nhp\n\n\ndisp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ncarb\n\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n110\n\n\n160\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n110\n\n\n160\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n\n\n6\n\n\n4\n\n\n19.2\n\n\n123\n\n\n167.6\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n\n\n6\n\n\n4\n\n\n17.8\n\n\n123\n\n\n167.6\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n93\n\n\n108\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n24.4\n\n\n62\n\n\n146.7\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n95\n\n\n140.8\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n32.4\n\n\n66\n\n\n78.7\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n30.4\n\n\n52\n\n\n75.7\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n33.9\n\n\n65\n\n\n71.1\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n27.3\n\n\n66\n\n\n79\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n21.4\n\n\n109\n\n\n121\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n2\n\n\n\n\n6\n\n\n3\n\n\n21.4\n\n\n110\n\n\n258\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n6\n\n\n3\n\n\n18.1\n\n\n105\n\n\n225\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n8\n\n\n3\n\n\n18.7\n\n\n175\n\n\n360\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n2\n\n\n\n\n\n[ omitted 17 entries ]\n\n\nMT_NEST_MULT[, c(rbindlist(data1), rbindlist(data2)), keyby = .(cyl, gear)]\ndata.table [32 x 11]\n\n\n\ncyl\n\n\ngear\n\n\nmpg\n\n\nhp\n\n\ndisp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ncarb\n\n\n\n\n\n4\n\n\n3\n\n\n21.5\n\n\n97\n\n\n120.1\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n93\n\n\n108\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n24.4\n\n\n62\n\n\n146.7\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n95\n\n\n140.8\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n32.4\n\n\n66\n\n\n78.7\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n30.4\n\n\n52\n\n\n75.7\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n33.9\n\n\n65\n\n\n71.1\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n27.3\n\n\n66\n\n\n79\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n21.4\n\n\n109\n\n\n121\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n2\n\n\n\n\n4\n\n\n5\n\n\n26\n\n\n91\n\n\n120.3\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n2\n\n\n\n\n4\n\n\n5\n\n\n30.4\n\n\n113\n\n\n95.1\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n2\n\n\n\n\n6\n\n\n3\n\n\n21.4\n\n\n110\n\n\n258\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n6\n\n\n3\n\n\n18.1\n\n\n105\n\n\n225\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n110\n\n\n160\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n110\n\n\n160\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\nMT_NEST_MULT[, do.call(c, unname(lapply(.SD, \\(c) rbindlist(c)))), .SDcols = patterns('data'), keyby = .(cyl, gear)]\ndata.table [32 x 11]\n\n\n\ncyl\n\n\ngear\n\n\nmpg\n\n\nhp\n\n\ndisp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ncarb\n\n\n\n\n\n4\n\n\n3\n\n\n21.5\n\n\n97\n\n\n120.1\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n93\n\n\n108\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n24.4\n\n\n62\n\n\n146.7\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n95\n\n\n140.8\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n32.4\n\n\n66\n\n\n78.7\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n30.4\n\n\n52\n\n\n75.7\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n33.9\n\n\n65\n\n\n71.1\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n27.3\n\n\n66\n\n\n79\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n21.4\n\n\n109\n\n\n121\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n2\n\n\n\n\n4\n\n\n5\n\n\n26\n\n\n91\n\n\n120.3\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n2\n\n\n\n\n4\n\n\n5\n\n\n30.4\n\n\n113\n\n\n95.1\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n2\n\n\n\n\n6\n\n\n3\n\n\n21.4\n\n\n110\n\n\n258\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n6\n\n\n3\n\n\n18.1\n\n\n105\n\n\n225\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n110\n\n\n160\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n110\n\n\n160\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n4.9.3 Operate on nested/list columns:\n\n(mtcars_nest <- mtcars |> nest(-cyl) |> ungroup())\ndata.frame [3 x 2]\n\n\n\ncyl\n\n\ndata\n\n\n\n\n\n6\n\n\n<tbl_df [7 x 10]>\n\n\n\n\n4\n\n\n<tbl_df [11 x 10]>\n\n\n\n\n8\n\n\n<tbl_df [14 x 10]>\n\n\n\n(MT_NEST <- MT[, .(data = .(.SD)), keyby = cyl])\ndata.table [3 x 2]\n\n\n\ncyl\n\n\ndata\n\n\n\n\n\n4\n\n\n<data.table [11 x 10]>\n\n\n\n\n6\n\n\n<data.table [7 x 10]>\n\n\n\n\n8\n\n\n<data.table [14 x 10]>\n\n\n\n\n\nCreating a new column using the nested data:\nKeeping the nested column:\n\nmtcars_nest |> group_by(cyl) |> mutate(sum = sum(unlist(data))) |> ungroup()\ndata.frame [3 x 3]\n\n\n\ncyl\n\n\ndata\n\n\nsum\n\n\n\n\n\n6\n\n\n<tbl_df [7 x 10]>\n\n\n2 508.16\n\n\n\n\n4\n\n\n<tbl_df [11 x 10]>\n\n\n2 719.233\n\n\n\n\n8\n\n\n<tbl_df [14 x 10]>\n\n\n8 516.809\n\n\n\ncopy(MT_NEST)[, sum := sapply(data, \\(r) sum(r)), keyby = cyl][]\ndata.table [3 x 3]\n\n\n\ncyl\n\n\ndata\n\n\nsum\n\n\n\n\n\n4\n\n\n<data.table [11 x 10]>\n\n\n2 719.233\n\n\n\n\n6\n\n\n<data.table [7 x 10]>\n\n\n2 508.16\n\n\n\n\n8\n\n\n<data.table [14 x 10]>\n\n\n8 516.809\n\n\n\n\n\nDropping the nested column:\n\nmtcars_nest |> group_by(cyl) |> summarize(sum = sum(unlist(data))) |> ungroup()\ndata.frame [3 x 2]\n\n\n\ncyl\n\n\nsum\n\n\n\n\n\n4\n\n\n2 719.233\n\n\n\n\n6\n\n\n2 508.16\n\n\n\n\n8\n\n\n8 516.809\n\n\n\nMT_NEST[, .(sum = sapply(data, \\(r) sum(r))), keyby = cyl]\ndata.table [3 x 2]\n\n\n\ncyl\n\n\nsum\n\n\n\n\n\n4\n\n\n2 719.233\n\n\n\n\n6\n\n\n2 508.16\n\n\n\n\n8\n\n\n8 516.809\n\n\n\n\n\nCreating multiple new columns using the nested data:\n\nlinreg <- \\(data) lm(mpg ~ hp, data = data) |> broom::tidy()\n\n\nmtcars_nest |> group_by(cyl) |> group_modify(\\(d, g) linreg(unnest(d, everything()))) |> ungroup()\ndata.frame [6 x 6]\n\n\n\ncyl\n\n\nterm\n\n\nestimate\n\n\nstd.error\n\n\nstatistic\n\n\np.value\n\n\n\n\n\n4\n\n\n(Intercept)\n\n\n35.983\n\n\n5.201\n\n\n6.918\n\n\n<0.001 ***\n\n\n\n\n4\n\n\nhp\n\n\n−0.113\n\n\n0.061\n\n\n−1.843\n\n\n0.098\n\n\n\n\n6\n\n\n(Intercept)\n\n\n20.674\n\n\n3.304\n\n\n6.256\n\n\n0.002 **\n\n\n\n\n6\n\n\nhp\n\n\n−0.008\n\n\n0.027\n\n\n−0.286\n\n\n0.786\n\n\n\n\n8\n\n\n(Intercept)\n\n\n18.08\n\n\n2.988\n\n\n6.052\n\n\n<0.001 ***\n\n\n\n\n8\n\n\nhp\n\n\n−0.014\n\n\n0.014\n\n\n−1.025\n\n\n0.326\n\n\n\nMT_NEST[, rbindlist(lapply(data, \\(ndt) linreg(ndt))), keyby = cyl][]\ndata.table [6 x 6]\n\n\n\ncyl\n\n\nterm\n\n\nestimate\n\n\nstd.error\n\n\nstatistic\n\n\np.value\n\n\n\n\n\n4\n\n\n(Intercept)\n\n\n35.983\n\n\n5.201\n\n\n6.918\n\n\n<0.001 ***\n\n\n\n\n4\n\n\nhp\n\n\n−0.113\n\n\n0.061\n\n\n−1.843\n\n\n0.098\n\n\n\n\n6\n\n\n(Intercept)\n\n\n20.674\n\n\n3.304\n\n\n6.256\n\n\n0.002 **\n\n\n\n\n6\n\n\nhp\n\n\n−0.008\n\n\n0.027\n\n\n−0.286\n\n\n0.786\n\n\n\n\n8\n\n\n(Intercept)\n\n\n18.08\n\n\n2.988\n\n\n6.052\n\n\n<0.001 ***\n\n\n\n\n8\n\n\nhp\n\n\n−0.014\n\n\n0.014\n\n\n−1.025\n\n\n0.326\n\n\n\n\n\nOperating inside the nested data:\n\nmtcars_nest |> \n  mutate(data = map(data, \\(tibl) mutate(tibl, sum = pmap_dbl(cur_data(), sum)))) |> \n  unnest(data)\ndata.frame [32 x 12]\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nsum\n\n\n\n\n\n6\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n322.98\n\n\n\n\n6\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n323.795\n\n\n\n\n6\n\n\n21.4\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n420.135\n\n\n\n\n6\n\n\n18.1\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n379.54\n\n\n\n\n6\n\n\n19.2\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n344.46\n\n\n\n\n6\n\n\n17.8\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n343.66\n\n\n\n\n6\n\n\n19.7\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n373.59\n\n\n\n\n4\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n255.58\n\n\n\n\n4\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n266.98\n\n\n\n\n4\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n295.57\n\n\n\n\n4\n\n\n32.4\n\n\n78.7\n\n\n66\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n209.85\n\n\n\n\n4\n\n\n30.4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n191.165\n\n\n\n\n4\n\n\n33.9\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n202.955\n\n\n\n\n4\n\n\n21.5\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n269.775\n\n\n\n\n4\n\n\n27.3\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n204.215\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\nmtcars_nest |> \n  mutate(across(data, \\(tibls) map(tibls, \\(tibl) mutate(tibl, sum = apply(cur_data(), 1, sum))))) |> \n  unnest(data)\ndata.frame [32 x 12]\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nsum\n\n\n\n\n\n6\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n322.98\n\n\n\n\n6\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n323.795\n\n\n\n\n6\n\n\n21.4\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n420.135\n\n\n\n\n6\n\n\n18.1\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n379.54\n\n\n\n\n6\n\n\n19.2\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n344.46\n\n\n\n\n6\n\n\n17.8\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n343.66\n\n\n\n\n6\n\n\n19.7\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n373.59\n\n\n\n\n4\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n255.58\n\n\n\n\n4\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n266.98\n\n\n\n\n4\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n295.57\n\n\n\n\n4\n\n\n32.4\n\n\n78.7\n\n\n66\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n209.85\n\n\n\n\n4\n\n\n30.4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n191.165\n\n\n\n\n4\n\n\n33.9\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n202.955\n\n\n\n\n4\n\n\n21.5\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n269.775\n\n\n\n\n4\n\n\n27.3\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n204.215\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nUsing the nplyr package:\n\nlibrary(nplyr)\n\nmtcars_nest |> \n  nplyr::nest_mutate(data, sum = apply(cur_data(), 1, sum)) |> \n  unnest(data)\ndata.frame [32 x 12]\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nsum\n\n\n\n\n\n6\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n322.98\n\n\n\n\n6\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n323.795\n\n\n\n\n6\n\n\n21.4\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n420.135\n\n\n\n\n6\n\n\n18.1\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n379.54\n\n\n\n\n6\n\n\n19.2\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n344.46\n\n\n\n\n6\n\n\n17.8\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n343.66\n\n\n\n\n6\n\n\n19.7\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n373.59\n\n\n\n\n4\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n255.58\n\n\n\n\n4\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n266.98\n\n\n\n\n4\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n295.57\n\n\n\n\n4\n\n\n32.4\n\n\n78.7\n\n\n66\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n209.85\n\n\n\n\n4\n\n\n30.4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n191.165\n\n\n\n\n4\n\n\n33.9\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n202.955\n\n\n\n\n4\n\n\n21.5\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n269.775\n\n\n\n\n4\n\n\n27.3\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n204.215\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\ncopy(MT_NEST)[, data := lapply(data, \\(dt) dt[, sum := apply(.SD, 1, sum)])\n            ][, rbindlist(data), keyby = cyl]\ndata.table [32 x 12]\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nsum\n\n\n\n\n\n4\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n255.58\n\n\n\n\n4\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n266.98\n\n\n\n\n4\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n295.57\n\n\n\n\n4\n\n\n32.4\n\n\n78.7\n\n\n66\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n209.85\n\n\n\n\n4\n\n\n30.4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n191.165\n\n\n\n\n4\n\n\n33.9\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n202.955\n\n\n\n\n4\n\n\n21.5\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n269.775\n\n\n\n\n4\n\n\n27.3\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n204.215\n\n\n\n\n4\n\n\n26\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n268.57\n\n\n\n\n4\n\n\n30.4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n269.683\n\n\n\n\n4\n\n\n21.4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n284.89\n\n\n\n\n6\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n322.98\n\n\n\n\n6\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n323.795\n\n\n\n\n6\n\n\n21.4\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n420.135\n\n\n\n\n6\n\n\n18.1\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n379.54\n\n\n\n\n\n[ omitted 17 entries ]"
  },
  {
    "objectID": "content/posts/data.table/index.html#rotate-transpose",
    "href": "content/posts/data.table/index.html#rotate-transpose",
    "title": "Tidyverse <-> data.table",
    "section": "\n4.10 Rotate / Transpose:",
    "text": "4.10 Rotate / Transpose:\n\n(MT_SUMMARY <- MT[, tidy(summary(mpg)), by = cyl])\ndata.table [3 x 7]\n\n\n\ncyl\n\n\nminimum\n\n\nq1\n\n\nmedian\n\n\nmean\n\n\nq3\n\n\nmaximum\n\n\n\n\n\n6\n\n\n17.8\n\n\n18.65\n\n\n19.7\n\n\n19.743\n\n\n21\n\n\n21.4\n\n\n\n\n4\n\n\n21.4\n\n\n22.8\n\n\n26\n\n\n26.664\n\n\n30.4\n\n\n33.9\n\n\n\n\n8\n\n\n10.4\n\n\n14.4\n\n\n15.2\n\n\n15.1\n\n\n16.25\n\n\n19.2\n\n\n\n\n\nSolution 1:\nUsing pivots to fully rotate the data.table:\n\nMT_SUMMARY |> \n  pivot_longer(!cyl, names_to = \"Statistic\") |> \n  pivot_wider(id_cols = \"Statistic\", names_from = \"cyl\", names_prefix = \"Cyl \")\ndata.frame [6 x 4]\n\n\n\nStatistic\n\n\nCyl 6\n\n\nCyl 4\n\n\nCyl 8\n\n\n\n\n\nminimum\n\n\n17.8\n\n\n21.4\n\n\n10.4\n\n\n\n\nq1\n\n\n18.65\n\n\n22.8\n\n\n14.4\n\n\n\n\nmedian\n\n\n19.7\n\n\n26\n\n\n15.2\n\n\n\n\nmean\n\n\n19.743\n\n\n26.664\n\n\n15.1\n\n\n\n\nq3\n\n\n21\n\n\n30.4\n\n\n16.25\n\n\n\n\nmaximum\n\n\n21.4\n\n\n33.9\n\n\n19.2\n\n\n\n\n\n\nMT_SUMMARY |> \n  melt(id.vars = \"cyl\", variable.name = \"Statistic\") |> \n  dcast(Statistic ~ paste0(\"Cyl \", cyl))\ndata.table [6 x 4]\n\n\n\nStatistic\n\n\nCyl 4\n\n\nCyl 6\n\n\nCyl 8\n\n\n\n\n\nminimum\n\n\n21.4\n\n\n17.8\n\n\n10.4\n\n\n\n\nq1\n\n\n22.8\n\n\n18.65\n\n\n14.4\n\n\n\n\nmedian\n\n\n26\n\n\n19.7\n\n\n15.2\n\n\n\n\nmean\n\n\n26.664\n\n\n19.743\n\n\n15.1\n\n\n\n\nq3\n\n\n30.4\n\n\n21\n\n\n16.25\n\n\n\n\nmaximum\n\n\n33.9\n\n\n21.4\n\n\n19.2\n\n\n\n\n\nSolution 2:\n\nlibrary(datawizard)\n\ndatawizard::data_rotate(MT_SUMMARY, colnames = TRUE, rownames = \"Statistic\")\ndata.frame [6 x 4]\n\n\n\nStatistic\n\n\n6\n\n\n4\n\n\n8\n\n\n\n\n\nminimum\n\n\n17.8\n\n\n21.4\n\n\n10.4\n\n\n\n\nq1\n\n\n18.65\n\n\n22.8\n\n\n14.4\n\n\n\n\nmedian\n\n\n19.7\n\n\n26\n\n\n15.2\n\n\n\n\nmean\n\n\n19.743\n\n\n26.664\n\n\n15.1\n\n\n\n\nq3\n\n\n21\n\n\n30.4\n\n\n16.25\n\n\n\n\nmaximum\n\n\n21.4\n\n\n33.9\n\n\n19.2\n\n\n\n\n\n\ndata.table::transpose(MT_SUMMARY, keep.names = \"Statistic\", make.names = 1)\ndata.table [6 x 4]\n\n\n\nStatistic\n\n\n6\n\n\n4\n\n\n8\n\n\n\n\n\nminimum\n\n\n17.8\n\n\n21.4\n\n\n10.4\n\n\n\n\nq1\n\n\n18.65\n\n\n22.8\n\n\n14.4\n\n\n\n\nmedian\n\n\n19.7\n\n\n26\n\n\n15.2\n\n\n\n\nmean\n\n\n19.743\n\n\n26.664\n\n\n15.1\n\n\n\n\nq3\n\n\n21\n\n\n30.4\n\n\n16.25\n\n\n\n\nmaximum\n\n\n21.4\n\n\n33.9\n\n\n19.2"
  },
  {
    "objectID": "content/posts/data.table/index.html#find-minimum-in-each-group",
    "href": "content/posts/data.table/index.html#find-minimum-in-each-group",
    "title": "Tidyverse <-> data.table",
    "section": "\n5.1 Find minimum in each group:",
    "text": "5.1 Find minimum in each group:\n\nMT |> group_by(cyl) |> arrange(mpg) |> slice(1) |> ungroup()\ndata.frame [3 x 11]\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n\nMT[, .SD[which.min(mpg)], keyby = cyl]\ndata.table [3 x 11]\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n4\n\n\n21.4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n6\n\n\n17.8\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n8\n\n\n10.4\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4"
  },
  {
    "objectID": "content/posts/data.table/index.html#group-filter-mutate",
    "href": "content/posts/data.table/index.html#group-filter-mutate",
    "title": "Tidyverse <-> data.table",
    "section": "\n5.2 GROUP > FILTER > MUTATE",
    "text": "5.2 GROUP > FILTER > MUTATE\nData:\n\n(DAT <- structure(list(\n  id = c(1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L), \n  name = c(\"Jane\", \"Jane\", \"Jane\", \"Jane\", \"Jane\", \"Jane\", \"Jane\", \"Jane\", \"Bob\", \"Bob\", \"Bob\", \"Bob\", \"Bob\", \"Bob\", \"Bob\", \"Bob\"), \n  year = c(1980L, 1981L, 1982L, 1983L, 1984L, 1985L, 1986L, 1987L, 1985L, 1986L, 1987L, 1988L, 1989L, 1990L, 1991L, 1992L), \n  job = c(\"Manager\", \"Manager\", \"Manager\", \"Manager\", \"Manager\", \"Manager\", \"Boss\", \"Boss\", \"Manager\", \"Manager\", \"Manager\", \"Boss\", \"Boss\", \"Boss\", \"Boss\", \"Boss\"), \n  job2 = c(1L, 1L, 1L, 1L, 1L, 1L, 0L, 0L, 1L, 1L, 1L, 0L, 0L, 0L, 0L, 0L)\n  ), \n  .Names = c(\"id\", \"name\", \"year\", \"job\", \"job2\"), \n  class = \"data.frame\", \n  row.names = c(NA, -16L)\n) |> setDT())\ndata.table [16 x 5]\n\n\n\nid\n\n\nname\n\n\nyear\n\n\njob\n\n\njob2\n\n\n\n\n\n1\n\n\nJane\n\n\n1 980\n\n\nManager\n\n\n1\n\n\n\n\n1\n\n\nJane\n\n\n1 981\n\n\nManager\n\n\n1\n\n\n\n\n1\n\n\nJane\n\n\n1 982\n\n\nManager\n\n\n1\n\n\n\n\n1\n\n\nJane\n\n\n1 983\n\n\nManager\n\n\n1\n\n\n\n\n1\n\n\nJane\n\n\n1 984\n\n\nManager\n\n\n1\n\n\n\n\n1\n\n\nJane\n\n\n1 985\n\n\nManager\n\n\n1\n\n\n\n\n1\n\n\nJane\n\n\n1 986\n\n\nBoss\n\n\n0\n\n\n\n\n1\n\n\nJane\n\n\n1 987\n\n\nBoss\n\n\n0\n\n\n\n\n2\n\n\nBob\n\n\n1 985\n\n\nManager\n\n\n1\n\n\n\n\n2\n\n\nBob\n\n\n1 986\n\n\nManager\n\n\n1\n\n\n\n\n2\n\n\nBob\n\n\n1 987\n\n\nManager\n\n\n1\n\n\n\n\n2\n\n\nBob\n\n\n1 988\n\n\nBoss\n\n\n0\n\n\n\n\n2\n\n\nBob\n\n\n1 989\n\n\nBoss\n\n\n0\n\n\n\n\n2\n\n\nBob\n\n\n1 990\n\n\nBoss\n\n\n0\n\n\n\n\n2\n\n\nBob\n\n\n1 991\n\n\nBoss\n\n\n0\n\n\n\n\n\n[ omitted 1 entries ]\n\n\n\n\nTidyverse:\n\nDAT |> group_by(name, job) |> \n  filter(job != \"Boss\" | year == min(year)) |> \n  mutate(cumu_job2 = cumsum(job2)) |> \n  ungroup()\ndata.frame [11 x 6]\n\n\n\nid\n\n\nname\n\n\nyear\n\n\njob\n\n\njob2\n\n\ncumu_job2\n\n\n\n\n\n1\n\n\nJane\n\n\n1 980\n\n\nManager\n\n\n1\n\n\n1\n\n\n\n\n1\n\n\nJane\n\n\n1 981\n\n\nManager\n\n\n1\n\n\n2\n\n\n\n\n1\n\n\nJane\n\n\n1 982\n\n\nManager\n\n\n1\n\n\n3\n\n\n\n\n1\n\n\nJane\n\n\n1 983\n\n\nManager\n\n\n1\n\n\n4\n\n\n\n\n1\n\n\nJane\n\n\n1 984\n\n\nManager\n\n\n1\n\n\n5\n\n\n\n\n1\n\n\nJane\n\n\n1 985\n\n\nManager\n\n\n1\n\n\n6\n\n\n\n\n1\n\n\nJane\n\n\n1 986\n\n\nBoss\n\n\n0\n\n\n0\n\n\n\n\n2\n\n\nBob\n\n\n1 985\n\n\nManager\n\n\n1\n\n\n1\n\n\n\n\n2\n\n\nBob\n\n\n1 986\n\n\nManager\n\n\n1\n\n\n2\n\n\n\n\n2\n\n\nBob\n\n\n1 987\n\n\nManager\n\n\n1\n\n\n3\n\n\n\n\n2\n\n\nBob\n\n\n1 988\n\n\nBoss\n\n\n0\n\n\n0\n\n\n\n\n\n\n\n\n\n\n\nNote\n\n\n\nHere, the grouping is done BEFORE the filter -> there will be empty groups, meaning they will sum to 0\n\n\ndata.table:\nSolution 1:\n\nDAT[ , .SD[job != \"Boss\" | year == min(year), .(cumu_job2 = cumsum(job2))], by = .(name, job)]\ndata.table [11 x 3]\n\n\n\nname\n\n\njob\n\n\ncumu_job2\n\n\n\n\n\nJane\n\n\nManager\n\n\n1\n\n\n\n\nJane\n\n\nManager\n\n\n2\n\n\n\n\nJane\n\n\nManager\n\n\n3\n\n\n\n\nJane\n\n\nManager\n\n\n4\n\n\n\n\nJane\n\n\nManager\n\n\n5\n\n\n\n\nJane\n\n\nManager\n\n\n6\n\n\n\n\nJane\n\n\nBoss\n\n\n0\n\n\n\n\nBob\n\n\nManager\n\n\n1\n\n\n\n\nBob\n\n\nManager\n\n\n2\n\n\n\n\nBob\n\n\nManager\n\n\n3\n\n\n\n\nBob\n\n\nBoss\n\n\n0\n\n\n\n\n\nSolution 2:\n\nDAT[ , .(cum_job2 = cumsum(job2[job != \"Boss\" | year == min(year)])), by = .(name, job)]\ndata.table [11 x 3]\n\n\n\nname\n\n\njob\n\n\ncum_job2\n\n\n\n\n\nJane\n\n\nManager\n\n\n1\n\n\n\n\nJane\n\n\nManager\n\n\n2\n\n\n\n\nJane\n\n\nManager\n\n\n3\n\n\n\n\nJane\n\n\nManager\n\n\n4\n\n\n\n\nJane\n\n\nManager\n\n\n5\n\n\n\n\nJane\n\n\nManager\n\n\n6\n\n\n\n\nJane\n\n\nBoss\n\n\n0\n\n\n\n\nBob\n\n\nManager\n\n\n1\n\n\n\n\nBob\n\n\nManager\n\n\n2\n\n\n\n\nBob\n\n\nManager\n\n\n3\n\n\n\n\nBob\n\n\nBoss\n\n\n0\n\n\n\n\n\nSolution 3:\n\nDAT[DAT[, .I[job != \"Boss\" | year == min(year)], by = .(name, job)]$V1\n  ][, cumu_job2 := cumsum(job2), by = .(name, job)][]\ndata.table [11 x 6]\n\n\n\nid\n\n\nname\n\n\nyear\n\n\njob\n\n\njob2\n\n\ncumu_job2\n\n\n\n\n\n1\n\n\nJane\n\n\n1 980\n\n\nManager\n\n\n1\n\n\n1\n\n\n\n\n1\n\n\nJane\n\n\n1 981\n\n\nManager\n\n\n1\n\n\n2\n\n\n\n\n1\n\n\nJane\n\n\n1 982\n\n\nManager\n\n\n1\n\n\n3\n\n\n\n\n1\n\n\nJane\n\n\n1 983\n\n\nManager\n\n\n1\n\n\n4\n\n\n\n\n1\n\n\nJane\n\n\n1 984\n\n\nManager\n\n\n1\n\n\n5\n\n\n\n\n1\n\n\nJane\n\n\n1 985\n\n\nManager\n\n\n1\n\n\n6\n\n\n\n\n1\n\n\nJane\n\n\n1 986\n\n\nBoss\n\n\n0\n\n\n0\n\n\n\n\n2\n\n\nBob\n\n\n1 985\n\n\nManager\n\n\n1\n\n\n1\n\n\n\n\n2\n\n\nBob\n\n\n1 986\n\n\nManager\n\n\n1\n\n\n2\n\n\n\n\n2\n\n\nBob\n\n\n1 987\n\n\nManager\n\n\n1\n\n\n3\n\n\n\n\n2\n\n\nBob\n\n\n1 988\n\n\nBoss\n\n\n0\n\n\n0\n\n\n\n\n\nIf we filtered after the grouping:\n\nDAT[job != \"Boss\" | year == min(year), list(cumu_job2 = cumsum(job2)), by = .(name, job)]\ndata.table [9 x 3]\n\n\n\nname\n\n\njob\n\n\ncumu_job2\n\n\n\n\n\nJane\n\n\nManager\n\n\n1\n\n\n\n\nJane\n\n\nManager\n\n\n2\n\n\n\n\nJane\n\n\nManager\n\n\n3\n\n\n\n\nJane\n\n\nManager\n\n\n4\n\n\n\n\nJane\n\n\nManager\n\n\n5\n\n\n\n\nJane\n\n\nManager\n\n\n6\n\n\n\n\nBob\n\n\nManager\n\n\n1\n\n\n\n\nBob\n\n\nManager\n\n\n2\n\n\n\n\nBob\n\n\nManager\n\n\n3"
  },
  {
    "objectID": "content/posts/data.table/index.html#group-summarize-join-mutate",
    "href": "content/posts/data.table/index.html#group-summarize-join-mutate",
    "title": "Tidyverse <-> data.table",
    "section": "\n5.3 GROUP > SUMMARIZE > JOIN > MUTATE",
    "text": "5.3 GROUP > SUMMARIZE > JOIN > MUTATE\nData:\n\n(GSJM1 <- data.table(x = c(1,1,1,1,2,2,2,2), y = c(\"a\", \"a\", \"b\", \"b\"), z = 1:8, key = c(\"x\", \"y\")))\ndata.table [8 x 3]\n\n\n\nx\n\n\ny\n\n\nz\n\n\n\n\n\n1\n\n\na\n\n\n1\n\n\n\n\n1\n\n\na\n\n\n2\n\n\n\n\n1\n\n\nb\n\n\n3\n\n\n\n\n1\n\n\nb\n\n\n4\n\n\n\n\n2\n\n\na\n\n\n5\n\n\n\n\n2\n\n\na\n\n\n6\n\n\n\n\n2\n\n\nb\n\n\n7\n\n\n\n\n2\n\n\nb\n\n\n8\n\n\n\n(GSJM2 <- data.table(x = 1:2, y = c(\"a\", \"b\"), mul = 4:3, key = c(\"x\", \"y\")))\ndata.table [2 x 3]\n\n\n\nx\n\n\ny\n\n\nmul\n\n\n\n\n\n1\n\n\na\n\n\n4\n\n\n\n\n2\n\n\nb\n\n\n3\n\n\n\n\n\nTidyverse:\n\nas.data.frame(GSJM1) |> \n  group_by(x, y) |>\n  summarise(z = sum(z)) |>\n  ungroup() |> \n  right_join(GSJM2) |>\n  mutate(z = z * mul) |> \n  select(-mul)\ndata.frame [2 x 3]\n\n\n\nx\n\n\ny\n\n\nz\n\n\n\n\n\n1\n\n\na\n\n\n12\n\n\n\n\n2\n\n\nb\n\n\n45\n\n\n\n\n\ndata.table:\nBasic:\n\nGSJM1[, .(z = sum(z)), by = .(x, y)][GSJM2][, let(z = z * mul, mul = NULL)][]\ndata.table [2 x 3]\n\n\n\nx\n\n\ny\n\n\nz\n\n\n\n\n\n1\n\n\na\n\n\n12\n\n\n\n\n2\n\n\nb\n\n\n45\n\n\n\n\n\nAdvanced (using .EACHI):\n\n\n\nGSJM1[GSJM2, .(z = sum(z) * mul), by = .EACHI]\ndata.table [2 x 3]\n\n\n\nx\n\n\ny\n\n\nz\n\n\n\n\n\n1\n\n\na\n\n\n12\n\n\n\n\n2\n\n\nb\n\n\n45"
  },
  {
    "objectID": "content/posts/data.table/index.html#separating-rows-cleaning-text",
    "href": "content/posts/data.table/index.html#separating-rows-cleaning-text",
    "title": "Tidyverse <-> data.table",
    "section": "\n5.4 Separating rows & cleaning text:",
    "text": "5.4 Separating rows & cleaning text:\nData\n\n(DT_COMA <- data.table(\n  first = c(1,\"2,3\",3,4,5,6.5,7,8,9,0), \n  second = c(1,\"2,,5\",3,4,5,\"6,5,9\",7,8,9,0), \n  third = c(\"one\", \"two\", \"thr,ee\", \"four\", \"five\", \"six\", \"sev,en\", \"eight\", \"nine\", \"zero\"), \n  fourth = as.Date(c(1/1/2020, 2/1/2020, 3/1/2020, 4/1/2020, 5/1/2020, 6/1/2020, 7/1/2020, 8/1/2020, 9/1/2020, 10/1/2020), origin = \"1970-01-01\")\n  )\n)\ndata.table [10 x 4]\n\n\n\nfirst\n\n\nsecond\n\n\nthird\n\n\nfourth\n\n\n\n\n\n1\n\n\n1\n\n\none\n\n\n1970-01-01\n\n\n\n\n2,3\n\n\n2,,5\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n3\n\n\n3\n\n\nthr,ee\n\n\n1970-01-01\n\n\n\n\n4\n\n\n4\n\n\nfour\n\n\n1970-01-01\n\n\n\n\n5\n\n\n5\n\n\nfive\n\n\n1970-01-01\n\n\n\n\n6.5\n\n\n6,5,9\n\n\nsix\n\n\n1970-01-01\n\n\n\n\n7\n\n\n7\n\n\nsev,en\n\n\n1970-01-01\n\n\n\n\n8\n\n\n8\n\n\neight\n\n\n1970-01-01\n\n\n\n\n9\n\n\n9\n\n\nnine\n\n\n1970-01-01\n\n\n\n\n0\n\n\n0\n\n\nzero\n\n\n1970-01-01\n\n\n\n\n\n\n5.4.1 Step1: Cleaning\nRemoving unwanted commas within words\nTidyverse:\n\nDT_COMA |> mutate(across(where(\\(v) is.character(v) & all(is.na(as.numeric(v)))), \\(v) str_remove_all(v, \",\")))\ndata.table [10 x 4]\n\n\n\nfirst\n\n\nsecond\n\n\nthird\n\n\nfourth\n\n\n\n\n\n1\n\n\n1\n\n\none\n\n\n1970-01-01\n\n\n\n\n2,3\n\n\n2,,5\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n3\n\n\n3\n\n\nthree\n\n\n1970-01-01\n\n\n\n\n4\n\n\n4\n\n\nfour\n\n\n1970-01-01\n\n\n\n\n5\n\n\n5\n\n\nfive\n\n\n1970-01-01\n\n\n\n\n6.5\n\n\n6,5,9\n\n\nsix\n\n\n1970-01-01\n\n\n\n\n7\n\n\n7\n\n\nseven\n\n\n1970-01-01\n\n\n\n\n8\n\n\n8\n\n\neight\n\n\n1970-01-01\n\n\n\n\n9\n\n\n9\n\n\nnine\n\n\n1970-01-01\n\n\n\n\n0\n\n\n0\n\n\nzero\n\n\n1970-01-01\n\n\n\n\n\ndata.table:\n\ncols_to_clean <- DT_COMA[, .SD, .SDcols = \\(v) is.character(v) & all(is.na(as.numeric(v)))] |> colnames()\n\ncopy(DT_COMA)[, c(cols_to_clean) := map(.SD[, cols_to_clean, with = F], \\(v) str_remove_all(v, \",\"))][]\ndata.table [10 x 4]\n\n\n\nfirst\n\n\nsecond\n\n\nthird\n\n\nfourth\n\n\n\n\n\n1\n\n\n1\n\n\none\n\n\n1970-01-01\n\n\n\n\n2,3\n\n\n2,,5\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n3\n\n\n3\n\n\nthree\n\n\n1970-01-01\n\n\n\n\n4\n\n\n4\n\n\nfour\n\n\n1970-01-01\n\n\n\n\n5\n\n\n5\n\n\nfive\n\n\n1970-01-01\n\n\n\n\n6.5\n\n\n6,5,9\n\n\nsix\n\n\n1970-01-01\n\n\n\n\n7\n\n\n7\n\n\nseven\n\n\n1970-01-01\n\n\n\n\n8\n\n\n8\n\n\neight\n\n\n1970-01-01\n\n\n\n\n9\n\n\n9\n\n\nnine\n\n\n1970-01-01\n\n\n\n\n0\n\n\n0\n\n\nzero\n\n\n1970-01-01\n\n\n\n\n\n\n5.4.2 Step 2: Separating rows\nEach numeric row that has multiple comma-separated values has to be split into multiple rows (one value per row)\nTidyverse:\n\ncols_to_separate <- DT_COMA |> select(where(\\(v) is.character(v) & any(!is.na(as.numeric(v))))) |> colnames()\n\nreduce(\n  cols_to_separate, \n  \\(acc, col) acc |> tidyr::separate_rows(col, sep = \",\", convert = T), \n  .init = DT_COMA\n)\ndata.frame [17 x 4]\n\n\n\nfirst\n\n\nsecond\n\n\nthird\n\n\nfourth\n\n\n\n\n\n1\n\n\n1\n\n\none\n\n\n1970-01-01\n\n\n\n\n2\n\n\n2\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n2\n\n\nNA\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n2\n\n\n5\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n3\n\n\n2\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n3\n\n\nNA\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n3\n\n\n5\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n3\n\n\n3\n\n\nthr,ee\n\n\n1970-01-01\n\n\n\n\n4\n\n\n4\n\n\nfour\n\n\n1970-01-01\n\n\n\n\n5\n\n\n5\n\n\nfive\n\n\n1970-01-01\n\n\n\n\n6.5\n\n\n6\n\n\nsix\n\n\n1970-01-01\n\n\n\n\n6.5\n\n\n5\n\n\nsix\n\n\n1970-01-01\n\n\n\n\n6.5\n\n\n9\n\n\nsix\n\n\n1970-01-01\n\n\n\n\n7\n\n\n7\n\n\nsev,en\n\n\n1970-01-01\n\n\n\n\n8\n\n\n8\n\n\neight\n\n\n1970-01-01\n\n\n\n\n\n[ omitted 2 entries ]\n\n\n\n\ndata.table:\n\ncols_to_separate <- DT_COMA[, .SD, .SDcols = \\(v) is.character(v) & any(!is.na(as.numeric(v)))] |> colnames()\n\n(reduce(\n  cols_to_separate,\n  \\(acc, col) acc[rep(1:.N, lengths(strsplit(get(col), \",\")))][, (col) := type.convert(unlist(strsplit(acc[[col]], \",\", fixed = T)), as.is = T, na.strings = \"\")],\n  .init = DT_COMA\n))[]\ndata.table [17 x 4]\n\n\n\nfirst\n\n\nsecond\n\n\nthird\n\n\nfourth\n\n\n\n\n\n1\n\n\n1\n\n\none\n\n\n1970-01-01\n\n\n\n\n2\n\n\n2\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n2\n\n\nNA\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n2\n\n\n5\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n3\n\n\n2\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n3\n\n\nNA\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n3\n\n\n5\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n3\n\n\n3\n\n\nthr,ee\n\n\n1970-01-01\n\n\n\n\n4\n\n\n4\n\n\nfour\n\n\n1970-01-01\n\n\n\n\n5\n\n\n5\n\n\nfive\n\n\n1970-01-01\n\n\n\n\n6.5\n\n\n6\n\n\nsix\n\n\n1970-01-01\n\n\n\n\n6.5\n\n\n5\n\n\nsix\n\n\n1970-01-01\n\n\n\n\n6.5\n\n\n9\n\n\nsix\n\n\n1970-01-01\n\n\n\n\n7\n\n\n7\n\n\nsev,en\n\n\n1970-01-01\n\n\n\n\n8\n\n\n8\n\n\neight\n\n\n1970-01-01\n\n\n\n\n\n[ omitted 2 entries ]\n\n\n\n\n\n5.4.3 Combining both steps:\nTidyverse:\n\nDT_COMA <- DT_COMA |> mutate(across(where(\\(v) is.character(v) & all(is.na(as.numeric(v)))), \\(v) str_remove_all(v, \",\")))\n\nreduce(\n  select(DT_COMA, where(\\(v) is.character(v) & any(!is.na(as.numeric(v))))) |> colnames(), \n  \\(acc, col) acc |> tidyr::separate_rows(col, sep = \",\", convert = T), \n  .init = DT_COMA\n)\ndata.frame [17 x 4]\n\n\n\nfirst\n\n\nsecond\n\n\nthird\n\n\nfourth\n\n\n\n\n\n1\n\n\n1\n\n\none\n\n\n1970-01-01\n\n\n\n\n2\n\n\n2\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n2\n\n\nNA\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n2\n\n\n5\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n3\n\n\n2\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n3\n\n\nNA\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n3\n\n\n5\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n3\n\n\n3\n\n\nthree\n\n\n1970-01-01\n\n\n\n\n4\n\n\n4\n\n\nfour\n\n\n1970-01-01\n\n\n\n\n5\n\n\n5\n\n\nfive\n\n\n1970-01-01\n\n\n\n\n6.5\n\n\n6\n\n\nsix\n\n\n1970-01-01\n\n\n\n\n6.5\n\n\n5\n\n\nsix\n\n\n1970-01-01\n\n\n\n\n6.5\n\n\n9\n\n\nsix\n\n\n1970-01-01\n\n\n\n\n7\n\n\n7\n\n\nseven\n\n\n1970-01-01\n\n\n\n\n8\n\n\n8\n\n\neight\n\n\n1970-01-01\n\n\n\n\n\n[ omitted 2 entries ]\n\n\n\n\ndata.table:\n\ncols_to_clean <- DT_COMA[, .SD, .SDcols = \\(v) is.character(v) & all(is.na(as.numeric(v)))] |> colnames()\ncols_to_separate <- DT_COMA[, .SD, .SDcols = \\(v) is.character(v) & any(!is.na(as.numeric(v)))] |> colnames()\n\nDT_COMA[, c(cols_to_clean) := map(.SD[, cols_to_clean, with = F], \\(v) str_remove_all(v, \",\"))]\ndata.table [10 x 4]\n\n\n\nfirst\n\n\nsecond\n\n\nthird\n\n\nfourth\n\n\n\n\n\n1\n\n\n1\n\n\none\n\n\n1970-01-01\n\n\n\n\n2,3\n\n\n2,,5\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n3\n\n\n3\n\n\nthree\n\n\n1970-01-01\n\n\n\n\n4\n\n\n4\n\n\nfour\n\n\n1970-01-01\n\n\n\n\n5\n\n\n5\n\n\nfive\n\n\n1970-01-01\n\n\n\n\n6.5\n\n\n6,5,9\n\n\nsix\n\n\n1970-01-01\n\n\n\n\n7\n\n\n7\n\n\nseven\n\n\n1970-01-01\n\n\n\n\n8\n\n\n8\n\n\neight\n\n\n1970-01-01\n\n\n\n\n9\n\n\n9\n\n\nnine\n\n\n1970-01-01\n\n\n\n\n0\n\n\n0\n\n\nzero\n\n\n1970-01-01\n\n\n\n(reduce(\n  cols_to_separate,\n  \\(acc, col) acc[rep(1:.N, lengths(strsplit(get(col), \",\")))][, (col) := type.convert(unlist(strsplit(acc[[col]], \",\", fixed = T)), as.is = T, na.strings = \"\")],\n  .init = DT_COMA\n))[]\ndata.table [17 x 4]\n\n\n\nfirst\n\n\nsecond\n\n\nthird\n\n\nfourth\n\n\n\n\n\n1\n\n\n1\n\n\none\n\n\n1970-01-01\n\n\n\n\n2\n\n\n2\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n2\n\n\nNA\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n2\n\n\n5\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n3\n\n\n2\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n3\n\n\nNA\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n3\n\n\n5\n\n\ntwo\n\n\n1970-01-01\n\n\n\n\n3\n\n\n3\n\n\nthree\n\n\n1970-01-01\n\n\n\n\n4\n\n\n4\n\n\nfour\n\n\n1970-01-01\n\n\n\n\n5\n\n\n5\n\n\nfive\n\n\n1970-01-01\n\n\n\n\n6.5\n\n\n6\n\n\nsix\n\n\n1970-01-01\n\n\n\n\n6.5\n\n\n5\n\n\nsix\n\n\n1970-01-01\n\n\n\n\n6.5\n\n\n9\n\n\nsix\n\n\n1970-01-01\n\n\n\n\n7\n\n\n7\n\n\nseven\n\n\n1970-01-01\n\n\n\n\n8\n\n\n8\n\n\neight\n\n\n1970-01-01\n\n\n\n\n\n[ omitted 2 entries ]"
  },
  {
    "objectID": "content/posts/data.table/index.html#multiple-choice-questions",
    "href": "content/posts/data.table/index.html#multiple-choice-questions",
    "title": "Tidyverse <-> data.table",
    "section": "\n5.5 Multiple choice questions:",
    "text": "5.5 Multiple choice questions:\nData:\n\n\n\n\nsurv\ndata.frame [5 x 2]\n\n\n\nID\n\n\nresponse\n\n\n\n\n\n1\n\n\nI read the assigned readings.|I reread my notes.|I worked with one or more classmates.\n\n\n\n\n2\n\n\nI read the assigned readings.|I reviewed this week’s slides.\n\n\n\n\n3\n\n\nI worked on practice problems.|I read the assigned readings.|I reread my notes.\n\n\n\n\n4\n\n\nI worked on practice problems.|I read the assigned readings.|I reread my notes.\n\n\n\n\n5\n\n\nI worked on practice problems.|I read the assigned readings.|I reread my notes.|I reviewed this week’s slides.|I worked with one or more classmates.\n\n\n\n\n\nHere we will spread the answers into their own columns using a pivot because not all rows have all the possible answers:\nTidyverse:\n\nsurv |> \n  mutate(response = str_split(response, fixed(\"|\"))) |> \n  unnest(response) |> \n  pivot_wider(id_cols = ID, names_from = response, values_from = response, values_fn = \\(.x) sum(!is.na(.x)), values_fill = 0)\ndata.frame [5 x 6]\n\n\n\nID\n\n\nI read the assigned readings.\n\n\nI reread my notes.\n\n\nI worked with one or more classmates.\n\n\nI reviewed this week’s slides.\n\n\nI worked on practice problems.\n\n\n\n\n\n1\n\n\n1\n\n\n1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n2\n\n\n1\n\n\n0\n\n\n0\n\n\n1\n\n\n0\n\n\n\n\n3\n\n\n1\n\n\n1\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n4\n\n\n1\n\n\n1\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n5\n\n\n1\n\n\n1\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n\ndata.table:\n\nSURV[, c(.SD, tstrsplit(response, \"|\", fixed = T))][, -\"response\"] |> \n  melt(measure.vars = patterns(\"^V\")) |> \n  dcast(ID ~ value, fun.agg = \\(.x) sum(!is.na(.x)), subset = .(!is.na(value)))\ndata.table [5 x 6]\n\n\n\nID\n\n\nI read the assigned readings.\n\n\nI reread my notes.\n\n\nI reviewed this week’s slides.\n\n\nI worked on practice problems.\n\n\nI worked with one or more classmates.\n\n\n\n\n\n1\n\n\n1\n\n\n1\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n2\n\n\n1\n\n\n0\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n3\n\n\n1\n\n\n1\n\n\n0\n\n\n1\n\n\n0\n\n\n\n\n4\n\n\n1\n\n\n1\n\n\n0\n\n\n1\n\n\n0\n\n\n\n\n5\n\n\n1\n\n\n1\n\n\n1\n\n\n1\n\n\n1"
  },
  {
    "objectID": "content/posts/data.table/index.html#filling-with-lagging-conditions",
    "href": "content/posts/data.table/index.html#filling-with-lagging-conditions",
    "title": "Tidyverse <-> data.table",
    "section": "\n5.6 Filling with lagging conditions:",
    "text": "5.6 Filling with lagging conditions:\nTask: See this SO question.\nData:\n\nZIP <- structure(\n  list(\n    zipcode = c(1001, 1002, 1003, 1004, 1101, 1102, 1103, 1104, 1201, 1202, 1203, 1302), \n    areacode = c(4, 4, NA, 4, 4, 4, NA, 1, 4, 4, NA, 4), \n    type = structure(c(1L, 1L, NA, 1L, 2L, 2L, NA, 1L, 1L, 1L, NA, 1L), .Label = c(\"clay\", \"sand\"), class = \"factor\"), \n    region = c(3, 3, NA, 3, 3, 3, NA, 3, 3, 3, NA, 3), \n    do_not_fill = c(1, NA, NA, 1, 1, NA, NA, 1, NA, NA, NA, 1)\n    ), \n  class = c(\"data.table\", \"data.frame\"), row.names = c(NA, -4L)\n)\n\nTidyverse:\n\nas_tibble(ZIP) |>\n  mutate(type = as.character(type)) |>\n  mutate(\n    across(1:4, ~ ifelse(\n        is.na(.) & lag(areacode) == lead(areacode) & \n          lag(as.numeric(substr(zipcode, 1, 2))) == lead(as.numeric(substr(zipcode, 1, 2))),\n        lag(.), .\n      )\n    )\n  )\ndata.frame [12 x 5]\n\n\n\nzipcode\n\n\nareacode\n\n\ntype\n\n\nregion\n\n\ndo_not_fill\n\n\n\n\n\n1 001\n\n\n4\n\n\nclay\n\n\n3\n\n\n1\n\n\n\n\n1 002\n\n\n4\n\n\nclay\n\n\n3\n\n\nNA\n\n\n\n\n1 003\n\n\n4\n\n\nclay\n\n\n3\n\n\nNA\n\n\n\n\n1 004\n\n\n4\n\n\nclay\n\n\n3\n\n\n1\n\n\n\n\n1 101\n\n\n4\n\n\nsand\n\n\n3\n\n\n1\n\n\n\n\n1 102\n\n\n4\n\n\nsand\n\n\n3\n\n\nNA\n\n\n\n\n1 103\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n1 104\n\n\n1\n\n\nclay\n\n\n3\n\n\n1\n\n\n\n\n1 201\n\n\n4\n\n\nclay\n\n\n3\n\n\nNA\n\n\n\n\n1 202\n\n\n4\n\n\nclay\n\n\n3\n\n\nNA\n\n\n\n\n1 203\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n1 302\n\n\n4\n\n\nclay\n\n\n3\n\n\n1\n\n\n\n\n\ndata.table:\n\nZIP[, c(lapply(.SD, \\(v) {fifelse(\n  is.na(areacode) & lag(areacode) == lead(areacode) &\n    lag(as.numeric(substr(zipcode, 1, 2))) == lead(as.numeric(substr(zipcode, 1, 2))), lag(v), v)}), \n  .SD[, .(do_not_fill)]), .SDcols = !patterns(\"do_not_fill\")]\ndata.table [12 x 5]\n\n\n\nzipcode\n\n\nareacode\n\n\ntype\n\n\nregion\n\n\ndo_not_fill\n\n\n\n\n\n1 001\n\n\n4\n\n\nclay\n\n\n3\n\n\n1\n\n\n\n\n1 002\n\n\n4\n\n\nclay\n\n\n3\n\n\nNA\n\n\n\n\n1 002\n\n\n4\n\n\nclay\n\n\n3\n\n\nNA\n\n\n\n\n1 004\n\n\n4\n\n\nclay\n\n\n3\n\n\n1\n\n\n\n\n1 101\n\n\n4\n\n\nsand\n\n\n3\n\n\n1\n\n\n\n\n1 102\n\n\n4\n\n\nsand\n\n\n3\n\n\nNA\n\n\n\n\n1 103\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n1 104\n\n\n1\n\n\nclay\n\n\n3\n\n\n1\n\n\n\n\n1 201\n\n\n4\n\n\nclay\n\n\n3\n\n\nNA\n\n\n\n\n1 202\n\n\n4\n\n\nclay\n\n\n3\n\n\nNA\n\n\n\n\n1 203\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n1 302\n\n\n4\n\n\nclay\n\n\n3\n\n\n1"
  },
  {
    "objectID": "content/posts/data.table/index.html#join-coalesce",
    "href": "content/posts/data.table/index.html#join-coalesce",
    "title": "Tidyverse <-> data.table",
    "section": "\n5.7 Join + Coalesce:",
    "text": "5.7 Join + Coalesce:\nTask: Replace the missing dates from one dataset with the earliest date from another dataset, matching by ID:\nData:\n\n(dt1 <- data.table::fread(\n\"\n      id  x       y   z         \n     1    A       1    NA        \n     2    C       3    NA        \n     3    C       3    NA        \n     4    C       2    NA        \n     5    B       2    2019-08-04\n     6    C       1    2019-09-18\n     7    B       3    2019-12-17\n     8    A       2    2019-11-02\n     9    A       3    2020-03-16\n    10    A       1    2020-01-31\n\"\n))\ndata.table [10 x 4]\n\n\n\nid\n\n\nx\n\n\ny\n\n\nz\n\n\n\n\n\n1\n\n\nA\n\n\n1\n\n\nNA\n\n\n\n\n2\n\n\nC\n\n\n3\n\n\nNA\n\n\n\n\n3\n\n\nC\n\n\n3\n\n\nNA\n\n\n\n\n4\n\n\nC\n\n\n2\n\n\nNA\n\n\n\n\n5\n\n\nB\n\n\n2\n\n\n2019-08-04\n\n\n\n\n6\n\n\nC\n\n\n1\n\n\n2019-09-18\n\n\n\n\n7\n\n\nB\n\n\n3\n\n\n2019-12-17\n\n\n\n\n8\n\n\nA\n\n\n2\n\n\n2019-11-02\n\n\n\n\n9\n\n\nA\n\n\n3\n\n\n2020-03-16\n\n\n\n\n10\n\n\nA\n\n\n1\n\n\n2020-01-31\n\n\n\n(dt2 <- data.table::fread(\n\"      id      date\n      1      2012-09-25\n      1      2012-03-26\n      1      2012-11-12\n      2      2013-01-24\n      2      2012-05-04\n      2      2012-02-24\n      3      2012-05-30\n      3      2012-02-15\n      4      2012-03-13\n      4      2012-05-18\n\"))\ndata.table [10 x 2]\n\n\n\nid\n\n\ndate\n\n\n\n\n\n1\n\n\n2012-09-25\n\n\n\n\n1\n\n\n2012-03-26\n\n\n\n\n1\n\n\n2012-11-12\n\n\n\n\n2\n\n\n2013-01-24\n\n\n\n\n2\n\n\n2012-05-04\n\n\n\n\n2\n\n\n2012-02-24\n\n\n\n\n3\n\n\n2012-05-30\n\n\n\n\n3\n\n\n2012-02-15\n\n\n\n\n4\n\n\n2012-03-13\n\n\n\n\n4\n\n\n2012-05-18\n\n\n\n\n\nTidyverse:\nUsing coalesce:\n\nleft_join(\n  dt1, \n  dt2 |> group_by(id) |> summarize(date = min(date)), \n  by = \"id\"\n) |> mutate(date = coalesce(z, date), z = NULL)\ndata.table [10 x 4]\n\n\n\nid\n\n\nx\n\n\ny\n\n\ndate\n\n\n\n\n\n1\n\n\nA\n\n\n1\n\n\n2012-03-26\n\n\n\n\n2\n\n\nC\n\n\n3\n\n\n2012-02-24\n\n\n\n\n3\n\n\nC\n\n\n3\n\n\n2012-02-15\n\n\n\n\n4\n\n\nC\n\n\n2\n\n\n2012-03-13\n\n\n\n\n5\n\n\nB\n\n\n2\n\n\n2019-08-04\n\n\n\n\n6\n\n\nC\n\n\n1\n\n\n2019-09-18\n\n\n\n\n7\n\n\nB\n\n\n3\n\n\n2019-12-17\n\n\n\n\n8\n\n\nA\n\n\n2\n\n\n2019-11-02\n\n\n\n\n9\n\n\nA\n\n\n3\n\n\n2020-03-16\n\n\n\n\n10\n\n\nA\n\n\n1\n\n\n2020-01-31\n\n\n\n\n\nUsing the rows_* functions:\n\nrows_patch(\n  dt1 |> rename(date = z), \n  dt2 |> group_by(id) |> summarize(date = min(date)), \n  by = \"id\"\n)\ndata.table [10 x 4]\n\n\n\nid\n\n\nx\n\n\ny\n\n\ndate\n\n\n\n\n\n1\n\n\nA\n\n\n1\n\n\n2012-03-26\n\n\n\n\n2\n\n\nC\n\n\n3\n\n\n2012-02-24\n\n\n\n\n3\n\n\nC\n\n\n3\n\n\n2012-02-15\n\n\n\n\n4\n\n\nC\n\n\n2\n\n\n2012-03-13\n\n\n\n\n5\n\n\nB\n\n\n2\n\n\n2019-08-04\n\n\n\n\n6\n\n\nC\n\n\n1\n\n\n2019-09-18\n\n\n\n\n7\n\n\nB\n\n\n3\n\n\n2019-12-17\n\n\n\n\n8\n\n\nA\n\n\n2\n\n\n2019-11-02\n\n\n\n\n9\n\n\nA\n\n\n3\n\n\n2020-03-16\n\n\n\n\n10\n\n\nA\n\n\n1\n\n\n2020-01-31\n\n\n\n\n\ndata.table:\nAs a right join:\n\ncopy(dt2)[, .(date = min(date)), by = id\n  ][dt1, on = \"id\"][, let(date = fcoalesce(date, z), z = NULL)][]\ndata.table [10 x 4]\n\n\n\nid\n\n\ndate\n\n\nx\n\n\ny\n\n\n\n\n\n1\n\n\n2012-03-26\n\n\nA\n\n\n1\n\n\n\n\n2\n\n\n2012-02-24\n\n\nC\n\n\n3\n\n\n\n\n3\n\n\n2012-02-15\n\n\nC\n\n\n3\n\n\n\n\n4\n\n\n2012-03-13\n\n\nC\n\n\n2\n\n\n\n\n5\n\n\n2019-08-04\n\n\nB\n\n\n2\n\n\n\n\n6\n\n\n2019-09-18\n\n\nC\n\n\n1\n\n\n\n\n7\n\n\n2019-12-17\n\n\nB\n\n\n3\n\n\n\n\n8\n\n\n2019-11-02\n\n\nA\n\n\n2\n\n\n\n\n9\n\n\n2020-03-16\n\n\nA\n\n\n3\n\n\n\n\n10\n\n\n2020-01-31\n\n\nA\n\n\n1\n\n\n\n\n\nAs a left join:\n\ncopy(dt1)[dt2[, .(date = min(date)), by = id], c(\"id\", \"date\") := .(i.id, i.date), on = \"id\"\n  ][, let(date = fcoalesce(date, z), z = NULL)][]\ndata.table [10 x 4]\n\n\n\nid\n\n\nx\n\n\ny\n\n\ndate\n\n\n\n\n\n1\n\n\nA\n\n\n1\n\n\n2012-03-26\n\n\n\n\n2\n\n\nC\n\n\n3\n\n\n2012-02-24\n\n\n\n\n3\n\n\nC\n\n\n3\n\n\n2012-02-15\n\n\n\n\n4\n\n\nC\n\n\n2\n\n\n2012-03-13\n\n\n\n\n5\n\n\nB\n\n\n2\n\n\n2019-08-04\n\n\n\n\n6\n\n\nC\n\n\n1\n\n\n2019-09-18\n\n\n\n\n7\n\n\nB\n\n\n3\n\n\n2019-12-17\n\n\n\n\n8\n\n\nA\n\n\n2\n\n\n2019-11-02\n\n\n\n\n9\n\n\nA\n\n\n3\n\n\n2020-03-16\n\n\n\n\n10\n\n\nA\n\n\n1\n\n\n2020-01-31"
  },
  {
    "objectID": "content/posts/data.table/index.html#join-on-multiple-columns-partial-matching",
    "href": "content/posts/data.table/index.html#join-on-multiple-columns-partial-matching",
    "title": "Tidyverse <-> data.table",
    "section": "\n5.8 Join on multiple columns (partial matching):",
    "text": "5.8 Join on multiple columns (partial matching):\nTask: Join both tables based on matching IDs, but the IDs are split between multiple columns in one table (id1 & id2).\n\n(dt1 <- data.table(id = c(\"ABC\", \"AAA\", \"CBC\"), x = 1:3))\ndata.table [3 x 2]\n\n\n\nid\n\n\nx\n\n\n\n\n\nABC\n\n\n1\n\n\n\n\nAAA\n\n\n2\n\n\n\n\nCBC\n\n\n3\n\n\n\n(dt2 <- data.table(\n  id1 = c(\"ABC\", \"AA\", \"CB\"), \n  id2 = c(\"AB\", \"AAA\", \"CBC\"), \n  y = c(0.307, 0.144, 0.786))\n)\ndata.table [3 x 3]\n\n\n\nid1\n\n\nid2\n\n\ny\n\n\n\n\n\nABC\n\n\nAB\n\n\n0.307\n\n\n\n\nAA\n\n\nAAA\n\n\n0.144\n\n\n\n\nCB\n\n\nCBC\n\n\n0.786\n\n\n\n\n\nSolution 1:\nCombine the two ID columns into one with pivot_longer, then join:\n\ndt2 |> pivot_longer(matches(\"^id\"), names_to = NULL, values_to = \"id\") |> right_join(dt1)\ndata.frame [3 x 3]\n\n\n\ny\n\n\nid\n\n\nx\n\n\n\n\n\n0.307\n\n\nABC\n\n\n1\n\n\n\n\n0.144\n\n\nAAA\n\n\n2\n\n\n\n\n0.786\n\n\nCBC\n\n\n3\n\n\n\n\n\n\nmelt(dt2, measure.vars = patterns(\"^id\"), value.name = \"id\")[, variable := NULL][dt1, on = \"id\"]\ndata.table [3 x 3]\n\n\n\ny\n\n\nid\n\n\nx\n\n\n\n\n\n0.307\n\n\nABC\n\n\n1\n\n\n\n\n0.144\n\n\nAAA\n\n\n2\n\n\n\n\n0.786\n\n\nCBC\n\n\n3\n\n\n\n\n\nSolution 2:\nCombine the two ID columns into one with unite + separate_rows, then join:\n(From @TimTeaFan\n\ndt2 |> unite(\"id\", id1, id2, sep = \"_\") |> separate_rows(\"id\") |> right_join(dt1)\ndata.frame [3 x 3]\n\n\n\nid\n\n\ny\n\n\nx\n\n\n\n\n\nABC\n\n\n0.307\n\n\n1\n\n\n\n\nAAA\n\n\n0.144\n\n\n2\n\n\n\n\nCBC\n\n\n0.786\n\n\n3\n\n\n\n\n\n\ncopy(dt2)[, id := paste(id1, id2, sep = \"_\")\n        ][, c(V1 = strsplit(id, \"_\", fixed = TRUE), .SD), by = id\n        ][, let(id = V1, V1 = NULL, id1 = NULL, id2 = NULL)\n        ][dt1, on = \"id\"]\ndata.table [3 x 3]\n\n\n\nid\n\n\ny\n\n\nx\n\n\n\n\n\nABC\n\n\n0.307\n\n\n1\n\n\n\n\nAAA\n\n\n0.144\n\n\n2\n\n\n\n\nCBC\n\n\n0.786\n\n\n3\n\n\n\n\n\nSolution 3:\nJoin on one of the two columns (id2 here), and then fill in (patch) the missing values:\n\nleft_join(dt2, dt1, by = c(\"id2\" = \"id\")) |> \n  rows_patch(rename(dt1, id1 = id), unmatched = \"ignore\")\ndata.table [3 x 4]\n\n\n\nid1\n\n\nid2\n\n\ny\n\n\nx\n\n\n\n\n\nABC\n\n\nAB\n\n\n0.307\n\n\n1\n\n\n\n\nAA\n\n\nAAA\n\n\n0.144\n\n\n2\n\n\n\n\nCB\n\n\nCBC\n\n\n0.786\n\n\n3"
  },
  {
    "objectID": "content/posts/data.table/index.html#merging-rows-across-multiple-columns-every-x-rows",
    "href": "content/posts/data.table/index.html#merging-rows-across-multiple-columns-every-x-rows",
    "title": "Tidyverse <-> data.table",
    "section": "\n5.9 Merging rows across multiple columns (every X rows):",
    "text": "5.9 Merging rows across multiple columns (every X rows):\nData:\n\n(BANK <- data.table(\n    date = c(\"30 feb\", \"NA\", \"NA\", \"NA\", \"31 feb\", \"NA\", \"NA\", \"NA\"), \n    description = c(\"Mary\", \"had a\", \"little\", \"lamb\", \"Twinkle\", \"twinkle\", \"little\", \"star\"), \n    withdrawal = c(\"100\", \"NA\", \"NA\", \"NA\", \"NA\", \"NA\", \"NA\", \"NA\"), \n    deposit = c(\"NA\", \"NA\", \"NA\", \"NA\", \"100\", \"NA\", \"NA\", \"NA\")\n  )[, lapply(.SD, \\(c) type.convert(c, as.is = T))]\n)\ndata.table [8 x 4]\n\n\n\ndate\n\n\ndescription\n\n\nwithdrawal\n\n\ndeposit\n\n\n\n\n\n30 feb\n\n\nMary\n\n\n100\n\n\nNA\n\n\n\n\nNA\n\n\nhad a\n\n\nNA\n\n\nNA\n\n\n\n\nNA\n\n\nlittle\n\n\nNA\n\n\nNA\n\n\n\n\nNA\n\n\nlamb\n\n\nNA\n\n\nNA\n\n\n\n\n31 feb\n\n\nTwinkle\n\n\nNA\n\n\n100\n\n\n\n\nNA\n\n\ntwinkle\n\n\nNA\n\n\nNA\n\n\n\n\nNA\n\n\nlittle\n\n\nNA\n\n\nNA\n\n\n\n\nNA\n\n\nstar\n\n\nNA\n\n\nNA\n\n\n\n\n\n\nmerge_and_convert <- function(v) {\n  type.convert(v, as.is = T) |> na.omit() |> \n    paste(collapse = \" \") |> type.convert(as.is = T) |> \n    bind(x, ifelse(is.logical(x), as.integer(x), x))\n}\n\nTidyverse:\nSolution 1:\n\nmutate(BANK, ID = ceiling(seq_along(row_number())/4)) |> \n  group_by(ID) |> \n  summarize(across(everything(), \\(m) merge_and_convert(m)))\ndata.frame [2 x 5]\n\n\n\nID\n\n\ndate\n\n\ndescription\n\n\nwithdrawal\n\n\ndeposit\n\n\n\n\n\n1\n\n\n30 feb\n\n\nMary had a little lamb\n\n\n100\n\n\nNA\n\n\n\n\n2\n\n\n31 feb\n\n\nTwinkle twinkle little star\n\n\nNA\n\n\n100\n\n\n\n\n\nSolution 2:\n\nsummarize(BANK, across(\n  everything(), \n  \\(c) sapply(split(c, ceiling(seq_along(c)/4)), \\(m) merge_and_convert(m))\n))\ndata.frame [2 x 4]\n\n\n\ndate\n\n\ndescription\n\n\nwithdrawal\n\n\ndeposit\n\n\n\n\n\n30 feb\n\n\nMary had a little lamb\n\n\n100\n\n\nNA\n\n\n\n\n31 feb\n\n\nTwinkle twinkle little star\n\n\nNA\n\n\n100\n\n\n\n\n\ndata.table:\n\nBANK[, lapply(.SD, \\(c) sapply(split(c, ceiling(seq_along(c)/4)), \\(m) merge_and_convert(m)))]\ndata.table [2 x 4]\n\n\n\ndate\n\n\ndescription\n\n\nwithdrawal\n\n\ndeposit\n\n\n\n\n\n30 feb\n\n\nMary had a little lamb\n\n\n100\n\n\nNA\n\n\n\n\n31 feb\n\n\nTwinkle twinkle little star\n\n\nNA\n\n\n100\n\n\n\n\n\n\ncopy(BANK)[, ID := ceiling(seq_along(.I)/4)][, lapply(.SD, \\(m) merge_and_convert(m)), by = ID][]\ndata.table [2 x 5]\n\n\n\nID\n\n\ndate\n\n\ndescription\n\n\nwithdrawal\n\n\ndeposit\n\n\n\n\n\n1\n\n\n30 feb\n\n\nMary had a little lamb\n\n\n100\n\n\nNA\n\n\n\n\n2\n\n\n31 feb\n\n\nTwinkle twinkle little star\n\n\nNA\n\n\n100"
  },
  {
    "objectID": "content/posts/data.table/index.html#tagging-successive-events",
    "href": "content/posts/data.table/index.html#tagging-successive-events",
    "title": "Tidyverse <-> data.table",
    "section": "\n5.10 Tagging successive events:",
    "text": "5.10 Tagging successive events:\nTagging repeated blocks of events (aka run length encoding):\n\n(dat <- data.frame(event = c(\n  rep(\"A\", 3),\n  rep(\"B\", 5),\n  rep(\"C\", 2),\n  rep(\"B\", 2),\n  rep(\"A\", 3)\n)))\ndata.frame [15 x 1]\n\n\n\nevent\n\n\n\n\n\nA\n\n\n\n\nA\n\n\n\n\nA\n\n\n\n\nB\n\n\n\n\nB\n\n\n\n\nB\n\n\n\n\nB\n\n\n\n\nB\n\n\n\n\nC\n\n\n\n\nC\n\n\n\n\nB\n\n\n\n\nB\n\n\n\n\nA\n\n\n\n\nA\n\n\n\n\nA\n\n\n\nDAT <- as.data.table(dat)\n\nManually:\n\ndat |> mutate(ID = with(rle(event), rep(seq_along(lengths), lengths)))\ndata.frame [15 x 2]\n\n\n\nevent\n\n\nID\n\n\n\n\n\nA\n\n\n1\n\n\n\n\nA\n\n\n1\n\n\n\n\nA\n\n\n1\n\n\n\n\nB\n\n\n2\n\n\n\n\nB\n\n\n2\n\n\n\n\nB\n\n\n2\n\n\n\n\nB\n\n\n2\n\n\n\n\nB\n\n\n2\n\n\n\n\nC\n\n\n3\n\n\n\n\nC\n\n\n3\n\n\n\n\nB\n\n\n4\n\n\n\n\nB\n\n\n4\n\n\n\n\nA\n\n\n5\n\n\n\n\nA\n\n\n5\n\n\n\n\nA\n\n\n5\n\n\n\ndat |> mutate(ID = c(0, cumsum(diff(as.integer(factor(event))) != 0)) + 1)\ndata.frame [15 x 2]\n\n\n\nevent\n\n\nID\n\n\n\n\n\nA\n\n\n1\n\n\n\n\nA\n\n\n1\n\n\n\n\nA\n\n\n1\n\n\n\n\nB\n\n\n2\n\n\n\n\nB\n\n\n2\n\n\n\n\nB\n\n\n2\n\n\n\n\nB\n\n\n2\n\n\n\n\nB\n\n\n2\n\n\n\n\nC\n\n\n3\n\n\n\n\nC\n\n\n3\n\n\n\n\nB\n\n\n4\n\n\n\n\nB\n\n\n4\n\n\n\n\nA\n\n\n5\n\n\n\n\nA\n\n\n5\n\n\n\n\nA\n\n\n5\n\n\n\n\n\nTidyverse:\n\ndat |> mutate(ID = consecutive_id(event))\ndata.frame [15 x 2]\n\n\n\nevent\n\n\nID\n\n\n\n\n\nA\n\n\n1\n\n\n\n\nA\n\n\n1\n\n\n\n\nA\n\n\n1\n\n\n\n\nB\n\n\n2\n\n\n\n\nB\n\n\n2\n\n\n\n\nB\n\n\n2\n\n\n\n\nB\n\n\n2\n\n\n\n\nB\n\n\n2\n\n\n\n\nC\n\n\n3\n\n\n\n\nC\n\n\n3\n\n\n\n\nB\n\n\n4\n\n\n\n\nB\n\n\n4\n\n\n\n\nA\n\n\n5\n\n\n\n\nA\n\n\n5\n\n\n\n\nA\n\n\n5\n\n\n\n\n\ndata.table:\n\nDAT[, ID := rleid(event)][]\ndata.table [15 x 2]\n\n\n\nevent\n\n\nID\n\n\n\n\n\nA\n\n\n1\n\n\n\n\nA\n\n\n1\n\n\n\n\nA\n\n\n1\n\n\n\n\nB\n\n\n2\n\n\n\n\nB\n\n\n2\n\n\n\n\nB\n\n\n2\n\n\n\n\nB\n\n\n2\n\n\n\n\nB\n\n\n2\n\n\n\n\nC\n\n\n3\n\n\n\n\nC\n\n\n3\n\n\n\n\nB\n\n\n4\n\n\n\n\nB\n\n\n4\n\n\n\n\nA\n\n\n5\n\n\n\n\nA\n\n\n5\n\n\n\n\nA\n\n\n5"
  },
  {
    "objectID": "content/posts/data.table/index.html#keywords",
    "href": "content/posts/data.table/index.html#keywords",
    "title": "Tidyverse <-> data.table",
    "section": "\n6.1 Keywords:",
    "text": "6.1 Keywords:\n.SD\n.I, .N\n.GRP, .NGRP\n.BY\n.EACHI"
  },
  {
    "objectID": "content/posts/data.table/index.html#useful-functions",
    "href": "content/posts/data.table/index.html#useful-functions",
    "title": "Tidyverse <-> data.table",
    "section": "\n6.2 Useful functions:",
    "text": "6.2 Useful functions:\nfsetdiff, fintersect, funion and fsetequal (apply to data.tables instead of vectors)\nnafill, fcoalesce\nas.IDate"
  },
  {
    "objectID": "content/posts/index.html",
    "href": "content/posts/index.html",
    "title": " Blog Posts",
    "section": "",
    "text": "Order By\n       Default\n         \n          Date - Oldest\n        \n         \n          Date - Newest\n        \n         \n          Title\n        \n     \n  \n    \n      \n      \n    \n\n\n\n\n\n\nFast spatial data matching in R\n\n\nHow to match locations based on their coordinates\n\n\n\n\nBig Data\n\n\nData Manipulation\n\n\nSpatial\n\n\nR\n\n\nSQL\n\n\n\n\nThis document was prompted by a reddit question on how to fill missing location names by matching them to other known locations by their geographical proximity (using lat/long coordinates). The question is apparently linked to a case study of Google’s Data Analytics certificate. To answer the question in a nutshell: the proposed matching by position won’t yield anything with this particular dataset. It appears that the locations missing a name or id are missing one because their coordinates lack the precision necessary to be reliably matched to a known station by proximity alone. This post showcases different solutions/packages to achieve the distance-based matching, with timings to compare their speed.\n\n\n\n\n\n\nJun 18, 2022\n\n\n18 min\n\n\n\n\n\n\n\n\nMCMC for ‘Big Data’ with Stan\n\n\nFaster sampling with CmdStan using within-chain parallelization\n\n\n\n\nStatistics\n\n\nML\n\n\nBayesian Modeling\n\n\nBig Data\n\n\nStan\n\n\nR\n\n\n\n\nThis is an extension (and a translation in R) of PyMC-Labs’ benchmarking of MCMC for Big Data. The Stan code was updated to use within-chain parallelization and compiler optimization for faster CPU sampling.\n\n\n\n\n\n\nJun 5, 2022\n\n\n8 min\n\n\n\n\n\n\n\n\nTidyverse <-> data.table\n\n\nEquivalence between Tidyverse and data.table expressions\n\n\n\n\nData Manipulation\n\n\nTidyverse\n\n\ndata.table\n\n\nR\n\n\n\n\nThis document is a collection of notes I took while learning to use data.table, summarizing the equivalences between most dplyr/tidyr verbs and data.table.\n\n\n\n\n\n\nMay 19, 2022\n\n\n44 min\n\n\n\n\n\n\n\n\nBayesian Rock Climbing Rankings\n\n\nWith R and Stan\n\n\n\n\nStatistics\n\n\nML\n\n\nBayesian Modeling\n\n\nStan\n\n\nR\n\n\n\n\nThis is a transposition of Ethan Rosenthal’s article on Bayesian Rock Climbing to R. The Stan code was updated to use within-chain parallelization and compiler optimization for faster CPU sampling. I included several translation options for the data processing, such as data.table, dtplyr, or dbplyr with a DuckDB backend, with timings.\n\n\n\n\n\n\nApr 19, 2022\n\n\n16 min\n\n\n\n\n\n\nNo matching items\n\nReusehttps://creativecommons.org/licenses/by/4.0/"
  },
  {
    "objectID": "content/posts/spatial/index.html#wide-format-original",
    "href": "content/posts/spatial/index.html#wide-format-original",
    "title": "Fast spatial data matching in R",
    "section": "\n1.1 Wide format (original)",
    "text": "1.1 Wide format (original)\n\n\ndata.table\nSQL (DuckDB)\n\n\n\n\nrides <- (\n  map(dir_ls(data_path, glob = \"*.csv\"), \\(f) fread(f, na.strings = \"\"))\n  |> list_rbind()\n  |> setkey(ride_id)\n)\n\n\n\nTime difference of 16.65 secs\n\n\n\n\n\nrides_con <- dbConnect(duckdb(), \":memory:\")\n\n\n\n\n\nduckdb_read_csv(rides_con, \"rides\", dir_ls(data_path, glob = \"*.csv\"))\n\ndb_create_index(rides_con, \"rides\", \"ride_id\")\n\n\n\nTime difference of 8.222 secs\n\n\n\n\n\n\n\ndata.frame [5,860,776 x 13]\n\n\n\nride_id\n\n\nrideable_type\n\n\nstarted_at\n\n\nended_at\n\n\nstart_station_name\n\n\nstart_station_id\n\n\nend_station_name\n\n\nend_station_id\n\n\nstart_lat\n\n\nstart_lng\n\n\nend_lat\n\n\nend_lng\n\n\nmember_casual\n\n\n\n\n\n00000123F60251E6\n\n\nclassic_bike\n\n\n2022-02-07 15:47:40\n\n\n2022-02-07 15:49:28\n\n\nWells St & Hubbard St\n\n\nTA1307000151\n\n\nKingsbury St & Kinzie St\n\n\nKA1503000043\n\n\n41.89\n\n\n−87.634\n\n\n41.889\n\n\n−87.639\n\n\nmember\n\n\n\n\n000002EBE159AE82\n\n\nelectric_bike\n\n\n2021-06-22 17:25:15\n\n\n2021-06-22 17:31:34\n\n\nClinton St & Jackson Blvd\n\n\n638\n\n\nMilwaukee Ave & Grand Ave\n\n\n13033\n\n\n41.878\n\n\n−87.641\n\n\n41.891\n\n\n−87.648\n\n\nmember\n\n\n\n\n0000080D43BAA9E4\n\n\nclassic_bike\n\n\n2021-08-29 15:38:05\n\n\n2021-08-29 16:24:03\n\n\nDearborn St & Van Buren St\n\n\n624\n\n\nFederal St & Polk St\n\n\nSL-008\n\n\n41.876\n\n\n−87.629\n\n\n41.872\n\n\n−87.63\n\n\ncasual\n\n\n\n\n00000B4F1F71F9C2\n\n\nelectric_bike\n\n\n2021-09-08 16:31:38\n\n\n2021-09-08 16:37:54\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n41.91\n\n\n−87.69\n\n\n41.91\n\n\n−87.7\n\n\nmember\n\n\n\n\n00000CAE95438C9D\n\n\nclassic_bike\n\n\n2021-07-20 15:40:46\n\n\n2021-07-20 17:38:17\n\n\nStreeter Dr & Grand Ave\n\n\n13022\n\n\nFairbanks Ct & Grand Ave\n\n\nTA1305000003\n\n\n41.892\n\n\n−87.612\n\n\n41.892\n\n\n−87.621\n\n\ncasual\n\n\n\n\n00000E22FBA89D81\n\n\nelectric_bike\n\n\n2022-05-19 14:42:55\n\n\n2022-05-19 14:54:03\n\n\nNA\n\n\nNA\n\n\nClark St & Armitage Ave\n\n\n13146\n\n\n41.9\n\n\n−87.62\n\n\n41.918\n\n\n−87.636\n\n\nmember\n\n\n\n\n00000EBBC119168C\n\n\nclassic_bike\n\n\n2021-10-31 11:30:37\n\n\n2021-10-31 11:39:27\n\n\nDorchester Ave & 49th St\n\n\nKA1503000069\n\n\nKimbark Ave & 53rd St\n\n\nTA1309000037\n\n\n41.806\n\n\n−87.592\n\n\n41.8\n\n\n−87.595\n\n\nmember\n\n\n\n\n000018B1D040DB44\n\n\nelectric_bike\n\n\n2022-04-25 10:37:22\n\n\n2022-04-25 10:44:19\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n41.79\n\n\n−87.6\n\n\n41.79\n\n\n−87.59\n\n\nmember\n\n\n\n\n000019B7F053D461\n\n\nclassic_bike\n\n\n2021-08-13 19:57:28\n\n\n2021-08-13 20:02:56\n\n\nLarrabee St & Webster Ave\n\n\n13193\n\n\nSheffield Ave & Webster Ave\n\n\nTA1309000033\n\n\n41.922\n\n\n−87.644\n\n\n41.922\n\n\n−87.654\n\n\nmember\n\n\n\n\n00001B4F79D102B5\n\n\nclassic_bike\n\n\n2021-07-28 07:58:27\n\n\n2021-07-28 08:05:00\n\n\nDuSable Lake Shore Dr & Belmont Ave\n\n\nTA1309000049\n\n\nBroadway & Waveland Ave\n\n\n13325\n\n\n41.941\n\n\n−87.639\n\n\n41.949\n\n\n−87.649\n\n\ncasual\n\n\n\n\n\n[ omitted 5,860,761 entries ]"
  },
  {
    "objectID": "content/posts/spatial/index.html#long-format",
    "href": "content/posts/spatial/index.html#long-format",
    "title": "Fast spatial data matching in R",
    "section": "\n1.2 Long format",
    "text": "1.2 Long format\n\n\ndata.table\ndtplyr\nSQL (DuckDB)\ndbplyr\n\n\n\n\nrides_l <- (melt(\n    rides,\n    measure = measure(way, value.name, pattern = \"(end|start).*(name|id|lat|lng)\")\n  )\n  |> setkey(ride_id, id)\n)\n\n\n\nTime difference of 5.768 secs\n\n\n\n\n\n(pivot_longer(\n    rides,\n    matches(\"^end_|^start_\"),\n    names_pattern = \"(end|start).*(name|id|lat|lng)\",\n    names_to = c(\"way\", \".value\")\n  ) \n  |> as.data.table()\n  |> setkey(ride_id, id)\n)\n\n\n\nTime difference of 13.37 secs\n\n\n\n\n\nCREATE TABLE rides_l AS \n(\n  SELECT\n    ride_id, rideable_type, started_at, ended_at,member_casual\n    , 'start' AS way\n    , start_station_name AS name\n    , start_station_id AS id\n    , start_lat AS lat\n    , start_lng AS lng\n  FROM rides\n)\nUNION ALL\n(\n  SELECT\n    ride_id, rideable_type, started_at, ended_at, member_casual\n    , 'end' AS way\n    , end_station_name AS name\n    , end_station_id AS id\n    , end_lat AS lat\n    , end_lng AS lng\n  FROM rides\n);\n\nCREATE INDEX station_idx ON rides_l (id);\n\n\n\nTime difference of 6.073 secs\n\n\n\n\n\n\n\n\nAlternatively\n\n\n\n\n\nWe can reuse an existinf df and directly add it (or bind it as a view) to the database:\n\ndbWriteTable(rides_con, \"rides_l\", rides_l) # As a TABLE\n\nduckdb_register(rides_con, \"rides_l\", rides_l) # As a VIEW\n\n\n\n\n\n\n\n(tbl(rides_con, \"rides\") \n  |> pivot_longer(\n    matches(\"^end_|^start_\"),\n    names_pattern = \"(end|start).*(name|id|lat|lng)\", \n    names_to = c(\"way\", \".value\")\n  )\n  |> compute(\"rides_l.dbp\")\n)\n\ndb_create_index(rides_con, \"rides_l.dbp\", \"id\")\n\n\n\nTime difference of 6.449 secs\n\n\n\n\n\n\n\ndata.frame [11,721,552 x 10]\n\n\n\nride_id\n\n\nrideable_type\n\n\nstarted_at\n\n\nended_at\n\n\nmember_casual\n\n\nway\n\n\nname\n\n\nid\n\n\nlat\n\n\nlng\n\n\n\n\n\n99FEC93BA843FB20\n\n\nelectric_bike\n\n\n2021-06-13 14:31:28\n\n\n2021-06-13 14:34:11\n\n\nmember\n\n\nstart\n\n\nNA\n\n\nNA\n\n\n41.8\n\n\n−87.59\n\n\n\n\n06048DCFC8520CAF\n\n\nelectric_bike\n\n\n2021-06-04 11:18:02\n\n\n2021-06-04 11:24:19\n\n\nmember\n\n\nstart\n\n\nNA\n\n\nNA\n\n\n41.79\n\n\n−87.59\n\n\n\n\n9598066F68045DF2\n\n\nelectric_bike\n\n\n2021-06-04 09:49:35\n\n\n2021-06-04 09:55:34\n\n\nmember\n\n\nstart\n\n\nNA\n\n\nNA\n\n\n41.8\n\n\n−87.6\n\n\n\n\nB03C0FE48C412214\n\n\nelectric_bike\n\n\n2021-06-03 19:56:05\n\n\n2021-06-03 20:21:55\n\n\nmember\n\n\nstart\n\n\nNA\n\n\nNA\n\n\n41.78\n\n\n−87.58\n\n\n\n\nB9EEA89F8FEE73B7\n\n\nelectric_bike\n\n\n2021-06-04 14:05:51\n\n\n2021-06-04 14:09:59\n\n\nmember\n\n\nstart\n\n\nNA\n\n\nNA\n\n\n41.8\n\n\n−87.59\n\n\n\n\n62B943CEAAA420BA\n\n\nelectric_bike\n\n\n2021-06-03 19:32:01\n\n\n2021-06-03 19:38:46\n\n\nmember\n\n\nstart\n\n\nNA\n\n\nNA\n\n\n41.78\n\n\n−87.58\n\n\n\n\n7E2546FBA79C46EE\n\n\nelectric_bike\n\n\n2021-06-10 16:30:10\n\n\n2021-06-10 16:36:21\n\n\nmember\n\n\nstart\n\n\nNA\n\n\nNA\n\n\n41.79\n\n\n−87.6\n\n\n\n\n3DDF3BBF6C4C3C89\n\n\nelectric_bike\n\n\n2021-06-10 17:00:30\n\n\n2021-06-10 17:06:48\n\n\nmember\n\n\nstart\n\n\nNA\n\n\nNA\n\n\n41.79\n\n\n−87.59\n\n\n\n\n2608805637155AB6\n\n\nelectric_bike\n\n\n2021-06-10 12:46:16\n\n\n2021-06-10 12:55:02\n\n\nmember\n\n\nstart\n\n\nNA\n\n\nNA\n\n\n41.93\n\n\n−87.67\n\n\n\n\nAF529C946F28ED42\n\n\nelectric_bike\n\n\n2021-06-23 17:57:29\n\n\n2021-06-23 18:06:40\n\n\nmember\n\n\nstart\n\n\nNA\n\n\nNA\n\n\n41.88\n\n\n−87.61\n\n\n\n\n\n[ omitted 11,721,537 entries ]"
  },
  {
    "objectID": "content/posts/spatial/index.html#cleaning-useless-coordinates",
    "href": "content/posts/spatial/index.html#cleaning-useless-coordinates",
    "title": "Fast spatial data matching in R",
    "section": "\n2.1 Cleaning useless coordinates",
    "text": "2.1 Cleaning useless coordinates\nRemoving entries were lat/lng do not have sufficient precision to be reliably matched to a station (i.e. entries having less than 4 decimals, which corresponds to a 11 meters “radius” at the equator).\n\n\n\n\n\n\nDegrees to distance equivalence\n\n\n\n\n\n\n\nDecimal\nDistance at the equator (m)\n\n\n\n0\n111,120\n\n\n1\n11,112\n\n\n2\n1,111.2\n\n\n3\n111.12\n\n\n4\n11.112\n\n\n5\n1.1112\n\n\n\n\n\n\n\ndecp <- \\(x) str_length(str_remove(as.character(abs(x)), \".*\\\\.\")) >= 4\n\n\nCREATE FUNCTION decp(x) AS length(str_split(CAST(abs(x) AS VARCHAR(10)), '.')[2]) >= 4\n\n\n\n\n\n\ndata.table\ndtplyr\nSQL (DuckDB)\ndbplyr\n\n\n\n\nrides_l_clean <- rides_l[decp(lat) & decp(lng), ] |> setkey(ride_id)\n\n\n\nTime difference of 24.44 secs\n\n\n\n\n\nrides_l |> filter(decp(lat) & decp(lng)) |> as.data.table() |> setkey(ride_id)\n\n\n\nTime difference of 25.52 secs\n\n\n\n\n\nCREATE TABLE rides_l_clean AS \nSELECT * FROM rides_l \nWHERE decp(lat) AND decp(lng)\n\n\n\nTime difference of 5.136 secs\n\n\n\n\n\n\n\n\n\n\nNote\n\n\n\nHere, dbplyr will leave the decp call as-is in the SQL translation, but since we have previously defined a decp SQL function, this function will get called when the SQL query is executed.\n\n\n\n(tbl(rides_con, \"rides_l.dbp\") \n  |> filter(if_all(c(lat, lng), \\(x) decp(x)))\n  |> compute(\"rides_l_clean.dbp\")\n)\n\ndb_create_index(rides_con, \"rides_l_clean.dbp\", \"ride_id\")\n\n\n\nTime difference of 11.87 secs\n\n\n\n\n\n\n\ndata.table [9,937,077 x 10]\n\n\n\nride_id\n\n\nrideable_type\n\n\nstarted_at\n\n\nended_at\n\n\nmember_casual\n\n\nway\n\n\nname\n\n\nid\n\n\nlat\n\n\nlng\n\n\n\n\n\n00000123F60251E6\n\n\nclassic_bike\n\n\n2022-02-07 15:47:40\n\n\n2022-02-07 15:49:28\n\n\nmember\n\n\nend\n\n\nKingsbury St & Kinzie St\n\n\nKA1503000043\n\n\n41.889\n\n\n−87.639\n\n\n\n\n00000123F60251E6\n\n\nclassic_bike\n\n\n2022-02-07 15:47:40\n\n\n2022-02-07 15:49:28\n\n\nmember\n\n\nstart\n\n\nWells St & Hubbard St\n\n\nTA1307000151\n\n\n41.89\n\n\n−87.634\n\n\n\n\n000002EBE159AE82\n\n\nelectric_bike\n\n\n2021-06-22 17:25:15\n\n\n2021-06-22 17:31:34\n\n\nmember\n\n\nend\n\n\nMilwaukee Ave & Grand Ave\n\n\n13033\n\n\n41.891\n\n\n−87.648\n\n\n\n\n000002EBE159AE82\n\n\nelectric_bike\n\n\n2021-06-22 17:25:15\n\n\n2021-06-22 17:31:34\n\n\nmember\n\n\nstart\n\n\nClinton St & Jackson Blvd\n\n\n638\n\n\n41.878\n\n\n−87.641\n\n\n\n\n0000080D43BAA9E4\n\n\nclassic_bike\n\n\n2021-08-29 15:38:05\n\n\n2021-08-29 16:24:03\n\n\ncasual\n\n\nstart\n\n\nDearborn St & Van Buren St\n\n\n624\n\n\n41.876\n\n\n−87.629\n\n\n\n\n0000080D43BAA9E4\n\n\nclassic_bike\n\n\n2021-08-29 15:38:05\n\n\n2021-08-29 16:24:03\n\n\ncasual\n\n\nend\n\n\nFederal St & Polk St\n\n\nSL-008\n\n\n41.872\n\n\n−87.63\n\n\n\n\n00000CAE95438C9D\n\n\nclassic_bike\n\n\n2021-07-20 15:40:46\n\n\n2021-07-20 17:38:17\n\n\ncasual\n\n\nstart\n\n\nStreeter Dr & Grand Ave\n\n\n13022\n\n\n41.892\n\n\n−87.612\n\n\n\n\n00000CAE95438C9D\n\n\nclassic_bike\n\n\n2021-07-20 15:40:46\n\n\n2021-07-20 17:38:17\n\n\ncasual\n\n\nend\n\n\nFairbanks Ct & Grand Ave\n\n\nTA1305000003\n\n\n41.892\n\n\n−87.621\n\n\n\n\n00000E22FBA89D81\n\n\nelectric_bike\n\n\n2022-05-19 14:42:55\n\n\n2022-05-19 14:54:03\n\n\nmember\n\n\nend\n\n\nClark St & Armitage Ave\n\n\n13146\n\n\n41.918\n\n\n−87.636\n\n\n\n\n00000EBBC119168C\n\n\nclassic_bike\n\n\n2021-10-31 11:30:37\n\n\n2021-10-31 11:39:27\n\n\nmember\n\n\nstart\n\n\nDorchester Ave & 49th St\n\n\nKA1503000069\n\n\n41.806\n\n\n−87.592\n\n\n\n\n00000EBBC119168C\n\n\nclassic_bike\n\n\n2021-10-31 11:30:37\n\n\n2021-10-31 11:39:27\n\n\nmember\n\n\nend\n\n\nKimbark Ave & 53rd St\n\n\nTA1309000037\n\n\n41.8\n\n\n−87.595\n\n\n\n\n000019B7F053D461\n\n\nclassic_bike\n\n\n2021-08-13 19:57:28\n\n\n2021-08-13 20:02:56\n\n\nmember\n\n\nstart\n\n\nLarrabee St & Webster Ave\n\n\n13193\n\n\n41.922\n\n\n−87.644\n\n\n\n\n000019B7F053D461\n\n\nclassic_bike\n\n\n2021-08-13 19:57:28\n\n\n2021-08-13 20:02:56\n\n\nmember\n\n\nend\n\n\nSheffield Ave & Webster Ave\n\n\nTA1309000033\n\n\n41.922\n\n\n−87.654\n\n\n\n\n00001B4F79D102B5\n\n\nclassic_bike\n\n\n2021-07-28 07:58:27\n\n\n2021-07-28 08:05:00\n\n\ncasual\n\n\nend\n\n\nBroadway & Waveland Ave\n\n\n13325\n\n\n41.949\n\n\n−87.649\n\n\n\n\n00001B4F79D102B5\n\n\nclassic_bike\n\n\n2021-07-28 07:58:27\n\n\n2021-07-28 08:05:00\n\n\ncasual\n\n\nstart\n\n\nDuSable Lake Shore Dr & Belmont Ave\n\n\nTA1309000049\n\n\n41.941\n\n\n−87.639\n\n\n\n\n\n[ omitted 9,937,062 entries ]"
  },
  {
    "objectID": "content/posts/spatial/index.html#whats-missing",
    "href": "content/posts/spatial/index.html#whats-missing",
    "title": "Fast spatial data matching in R",
    "section": "\n2.2 What’s missing ?",
    "text": "2.2 What’s missing ?\nEntries missing one or both coordinates but having an id or name:\n\n\ndata.table\nSQL (DuckDB)\ndbplyr\n\n\n\n\nrides_l_clean[(is.na(lat) | is.na(lng)) & (!is.na(id) | !is.na(name)), ]\n\n\n\n\nSELECT * FROM rides_l_clean \nWHERE ((lat IS NULL) OR (lng IS NULL) \n  AND (NOT((id IS NULL)) OR NOT((name IS NULL))))\n\n\n\n\n(tbl(rides_con, \"rides_l_clean.dbp\")\n  |> filter(if_any(c(lat, lng), \\(v) is.na(v)) & (!is.na(id) | !is.na(name)))\n  |> collect()\n)\n\n\n\n\n\n\ndata.frame [0 x 10]\n\n\n\nride_id\n\n\nrideable_type\n\n\nstarted_at\n\n\nended_at\n\n\nmember_casual\n\n\nway\n\n\nname\n\n\nid\n\n\nlat\n\n\nlng\n\n\n\n\n\nEntries missing either name or id, but having coordinates:\n\n\ndata.table\ndtplyr\nSQL (DuckDB)\ndbplyr\n\n\n\n\nrides_l_clean[(!is.na(lat) & !is.na(lng)) & (is.na(id) | is.na(name))] -> rides_l_clean_unk\n\n\n\n\n(rides_l_clean \n  |> filter(if_all(c(lat, lng), \\(v) !is.na(v)) & (is.na(id) | is.na(name)))\n  |> as.data.table()\n)\n\n\n\n\nCREATE TABLE rides_l_clean_unk AS\nSELECT * FROM rides_l_clean\nWHERE ((id IS NULL) OR (name IS NULL)) \n  AND (NOT((lat IS NULL)) AND NOT((lng IS NULL)))\n\n\n\n\n\n\n\n(tbl(rides_con, \"rides_l_clean.dbp\") \n  |> filter(if_all(c(lat, lng), \\(v) !is.na(v)) & (is.na(id) | is.na(name)))\n  |> compute(\"rides_l_clean.dbp\")\n)\n\n\n\n\n\n\ndata.frame [3 x 10]\n\n\n\nride_id\n\n\nrideable_type\n\n\nstarted_at\n\n\nended_at\n\n\nmember_casual\n\n\nway\n\n\nname\n\n\nid\n\n\nlat\n\n\nlng\n\n\n\n\n\n176105D1F8A1216B\n\n\nelectric_bike\n\n\n2021-07-18 03:44:22\n\n\n2021-07-18 04:12:23\n\n\ncasual\n\n\nstart\n\n\nNA\n\n\n13221\n\n\n41.908\n\n\n−87.673\n\n\n\n\nDE82A15026BA3056\n\n\nelectric_bike\n\n\n2021-09-21 18:18:59\n\n\n2021-09-21 18:21:48\n\n\ncasual\n\n\nstart\n\n\nNA\n\n\n20215\n\n\n41.648\n\n\n−87.546\n\n\n\n\nEE197EDA4CF8CFE5\n\n\nelectric_bike\n\n\n2021-09-22 07:14:42\n\n\n2021-09-22 07:22:38\n\n\ncasual\n\n\nstart\n\n\nNA\n\n\nWL-008\n\n\n41.867\n\n\n−87.641\n\n\n\n\n\nIt seems there are only 3 entries missing identification that could be matched based on their coordinates at the level of precision we use (11m / 4 decimals).\n\n\n\n\n\n\nWarning\n\n\n\nAlthough, if we look at the original dataset (before filtering the inaccurate coordinates):\n\n\n\n\ndata.table\ndtplyr\nSQL (DuckDB)\ndbplyr\n\n\n\n\nrides_l[(!is.na(lat) & !is.na(lng)) & (is.na(id) | is.na(name))] -> rides_l_unk\n\n\n\n\n(rides_l\n  |> filter(if_all(c(lat, lng), \\(v) !is.na(v)) & (is.na(id) | is.na(name)))\n  |> as.data.table()\n)\n\n\n\n\nCREATE TABLE rides_l_unk AS\nSELECT * FROM rides_l\nWHERE ((id IS NULL) OR (name IS NULL)) \n  AND (NOT((lat IS NULL)) AND NOT((lng IS NULL)))\n\n\n\n\n\n\n\n(tbl(rides_con, \"rides_l.dbp\") \n  |> filter(if_all(c(lat, lng), \\(v) !is.na(v)) & (is.na(id) | is.na(name)))\n  |> compute(\"rides_l_unk.dbp\")\n)\n\n\n\n\n\n\ndata.frame [1,696,469 x 10]\n\n\n\nride_id\n\n\nrideable_type\n\n\nstarted_at\n\n\nended_at\n\n\nmember_casual\n\n\nway\n\n\nname\n\n\nid\n\n\nlat\n\n\nlng\n\n\n\n\n\n00000B4F1F71F9C2\n\n\nelectric_bike\n\n\n2021-09-08 16:31:38\n\n\n2021-09-08 16:37:54\n\n\nmember\n\n\nstart\n\n\nNA\n\n\nNA\n\n\n41.91\n\n\n−87.69\n\n\n\n\n00000B4F1F71F9C2\n\n\nelectric_bike\n\n\n2021-09-08 16:31:38\n\n\n2021-09-08 16:37:54\n\n\nmember\n\n\nend\n\n\nNA\n\n\nNA\n\n\n41.91\n\n\n−87.7\n\n\n\n\n00000E22FBA89D81\n\n\nelectric_bike\n\n\n2022-05-19 14:42:55\n\n\n2022-05-19 14:54:03\n\n\nmember\n\n\nstart\n\n\nNA\n\n\nNA\n\n\n41.9\n\n\n−87.62\n\n\n\n\n000018B1D040DB44\n\n\nelectric_bike\n\n\n2022-04-25 10:37:22\n\n\n2022-04-25 10:44:19\n\n\nmember\n\n\nend\n\n\nNA\n\n\nNA\n\n\n41.79\n\n\n−87.59\n\n\n\n\n000018B1D040DB44\n\n\nelectric_bike\n\n\n2022-04-25 10:37:22\n\n\n2022-04-25 10:44:19\n\n\nmember\n\n\nstart\n\n\nNA\n\n\nNA\n\n\n41.79\n\n\n−87.6\n\n\n\n\n000025C113FEB7B6\n\n\nelectric_bike\n\n\n2021-10-25 11:15:21\n\n\n2021-10-25 11:20:21\n\n\nmember\n\n\nstart\n\n\nNA\n\n\nNA\n\n\n41.81\n\n\n−87.62\n\n\n\n\n000025C113FEB7B6\n\n\nelectric_bike\n\n\n2021-10-25 11:15:21\n\n\n2021-10-25 11:20:21\n\n\nmember\n\n\nend\n\n\nNA\n\n\nNA\n\n\n41.81\n\n\n−87.62\n\n\n\n\n00002E385DB2888C\n\n\nelectric_bike\n\n\n2022-05-07 16:28:53\n\n\n2022-05-07 16:40:28\n\n\ncasual\n\n\nend\n\n\nNA\n\n\nNA\n\n\n41.87\n\n\n−87.75\n\n\n\n\n00002E385DB2888C\n\n\nelectric_bike\n\n\n2022-05-07 16:28:53\n\n\n2022-05-07 16:40:28\n\n\ncasual\n\n\nstart\n\n\nNA\n\n\nNA\n\n\n41.89\n\n\n−87.75\n\n\n\n\n000043B681BFB305\n\n\nelectric_bike\n\n\n2021-10-14 16:24:41\n\n\n2021-10-14 16:29:02\n\n\ncasual\n\n\nend\n\n\nNA\n\n\nNA\n\n\n41.9\n\n\n−87.7\n\n\n\n\n\n[ omitted 1,696,454 entries ]\n\n\n\n\nThere are 1,696,469 missing stations’ id or name that could be filled in the original data. However, it would seem that those entries were missing their id/name in the source data because their coordinates were too imprecise to be matched to any station in the first place. Attempting to match them by position could lead to wrong matches, or matching one ride to multiple stations.\n\n\n\n\n\n\nIf one were to do the macthing anyway, here’s how:"
  },
  {
    "objectID": "content/posts/spatial/index.html#creating-stations-data",
    "href": "content/posts/spatial/index.html#creating-stations-data",
    "title": "Fast spatial data matching in R",
    "section": "\n3.1 Creating stations data",
    "text": "3.1 Creating stations data\nFirst, we need to assemble a dataset linking each unique station id (and name) with a set of coordinates (here, we use the average lat & lng)\n\n\ndata.table\nSQL (DuckDB)\ndbplyr\n\n\n\n\nstations_clean <- (rides_l_clean\n  |> na.omit(cols = c(\"id\", \"name\"))\n  |> dcast(id+name ~ ., fun.agg = list(min, max, mean), value.var = c(\"lat\", \"lng\"))\n  |> bind(x, setcolorder(x, c(\"id\", \"name\", str_subset(colnames(x), \"lat_|_lng\"))))\n  |> unique(by = \"id\")\n  |> setkey(id)\n)\n\n\n\nTime difference of 0.8978 secs\n\n\n\n\n\nCREATE TABLE stations_clean AS \nSELECT DISTINCT on(id)\n  id, name\n  , MIN(lat) AS lat_min\n  , MAX(lat) AS lat_max\n  , AVG(lat) AS lat_mean\n  , MIN(lng) AS lng_min\n  , MAX(lng) AS lng_max\n  , AVG(lng) AS lng_mean\nFROM rides_l_clean\nWHERE (NOT((id IS NULL))) AND (NOT((name IS NULL)))\nGROUP BY id, name;\n\n\n\nTime difference of 0.07524 secs\n\n\n\n\n\n(tbl(rides_con, \"rides_l_clean.dbp\")\n  |> filter(!is.na(id), !is.na(name))\n  |> group_by(id)\n  |> summarize(\n    name = first(name),\n    across(c(lat, lng), list(min, max, mean), .names = \"{.col}_{.fn}\")\n  )\n  |> arrange(id)\n  |> compute(\"stations_clean.dbp\")\n)\n\ndb_create_index(rides_con, \"stations_clean.dbp\", \"id\")\n\n\n\nTime difference of 0.5303 secs\n\n\n\n\n\n\n\ndata.frame [693 x 8]\n\n\n\nid\n\n\nname\n\n\nlat_min\n\n\nlat_max\n\n\nlat_mean\n\n\nlng_min\n\n\nlng_max\n\n\nlng_mean\n\n\n\n\n\n13001\n\n\nMichigan Ave & Washington St\n\n\n41.813\n\n\n41.958\n\n\n41.884\n\n\n−87.657\n\n\n−87.59\n\n\n−87.625\n\n\n\n\n13006\n\n\nLaSalle St & Washington St\n\n\n41.872\n\n\n41.952\n\n\n41.883\n\n\n−87.833\n\n\n−87.619\n\n\n−87.633\n\n\n\n\n13008\n\n\nMillennium Park\n\n\n41.809\n\n\n41.96\n\n\n41.881\n\n\n−87.785\n\n\n−87.587\n\n\n−87.624\n\n\n\n\n13011\n\n\nCanal St & Adams St\n\n\n41.871\n\n\n41.902\n\n\n41.879\n\n\n−87.657\n\n\n−87.626\n\n\n−87.64\n\n\n\n\n13016\n\n\nSt. Clair St & Erie St\n\n\n41.841\n\n\n41.931\n\n\n41.894\n\n\n−87.744\n\n\n−87.616\n\n\n−87.623\n\n\n\n\n13017\n\n\nFranklin St & Chicago Ave\n\n\n41.873\n\n\n41.917\n\n\n41.897\n\n\n−87.663\n\n\n−87.625\n\n\n−87.636\n\n\n\n\n13021\n\n\nClinton St & Lake St\n\n\n41.876\n\n\n41.909\n\n\n41.886\n\n\n−87.661\n\n\n−87.617\n\n\n−87.642\n\n\n\n\n13022\n\n\nStreeter Dr & Grand Ave\n\n\n41.772\n\n\n41.969\n\n\n41.892\n\n\n−87.785\n\n\n−87.586\n\n\n−87.612\n\n\n\n\n13028\n\n\n900 W Harrison St\n\n\n41.836\n\n\n41.881\n\n\n41.875\n\n\n−87.679\n\n\n−87.607\n\n\n−87.65\n\n\n\n\n13029\n\n\nField Museum\n\n\n41.81\n\n\n41.896\n\n\n41.865\n\n\n−87.625\n\n\n−87.588\n\n\n−87.618\n\n\n\n\n\n[ omitted 678 entries ]"
  },
  {
    "objectID": "content/posts/spatial/index.html#matching-on-the-cleaned-data",
    "href": "content/posts/spatial/index.html#matching-on-the-cleaned-data",
    "title": "Fast spatial data matching in R",
    "section": "\n4.1 Matching on the cleaned data",
    "text": "4.1 Matching on the cleaned data\nTo save time, let’s only apply the procedure to the entries that actually need to be matched (i.e. the ones having coordinates but missing either name or id).\n\n\nfuzzyjoin\nSQL (DuckDB)\n\n\n\nThere are 3 entries from rides_l_clean that could be position-matched to a known station.\n\nmatched_clean <- (fuzzyjoin::geo_inner_join(\n    as.data.frame(rides_l_clean_unk),\n    as.data.frame(stations_clean),\n    by = c(\"lng\" = \"lng_mean\", \"lat\" = \"lat_mean\"),\n    method = \"haversine\",\n    unit = \"km\",\n    max_dist = 0.011, # 11 meters\n    distance_col = \"dist\"\n  ) \n  |> mutate(name = coalesce(name.x, name.y), id = coalesce(id.x, id.y)) \n  |> select(colnames(rides_l_clean), dist)\n  |> arrange(ride_id)\n  |> drop_na(ride_id, id, name)\n  |> as.data.table()\n  |> setkey(ride_id, id)\n)\n\n\n\nTime difference of 0.4157 secs\n\n\n\n\nThere are 3 entries from rides_l_clean that could be position-matched to a known station.\nCreating the haversine distance function:\n\n\nCREATE FUNCTION haversine(lat1, lng1, lat2, lng2) \n    AS ( 6371 * acos( cos( radians(lat1) ) *\n       cos( radians(lat2) ) * cos( radians(lng2) - radians(lng1) ) +\n       sin( radians(lat1) ) * sin( radians(lat2) ) ) \n    );\n\nDoing the matching:\n\nCREATE TABLE matched_clean AS\nSELECT\n  ride_id, rideable_type, started_at, ended_at, member_casual, way  \n  , COALESCE(r.name, s.name) AS name\n  , COALESCE(r.id, s.id) AS id\n  , r.lat, r.lng\n  , haversine(s.lat_mean, s.lng_mean, r.lat, r.lng) AS dist\nFROM rides_l_clean_unk r, stations_clean s\nWHERE dist <= 0.011\n\n\n\nTime difference of 0.004007 secs\n\n\n\n\n\n\ndata.table [3 x 11]\n\n\n\nride_id\n\n\nrideable_type\n\n\nstarted_at\n\n\nended_at\n\n\nmember_casual\n\n\nway\n\n\nname\n\n\nid\n\n\nlat\n\n\nlng\n\n\ndist\n\n\n\n\n\n176105D1F8A1216B\n\n\nelectric_bike\n\n\n2021-07-18 03:44:22\n\n\n2021-07-18 04:12:23\n\n\ncasual\n\n\nstart\n\n\nWood St & Milwaukee Ave\n\n\n13221\n\n\n41.908\n\n\n−87.673\n\n\n0.002\n\n\n\n\nDE82A15026BA3056\n\n\nelectric_bike\n\n\n2021-09-21 18:18:59\n\n\n2021-09-21 18:21:48\n\n\ncasual\n\n\nstart\n\n\nHegewisch Metra Station\n\n\n20215\n\n\n41.648\n\n\n−87.546\n\n\n0.009\n\n\n\n\nEE197EDA4CF8CFE5\n\n\nelectric_bike\n\n\n2021-09-22 07:14:42\n\n\n2021-09-22 07:22:38\n\n\ncasual\n\n\nstart\n\n\nClinton St & Roosevelt Rd\n\n\nWL-008\n\n\n41.867\n\n\n−87.641\n\n\n0.001\n\n\n\n\n\nAnd we indeed get three matches !\n\n\n\n\n\n\nNote\n\n\n\nBut those three already had an id, so we could probably have filled their missing name using stations_clean directly, instead of a convoluted proximity-based matching (which is more ressource intensive and less precise).\n\n\n\nstations_clean[matched_clean, on = .(id)\n             ][, .(id, name.stations = name, name.proximity = i.name, lat, lng)]\ndata.table [3 x 5]\n\n\n\nid\n\n\nname.stations\n\n\nname.proximity\n\n\nlat\n\n\nlng\n\n\n\n\n\n13221\n\n\nWood St & Milwaukee Ave\n\n\nWood St & Milwaukee Ave\n\n\n41.908\n\n\n−87.673\n\n\n\n\n20215\n\n\nHegewisch Metra Station\n\n\nHegewisch Metra Station\n\n\n41.648\n\n\n−87.546\n\n\n\n\nWL-008\n\n\nClinton St & Roosevelt Rd\n\n\nClinton St & Roosevelt Rd\n\n\n41.867\n\n\n−87.641\n\n\n\n\n\nAt least, we can see that the proximity-based matched name and the one associated to that station in stations_clean are the same, so the proximity-matching method works reasonably well."
  },
  {
    "objectID": "content/posts/spatial/index.html#matching-on-the-original-data",
    "href": "content/posts/spatial/index.html#matching-on-the-original-data",
    "title": "Fast spatial data matching in R",
    "section": "\n4.2 Matching on the original data",
    "text": "4.2 Matching on the original data\nWhat if we did the same procedure on the non-cleaned data (the one with coordinates less precise than our criteria for matching) ?\n\n4.2.1 Unfiltered stations data\nFirst, we need to recompute the stations data from rides_l (i.e. rides data before cleaning):\n\n\ndata.table\nSQL (DuckDB)\ndbplyr\n\n\n\n\nstations <- (rides_l\n  |> na.omit(cols = c(\"id\", \"name\"))\n  |> dcast(id+name ~ ., fun.agg = list(min, max, mean), value.var = c(\"lat\", \"lng\"))\n  |> bind(x, setcolorder(x, c(\"id\", \"name\", str_subset(colnames(x), \"lat_|_lng\"))))\n  |> unique(by = \"id\")\n  |> setkey(id, name)\n)\n\n\n\nTime difference of 0.784 secs\n\n\n\n\n\nCREATE TABLE stations AS \nSELECT DISTINCT on(id)\n  id, name\n  , MIN(lat) AS lat_min\n  , MAX(lat) AS lat_max\n  , AVG(lat) AS lat_mean\n  , MIN(lng) AS lng_min\n  , MAX(lng) AS lng_max\n  , AVG(lng) AS lng_mean\nFROM rides_l\nWHERE (NOT((id IS NULL))) AND (NOT((name IS NULL)))\nGROUP BY id, name;\n\n\n\nTime difference of 0.07564 secs\n\n\n\n\n\n(tbl(rides_con, \"rides_l.dbp\")\n  |> filter(!is.na(id), !is.na(name))\n  |> group_by(id)\n  |> summarize(\n    name = first(name),\n    across(c(lat, lng), list(min, max, mean), .names = \"{.col}_{.fn}\")\n  )\n  |> arrange(id)\n  |> compute(\"stations.dbp\")\n)\n\ndb_create_index(rides_con, \"stations.dbp\", \"id\")\n\n\n\nTime difference of 0.5281 secs\n\n\n\n\n\n\n\ndata.frame [1,078 x 8]\n\n\n\nid\n\n\nname\n\n\nlat_min\n\n\nlat_max\n\n\nlat_mean\n\n\nlng_min\n\n\nlng_max\n\n\nlng_mean\n\n\n\n\n\n021320\n\n\nMTV Hubbard St\n\n\n41.89\n\n\n41.89\n\n\n41.89\n\n\n−87.68\n\n\n−87.68\n\n\n−87.68\n\n\n\n\n13001\n\n\nMichigan Ave & Washington St\n\n\n41.813\n\n\n41.958\n\n\n41.884\n\n\n−87.657\n\n\n−87.59\n\n\n−87.625\n\n\n\n\n13006\n\n\nLaSalle St & Washington St\n\n\n41.872\n\n\n41.952\n\n\n41.883\n\n\n−87.833\n\n\n−87.619\n\n\n−87.633\n\n\n\n\n13008\n\n\nMillennium Park\n\n\n41.809\n\n\n41.96\n\n\n41.881\n\n\n−87.785\n\n\n−87.587\n\n\n−87.624\n\n\n\n\n13011\n\n\nCanal St & Adams St\n\n\n41.871\n\n\n41.902\n\n\n41.879\n\n\n−87.657\n\n\n−87.626\n\n\n−87.64\n\n\n\n\n13016\n\n\nSt. Clair St & Erie St\n\n\n41.841\n\n\n41.931\n\n\n41.894\n\n\n−87.744\n\n\n−87.616\n\n\n−87.623\n\n\n\n\n13017\n\n\nFranklin St & Chicago Ave\n\n\n41.873\n\n\n41.917\n\n\n41.897\n\n\n−87.663\n\n\n−87.625\n\n\n−87.636\n\n\n\n\n13021\n\n\nClinton St & Lake St\n\n\n41.876\n\n\n41.909\n\n\n41.886\n\n\n−87.661\n\n\n−87.617\n\n\n−87.642\n\n\n\n\n13022\n\n\nStreeter Dr & Grand Ave\n\n\n41.772\n\n\n41.969\n\n\n41.892\n\n\n−87.785\n\n\n−87.586\n\n\n−87.612\n\n\n\n\n13028\n\n\n900 W Harrison St\n\n\n41.836\n\n\n41.881\n\n\n41.875\n\n\n−87.679\n\n\n−87.607\n\n\n−87.65\n\n\n\n\n\n[ omitted 1,063 entries ]\n\n\n\n\nCleaning the results:\nNotice we get a lot more entries in our stations: 1078 entries vs 693 entries in the filtered version.\nWhich entries are in stations but not in stations_clean ?\n\n(stations_diff <- stations[!stations_clean, on = .(id, name)])\ndata.table [417 x 8]\n\n\n\nid\n\n\nname\n\n\nlat_min\n\n\nlat_max\n\n\nlat_mean\n\n\nlng_min\n\n\nlng_max\n\n\nlng_mean\n\n\n\n\n\n021320\n\n\nMTV Hubbard St\n\n\n41.89\n\n\n41.89\n\n\n41.89\n\n\n−87.68\n\n\n−87.68\n\n\n−87.68\n\n\n\n\n20.0\n\n\nDamen Ave & Wabansia Ave\n\n\n41.91\n\n\n41.91\n\n\n41.91\n\n\n−87.68\n\n\n−87.68\n\n\n−87.68\n\n\n\n\n20126\n\n\nS Aberdeen St & W 106th St\n\n\n41.7\n\n\n41.7\n\n\n41.7\n\n\n−87.65\n\n\n−87.65\n\n\n−87.65\n\n\n\n\n20128\n\n\nS Wentworth Ave & W 111th St\n\n\n41.69\n\n\n41.69\n\n\n41.69\n\n\n−87.63\n\n\n−87.63\n\n\n−87.63\n\n\n\n\n20133\n\n\nWoodlawn & 103rd - Olive Harvey Vaccination Site\n\n\n41.71\n\n\n41.71\n\n\n41.71\n\n\n−87.59\n\n\n−87.59\n\n\n−87.59\n\n\n\n\n20134\n\n\nMaryland Ave & 104th St\n\n\n41.71\n\n\n41.71\n\n\n41.71\n\n\n−87.6\n\n\n−87.6\n\n\n−87.6\n\n\n\n\n20201\n\n\nKedzie Ave & 104th St\n\n\n41.7\n\n\n41.7\n\n\n41.7\n\n\n−87.7\n\n\n−87.7\n\n\n−87.7\n\n\n\n\n20202\n\n\nW 103rd St & S Avers Ave\n\n\n41.71\n\n\n41.71\n\n\n41.71\n\n\n−87.72\n\n\n−87.72\n\n\n−87.72\n\n\n\n\n20209\n\n\nS Michigan Ave & E 118th St\n\n\n41.68\n\n\n41.68\n\n\n41.68\n\n\n−87.62\n\n\n−87.62\n\n\n−87.62\n\n\n\n\n20220\n\n\nAvenue L & 114th St\n\n\n41.69\n\n\n41.69\n\n\n41.69\n\n\n−87.54\n\n\n−87.54\n\n\n−87.54\n\n\n\n\n20240\n\n\nIndiana Ave & 133rd St\n\n\n41.65\n\n\n41.65\n\n\n41.65\n\n\n−87.62\n\n\n−87.62\n\n\n−87.62\n\n\n\n\n20241\n\n\nSteelworkers Park\n\n\n41.74\n\n\n41.74\n\n\n41.74\n\n\n−87.53\n\n\n−87.53\n\n\n−87.53\n\n\n\n\n20246.0\n\n\nN Green St & W Lake St\n\n\n41.89\n\n\n41.89\n\n\n41.89\n\n\n−87.65\n\n\n−87.65\n\n\n−87.65\n\n\n\n\n20247.0\n\n\nW Washington Blvd & N Peoria St\n\n\n41.88\n\n\n41.88\n\n\n41.88\n\n\n−87.65\n\n\n−87.65\n\n\n−87.65\n\n\n\n\n202480.0\n\n\nHampden Ct & Diversey Ave\n\n\n41.93\n\n\n41.93\n\n\n41.93\n\n\n−87.64\n\n\n−87.64\n\n\n−87.64\n\n\n\n\n\n[ omitted 402 entries ]\n\n\n\n\nAnd which of those 417 entries have the necessary coordinate precision to be used later on to match against the unknown stations ?\n\nstations_diff[stations_diff[, Reduce(`&`, lapply(.SD, decp)), .SDcols = patterns(\"^lat|^lng\")]]\ndata.table [0 x 8]\n\n\n\nid\n\n\nname\n\n\nlat_min\n\n\nlat_max\n\n\nlat_mean\n\n\nlng_min\n\n\nlng_max\n\n\nlng_mean\n\n\n\n\n\nAs expected, none. But we’re still going to do the matching, for posterity !\n\n4.2.2 Position-matching on stations\n\nTo save time, let’s only apply the procedure to the entries that actually need to be matched (i.e. the ones having coordinates but missing either name or id):\n\n\nfuzzyjoin\nSQL (DuckDB)\n\n\n\nThere are 1,696,469 entries from rides_l that could be position-matched to a known station.\n\nmatched <- (fuzzyjoin::geo_inner_join(\n    as.data.frame(rides_l_unk),\n    as.data.frame(stations),\n    by = c(\"lng\" = \"lng_mean\", \"lat\" = \"lat_mean\"),\n    method = \"haversine\",\n    unit = \"km\",\n    max_dist = 0.011, # 11 meters\n    distance_col = \"dist\"\n  ) \n  |> mutate(name = coalesce(name.x, name.y), id = coalesce(id.x, id.y)) \n  |> select(colnames(rides_l), dist)\n  |> arrange(ride_id)\n  |> drop_na(ride_id, id, name)\n  |> as.data.table()\n  |> setkey(ride_id, id)\n)\n\n\n\nTime difference of 1.96 secs\n\n\n\n\nThere are 1,696,469 entries from rides_l that could be position-matched to a known station.\n\nSELECT\n  ride_id, rideable_type, started_at, ended_at, member_casual, way  \n  , COALESCE(r.name, s.name) AS name\n  , COALESCE(r.id, s.id) AS id\n  , r.lat, r.lng\n  , haversine(s.lat_mean, s.lng_mean, r.lat, r.lng) AS dist\nFROM rides_l_unk r, stations s\nWHERE dist <= 0.011\n\n\n\nTime difference of 10.03 secs\n\n\n\n\n\n\n\ndata.table [939,829 x 11]\n\n\n\nride_id\n\n\nrideable_type\n\n\nstarted_at\n\n\nended_at\n\n\nmember_casual\n\n\nway\n\n\nname\n\n\nid\n\n\nlat\n\n\nlng\n\n\ndist\n\n\n\n\n\n00000B4F1F71F9C2\n\n\nelectric_bike\n\n\n2021-09-08 16:31:38\n\n\n2021-09-08 16:37:54\n\n\nmember\n\n\nend\n\n\nFrancisco Ave & Bloomingdale Ave\n\n\n429\n\n\n41.91\n\n\n−87.7\n\n\n0\n\n\n\n\n000025C113FEB7B6\n\n\nelectric_bike\n\n\n2021-10-25 11:15:21\n\n\n2021-10-25 11:20:21\n\n\nmember\n\n\nstart\n\n\nPrairie Ave & 47th St - midblock\n\n\n814\n\n\n41.81\n\n\n−87.62\n\n\n0\n\n\n\n\n000025C113FEB7B6\n\n\nelectric_bike\n\n\n2021-10-25 11:15:21\n\n\n2021-10-25 11:20:21\n\n\nmember\n\n\nend\n\n\nPrairie Ave & 47th St - midblock\n\n\n814\n\n\n41.81\n\n\n−87.62\n\n\n0\n\n\n\n\n000025C113FEB7B6\n\n\nelectric_bike\n\n\n2021-10-25 11:15:21\n\n\n2021-10-25 11:20:21\n\n\nmember\n\n\nstart\n\n\nMartin Luther King Dr & 44th St\n\n\n914\n\n\n41.81\n\n\n−87.62\n\n\n0\n\n\n\n\n000025C113FEB7B6\n\n\nelectric_bike\n\n\n2021-10-25 11:15:21\n\n\n2021-10-25 11:20:21\n\n\nmember\n\n\nend\n\n\nMartin Luther King Dr & 44th St\n\n\n914\n\n\n41.81\n\n\n−87.62\n\n\n0\n\n\n\n\n000043B681BFB305\n\n\nelectric_bike\n\n\n2021-10-14 16:24:41\n\n\n2021-10-14 16:29:02\n\n\ncasual\n\n\nend\n\n\nCalifornia Ave & Cortez St\n\n\n512\n\n\n41.9\n\n\n−87.7\n\n\n0\n\n\n\n\n00009A0299026096\n\n\nelectric_bike\n\n\n2021-07-04 17:10:35\n\n\n2021-07-04 17:21:29\n\n\ncasual\n\n\nstart\n\n\nLake Park Ave & 44th St\n\n\n787\n\n\n41.81\n\n\n−87.6\n\n\n0\n\n\n\n\n00009F76371B5B23\n\n\nelectric_bike\n\n\n2021-12-12 14:10:54\n\n\n2021-12-12 14:42:44\n\n\nmember\n\n\nend\n\n\nDamen Ave & Wabansia Ave\n\n\n20.0\n\n\n41.91\n\n\n−87.68\n\n\n0\n\n\n\n\n00009FC70913FC9F\n\n\nelectric_bike\n\n\n2021-11-09 15:02:41\n\n\n2021-11-09 15:07:55\n\n\ncasual\n\n\nend\n\n\nLincoln Ave & Balmoral Ave\n\n\n442\n\n\n41.98\n\n\n−87.69\n\n\n0\n\n\n\n\n0000D2CE5AF46802\n\n\nelectric_bike\n\n\n2021-10-21 17:41:43\n\n\n2021-10-21 17:58:18\n\n\nmember\n\n\nend\n\n\nElston Ave & George St\n\n\n472\n\n\n41.93\n\n\n−87.69\n\n\n0\n\n\n\n\n0000D8A70B8D59B7\n\n\nelectric_bike\n\n\n2021-06-23 18:28:49\n\n\n2021-06-23 19:08:40\n\n\ncasual\n\n\nstart\n\n\nParnell Ave & 103rd St\n\n\n605\n\n\n41.71\n\n\n−87.64\n\n\n0\n\n\n\n\n0000D8A70B8D59B7\n\n\nelectric_bike\n\n\n2021-06-23 18:28:49\n\n\n2021-06-23 19:08:40\n\n\ncasual\n\n\nend\n\n\nParnell Ave & 103rd St\n\n\n605\n\n\n41.71\n\n\n−87.64\n\n\n0\n\n\n\n\n0000D8A70B8D59B7\n\n\nelectric_bike\n\n\n2021-06-23 18:28:49\n\n\n2021-06-23 19:08:40\n\n\ncasual\n\n\nstart\n\n\nHalsted St & 102nd St\n\n\n623\n\n\n41.71\n\n\n−87.64\n\n\n0\n\n\n\n\n0000D8A70B8D59B7\n\n\nelectric_bike\n\n\n2021-06-23 18:28:49\n\n\n2021-06-23 19:08:40\n\n\ncasual\n\n\nend\n\n\nHalsted St & 102nd St\n\n\n623\n\n\n41.71\n\n\n−87.64\n\n\n0\n\n\n\n\n0000D8A70B8D59B7\n\n\nelectric_bike\n\n\n2021-06-23 18:28:49\n\n\n2021-06-23 19:08:40\n\n\ncasual\n\n\nstart\n\n\nGreen St & 103rd St\n\n\n878\n\n\n41.71\n\n\n−87.64\n\n\n0\n\n\n\n\n\n[ omitted 939,814 entries ]\n\n\n\n\n\n\n\n\n\n\nNote\n\n\n\nNotice how fast the procedure is, even if the results are mostly “garbage”.\n\n\nWhat’s inside those matches ?\n\nmatched[, .(`Number of matches for an entry` = .N), by = .(ride_id, way)\n      ][, .(`Number of times it happens` = .N), by = `Number of matches for an entry`]\ndata.table [5 x 2]\n\n\n\nNumber of matches for an entry\n\n\nNumber of times it happens\n\n\n\n\n\n1\n\n\n437 864\n\n\n\n\n2\n\n\n130 830\n\n\n\n\n3\n\n\n51 620\n\n\n\n\n4\n\n\n19 615\n\n\n\n\n5\n\n\n1 397\n\n\n\n\n\nWe can see that more than half of the matches are coordinates that matched 2 or more stations, which we should definitely not keep.\nBut, among the ones with only one match, how many have coordinates precise enough to make that match in the first place (i.e. have 4 or more decimals or precision) ?\n\nmatched[, if(.N == 1) .SD, by = .(ride_id, way)][decp(lat) & decp(lng)]\ndata.table [3 x 11]\n\n\n\nride_id\n\n\nway\n\n\nrideable_type\n\n\nstarted_at\n\n\nended_at\n\n\nmember_casual\n\n\nname\n\n\nid\n\n\nlat\n\n\nlng\n\n\ndist\n\n\n\n\n\n176105D1F8A1216B\n\n\nstart\n\n\nelectric_bike\n\n\n2021-07-18 03:44:22\n\n\n2021-07-18 04:12:23\n\n\ncasual\n\n\nWood St & Milwaukee Ave\n\n\n13221\n\n\n41.908\n\n\n−87.673\n\n\n0.002\n\n\n\n\nDE82A15026BA3056\n\n\nstart\n\n\nelectric_bike\n\n\n2021-09-21 18:18:59\n\n\n2021-09-21 18:21:48\n\n\ncasual\n\n\nHegewisch Metra Station\n\n\n20215\n\n\n41.648\n\n\n−87.546\n\n\n0.009\n\n\n\n\nEE197EDA4CF8CFE5\n\n\nstart\n\n\nelectric_bike\n\n\n2021-09-22 07:14:42\n\n\n2021-09-22 07:22:38\n\n\ncasual\n\n\nClinton St & Roosevelt Rd\n\n\nWL-008\n\n\n41.867\n\n\n−87.641\n\n\n0.001\n\n\n\n\n\nAs it turns out ? Only 3. And those are the same three matches we got from the filtered data.\nIn the end, those three are the only three position-based matches we should reasonably keep !"
  },
  {
    "objectID": "content/posts/spatial/index.html#merging-the-two-datasets",
    "href": "content/posts/spatial/index.html#merging-the-two-datasets",
    "title": "Fast spatial data matching in R",
    "section": "\n5.1 Merging the two datasets",
    "text": "5.1 Merging the two datasets\n\n\n\n\n\n\nNote\n\n\n\nWe can update the initial (cleaned) data with the position-matched in two ways:\n- A join + coalesce: join the two tables and merge the two name & id columns (new and old) together.\n- A rows_patch: only replace the missing values (name & id) by matching new and old rows together.\n\n\n\n5.1.1 join + coalesce\n\n\ndata.table\ndtplyr\nSQL (DuckDB)\ndbplyr\n\n\n\n\nmatched_clean[rides_l_clean, on = setdiff(colnames(rides_l_clean), c(\"id\", \"name\"))\n            ][, let(name = fcoalesce(name, i.name), id = fcoalesce(id, i.id))\n            ][, nms, env = list(nms = I(colnames(rides_l_clean)))] -> rides_l_merged\n\nsetkey(rides_l_merged, ride_id)\n\n\n\nTime difference of 9.747 secs\n\n\n\n\n\n(right_join(\n    matched_clean,\n    rides_l_clean,\n    by = setdiff(colnames(rides_l_clean), c(\"id\", \"name\"))\n  ) \n  |> mutate(name = coalesce(name.x, name.y), id = coalesce(id.x, id.y))\n  |> select(-matches(\"\\\\.x|\\\\.y\"), -dist)\n  |> as.data.table()\n  |> setkey(ride_id)\n)\n\n\n\nTime difference of 13.76 secs\n\n\n\n\n\nCREATE TABLE rides_l_merged AS\nSELECT \n  ride_id, rideable_type, started_at, ended_at, member_casual, way,\n  COALESCE(id_x, id_y) AS id,\n  COALESCE(name_x, name_y) AS name,\n  lat, lng\nFROM (\n  SELECT\n    r.ride_id AS ride_id,\n    r.rideable_type AS rideable_type,\n    r.started_at AS started_at,\n    r.ended_at AS ended_at,\n    r.member_casual AS member_casual,\n    r.way AS way,\n    m.name AS name_x,\n    m.id AS id_x,\n    r.lat AS lat,\n    r.lng AS lng,\n    r.name AS name_y,\n    r.id AS id_y\n  FROM matched_clean AS m\n  RIGHT JOIN rides_l_clean AS r\n  ON m.ride_id = r.ride_id \n     AND m.rideable_type = r.rideable_type \n     AND m.started_at = r.started_at\n     AND m.ended_at = r.ended_at\n     AND m.member_casual = r.member_casual\n     AND m.way = r.way\n);\n\n\n\nTime difference of 3.899 secs\n\n\n\n\n\n(right_join(\n    tbl(rides_con, \"matched_clean\"),\n    tbl(rides_con, \"rides_l_clean.dbp\"),\n    by = tbl(rides_con, \"rides_l_clean.dbp\") |> select(-name, -id) |> colnames()\n  ) \n  |> mutate(name = coalesce(name.x, name.y), id = coalesce(id.x, id.y))\n  |> select(-matches(\"\\\\.x|\\\\.y\"), -dist)\n  |> compute(\"rides_l_merged.dbp\")\n)\n\ndb_create_index(rides_con, \"rides_l_merged.dbp\", \"ride_id\")\n\n\n\nTime difference of 13.7 secs\n\n\n\n\n\n\n5.1.2 rows_patch\n\n\ndplyr\ndbplyr\n\n\n\n\nrows_patch(\n  as.data.frame(rides_l_clean),\n  as.data.frame(matched_clean) |> select(-dist),\n  by = setdiff(colnames(rides_l_clean), c(\"name\", \"id\")),\n  unmatched = \"ignore\"\n)\n\n\n\nTime difference of 4.969 secs\n\n\n\n\n\n(tbl(rides_con, \"rides_l_clean.dbp\")\n |> rows_patch(\n    tbl(rides_con, \"matched_clean\") |> select(-dist),\n    by = tbl(rides_con, \"rides_l_clean.dbp\") |> select(-name, -id) |> colnames(),\n    unmatched = \"ignore\"\n  )\n  |> compute(\"rides_l_merged.rows_dbp\")\n)\n\n\n\n\n\n\n\n\n\ndata.table [9,937,077 x 10]\n\n\n\nride_id\n\n\nrideable_type\n\n\nstarted_at\n\n\nended_at\n\n\nmember_casual\n\n\nway\n\n\nname\n\n\nid\n\n\nlat\n\n\nlng\n\n\n\n\n\n00000123F60251E6\n\n\nclassic_bike\n\n\n2022-02-07 15:47:40\n\n\n2022-02-07 15:49:28\n\n\nmember\n\n\nend\n\n\nKingsbury St & Kinzie St\n\n\nKA1503000043\n\n\n41.889\n\n\n−87.639\n\n\n\n\n00000123F60251E6\n\n\nclassic_bike\n\n\n2022-02-07 15:47:40\n\n\n2022-02-07 15:49:28\n\n\nmember\n\n\nstart\n\n\nWells St & Hubbard St\n\n\nTA1307000151\n\n\n41.89\n\n\n−87.634\n\n\n\n\n000002EBE159AE82\n\n\nelectric_bike\n\n\n2021-06-22 17:25:15\n\n\n2021-06-22 17:31:34\n\n\nmember\n\n\nend\n\n\nMilwaukee Ave & Grand Ave\n\n\n13033\n\n\n41.891\n\n\n−87.648\n\n\n\n\n000002EBE159AE82\n\n\nelectric_bike\n\n\n2021-06-22 17:25:15\n\n\n2021-06-22 17:31:34\n\n\nmember\n\n\nstart\n\n\nClinton St & Jackson Blvd\n\n\n638\n\n\n41.878\n\n\n−87.641\n\n\n\n\n0000080D43BAA9E4\n\n\nclassic_bike\n\n\n2021-08-29 15:38:05\n\n\n2021-08-29 16:24:03\n\n\ncasual\n\n\nstart\n\n\nDearborn St & Van Buren St\n\n\n624\n\n\n41.876\n\n\n−87.629\n\n\n\n\n0000080D43BAA9E4\n\n\nclassic_bike\n\n\n2021-08-29 15:38:05\n\n\n2021-08-29 16:24:03\n\n\ncasual\n\n\nend\n\n\nFederal St & Polk St\n\n\nSL-008\n\n\n41.872\n\n\n−87.63\n\n\n\n\n00000CAE95438C9D\n\n\nclassic_bike\n\n\n2021-07-20 15:40:46\n\n\n2021-07-20 17:38:17\n\n\ncasual\n\n\nstart\n\n\nStreeter Dr & Grand Ave\n\n\n13022\n\n\n41.892\n\n\n−87.612\n\n\n\n\n00000CAE95438C9D\n\n\nclassic_bike\n\n\n2021-07-20 15:40:46\n\n\n2021-07-20 17:38:17\n\n\ncasual\n\n\nend\n\n\nFairbanks Ct & Grand Ave\n\n\nTA1305000003\n\n\n41.892\n\n\n−87.621\n\n\n\n\n00000E22FBA89D81\n\n\nelectric_bike\n\n\n2022-05-19 14:42:55\n\n\n2022-05-19 14:54:03\n\n\nmember\n\n\nend\n\n\nClark St & Armitage Ave\n\n\n13146\n\n\n41.918\n\n\n−87.636\n\n\n\n\n00000EBBC119168C\n\n\nclassic_bike\n\n\n2021-10-31 11:30:37\n\n\n2021-10-31 11:39:27\n\n\nmember\n\n\nstart\n\n\nDorchester Ave & 49th St\n\n\nKA1503000069\n\n\n41.806\n\n\n−87.592\n\n\n\n\n00000EBBC119168C\n\n\nclassic_bike\n\n\n2021-10-31 11:30:37\n\n\n2021-10-31 11:39:27\n\n\nmember\n\n\nend\n\n\nKimbark Ave & 53rd St\n\n\nTA1309000037\n\n\n41.8\n\n\n−87.595\n\n\n\n\n000019B7F053D461\n\n\nclassic_bike\n\n\n2021-08-13 19:57:28\n\n\n2021-08-13 20:02:56\n\n\nmember\n\n\nstart\n\n\nLarrabee St & Webster Ave\n\n\n13193\n\n\n41.922\n\n\n−87.644\n\n\n\n\n000019B7F053D461\n\n\nclassic_bike\n\n\n2021-08-13 19:57:28\n\n\n2021-08-13 20:02:56\n\n\nmember\n\n\nend\n\n\nSheffield Ave & Webster Ave\n\n\nTA1309000033\n\n\n41.922\n\n\n−87.654\n\n\n\n\n00001B4F79D102B5\n\n\nclassic_bike\n\n\n2021-07-28 07:58:27\n\n\n2021-07-28 08:05:00\n\n\ncasual\n\n\nend\n\n\nBroadway & Waveland Ave\n\n\n13325\n\n\n41.949\n\n\n−87.649\n\n\n\n\n00001B4F79D102B5\n\n\nclassic_bike\n\n\n2021-07-28 07:58:27\n\n\n2021-07-28 08:05:00\n\n\ncasual\n\n\nstart\n\n\nDuSable Lake Shore Dr & Belmont Ave\n\n\nTA1309000049\n\n\n41.941\n\n\n−87.639\n\n\n\n\n\n[ omitted 9,937,062 entries ]"
  },
  {
    "objectID": "content/posts/spatial/index.html#validating-the-merge",
    "href": "content/posts/spatial/index.html#validating-the-merge",
    "title": "Fast spatial data matching in R",
    "section": "\n5.2 Validating the merge:",
    "text": "5.2 Validating the merge:\n\nrides_l_merged[(is.na(id) | is.na(name)) & (!is.na(lat) & !is.na(lng))]\ndata.table [0 x 10]\n\n\n\nride_id\n\n\nrideable_type\n\n\nstarted_at\n\n\nended_at\n\n\nmember_casual\n\n\nway\n\n\nname\n\n\nid\n\n\nlat\n\n\nlng\n\n\n\n\n\nWe can see that the resulting dataset no longer has any entries that have coordinates but miss a name or an id, whereas there were three before. We have successfully updated them !"
  },
  {
    "objectID": "content/posts/spatial/index.html#pivoting-back-to-the-original-wide-format",
    "href": "content/posts/spatial/index.html#pivoting-back-to-the-original-wide-format",
    "title": "Fast spatial data matching in R",
    "section": "\n5.3 Pivoting back to the original (wide) format",
    "text": "5.3 Pivoting back to the original (wide) format\nTo finish, let’s pivot the resulting data back into the wider format it was originally in:\n\n\ndata.table\ndtplyr\nSQL (DuckDB)\ndbplyr\n\n\n\n\nrides_merged <- (rides_l_merged\n  |> dcast(... ~ way, sep = \"_station_\", value.var = c(\"name\", \"id\", \"lat\", \"lng\"))\n  |> setkey(ride_id)\n)\n\n\n\nTime difference of 9.082 secs\n\n\n\n\n\n(rides_l_merged\n |> pivot_wider(\n    names_from = \"way\", names_glue = \"{way}_station_{.value}\",\n    values_from = c(\"name\", \"id\", \"lat\", \"lng\")\n  )\n  |> as.data.table()\n  |> setkey(ride_id)\n)\n\n\n\nTime difference of 12.94 secs\n\n\n\n\n\nCREATE TABLE rides_merged AS\nSELECT\n  ride_id, rideable_type, started_at, ended_at, member_casual,\n  MAX(CASE WHEN (way = 'start') THEN name END) AS start_station_name,\n  MAX(CASE WHEN (way = 'end') THEN name END) AS end_station_name,\n  MAX(CASE WHEN (way = 'start') THEN id END) AS start_station_id,\n  MAX(CASE WHEN (way = 'end') THEN id END) AS end_station_id,\n  MAX(CASE WHEN (way = 'start') THEN lat END) AS start_lat,\n  MAX(CASE WHEN (way = 'end') THEN lat END) AS end_lat,\n  MAX(CASE WHEN (way = 'start') THEN lng END) AS start_lng,\n  MAX(CASE WHEN (way = 'end') THEN lng END) AS end_lng\nFROM rides_l_merged\nGROUP BY ride_id, rideable_type, started_at, ended_at, member_casual\n\n\n\nTime difference of 15.84 secs\n\n\n\n\n\n(tbl(rides_con, \"rides_l_merged\")\n |> pivot_wider(\n    names_from = \"way\", names_glue = \"{way}_station_{.value}\", \n    values_from = c(\"name\", \"id\", \"lat\", \"lng\")\n  )\n  |> compute(\"rides_merged.dbp\")\n)\n\ndb_create_index(rides_con, \"rides_merged.dbp\", \"ride_id\")\n\n\n\nTime difference of 25.43 secs\n\n\n\n\n\n\n\ndata.table [5,316,218 x 13]\n\n\n\nride_id\n\n\nrideable_type\n\n\nstarted_at\n\n\nended_at\n\n\nmember_casual\n\n\nname_station_end\n\n\nname_station_start\n\n\nid_station_end\n\n\nid_station_start\n\n\nlat_station_end\n\n\nlat_station_start\n\n\nlng_station_end\n\n\nlng_station_start\n\n\n\n\n\n00000123F60251E6\n\n\nclassic_bike\n\n\n2022-02-07 15:47:40\n\n\n2022-02-07 15:49:28\n\n\nmember\n\n\nKingsbury St & Kinzie St\n\n\nWells St & Hubbard St\n\n\nKA1503000043\n\n\nTA1307000151\n\n\n41.889\n\n\n41.89\n\n\n−87.639\n\n\n−87.634\n\n\n\n\n000002EBE159AE82\n\n\nelectric_bike\n\n\n2021-06-22 17:25:15\n\n\n2021-06-22 17:31:34\n\n\nmember\n\n\nMilwaukee Ave & Grand Ave\n\n\nClinton St & Jackson Blvd\n\n\n13033\n\n\n638\n\n\n41.891\n\n\n41.878\n\n\n−87.648\n\n\n−87.641\n\n\n\n\n0000080D43BAA9E4\n\n\nclassic_bike\n\n\n2021-08-29 15:38:05\n\n\n2021-08-29 16:24:03\n\n\ncasual\n\n\nFederal St & Polk St\n\n\nDearborn St & Van Buren St\n\n\nSL-008\n\n\n624\n\n\n41.872\n\n\n41.876\n\n\n−87.63\n\n\n−87.629\n\n\n\n\n00000CAE95438C9D\n\n\nclassic_bike\n\n\n2021-07-20 15:40:46\n\n\n2021-07-20 17:38:17\n\n\ncasual\n\n\nFairbanks Ct & Grand Ave\n\n\nStreeter Dr & Grand Ave\n\n\nTA1305000003\n\n\n13022\n\n\n41.892\n\n\n41.892\n\n\n−87.621\n\n\n−87.612\n\n\n\n\n00000E22FBA89D81\n\n\nelectric_bike\n\n\n2022-05-19 14:42:55\n\n\n2022-05-19 14:54:03\n\n\nmember\n\n\nClark St & Armitage Ave\n\n\nNA\n\n\n13146\n\n\nNA\n\n\n41.918\n\n\nNA\n\n\n−87.636\n\n\nNA\n\n\n\n\n00000EBBC119168C\n\n\nclassic_bike\n\n\n2021-10-31 11:30:37\n\n\n2021-10-31 11:39:27\n\n\nmember\n\n\nKimbark Ave & 53rd St\n\n\nDorchester Ave & 49th St\n\n\nTA1309000037\n\n\nKA1503000069\n\n\n41.8\n\n\n41.806\n\n\n−87.595\n\n\n−87.592\n\n\n\n\n000019B7F053D461\n\n\nclassic_bike\n\n\n2021-08-13 19:57:28\n\n\n2021-08-13 20:02:56\n\n\nmember\n\n\nSheffield Ave & Webster Ave\n\n\nLarrabee St & Webster Ave\n\n\nTA1309000033\n\n\n13193\n\n\n41.922\n\n\n41.922\n\n\n−87.654\n\n\n−87.644\n\n\n\n\n00001B4F79D102B5\n\n\nclassic_bike\n\n\n2021-07-28 07:58:27\n\n\n2021-07-28 08:05:00\n\n\ncasual\n\n\nBroadway & Waveland Ave\n\n\nDuSable Lake Shore Dr & Belmont Ave\n\n\n13325\n\n\nTA1309000049\n\n\n41.949\n\n\n41.941\n\n\n−87.649\n\n\n−87.639\n\n\n\n\n00001BEE76AB24E0\n\n\nelectric_bike\n\n\n2021-11-30 16:55:38\n\n\n2021-11-30 17:08:53\n\n\nmember\n\n\nAshland Ave & Division St\n\n\nDaley Center Plaza\n\n\n13061\n\n\nTA1306000010\n\n\n41.903\n\n\n41.884\n\n\n−87.668\n\n\n−87.629\n\n\n\n\n00001DCF2BC423F4\n\n\ndocked_bike\n\n\n2021-06-13 12:00:49\n\n\n2021-06-13 12:29:51\n\n\ncasual\n\n\nFort Dearborn Dr & 31st St\n\n\nMillennium Park\n\n\nTA1307000048\n\n\n13008\n\n\n41.839\n\n\n41.881\n\n\n−87.608\n\n\n−87.624\n\n\n\n\n000020C92AA9D6F7\n\n\nclassic_bike\n\n\n2021-09-12 09:53:00\n\n\n2021-09-12 10:12:52\n\n\ncasual\n\n\nDusable Harbor\n\n\nClark St & North Ave\n\n\nKA1503000064\n\n\n13128\n\n\n41.887\n\n\n41.912\n\n\n−87.613\n\n\n−87.632\n\n\n\n\n0000228A4B430869\n\n\nelectric_bike\n\n\n2021-10-18 10:42:20\n\n\n2021-10-18 10:47:58\n\n\nmember\n\n\nCalumet Ave & 18th St\n\n\nMLK Jr Dr & 29th St\n\n\n13102\n\n\nTA1307000139\n\n\n41.857\n\n\n41.842\n\n\n−87.619\n\n\n−87.617\n\n\n\n\n000022C3D3CE7DD5\n\n\nclassic_bike\n\n\n2022-04-30 09:57:39\n\n\n2022-04-30 10:03:12\n\n\ncasual\n\n\nSheffield Ave & Willow St\n\n\nHalsted St & Clybourn Ave\n\n\nTA1306000032\n\n\n331\n\n\n41.914\n\n\n41.91\n\n\n−87.653\n\n\n−87.648\n\n\n\n\n0000278F02EFFEF9\n\n\nclassic_bike\n\n\n2021-09-18 16:09:39\n\n\n2021-09-18 16:32:06\n\n\nmember\n\n\nMichigan Ave & Washington St\n\n\nBurnham Harbor\n\n\n13001\n\n\n15545\n\n\n41.884\n\n\n41.856\n\n\n−87.625\n\n\n−87.613\n\n\n\n\n000027C557F9372D\n\n\ndocked_bike\n\n\n2022-05-13 11:01:17\n\n\n2022-05-13 11:09:05\n\n\ncasual\n\n\nLincoln Ave & Roscoe St*\n\n\nAshland Ave & Belle Plaine Ave\n\n\nchargingstx5\n\n\n13249\n\n\n41.943\n\n\n41.956\n\n\n−87.671\n\n\n−87.669\n\n\n\n\n\n[ omitted 5,316,203 entries ]\n\n\n\n\n\n\n\n\n\n\nNote\n\n\n\nWe get less entries than in the original (wide format) dataset due to having removed (filtered) the entries with bad coordinates."
  },
  {
    "objectID": "content/projects/ACCESSPACE/index.html#our-interface-the-tactibelt",
    "href": "content/projects/ACCESSPACE/index.html#our-interface-the-tactibelt",
    "title": "ACCESSPACE",
    "section": "2.1 Our interface: the TactiBelt",
    "text": "2.1 Our interface: the TactiBelt\nTo provide the proposed egocentric encoding scheme to the user, we designed a vibro-tactile belt, the TactiBelt: it comprises of 46 ERM motors spread into three layers, controlled by an Arduino Mega, through a specialized software written in Java:\n\n\n\nFigure 2: First prototype of the TactiBelt"
  },
  {
    "objectID": "content/projects/ACCESSPACE/index.html#software-tools",
    "href": "content/projects/ACCESSPACE/index.html#software-tools",
    "title": "ACCESSPACE",
    "section": "2.2 Software tools",
    "text": "2.2 Software tools\nTo capture and extract the information we need from the VIP’s environment, we devised a series of software tools relying mostly on Computer Vision:\n1) Obstacle detection and indoor localisation using the ORB-SLAM algorithm:\n\n\n\n\n\n2) Depth estimation from a monocular RGB camera, using the MonoDepth algorithm:\n\n\n\n\n\n3) Generating a mobility graph of the environment during movement using Reinforcement Learning:\nApplied to an artificial agent exploring a virtual maze, looking for food:\n\n\n\n\n\nApplied to a real agent (human pushing a cart with a camera and the computer running the algorithm around a meeting table):\n\n\n\n\n\n4) A virtual environment to test the TactiBelt and our candidate spatial encoding schemes:"
  },
  {
    "objectID": "content/projects/ACCESSPACE/index.html#project-dissemination",
    "href": "content/projects/ACCESSPACE/index.html#project-dissemination",
    "title": "ACCESSPACE",
    "section": "2.3 Project dissemination",
    "text": "2.3 Project dissemination\nThe ACCESSPACE project was promoted in various mainstream and technical media, such as:\n- On RTL, a French national radio station ()\n- On PhDTalent, a platform and network for PhD Students who wish to transition to industry ()\n- On Guide Néret, a specialized website on Handicap in France ()\n- On Acuité, a specialized website dedicated to Opticians and news around visual impairment ()\n- On Oxytude, a weekly podcast reviewing news related to visual impairment ()\n- On FIRAH, the French Foundation on Applied Research for Handicap ()\nThis project has been warmly welcomed by the VIP community and was awarded the “Applied research on disability” award from the CCAH in 2017 🥇."
  },
  {
    "objectID": "content/projects/AdViS/index.html",
    "href": "content/projects/AdViS/index.html",
    "title": "AdViS",
    "section": "",
    "text": "1 Introduction\n\nAdViS aims to explore various ways to provide visuo-spatial information through auditory feedback, based on the Sensory Substitution framework. Since its inception, the project investigated visuo-auditive substitution possibilities for multiple tasks in which vision plays a crucial role:\n\nNavigating a small maze using a depth-map-to-auditory-cues transcoding\n\nFinger-guided image exploration (on a touch screen)\n\nEye-movement guided image exploration (on a turned off computer screen)\n\nPointing towards and reaching a virtual target in 3D space using a motion capture environment\n\n\n\n\n\n\nAdViS - Depth Map navigation\n\n\n\n\n\nAdViS - Motion Capture\n\n\n\n\nThe AdViS platform is coded in C++ (and Qt for the GUI). It currently uses PureData for complex sound generation, and the VICON system to track participant’s movements in an augmented reality environment.\n\n\n2 My role in this project\n\n1) Propose a new model for image exploration using a touch-to-audio-feedback loop, where a VIP explores an image by moving its finger across it and gets auditive feedback from the explored regions and its surroundings.\n2) Modify the existing AdViS code to include the ability to transcode grey-scale images into soundscapes, and to capture finger movements information on a touchscreen.\n3) Organize experimental evaluations with blindfolded students, tasked with recognizing geometrical shapes on a touchscreen, and analyse the results.\n\n\n\n\n\n4) Participate in implementing an eye-tracking-to-audio-feedback loop in order to evaluate the possibility of exploring images (on a turned off screen) with eye-movements (which are still controllable by most of the non-congenital VIP)."
  },
  {
    "objectID": "content/projects/CamIO/index.html",
    "href": "content/projects/CamIO/index.html",
    "title": "CamIO",
    "section": "",
    "text": "1 Introduction\n\n\n\n\n2 My role in this project\n\n1) Explore new solutions to improve the localisation & tracking capabilities of CamIO:\nTheir existing solution, iLocalize (Fusco & Coughlan, 2018) (Swift / iOS), used a combination of Visuo-Inertial Odometry (VIO) through Apple’s ARKit, particle filtering based on a simplified map of the environment, and drift-correction through visual identification of known landmarks (using a gradient boosting algorithm).\n\n\n\n\n\nI developed a web app to send the live camera stream from a mobile phone (JavaScript / socket.io) to a backend server (Python / Flask). The goal of the application was to facilitate the exploration of new Computer Vision algorithms to process the captured video and IMU data, which would send back location or navigational information.\nI also explored existing 3rd-party services for indoor localization, such as Indoor Atlas (which combines VIO, GPS data, WiFi & geomagnetic fingerprinting, dead-reckoning, and barometric readings for altitude changes), for which I made a small demo.\n\n\n\n\n\n\n(a) Indoor Atlas’ localization\n\n\n\n\n\n(b) Indoor Atlas’ navigation graph\n\n\n\nFigure 1: Indoor Atlas\n\n\n2) Assist in writing a scientific paper presenting the project.\n\n\n\n\nReferences\n\nFusco, G., & Coughlan, J. M. (2018). Indoor localization using computer vision and visual-inertial odometry (pp. 86–93). Springer International Publishing. https://doi.org/10.1007/978-3-319-94274-2_13"
  },
  {
    "objectID": "content/projects/DE-AoP/index.html",
    "href": "content/projects/DE-AoP/index.html",
    "title": "DE-AoP",
    "section": "",
    "text": "1 My role in this project\n\n1) Develop tools to assist the project’s researchers exploration of the collected data. To this end, I developed a modular Shiny dashboard to assist in the data exploration process.\n2) Handle the RT-qPCR data processing and analysis.\n3) Participate in writing the final scientific paper resulting from this project (ongoing)."
  },
  {
    "objectID": "content/projects/LT-AoP/index.html",
    "href": "content/projects/LT-AoP/index.html",
    "title": "LT-AoP",
    "section": "",
    "text": "1 My role in this project\n\n1) Handle the data processing and analysis, for both immunohistochemistry and RT-qPCR data. The code for those analyses was made open-source and registered on Zenodo, while the results of the analyses were published in Cell & Bioscience.\n2) Make a website documenting and showcasing the project’s data, analyses, and results. The website uses Quarto and relies on templates to automatically generates documentation for each of the ~70 variables analyzed during the project.\n\n\nClick to see a preview of a page of the documentation"
  },
  {
    "objectID": "content/projects/NAV-VIR/index.html#our-interface-f2t-v2",
    "href": "content/projects/NAV-VIR/index.html#our-interface-f2t-v2",
    "title": "NAV-VIR",
    "section": "1.1 Our interface: F2T (v2)",
    "text": "1.1 Our interface: F2T (v2)\nDuring this project, we improved upon the first iteration of the Force Feedback Tablet (F2T) from the TETMOST project to design the finalized prototype of this interface:"
  },
  {
    "objectID": "content/projects/SAM-Guide/index.html",
    "href": "content/projects/SAM-Guide/index.html",
    "title": "SAM-Guide",
    "section": "",
    "text": "1 Introduction\n\n\nInteracting with space is a constant challenge for Visually Impaired People (VIP) since spatial information in Humans is typically provided by vision. Sensory Substitution Devices (SSDs) have been promising Human-Machine Interfaces (HMI) to assist VIP. They re-code missing visual information as stimuli for other sensory channels. Our project redirects somehow from SSD’s initial ambition for a single universal integrated device that would replace the whole sense organ, towards common encoding schemes for multiple applications.\nSAM-Guide will search for the most natural way to give online access to geometric variables that are necessary to achieve a range of tasks without eyes. Defining such encoding schemes requires selecting a crucial set of geometrical variables, and building efficient and comfortable auditory and/or tactile signals to represent them. We propose to concentrate on action-perception loops representing target-reaching affordances, where spatial properties are defined as ego-centered deviations from selected beacons.\nThe same grammar of cues could better help VIP to get autonomy along with a range of vital or leisure activities. Among such activities, the consortium has advances in orienting and navigating, object locating and reaching, laser shooting. Based on current neurocognitive models of human action-perception and spatial cognition, the design of the encoding schemes will lay on common theoretical principles: parsimony (minimum yet sufficient information for a task), congruency (leverage existing sensorimotor control laws), and multimodality (redundant or complementary signals across modalities). To ensure an efficient collaboration all partners will develop and evaluate their transcoding schemes based on common principles, methodology, and tools. An inclusive user-centered “living-lab” approach will ensure constant adequacy of our solutions with VIP’s needs.\nFive labs (three campuses) comprising ergonomists, neuroscientists, engineers, and mathematicians, united by their interest and experience with designing assistive devices for VIP, will duplicate, combine and share their pre-existing SSDs prototypes: a vibrotactile navigation belt, an audio-spatialized virtual guide for jogging, and an object-reaching sonic pointer. Using those prototypes, they will iteratively evaluate and improve their transcoding schemes in a 3-phase approach: First, in controlled experimental settings through augmented-reality serious games in motion capture (virtual prototyping indeed facilitates the creation of ad-hoc environments, and gaming eases the participants’ engagement). Next, spatial interaction subtasks will be progressively combined and tested in wider and more ecological indoor and outdoor environments. Finally, SAM-Guide’s system will be fully transitioned to real-world conditions through a friendly sporting event of laser-run, a novel handi-sport, which will involve each subtask.\nSAM-Guide will develop action-perception and spatial cognition theories relevant to nonvisual interfaces. It will provide guidelines for the efficient representation of spatial interactions to facilitate the emergence of spatial awareness in a task-oriented perspective. Our portable modular transcoding libraries are independent of hardware consideration. The principled experimental platform offered by AR games will be a tool for evaluating VIP spatial cognition, and novel strategies for mobility training.\n\n\n\n\n2 My role in this project\n\n1) I was the driving force behind the genesis of this project. I connected the consortium members together and wrote most of the grant proposal (ANR AAPG 2021, funding of 609k€). This project will last 4 years and allow the recruitment of 2 PhD students, one post-doc, and one Research Engineer.\n2) Participated in the Data Management plan creation (compliance to the GPDR).\n3) Designed and participated in the development of the second prototype of the TactiBelt, which features wireless communication and amovible vibrators:\n\n\n\nFigure 1: Second prototype of the TactiBelt\n\n\n4) Lead the design and development of the project’s experimental platform (choice of tools, lead developer). The platform uses Unity, connects to various motion tracking devices used by the consortium (Polhemus, VICON, pozyx), uses PureData for sound-wave generation, uses Steam Audio for 3D audio modeling, and communicates to the TactiBelt wirelessly using the OSC protocol.\n\n\n\n\n\n\n(a) Testing environment with a PureData audio beacon\n\n\n\n \n\n\n\n\n(b) Auto-generated maze with 3D audio beacons on waypoints\n\n\n\nFigure 2: Screenshots from SAM-Guide’s experimental platform (in development)\n\n\nThis platform allows one to easily spin up experimental trials by specifying the desired characteristics in a JSON file (based on the OpenMaze project). Unity will automatically generate the trial’s environment according to those specifications and populate it with the relevant items (e.g. a tactile-signal emitting beacon signalling a target to reach in a maze), handle the transition between successive trials and blocks of trials, and log all the relevant user metrics into a data file.\n\n\n\n\n\n\n(a) Specifying the avatar and the experimental blocks’ characteristics\n\n\n\n \n\n\n\n\n(b) Specifying experimental trials, which can be repeated and randomized within blocks\n\n\n\nFigure 3: Examples of settings used to generate experimental trials on the fly.\n\n\n5) Handling the experimental design of the first wave of experiments (ongoing)."
  },
  {
    "objectID": "content/projects/TETMOST/index.html#exploring-existing-haptic-interfaces",
    "href": "content/projects/TETMOST/index.html#exploring-existing-haptic-interfaces",
    "title": "TETMOST",
    "section": "1.1 Exploring existing haptic interfaces",
    "text": "1.1 Exploring existing haptic interfaces\nWe researched and tried different categories of haptic interfaces in order to asses their strengths and weaknesses for our purposes:\n\n\n\n\n\n\n(a) Taxel mechanical interfaces\n\n\n\n\n\n(b) Electro-friction interfaces\n\n\n\n\n\n(c) Vibrational interfaces\n\n\n\nFigure 1: The three main categories of haptic interfaces\n\n\nOur experience with the existing categories of haptic interfaces allowed us to designed one best adapted to our need: the Force-Feedback Tablet (F2T)"
  },
  {
    "objectID": "content/projects/TETMOST/index.html#our-interface-f2t-v1",
    "href": "content/projects/TETMOST/index.html#our-interface-f2t-v1",
    "title": "TETMOST",
    "section": "2.1 Our interface: F2T (v1)",
    "text": "2.1 Our interface: F2T (v1)\nThe first prototype of the F2T was assembled with legos and a camera to better asses the position of the joystick within the frame of the device."
  },
  {
    "objectID": "content/projects/TETMOST/index.html#software-tools",
    "href": "content/projects/TETMOST/index.html#software-tools",
    "title": "TETMOST",
    "section": "2.2 Software tools",
    "text": "2.2 Software tools\n1) We developed a Java application to create or convert images into simplified tactile representations, which can then be explored using the F2T:\n\n\n\n\n\n2) In order to display an image haptically, we first needed a way to simplify the image’s content without losing its meaning. To do so, we explored various Computer Vision techniques such as image segmentation and edge detection:"
  },
  {
    "objectID": "content/projects/index.html",
    "href": "content/projects/index.html",
    "title": " Past & Current Projects",
    "section": "",
    "text": "Order By\n       Default\n         \n          Title\n        \n     \n  \n    \n      \n      \n    \n\n\n\n\n  \n\n\n\n\nSAM-Guide\n\n\nSpatial Awareness for Multimodal Guidance\n\n\n\n\nAssistive Devices\n\n\nAccessibility\n\n\nVisual Impairment\n\n\nAugmented Reality\n\n\nSensory Substitution\n\n\nAuditory Interface\n\n\nHaptic Interface\n\n\nComputer Vision\n\n\n\n\nDesigning an efficient multi-modal interface to help VIP during spatial interactions and sports.\n\n\n\n\n\n\nANR PRC (AAPG 2021)\n\n\n\n\n\n\n  \n\n\n\n\nDE-AoP\n\n\nDevelopmental effects of Apnea of Prematurity\n\n\n\n\nBiostatistics\n\n\nTranscriptomics\n\n\nData Science\n\n\nCerebellum\n\n\nHypoxia\n\n\nRT-qPCR\n\n\n\n\nThis project studies the underlying molecular and cellular mechanisms of apnea of prematurity at play during cerebellar development, using intermittent hypoxia in a mouse model.\n\n\n\n\n \n\n\n\n\n  \n\n\n\n\nNAV-VIR\n\n\nVirtual Map exploration for Visually Impaired People\n\n\n\n\nAssistive Devices\n\n\nAccessibility\n\n\nVisual Impairment\n\n\nVirtual Reality\n\n\nSensory Substitution\n\n\nHaptic Interface\n\n\nAuditory Interface\n\n\n\n\nDeveloping a multi-modal interface for Visually Impaired People to virtually explore a map in order to prepare for a journey.\n\n\n\n\n\n\nPHC Polonium (French-Polish EU grant)\n\n\n\n\n\n\n  \n\n\n\n\nCamIO\n\n\nCamera Input-Output\n\n\n\n\nAssistive Devices\n\n\nAccessibility\n\n\nVisual Impairment\n\n\nAugmented Reality\n\n\nSensory Substitution\n\n\nAuditory Interface\n\n\nComputer Vision\n\n\n\n\nSmart pen providing real-time audio-feedback on objects using the smartphone’s sensors.\n\n\n\n\n\n\nNIH/NEI & NIDILRR RERC\n\n\n\n\n\n\n  \n\n\n\n\nTETMOST\n\n\nMaking Art more accessible to Visually Impaired People\n\n\n\n\nAssistive Devices\n\n\nAccessibility\n\n\nVisual Impairment\n\n\nVirtual Reality\n\n\nSensory Substitution\n\n\nHaptic Interface\n\n\n\n\nDevelopping a haptic interface and studying ways to intuitively represent images and Art pieces haptically for Visually Impaired People.\n\n\n\n\n\n\nAUTON (CNRS)\n\n\n\n\n\n\n  \n\n\n\n\nACCESSPACE\n\n\nHelping Visually Impaired People travel autonomously\n\n\n\n\nAssistive Devices\n\n\nAccessibility\n\n\nVisual Impairment\n\n\nAugmented Reality\n\n\nSensory Substitution\n\n\nHaptic Interface\n\n\nComputer Vision\n\n\n\n\nDeveloping a wearable vibro-tactile electronic Orientation & Travel Aid for the autonomous navigation of VIP, based on Spatial Cognition models.\n\n\n\n\n\n\nCCAH & FIRAH\n\n\n\n\n\n\n  \n\n\n\n\nLT-AoP\n\n\nLong Term effects of Apnea of Prematurity\n\n\n\n\nBiostatistics\n\n\nTranscriptomics\n\n\nData Science\n\n\nCerebellum\n\n\nHypoxia\n\n\nRT-qPCR\n\n\n\n\nThis project studied the impact of apnea of prematurity on cerebellar development and the long-term functional deficits resulting from it, using intermittent hypoxia in a mouse model.\n\n\n\n\n \n\n\n\n\n  \n\n\n\n\nAdViS\n\n\nAdaptative Visual Substitution\n\n\n\n\nAssistive Devices\n\n\nAccessibility\n\n\nVisual Impairment\n\n\nAugmented Reality\n\n\nSensory Substitution\n\n\nAuditory Interface\n\n\nComputer Vision\n\n\n\n\nDeveloping a wearable visuo-auditive substitution system to assist Visually Impaired People in navigation and object-reaching tasks.\n\n\n\n\n\n\nAUTON (CNRS) & LabEx PERSYVAL (PIA)\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "content/pubs/ICCHP18-F2T/index.html",
    "href": "content/pubs/ICCHP18-F2T/index.html",
    "title": "Towards Haptic Surface Devices with Force Feedback for Visually Impaired People",
    "section": "",
    "text": "Link to the PDF\n\n\n\n\nCitationBibTeX citation:@inproceedings{gay2018,\n  author = {Simon Gay and Marc-Aurèle Rivière and Edwige Pissaloux},\n  editor = {Miesenberger Klaus and Kouroupetroglou Georgios},\n  publisher = {Springer International Publishing},\n  title = {Towards {Haptic} {Surface} {Devices} with {Force} {Feedback}\n    for {Visually} {Impaired} {People}},\n  booktitle = {Lecture Notes in Computer Science},\n  volume = {10897},\n  pages = {258-266},\n  date = {2018-07-12},\n  url = {http://link.springer.com/10.1007/978-3-319-94274-2_36},\n  doi = {10.1007/978-3-319-94274-2_36},\n  isbn = {978-3-319-94273-5 978-3-319-94274-2},\n  langid = {en},\n  abstract = {This paper presents a new haptic surface tablet that can\n    provide force feedback to the user. Force feedback means that the\n    device can react to the user’s movements and apply a force against\n    or in-line with these movements, according to the tactile properties\n    of a displayed image. The device consists of a frame attached to a\n    tactile tablet that generates a force feedback to user’s finger when\n    exploring the surface, providing haptic informations about the\n    displayed image. The experimental results suggest the relevance of\n    this tablet as an assistive device for visually impaired people in\n    perceiving and understanding the content of a displayed image.\n    Several potential applications are briefly presented.}\n}\nFor attribution, please cite this work as:\nSimon Gay, Marc-Aurèle Rivière, & Edwige Pissaloux. (2018). Towards\nHaptic Surface Devices with Force Feedback for Visually Impaired People.\nIn Miesenberger Klaus & Kouroupetroglou Georgios (Eds.), Lecture\nNotes in Computer Science (Vol. 10897, pp. 258–266). Springer\nInternational Publishing. https://doi.org/10.1007/978-3-319-94274-2_36"
  },
  {
    "objectID": "content/pubs/ICCHP18-TactiBelt/index.html",
    "href": "content/pubs/ICCHP18-TactiBelt/index.html",
    "title": "TactiBelt: integrating spatial cognition and mobility theories into the design of a novel orientation and mobility assistive device for the blind",
    "section": "",
    "text": "Link to the PDF\n\n\n\n\nCitationBibTeX citation:@inproceedings{rivière2018,\n  author = {Marc-Aurèle Rivière and Simon Gay and Edwige Pissaloux},\n  editor = {Miesenberger Klaus and Kouroupetroglou Georgios},\n  publisher = {Springer International Publishing},\n  title = {TactiBelt: Integrating Spatial Cognition and Mobility\n    Theories into the Design of a Novel Orientation and Mobility\n    Assistive Device for the Blind},\n  booktitle = {Lecture Notes in Computer Science},\n  volume = {10897},\n  pages = {110-113},\n  date = {2018-07-12},\n  url = {http://link.springer.com/10.1007/978-3-319-94274-2_16},\n  doi = {10.1007/978-3-319-94274-2_16},\n  isbn = {978-3-319-94273-5 978-3-319-94274-2},\n  langid = {en},\n  abstract = {The aim of this paper is to introduce a novel functional\n    design for an indoor and outdoor mobility assistive device for the\n    visually impaired, based on the theoretical frameworks of mobility\n    and spatial cognition. The originality of the proposed approach\n    comes from the integration of two main aspects of navigation,\n    locomotion and wayfinding. The cognitive theories which underpin the\n    design of the proposed sensory substitution device, called\n    TactiBelt, are identified and discussed in the framework of spatial\n    knowledge acquisition. The paper is organized as follows: section 1\n    gives a brief overview of the sensory substitution framework, while\n    sections 2 \\& 3 introduce the importance of navigation and spatial\n    cognition models for the design of mobility aids. Section 4 details\n    the functional design of the TactiBelt.}\n}\nFor attribution, please cite this work as:\nMarc-Aurèle Rivière, Simon Gay, & Edwige Pissaloux. (2018).\nTactiBelt: integrating spatial cognition and mobility theories into the\ndesign of a novel orientation and mobility assistive device for the\nblind. In Miesenberger Klaus & Kouroupetroglou Georgios (Eds.),\nLecture Notes in Computer Science (Vol. 10897, pp. 110–113).\nSpringer International Publishing. https://doi.org/10.1007/978-3-319-94274-2_16"
  },
  {
    "objectID": "content/pubs/ICCHP20/index.html",
    "href": "content/pubs/ICCHP20/index.html",
    "title": "An Audio-Based 3D Spatial Guidance AR System for Blind Users",
    "section": "",
    "text": "Link to the PDF (preprint)\n\n\n\n\nCitationBibTeX citation:@inproceedings{coughlan2020,\n  author = {James Coughlan and Brandon Biggs and Marc-Aurèle Rivière and\n    Huiying Shen},\n  editor = {Miesenberger Klaus and Manduchi Roberto and Covarrubias\n    Rodriguez Mario and Peňáz Petr},\n  publisher = {Springer International Publishing},\n  title = {An {Audio-Based} {3D} {Spatial} {Guidance} {AR} {System} for\n    {Blind} {Users}},\n  booktitle = {Lecture Notes in Computer Science},\n  volume = {12376},\n  pages = {475-484},\n  date = {2020-09-12},\n  url = {https://link.springer.com/chapter/10.1007/978-3-030-58796-3_55},\n  doi = {10.1007/978-3-030-58796-3_55},\n  isbn = {978-3-030-58795-6 978-3-030-58796-3},\n  langid = {en},\n  abstract = {Augmented reality (AR) has great potential for blind users\n    because it enables a range of applications that provide audio\n    information about specific locations or directions in the user’s\n    environment. For instance, the {[}CamIO{]}(/content/projects/CamIO)\n    (“Camera Input-Output”) AR app makes physical objects (such as\n    documents, maps, devices and 3D models) accessible to blind and\n    visually impaired persons by providing real-time audio feedback in\n    response to the location on an object that the user is touching\n    (using an inexpensive stylus). An important feature needed by blind\n    users of AR apps such as CamIO is a 3D spatial guidance feature that\n    provides real-time audio feedback to help the user find a desired\n    location on an object. We have devised a simple audio interface to\n    provide verbal guidance towards a target of interest in 3D. The\n    experiment we report with blind participants using this guidance\n    interface demonstrates the feasibility of the approach and its\n    benefit for helping users find locations of interest.}\n}\nFor attribution, please cite this work as:\nJames Coughlan, Brandon Biggs, Marc-Aurèle Rivière, & Huiying Shen.\n(2020). An Audio-Based 3D Spatial Guidance AR System for Blind Users. In\nMiesenberger Klaus, Manduchi Roberto, Covarrubias Rodriguez Mario, &\nPeňáz Petr (Eds.), Lecture Notes in Computer Science (Vol.\n12376, pp. 475–484). Springer International Publishing. https://doi.org/10.1007/978-3-030-58796-3_55"
  },
  {
    "objectID": "content/pubs/ICISP20/index.html",
    "href": "content/pubs/ICISP20/index.html",
    "title": "Towards the Tactile Discovery of Cultural Heritage with Multi-approach Segmentation",
    "section": "",
    "text": "Link to the PDF\n\n\n\n\nCitationBibTeX citation:@inproceedings{souradi2020,\n  author = {Ali Souradi and Christele Lecomte and Katerine Romeo and\n    Simon Gay and Marc-Aurèle Rivière and Abderrahim El Moataz and\n    Edwige Pissaloux},\n  editor = {Abderrahim El Moataz and Driss Mammass and Alamin Mansouri\n    and Fathallah Nouboud},\n  publisher = {Springer International Publishing},\n  title = {Towards the {Tactile} {Discovery} of {Cultural} {Heritage}\n    with {Multi-approach} {Segmentation}},\n  booktitle = {Lecture Notes in Computer Science},\n  volume = {12119},\n  pages = {14-23},\n  date = {2020-07-08},\n  url = {http://link.springer.com/10.1007/978-3-030-51935-3_2},\n  doi = {10.1007/978-3-030-51935-3_2},\n  isbn = {978-3-030-51934-6 978-3-030-51935-3},\n  langid = {en},\n  abstract = {This paper presents a new way to access visual information\n    in museums through tactile exploration, and related techniques to\n    efficiently transform visual data into tactile objects.\n    Accessibility to cultural heritage and artworks for people with\n    visual impairments requires the segmentation of images and paintings\n    to extract and classify their contents into meaningful elements\n    which can then be presented through a tactile medium. In this paper,\n    we investigate the feasibility and how to optimize the tactile\n    discovery of an image. First, we study the emergence of image\n    comprehension through tactile discovery, using 3D-printed objects\n    extracted from paintings. Later, we present a dynamic Force Feedback\n    Tablet (F2T) used to convey the 2D shape and texture information of\n    objects through haptic feedback. We then explore several image\n    segmentation methods to automate the extraction of meaningful\n    objects from selected artworks, to be presented to visually impaired\n    people through the F2T. Finally, we evaluate how to best combine the\n    F2T’s haptic effects in order to convey the extracted objects and\n    features to the users, with the aim of facilitating the\n    comprehension of the represented objects and their affordances.}\n}\nFor attribution, please cite this work as:\nAli Souradi, Christele Lecomte, Katerine Romeo, Simon Gay, Marc-Aurèle\nRivière, Abderrahim El Moataz, & Edwige Pissaloux. (2020). Towards\nthe Tactile Discovery of Cultural Heritage with Multi-approach\nSegmentation. In Abderrahim El Moataz, Driss Mammass, Alamin Mansouri,\n& Fathallah Nouboud (Eds.), Lecture Notes in Computer\nScience (Vol. 12119, pp. 14–23). Springer International Publishing.\nhttps://doi.org/10.1007/978-3-030-51935-3_2"
  },
  {
    "objectID": "content/pubs/JEP22/index.html",
    "href": "content/pubs/JEP22/index.html",
    "title": "Spatiotemporal influences on the recognition of two-dimensional vibrotactile patterns on the abdomen",
    "section": "",
    "text": "Link to the PDF (preprint)\n\n\n\n\nCitationBibTeX citation:@article{faugloire2022,\n  author = {Elise Faugloire and Laure Lejeune and Marc-Aurèle Rivière\n    and Bruno Mantel},\n  title = {Spatiotemporal Influences on the Recognition of\n    Two-Dimensional Vibrotactile Patterns on the Abdomen},\n  journal = {Journal of Experimental Psychology: Applied},\n  volume = {28},\n  number = {3},\n  pages = {606-628},\n  date = {2022-09-02},\n  url = {https://psycnet.apa.org/record/2022-01207-001},\n  doi = {10.1037/xap0000404},\n  issn = {1939-2192, 1076-898X},\n  langid = {en},\n  abstract = {Spatial and temporal factors are known to highly influence\n    tactile perception, but their role has been largely unexplored in\n    the case of two-dimensional (2D) pattern recognition. We\n    investigated whether recognition is facilitated by the spatial\n    and/or temporal separation of pattern elements, or by conditions\n    known to favor perceptual integration, such as the ones eliciting\n    apparent movement. 2D vibrotactile patterns were presented to the\n    abdomen of novice participants. In Experiment 1, we manipulated the\n    spatial (inter-tactor distance) and temporal (burst duration and\n    inter-burst interval) parameters applied to the tracing mode\n    (sequential activation of pattern elements). In Experiment 2, we\n    compared display modes differing in their level of temporal overlap\n    in the presentation of pattern elements: the static mode\n    (simultaneous activation of pattern elements), the slit-scan mode\n    (pattern revealed line by line), and the tracing mode. The results\n    of both experiments reveal that (a) recognition performance\n    increases with the isolation of pattern elements in space and/or in\n    time, (b) spatial and temporal factors interact in pattern\n    recognition, and (c) conditions leading to apparent movement tend to\n    be associated with lower recognition accuracy. These results further\n    our understanding of tactile perception and provide guidance for the\n    design of future vibrotactile communication systems.}\n}\nFor attribution, please cite this work as:\nElise Faugloire, Laure Lejeune, Marc-Aurèle Rivière, & Bruno Mantel.\n(2022). Spatiotemporal influences on the recognition of two-dimensional\nvibrotactile patterns on the abdomen. Journal of Experimental\nPsychology: Applied, 28(3), 606–628. https://doi.org/10.1037/xap0000404"
  },
  {
    "objectID": "content/pubs/NER19/index.html",
    "href": "content/pubs/NER19/index.html",
    "title": "NAV-VIR: an audio-tactile virtual environment to assist visually impaired people",
    "section": "",
    "text": "Link to the PDF\n\n\n\n\nCitationBibTeX citation:@inproceedings{rivière2019,\n  author = {Marc-Aurèle Rivière and Simon Gay and Katerine Romeo and\n    Edwige Pissaloux and Michal Bujacz and Piotr Skulimowski and Pawel\n    Strumillo},\n  publisher = {IEEE},\n  title = {NAV-VIR: An Audio-Tactile Virtual Environment to Assist\n    Visually Impaired People},\n  booktitle = {Proceedings of the International IEEE/EMBS Conference on\n    Neural Engineering},\n  pages = {1038-1041},\n  date = {2019-05-20},\n  url = {https://ieeexplore.ieee.org/document/8717086},\n  doi = {10.1109/NER.2019.8717086},\n  isbn = {978-1-5386-7921-0},\n  langid = {en},\n  abstract = {This paper introduces the\n    {[}NAV-VIR{]}(/content/projects/NAV-VIR) system, a multimodal\n    virtual environment to assist visually impaired people in virtually\n    discovering and exploring unknown areas from the safety of their\n    home. The originality of NAV-VIR resides in (1) an optimized\n    representation of the surrounding topography, the spatial gist,\n    based on human spatial cognition models and the sensorimotor\n    supplementation framework, and (2) a multimodal orientation-aware\n    immersive virtual environment relying on two synergetic interfaces:\n    an interactive force feedback tablet, the F2T, and an immersive\n    HRTF-based 3D audio simulation relying on binaural recordings of\n    real environments. This paper presents NAV-VIR functionalities and\n    its preliminary evaluation through a simple shape and movement\n    perception task.}\n}\nFor attribution, please cite this work as:\nMarc-Aurèle Rivière, Simon Gay, Katerine Romeo, Edwige Pissaloux, Michal\nBujacz, Piotr Skulimowski, & Pawel Strumillo. (2019). NAV-VIR: an\naudio-tactile virtual environment to assist visually impaired people.\nProceedings of the International IEEE/EMBS Conference on Neural\nEngineering, 1038–1041. https://doi.org/10.1109/NER.2019.8717086"
  },
  {
    "objectID": "content/pubs/index.html",
    "href": "content/pubs/index.html",
    "title": " Scientific Publications",
    "section": "",
    "text": "Order By\n       Default\n         \n          Date - Oldest\n        \n         \n          Date - Newest\n        \n         \n          Title\n        \n         \n          Author\n        \n     \n  \n    \n      \n      \n    \n\n\n\n\n\n\nSpatiotemporal influences on the recognition of two-dimensional vibrotactile patterns on the abdomen\n\n\nJournal of Experimental Psychology: Applied\n\n\n\n\nAssistive Devices\n\n\nAccessibility\n\n\nSensory Substitution\n\n\nHaptic Interface\n\n\nPsychophysics\n\n\n\n\nThis study reveals that patterns made up of several vibration points are better recognized when pattern elements are clearly isolated in time and space. The feeling of a single point moving continuously along the skin, as if the pattern was manually drawn on the skin, does not appear to favor the recognition of patterns’ shape\n\n\n\n\n\n\nSep 2, 2022\n\n\nElise Faugloire, Laure Lejeune, Marc-Aurèle Rivière, Bruno Mantel\n\n\n\n\n\n\n\n\nAn Audio-Based 3D Spatial Guidance AR System for Blind Users\n\n\nLecture Notes in Computer Science\n\n\n\n\nAssistive Devices\n\n\nAccessibility\n\n\nAugmented Reality\n\n\nSensory Substitution\n\n\nAuditory Interface\n\n\nComputer Vision\n\n\n\n\nWe introduce CamIO, an AR app for Visually Impaired People (VIP) to reach objects in their immediate environment through real-time 3D audio guidance\n\n\n\n\n\n\nSep 12, 2020\n\n\nJames Coughlan, Brandon Biggs, Marc-Aurèle Rivière, Huiying Shen\n\n\n\n\n\n\n\n\nTowards the Tactile Discovery of Cultural Heritage with Multi-approach Segmentation\n\n\nLecture Notes in Computer Science\n\n\n\n\nAssistive Devices\n\n\nAccessibility\n\n\nComputer Vision\n\n\nSensory Substitution\n\n\nHaptic Interface\n\n\n\n\nWe introduce preliminary work on using multi-approach image segmentation, combined with a force-feedback interface, to provide access to Artworks to Visually Impaired People\n\n\n\n\n\n\nJul 8, 2020\n\n\nAli Souradi, Christele Lecomte, Katerine Romeo, Simon Gay, Marc-Aurèle Rivière, Abderrahim El Moataz, Edwige Pissaloux\n\n\n\n\n\n\n\n\nNAV-VIR: an audio-tactile virtual environment to assist visually impaired people\n\n\nInternational IEEE/EMBS Conference on Neural Engineering\n\n\n\n\nAssistive Devices\n\n\nAccessibility\n\n\nAugmented Reality\n\n\nSensory Substitution\n\n\nAuditory Interface\n\n\nHaptic Interface\n\n\n\n\nWe introduce NAV-VIR, a multimodal interface for the interactive exploration of maps by Visually Impaired People\n\n\n\n\n\n\nMay 20, 2019\n\n\nMarc-Aurèle Rivière, Simon Gay, Katerine Romeo, Edwige Pissaloux, Michal Bujacz, Piotr Skulimowski, Pawel Strumillo\n\n\n\n\n\n\n\n\nTowards Haptic Surface Devices with Force Feedback for Visually Impaired People\n\n\nLecture Notes in Computer Science\n\n\n\n\nAssistive Devices\n\n\nAccessibility\n\n\nAugmented Reality\n\n\nSensory Substitution\n\n\nHaptic Interface\n\n\n\n\nWe introduce the principles of a haptic interface for finger-movement based exploration of image content through force-feedback\n\n\n\n\n\n\nJul 12, 2018\n\n\nSimon Gay, Marc-Aurèle Rivière, Edwige Pissaloux\n\n\n\n\n\n\n\n\nTactiBelt: integrating spatial cognition and mobility theories into the design of a novel orientation and mobility assistive device for the blind\n\n\nLecture Notes in Computer Science\n\n\n\n\nAssistive Devices\n\n\nAccessibility\n\n\nAugmented Reality\n\n\nSensory Substitution\n\n\nHaptic Interface\n\n\nSpatial Cognition\n\n\n\n\nWe introduce spatial cognition models as a framework to design novel mobility assistive devices for Visually Impaired People\n\n\n\n\n\n\nJul 12, 2018\n\n\nMarc-Aurèle Rivière, Simon Gay, Edwige Pissaloux\n\n\n\n\n\n\nNo matching items"
  }
]