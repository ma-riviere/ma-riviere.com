[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Marc-Aurèle Rivière",
    "section": "",
    "text": "Published scientist, now retrained as a Data Scientist and Software Engineer.\nI specialize in R programming, which I use both to build web apps (Shiny), APIs (plumber), packages, websites and interactive dashboards (Quarto), as well as to analyze a variety of data types.\nI was involved in several research projects at the intersection between Neuroscience and Biomedical Engineering. I have worked with biology/medical data, but also behavioral, surveys, energy, geography/spatial, and sales/marketing data.\nI am very fond of statistical modeling (especially of the Bayesian sort), and have an (unhealthy) obsession with the R ecosystem and its community.\n\n\n\n\n\n\n\n\n\n      \n\n\n\n\n\n\n Back to top"
  },
  {
    "objectID": "content/pubs/NER19/index.html",
    "href": "content/pubs/NER19/index.html",
    "title": "NAV-VIR: an audio-tactile virtual environment to assist visually impaired people",
    "section": "",
    "text": "Article (online)\n  \n  \n      Project (NAV-VIR)\n  \n\n      \n\n    \n    \n  \n\n\n\n\n\n\n\n\n\n\n\n Back to topCitationBibTeX citation:@inproceedings{rivière2019,\n  author = {Rivière, Marc-Aurèle and Gay, Simon and Romeo, Katerine and\n    Pissaloux, Edwige and Bujacz, Michal and Skulimowski, Piotr and\n    Strumillo, Pawel},\n  publisher = {IEEE},\n  title = {NAV-VIR: An Audio-Tactile Virtual Environment to Assist\n    Visually Impaired People},\n  booktitle = {Proceedings of the International IEEE/EMBS Conference on\n    Neural Engineering},\n  pages = {1038-1041},\n  date = {2019-05-20},\n  url = {https://ieeexplore.ieee.org/document/8717086},\n  doi = {10.1109/NER.2019.8717086},\n  isbn = {978-1-5386-7921-0},\n  langid = {en},\n  abstract = {This paper introduces the\n    {[}NAV-VIR{]}(/content/projects/NAV-VIR) system, a multimodal\n    virtual environment to assist visually impaired people in virtually\n    discovering and exploring unknown areas from the safety of their\n    home. The originality of NAV-VIR resides in (1) an optimized\n    representation of the surrounding topography, the spatial gist,\n    based on human spatial cognition models and the sensorimotor\n    supplementation framework, and (2) a multimodal orientation-aware\n    immersive virtual environment relying on two synergetic interfaces:\n    an interactive force feedback tablet, the F2T, and an immersive\n    HRTF-based 3D audio simulation relying on binaural recordings of\n    real environments. This paper presents NAV-VIR functionalities and\n    its preliminary evaluation through a simple shape and movement\n    perception task.}\n}\nFor attribution, please cite this work as:\nRivière, M.-A., Gay, S., Romeo, K., Pissaloux, E., Bujacz, M.,\nSkulimowski, P., & Strumillo, P. (2019). NAV-VIR: an audio-tactile\nvirtual environment to assist visually impaired people. Proceedings\nof the International IEEE/EMBS Conference on Neural Engineering,\n1038–1041. https://doi.org/10.1109/NER.2019.8717086"
  },
  {
    "objectID": "content/pubs/ICISP20/index.html",
    "href": "content/pubs/ICISP20/index.html",
    "title": "Towards the Tactile Discovery of Cultural Heritage with Multi-approach Segmentation",
    "section": "",
    "text": "Article (online)\n  \n  \n      Project (TETMOST)\n  \n\n      \n\n    \n    \n  \n\n\n\n\n\n\n\n\n\n\n\n Back to topCitationBibTeX citation:@inproceedings{souradi2020,\n  author = {Souradi, Ali and Lecomte, Christele and Romeo, Katerine and\n    Gay, Simon and Rivière, Marc-Aurèle and El Moataz, Abderrahim and\n    Pissaloux, Edwige},\n  editor = {El Moataz, Abderrahim and Mammass, Driss and Mansouri,\n    Alamin and Nouboud, Fathallah},\n  publisher = {Springer International Publishing},\n  title = {Towards the {Tactile} {Discovery} of {Cultural} {Heritage}\n    with {Multi-approach} {Segmentation}},\n  booktitle = {Lecture Notes in Computer Science},\n  volume = {12119},\n  pages = {14-23},\n  date = {2020-07-08},\n  url = {http://link.springer.com/10.1007/978-3-030-51935-3_2},\n  doi = {10.1007/978-3-030-51935-3_2},\n  isbn = {978-3-030-51934-6 978-3-030-51935-3},\n  langid = {en},\n  abstract = {This paper presents a new way to access visual information\n    in museums through tactile exploration, and related techniques to\n    efficiently transform visual data into tactile objects.\n    Accessibility to cultural heritage and artworks for people with\n    visual impairments requires the segmentation of images and paintings\n    to extract and classify their contents into meaningful elements\n    which can then be presented through a tactile medium. In this paper,\n    we investigate the feasibility and how to optimize the tactile\n    discovery of an image. First, we study the emergence of image\n    comprehension through tactile discovery, using 3D-printed objects\n    extracted from paintings. Later, we present a dynamic Force Feedback\n    Tablet (F2T) used to convey the 2D shape and texture information of\n    objects through haptic feedback. We then explore several image\n    segmentation methods to automate the extraction of meaningful\n    objects from selected artworks, to be presented to visually impaired\n    people through the F2T. Finally, we evaluate how to best combine the\n    F2T’s haptic effects in order to convey the extracted objects and\n    features to the users, with the aim of facilitating the\n    comprehension of the represented objects and their affordances.}\n}\nFor attribution, please cite this work as:\nSouradi, A., Lecomte, C., Romeo, K., Gay, S., Rivière, M.-A., El Moataz,\nA., & Pissaloux, E. (2020). Towards the Tactile Discovery of\nCultural Heritage with Multi-approach Segmentation. In A. El Moataz, D.\nMammass, A. Mansouri, & F. Nouboud (Eds.), Lecture Notes in\nComputer Science (Vol. 12119, pp. 14–23). Springer International\nPublishing. https://doi.org/10.1007/978-3-030-51935-3_2"
  },
  {
    "objectID": "content/pubs/ICCHP18-TactiBelt/index.html",
    "href": "content/pubs/ICCHP18-TactiBelt/index.html",
    "title": "TactiBelt: integrating spatial cognition and mobility theories into the design of a novel orientation and mobility assistive device for the blind",
    "section": "",
    "text": "Article (online)\n  \n  \n      Project (ACCESSPACE)\n  \n\n      \n\n    \n    \n  \n\n\n\n\n\n\n\n\n\n\n\n Back to topCitationBibTeX citation:@inproceedings{rivière2018,\n  author = {Rivière, Marc-Aurèle and Gay, Simon and Pissaloux, Edwige},\n  editor = {Klaus, Miesenberger and Georgios, Kouroupetroglou},\n  publisher = {Springer International Publishing},\n  title = {TactiBelt: Integrating Spatial Cognition and Mobility\n    Theories into the Design of a Novel Orientation and Mobility\n    Assistive Device for the Blind},\n  booktitle = {Lecture Notes in Computer Science},\n  volume = {10897},\n  pages = {110-113},\n  date = {2018-07-12},\n  url = {http://link.springer.com/10.1007/978-3-319-94274-2_16},\n  doi = {10.1007/978-3-319-94274-2_16},\n  isbn = {978-3-319-94273-5 978-3-319-94274-2},\n  langid = {en},\n  abstract = {The aim of this paper is to introduce a novel functional\n    design for an indoor and outdoor mobility assistive device for the\n    visually impaired, based on the theoretical frameworks of mobility\n    and spatial cognition. The originality of the proposed approach\n    comes from the integration of two main aspects of navigation,\n    locomotion and wayfinding. The cognitive theories which underpin the\n    design of the proposed sensory substitution device, called\n    TactiBelt, are identified and discussed in the framework of spatial\n    knowledge acquisition. The paper is organized as follows: section 1\n    gives a brief overview of the sensory substitution framework, while\n    sections 2 \\& 3 introduce the importance of navigation and spatial\n    cognition models for the design of mobility aids. Section 4 details\n    the functional design of the TactiBelt.}\n}\nFor attribution, please cite this work as:\nRivière, M.-A., Gay, S., & Pissaloux, E. (2018). TactiBelt:\nintegrating spatial cognition and mobility theories into the design of a\nnovel orientation and mobility assistive device for the blind. In M.\nKlaus & K. Georgios (Eds.), Lecture Notes in Computer\nScience (Vol. 10897, pp. 110–113). Springer International\nPublishing. https://doi.org/10.1007/978-3-319-94274-2_16"
  },
  {
    "objectID": "content/pubs/CRN23/index.html",
    "href": "content/pubs/CRN23/index.html",
    "title": "Apnea of Prematurity induces short and long-term development-related transcriptional changes in the murine cerebellum",
    "section": "",
    "text": "Article (online)\n  \n  \n      Project (DE-AoP)\n  \n\n      \n\n    \n    \n  \n\n\n\n\n\n\n\n\n\n\n\n Back to topReuseCC BY-NC-ND 4.0CitationBibTeX citation:@article{rodriguez-duboc2023,\n  author = {Rodriguez-Duboc, Agalic and Basille-Duguay, Magali and\n    Debonne, Aurélien and Rivière, Marc-Aurèle and Vaudry, David and\n    Burel, Delphine},\n  title = {Apnea of {Prematurity} Induces Short and Long-Term\n    Development-Related Transcriptional Changes in the Murine\n    Cerebellum},\n  journal = {Current Research in Neurobiology},\n  volume = {5},\n  pages = {100113},\n  date = {2023-10-20},\n  url = {https://www.sciencedirect.com/science/article/pii/S2665945X23000414},\n  doi = {10.1016/j.crneur.2023.100113},\n  issn = {2665-945X},\n  langid = {en},\n  abstract = {Apnea of prematurity (AOP) occurs in over 50\\% of preterm\n    infants and induces a perinatal intermittent hypoxia (IH) which\n    represents a leading cause of morbimortality worldwide. At birth,\n    the human cerebellar cortex is still immature, making it vulnerable\n    to perinatal events. Moreover, a correlation between cerebellar\n    functions and the deficits observed in children having suffered from\n    AOP has been demonstrated. Yet, the cerebellar alterations\n    underpinning this link remain poorly understood. To shed light on\n    the involvement of the cerebellum in perinatal hypoxia-related\n    sequelae, we developed a mouse model of AOP. In previous works, we\n    found that IH induces oxidative stress in the developing cerebellum\n    as shown by the overexpression of genes involved in reactive oxygen\n    species production, and the under-expression of genes encoding\n    antioxidant enzymes. These alterations suggest a failure of the\n    defense system against oxidative stress and could be responsible for\n    neuronal death in the cerebellum. Based on these results, we\n    performed a transcriptomic study of the genes involved in the\n    processes that occur during cerebellar development. We analyzed the\n    expression of these genes at various developmental stages and in\n    different cell types, by real time PCR. This enabled us to pinpoint\n    a timeframe of vulnerability at P8, which represents the age with\n    the highest number of downregulated genes in the cerebellum.\n    Moreover, we identified several molecular pathways that are impacted\n    by our IH protocol, such as proliferation, migration, and\n    differentiation. This suggests that IH can modify the development of\n    various cells, and then contribute to the histological and\n    behavioral deficits already observed in this model. Overall, our\n    data indicate that the cerebellum is highly sensitive to IH, and\n    provide elements to better understand the pathophysiology of AOP by\n    deciphering its cellular and molecular causal mechanisms. In the\n    long term, the present results could lead to the identification of\n    novel therapeutic targets to improve the clinical management of this\n    highly prevalent pathology.}\n}\nFor attribution, please cite this work as:\nRodriguez-Duboc, A., Basille-Duguay, M., Debonne, A., Rivière, M.-A.,\nVaudry, D., & Burel, D. (2023). Apnea of Prematurity induces short\nand long-term development-related transcriptional changes in the murine\ncerebellum. Current Research in Neurobiology, 5,\n100113. https://doi.org/10.1016/j.crneur.2023.100113"
  },
  {
    "objectID": "content/projects/Vasc-AoP/index.html",
    "href": "content/projects/Vasc-AoP/index.html",
    "title": "Vasc-AoP",
    "section": "",
    "text": "Code"
  },
  {
    "objectID": "content/projects/SAM-Guide/index.html",
    "href": "content/projects/SAM-Guide/index.html",
    "title": "SAM-Guide",
    "section": "",
    "text": "Official homepage\n  \n  \n    \n     ANR Grant\n  \n  \n    \n     Code\n  \n\n      \n\n    \n    \n  \n\n\n\n\nThe SAM-Guide project aims to help visually impaired people interact with the world around them by creating smart devices that convert visual information into sounds and vibrations they can feel and hear. Instead of trying to replace vision entirely, the project focuses on giving people the specific spatial information they need for everyday tasks like finding objects, navigating spaces, and even participating in sports activities. The team of researchers from multiple French universities is developing wearable devices like vibrating belts and audio systems that can guide users toward targets or help them understand their surroundings. They’re testing these technologies through virtual reality games and real-world activities, including a new sport called laser-run designed for people with visual impairments. The ultimate goal is to create a common “language” of sounds and vibrations that can help visually impaired people gain more independence in various activities, from simple daily tasks to recreational sports.\n\n\n\n\n\n\nNoteMy role in this project\n\n\n\n1) I was a major actor behind the birth of this project, by connecting the consortium members together and writing most of the grant proposal (ANR AAPG 2021, funding of 609k€).\n2) I designed and participated in the development of the second prototype of our vibro-tactile belt, which features wireless communication (thanks to an ESP32 module) and amovible vibrators:\n\n\n\n\n\n\nFigure 1: Second prototype of the TactiBelt\n\n\n\n3) I lead the design and development of the project’s experimental platform. The platform uses Unity, connects to various motion tracking devices used by the consortium (Polhemus, VICON, pozyx), uses PureData for sound-wave generation and Steam Audio for 3D audio modeling, and communicates with the consortium’s non-visual interfaces wirelessly.\n\n\n\n\n\n\n\n\n\n\n\n(a) Testing environment with a PureData audio beacon\n\n\n\n\n\n \n\n\n\n\n\n\n\n\n(b) Auto-generated maze with 3D audio beacons on waypoints\n\n\n\n\n\n\n\nFigure 2: Screenshots from SAM-Guide’s experimental platform (in development)\n\n\n\nThis platform allows one to easily spin up experimental trials by specifying the desired characteristics in a JSON file (based on the OpenMaze project). Unity will automatically generate the trial’s environment according to those specifications and populate it with the relevant items (e.g. a tactile-signal emitting beacon signalling a target to reach in a maze), handle the transition between successive trials and blocks of trials, and log all the relevant user metrics into a data file.\n\n\n\n\n\n\n\n\n\n\n\n(a) Specifying the avatar and the experimental blocks’ characteristics\n\n\n\n\n\n \n\n\n\n\n\n\n\n\n(b) Specifying experimental trials, which can be repeated and randomized within blocks\n\n\n\n\n\n\n\nFigure 3: Examples of settings used to generate experimental trials on the fly.\n\n\n\n4) Handled the experimental design of the first wave of experiments using the TactiBelt for “blind” navigation.\n5) Built the first version of the SAM-Guide’s website, using Quarto and hosted on GitHub Pages (code).\n\n\n\n\n\n\n Back to top"
  },
  {
    "objectID": "content/projects/LT-AoP/index.html",
    "href": "content/projects/LT-AoP/index.html",
    "title": "LT-AoP",
    "section": "",
    "text": "Article\n  \n  \n    \n     Code\n  \n  \n      Documentation\n  \n\n      \n\n    \n    \n  \n\n\n\n\nSummary\nThe LT-AoP project included behavioral, immunohistochemistry and RT-qPCR data, which were analysed in R, hosted on GitHub, and archived with Zenodo. Data were modeled through the Generalized Linear Mixed Model (GLMM) framework, using the glmmTMB package (Brooks et al., 2017). Random intercepts were added to account for the correlation between pseudo-replicates. Temporally-dependent repeated measures were modeled using auto-regressive (AR1) terms.\nThe optimal likelihood families were selected based on our theoretical understanding of the variable’s properties, and to minimize Aikake’s Information Criterion (AIC). Count data (e.g., cell counts, number of maze entries, …) were modeled using a Generalized Poisson likelihood, measures bound at 0 (e.g., cell density, volumes, weights, …) were modeled using a Gamma likelihood, and proportions (e.g., ratios of areas) with a Beta likelihood.\nModel diagnostics were done using the DHARMa (Hartig, 2022) & performance (Lüdecke et al., 2021) packages, and estimated marginal means/contrasts were computed with the emmeans package (Lenth, 2022).\nA website documenting the analyses and their results was generated using Quarto, to allow interested readers to explore our data & models’ outputs without having to run the code themselves.\n\n\n\n\n\n\nNoteMy role in this project\n\n\n\n1) Handled the data processing and analysis, for both immunohistochemistry and RT-qPCR data (R/Markdown).\n2) Helped write the methodology/statistics part of the paper (Leroux et al., 2022).\n3) Open-source the code and registered on Zenodo.\n4) Made a website documenting and showcasing the project’s data, analyses, and results. The website uses Quarto and relies on templates to automatically generates documentation for each of the ~70 variables analyzed during the project.\n\n\n\n\nQuarto website\nWe made a Quarto website to showcase the project’s data, analyses, and results with interactive plots and tables:\n  \n\n\n\n\n\n\n Back to topReferences\n\nBrooks, M. E., Kristensen, K., van Benthem, K. J., Magnusson, A., Berg, C. W., Nielsen, A., Skaug, H. J., Maechler, M., & Bolker, B. M. (2017). glmmTMB balances speed and flexibility among packages for zero-inflated generalized linear mixed modeling. The R Journal, 9(2), 378–400. https://journal.r-project.org/archive/2017/RJ-2017-066/index.html\n\n\nHartig, F. (2022). DHARMa: Residual diagnostics for hierarchical (multi-level / mixed) regression models. https://CRAN.R-project.org/package=DHARMa\n\n\nLenth, R. V. (2022). Emmeans: Estimated marginal means, aka least-squares means. https://CRAN.R-project.org/package=emmeans\n\n\nLeroux, S., Rodriguez-Duboc, A., Arabo, A., Basille-Dugay, M., Vaudry, D., & Burel, D. (2022). Intermittent hypoxia in a mouse model of apnea of prematurity leads to a retardation of cerebellar development and long-term functional deficits. Cell & Bioscience, 12(1), 148. https://doi.org/10.1186/s13578-022-00869-5\n\n\nLüdecke, D., Ben-Shachar, M. S., Patil, I., Waggoner, P., & Makowski, D. (2021). performance: An R package for assessment, comparison and testing of statistical models. Journal of Open Source Software, 6(60), 3139. https://doi.org/10.21105/joss.03139"
  },
  {
    "objectID": "content/projects/CamIO/index.html",
    "href": "content/projects/CamIO/index.html",
    "title": "CamIO",
    "section": "",
    "text": "Homepage\n  \n  \n    \n     Article\n  \n  \n    \n     Code\n  \n\n      \n\n    \n    \n  \n\n\n\n\n\n\n\n\n\nNoteMy role in this project\n\n\n\n1) Explore new solutions to improve the localisation & tracking capabilities of CamIO:\nTheir existing solution, iLocalize (Fusco & Coughlan, 2018) (Swift / iOS), used a combination of Visuo-Inertial Odometry (VIO) through Apple’s ARKit, particle filtering based on a simplified map of the environment, and drift-correction through visual identification of known landmarks (using a gradient boosting algorithm).\n\n\n\n\n\nI explored existing 3rd-party services for indoor localization, such as Indoor Atlas (which combines VIO, GPS data, WiFi & geomagnetic fingerprinting, dead-reckoning, and barometric readings for altitude changes), for which I made a small demo.\n\n\n\n\n\n\n\n\n\n\n\n(a) Indoor Atlas’ localization\n\n\n\n\n\n\n\n\n\n\n\n(b) Indoor Atlas’ navigation graph\n\n\n\n\n\n\n\nFigure 1: Indoor Atlas\n\n\n\n2) Developed a web app to send the live camera stream from a mobile phone (JavaScript / socket.io) to a backend server (Python / Flask). The goal of the application was to facilitate the exploration of new Computer Vision algorithms to process the captured video and IMU data, which would send back location or navigational information.\n3) Assisted in analyzing the data from the first human experiments using CamIO (code).\n4) Helped write a scientific paper on this project (Coughlan et al., 2020).\n\n\n\nSummary\n\n\n\n\n\n\n\n Back to topReferences\n\nCoughlan, J. M., Biggs, B., Rivière, M.-A., & Shen, H. (2020). An Audio-Based 3D Spatial Guidance AR System for Blind Users. In K. Miesenberger, R. Manduchi, M. Covarrubias Rodriguez, & P. Peňáz (Eds.), Computers Helping People with Special Needs (Vol. 12376, pp. 475–484). Springer International Publishing. https://doi.org/10.1007/978-3-030-58796-3_55\n\n\nFusco, G., & Coughlan, J. M. (2018). Indoor localization using computer vision and visual-inertial odometry (pp. 86–93). Springer International Publishing. https://doi.org/10.1007/978-3-319-94274-2_13"
  },
  {
    "objectID": "content/projects/AD-McGill/index.html",
    "href": "content/projects/AD-McGill/index.html",
    "title": "AD-McGill",
    "section": "",
    "text": "Article\n  \n  \n    \n     Code\n  \n\n      \n\n    \n    \n  \n\n\n\nSummary\n\n\n\n\n\n\n\nNoteMy role in this project\n\n\n\n1) Managed the code for data processing, modeling, and hypothesis testing.\n2) Helped write the methodology/statistics part of the paper (Rodriguez-Duboc et al., 2025).\n3) Open-sourced the resulting code on GitHub and registered it on Zenodo.\n\n\nData\nThe project analyzed brightfield immunohistochemistry (IHC) data quantified as optical density (OD) measurements from brain tissue sections. Data was collected from 24 rats (12 AD model, 12 controls) across three age groups (3, 12, 18 months) to measure BNIP3 protein expression in neuronal soma and axonal projections. Each animal contributed 7-8 tissue sections covering specific brain regions (entorhinal cortex, CA3, dentate gyrus), with background correction applied by subtracting deep layer measurements from raw OD values. The dataset included hierarchical structure with measurements nested within sections, sections within animals, creating pseudo-replication that required mixed-effects modeling approaches.\nData preprocessing involved standardizing variable names and metadata using a data dictionary to ensure consistent analysis workflows. The final dataset captured both cellular (soma) and projection field (molecular layer) measurements across genotype, age, and brain region factors.\nModels\nOptical Density (OD) data was modeled using a Gamma distribution to account for the data’s strict positivity and positive skewness, with a log link function.\nGeneralized Linear Mixed Models (GLMMs) were used to model the data, using random effects to account for pseudo-replication and the hierarchical nature of the data. For all models, categorical predictors were dummy-coded with a reference level: genotype (Wild-Type) and age (3 months). Models were fitted using the glmmTMB package (Brooks et al., 2017).\nModel fit was assessed using a combination of plots (normality, homoscedasticity, normality of residuals, collinearity), statistical tests (Levenne, KS, dispersion), and posterior predictive checks on simple statistics (min, max, mean, sd) using simulated residuals. Model fit was assessed using the DHARMa (Hartig, 2022) and performance (Lüdecke et al., 2021) packages.\nTwo models were fitted on the OD data, one for the soma and one for the molecular layer (terminal fields):\n\n\n‘Soma’ model\n‘Molecular Layer’ model\n\n\n\nWe modeled the OD of individual neuronal somata () using genotype, age, and brain area (LEC vs. MEC) as fixed effects, along with all their interactions. Random intercepts were included for each rat (j) and for each tissue section (k) nested within each rat.\nModel equation\n\n\n\n\n\n\n\nNoteEquivalent R model\n\n\n\n\n\n\nglmmTMB::glmmTMB(\n  od_corrected ~ genotype * age * area + (1 | rat / section),\n  family = Gamma(\"log\"),\n  data = od_data$soma,\n  REML = TRUE\n)\n\n\n\n\nModel fit\n\n\nPlots\nTests\nPosterior Predictive Checks\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nTo model the OD of the terminal fields (), the fixed effects included genotype, age, and their interaction. A random intercept for each rat (j) was included to account for inter-animal variability.\nModel equation\n\n\n\n\n\n\n\nNoteEquivalent R model\n\n\n\n\n\n\nglmmTMB(\n    od_corrected ~ genotype * age + (1 | rat),\n    family = Gamma(\"log\"),\n    data = od_data$ml,\n    REML = TRUE\n)\n\n\n\n\nModel fit\n\n\nPlots\nTests\nPosterior Predictive Checks\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nHypotheses\nContrasts for hypotheses of interest were tested with emmeans (Lenth, 2022), with the Holm method to adjust for multiple comparisons.\n\n\nSoma\nMolecular Layer\n\n\n\nSince Reelin neurons have high metabolism, we hypothesized a higher Bnip3 expression in the soma of LEC/MEC neurons in AD rats, and the difference should be higher in older rats. We used the ‘Soma’ model to test these hypotheses.\n\n\nGenotype (AD vs control)\nGenotype | Age\nGenotype : Age\n\n\n\n\nemmeans(mod_soma, specs = \"genotype\", type = \"response\") |&gt; \n    contrast(method = \"pairwise\", adjust = \"holm\", infer = TRUE)\n\n contrast    ratio    SE  df asymp.LCL asymp.UCL null z.ratio p.value\n WT / McGill 0.943 0.202 Inf     0.619      1.44    1  -0.274  0.7842\n\nResults are averaged over the levels of: age, area \nConfidence level used: 0.95 \nIntervals are back-transformed from the log scale \nTests are performed on the log scale \n\n\n\n\n\n\n\nemmeans(mod_soma, specs = ~ genotype | age, type = \"response\") |&gt; \n    contrast(method = \"pairwise\", adjust = \"none\", infer = TRUE) |&gt; \n    as.data.frame() |&gt; \n    modify_at(\"p.value\", \\(x) p.adjust(x, method = \"holm\"))\n\nage = M3:\n contrast     ratio     SE  df asymp.LCL asymp.UCL null z.ratio p.value\n WT / McGill 0.5012 0.1862 Inf    0.2420     1.038    1  -1.859  0.1891\n\nage = M12:\n contrast     ratio     SE  df asymp.LCL asymp.UCL null z.ratio p.value\n WT / McGill 1.5831 0.5882 Inf    0.7643     3.279    1   1.236  0.4326\n\nage = M18:\n contrast     ratio     SE  df asymp.LCL asymp.UCL null z.ratio p.value\n WT / McGill 1.0566 0.3927 Inf    0.5100     2.189    1   0.148  0.8822\n\nResults are averaged over the levels of: area \nConfidence level used: 0.95 \nIntervals are back-transformed from the log scale \nTests are performed on the log scale \n\n\n\n\n\n\n\nemmeans(mod_soma, specs = ~ genotype | age, type = \"response\") |&gt;\n    contrast(interaction = \"pairwise\", by = NULL, adjust = \"none\", infer = TRUE) |&gt; \n    as.data.frame() |&gt; \n    modify_at(\"p.value\", \\(x) p.adjust(x, method = \"holm\"))\n\n genotype_pairwise age_pairwise  ratio     SE  df asymp.LCL asymp.UCL null z.ratio p.value\n WT / McGill        M3 / M12     0.3166 0.1664 Inf    0.1131     0.887    1  -2.189  0.0858\n WT / McGill        M3 / M18     0.4744 0.2493 Inf    0.1694     1.329    1  -1.419  0.3118\n WT / McGill        M12 / M18    1.4983 0.7874 Inf    0.5349     4.197    1   0.769  0.4417\n\nResults are averaged over the levels of: area \nConfidence level used: 0.95 \nIntervals are back-transformed from the log scale \nTests are performed on the log scale \n\n\n\n\n\n\n\n\n\nWe hypothesized that BNIP3 expression would be relatively low in other areas, but may be high in the projection areas of those neurons (CA3 & dentate gyrus). We used the ‘Molecular Layer’ model to test these hypotheses.\n\n\nGenotype (AD vs control)\nGenotype | Age\nGenotype : Age\n\n\n\n\nemmeans(mod_ml, specs = \"genotype\", type = \"response\") |&gt; \n    contrast(method = \"pairwise\", adjust = \"holm\", infer = TRUE)\n\n contrast    ratio     SE  df asymp.LCL asymp.UCL null z.ratio p.value\n WT / McGill 0.715 0.0999 Inf     0.543      0.94    1  -2.403  0.0163\n\nResults are averaged over the levels of: age \nConfidence level used: 0.95 \nIntervals are back-transformed from the log scale \nTests are performed on the log scale\n\n\n\n\n\n\n\nemmeans(mod_ml, specs = ~ genotype | age, type = \"response\") |&gt; \n    contrast(method = \"pairwise\", adjust = \"none\", infer = TRUE) |&gt; \n    as.data.frame() |&gt; \n    modify_at(\"p.value\", \\(x) p.adjust(x, method = \"holm\"))\n\nage = M3:\n contrast     ratio     SE  df asymp.LCL asymp.UCL null z.ratio p.value\n WT / McGill 0.5610 0.1535 Inf    0.3281    0.9592    1  -2.112  0.0694\n\nage = M12:\n contrast     ratio     SE  df asymp.LCL asymp.UCL null z.ratio p.value\n WT / McGill 1.2950 0.3529 Inf    0.7591    2.2091    1   0.949  0.3429\n\nage = M18:\n contrast     ratio     SE  df asymp.LCL asymp.UCL null z.ratio p.value\n WT / McGill 0.5021 0.0823 Inf    0.3641    0.6924    1  -4.202  0.0001\n\nConfidence level used: 0.95 \nIntervals are back-transformed from the log scale \nTests are performed on the log scale \n\n\n\n\nemmeans(mod_ml, specs = ~ genotype | age, type = \"response\") |&gt;\n    contrast(interaction = \"pairwise\", by = NULL, adjust = \"none\", infer = TRUE) |&gt; \n    as.data.frame() |&gt; \n    modify_at(\"p.value\", \\(x) p.adjust(x, method = \"holm\"))\n\n genotype_pairwise age_pairwise  ratio     SE  df asymp.LCL asymp.UCL null z.ratio p.value\n WT / McGill        M3 / M12     0.4332 0.1673 Inf    0.2032     0.924    1  -2.166  0.0606\n WT / McGill        M3 / M18     1.1172 0.3564 Inf    0.5978     2.088    1   0.347  0.7283\n WT / McGill        M12 / M18    2.5788 0.8202 Inf    1.3826     4.810    1   2.979  0.0087\n\nConfidence level used: 0.95 \nIntervals are back-transformed from the log scale \nTests are performed on the log scale \n\n\n\n\n\n\n\n\n\n\n\n Back to topReferences\n\nBrooks, M. E., Kristensen, K., van Benthem, K. J., Magnusson, A., Berg, C. W., Nielsen, A., Skaug, H. J., Maechler, M., & Bolker, B. M. (2017). glmmTMB balances speed and flexibility among packages for zero-inflated generalized linear mixed modeling. The R Journal, 9(2), 378–400. https://journal.r-project.org/archive/2017/RJ-2017-066/index.html\n\n\nHartig, F. (2022). DHARMa: Residual diagnostics for hierarchical (multi-level / mixed) regression models. https://CRAN.R-project.org/package=DHARMa\n\n\nLenth, R. V. (2022). Emmeans: Estimated marginal means, aka least-squares means. https://CRAN.R-project.org/package=emmeans\n\n\nLüdecke, D., Ben-Shachar, M. S., Patil, I., Waggoner, P., & Makowski, D. (2021). performance: An R package for assessment, comparison and testing of statistical models. Journal of Open Source Software, 6(60), 3139. https://doi.org/10.21105/joss.03139\n\n\nRodriguez-Duboc, A., Velicer, S. T., & Kobro-Flatmoen, A. (2025). Bnip3 expression in the brain of an Alzheimer’s disease rat model. Brain Mechanisms, 148–150, 202518. https://doi.org/10.1016/j.bramec.2025.202518"
  },
  {
    "objectID": "content/blog/posts/data.table/index.html#arrange-order",
    "href": "content/blog/posts/data.table/index.html#arrange-order",
    "title": "Data wrangling with data.table and the Tidyverse",
    "section": "\n1.1 Arrange / Order",
    "text": "1.1 Arrange / Order\n\n1.1.1 Basic ordering\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |&gt; arrange(desc(cyl))\ndata.frame [32 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n10.4\n\n\n8\n\n\n460\n\n\n215\n\n\n3\n\n\n5.424\n\n\n17.82\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.7\n\n\n8\n\n\n440\n\n\n230\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n15.5\n\n\n8\n\n\n318\n\n\n150\n\n\n2.76\n\n\n3.52\n\n\n16.87\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n15.2\n\n\n8\n\n\n304\n\n\n150\n\n\n3.15\n\n\n3.435\n\n\n17.3\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n15.8\n\n\n8\n\n\n351\n\n\n264\n\n\n4.22\n\n\n3.17\n\n\n14.5\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n15\n\n\n8\n\n\n301\n\n\n335\n\n\n3.54\n\n\n3.57\n\n\n14.6\n\n\n0\n\n\n1\n\n\n5\n\n\n8\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nmtcars |&gt; arrange(desc(cyl), gear)\ndata.frame [32 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n10.4\n\n\n8\n\n\n460\n\n\n215\n\n\n3\n\n\n5.424\n\n\n17.82\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.7\n\n\n8\n\n\n440\n\n\n230\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n15.5\n\n\n8\n\n\n318\n\n\n150\n\n\n2.76\n\n\n3.52\n\n\n16.87\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n15.2\n\n\n8\n\n\n304\n\n\n150\n\n\n3.15\n\n\n3.435\n\n\n17.3\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n15.8\n\n\n8\n\n\n351\n\n\n264\n\n\n4.22\n\n\n3.17\n\n\n14.5\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n15\n\n\n8\n\n\n301\n\n\n335\n\n\n3.54\n\n\n3.57\n\n\n14.6\n\n\n0\n\n\n1\n\n\n5\n\n\n8\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\nMT[order(-cyl)]\ndata.table [32 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n10.4\n\n\n8\n\n\n460\n\n\n215\n\n\n3\n\n\n5.424\n\n\n17.82\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.7\n\n\n8\n\n\n440\n\n\n230\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n15.5\n\n\n8\n\n\n318\n\n\n150\n\n\n2.76\n\n\n3.52\n\n\n16.87\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n15.2\n\n\n8\n\n\n304\n\n\n150\n\n\n3.15\n\n\n3.435\n\n\n17.3\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n15.8\n\n\n8\n\n\n351\n\n\n264\n\n\n4.22\n\n\n3.17\n\n\n14.5\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n15\n\n\n8\n\n\n301\n\n\n335\n\n\n3.54\n\n\n3.57\n\n\n14.6\n\n\n0\n\n\n1\n\n\n5\n\n\n8\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nMT[order(-cyl, gear)]\ndata.table [32 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n10.4\n\n\n8\n\n\n460\n\n\n215\n\n\n3\n\n\n5.424\n\n\n17.82\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.7\n\n\n8\n\n\n440\n\n\n230\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n15.5\n\n\n8\n\n\n318\n\n\n150\n\n\n2.76\n\n\n3.52\n\n\n16.87\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n15.2\n\n\n8\n\n\n304\n\n\n150\n\n\n3.15\n\n\n3.435\n\n\n17.3\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n15.8\n\n\n8\n\n\n351\n\n\n264\n\n\n4.22\n\n\n3.17\n\n\n14.5\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n15\n\n\n8\n\n\n301\n\n\n335\n\n\n3.54\n\n\n3.57\n\n\n14.6\n\n\n0\n\n\n1\n\n\n5\n\n\n8\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nAlternativesMT[fsort(cyl, decreasing = TRUE)]\n\nsetorder(MT, -cyl, gear)[]\n\nsetorderv(MT, c(\"cyl\", \"gear\"), c(-1 ,1))[]\n\n\nOrdering on a character column\n\nIRIS[chorder(Species)]\ndata.table [150 x 5]\n\n\n\n\nSepal.Length\n\n\nSepal.Width\n\n\nPetal.Length\n\n\nPetal.Width\n\n\nSpecies\n\n\n\n\n\n5.1\n\n\n3.5\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.7\n\n\n3.2\n\n\n1.3\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.1\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5\n\n\n3.6\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.9\n\n\n1.7\n\n\n0.4\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.4\n\n\n1.4\n\n\n0.3\n\n\nsetosa\n\n\n\n\n5\n\n\n3.4\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.4\n\n\n2.9\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3.1\n\n\n1.5\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.7\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3.4\n\n\n1.6\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3\n\n\n1.4\n\n\n0.1\n\n\nsetosa\n\n\n\n\n4.3\n\n\n3\n\n\n1.1\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.8\n\n\n4\n\n\n1.2\n\n\n0.2\n\n\nsetosa\n\n\n\n\n\n[ omitted 135 entries ]\n\n\n\n\n\n\n\n\n\n\n1.1.2 Ordering with keys\n\nKeys physically reorders the dataset within the RAM (by reference)\n\nNo memory is used for sorting (other than marking which columns is the key)\n\n\n\nThe dataset is marked with an attribute “sorted”\n\nThe dataset is always sorted in ascending order, with NA first\n\nUsing keyby instead of by when grouping will set the grouping factors as keys\n\n\n\n\n\n\n\nTip\n\n\n\nSee this SO post for more information on keys.\n\n\n\nsetkey(MT, cyl, gear)\n\nsetkeyv(MT, c(\"cyl\", \"gear\"))\n\nMT\ndata.table [32 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21.5\n\n\n4\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n32.4\n\n\n4\n\n\n78.7\n\n\n66\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n30.4\n\n\n4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n33.9\n\n\n4\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n27.3\n\n\n4\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\nTo see over which keys (if any) the dataset is currently ordered:\n\nhaskey(MT)\n[1] TRUE\nkey(MT)\n[1] “cyl” “gear”\n\n\n\n\n\n\n\nWarning\n\n\n\nUnless our task involves repeated subsetting on the same column, the speed gain from key-based subsetting could effectively be nullified by the time needed to reorder the data in RAM, especially for large datasets.\n\n\n\n1.1.3 Ordering with (secondary) indices\n\n\nsetindex creates an index for the provided columns, but doesn’t physically reorder the dataset in RAM.\n\nIt computes the ordering vector of the dataset’s rows according to the provided columns in an additional attribute called index\n\n\n\nsetindex(MT, cyl, gear)\n\nsetindexv(MT, c(\"cyl\", \"gear\"))\n\nMT\ndata.table [32 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\nWe can see the additional index attribute added to the data.table:\n\nnames(attributes(MT))\n\n[1] \"names\"             \"row.names\"         \"class\"            \n[4] \".internal.selfref\" \"index\"            \n\n\nWe can get the currently used indices with:\n\nindices(MT)\n[1] “cyl__gear”\n\nAdding a new index doesn’t remove a previously existing one:\n\nsetindex(MT, hp)\n\nindices(MT)\n[1] “cyl__gear” “hp”\n\nWe can thus use indices to pre-compute the ordering for the columns (or combinations of columns) that we will be using to group or subset by frequently !"
  },
  {
    "objectID": "content/blog/posts/data.table/index.html#subset-filter",
    "href": "content/blog/posts/data.table/index.html#subset-filter",
    "title": "Data wrangling with data.table and the Tidyverse",
    "section": "\n1.2 Subset / Filter",
    "text": "1.2 Subset / Filter\n\n1.2.1 Basic filtering\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |&gt; filter(cyl &gt;= 6 & disp &lt; 180)\ndata.frame [5 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n19.7\n\n\n6\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n\n\n\n\n\n\niris |&gt; filter(Species %in% c(\"setosa\"))\ndata.frame [50 x 5]\n\n\n\n\nSepal.Length\n\n\nSepal.Width\n\n\nPetal.Length\n\n\nPetal.Width\n\n\nSpecies\n\n\n\n\n\n5.1\n\n\n3.5\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.7\n\n\n3.2\n\n\n1.3\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.1\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5\n\n\n3.6\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.9\n\n\n1.7\n\n\n0.4\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.4\n\n\n1.4\n\n\n0.3\n\n\nsetosa\n\n\n\n\n5\n\n\n3.4\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.4\n\n\n2.9\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3.1\n\n\n1.5\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.7\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3.4\n\n\n1.6\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3\n\n\n1.4\n\n\n0.1\n\n\nsetosa\n\n\n\n\n4.3\n\n\n3\n\n\n1.1\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.8\n\n\n4\n\n\n1.2\n\n\n0.2\n\n\nsetosa\n\n\n\n\n\n[ omitted 35 entries ]\n\n\n\n\n\n\n\n\n\nMT[cyl &gt;= 6 & disp &lt; 180]\ndata.table [5 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n19.7\n\n\n6\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n\n\n\n\n\n\nIRIS[Species %chin% c(\"setosa\")]\ndata.table [50 x 5]\n\n\n\n\nSepal.Length\n\n\nSepal.Width\n\n\nPetal.Length\n\n\nPetal.Width\n\n\nSpecies\n\n\n\n\n\n5.1\n\n\n3.5\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.7\n\n\n3.2\n\n\n1.3\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.1\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5\n\n\n3.6\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.9\n\n\n1.7\n\n\n0.4\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.4\n\n\n1.4\n\n\n0.3\n\n\nsetosa\n\n\n\n\n5\n\n\n3.4\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.4\n\n\n2.9\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3.1\n\n\n1.5\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.7\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3.4\n\n\n1.6\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3\n\n\n1.4\n\n\n0.1\n\n\nsetosa\n\n\n\n\n4.3\n\n\n3\n\n\n1.1\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.8\n\n\n4\n\n\n1.2\n\n\n0.2\n\n\nsetosa\n\n\n\n\n\n[ omitted 35 entries ]\n\n\n\n\n\n\nFor non-regex character filtering, use %chin% (which is a character-optimized version of %in%)\n\n\n\n\n1.2.2 Filter based on a range\n\nmtcars |&gt; filter(between(disp, 200, 300))\ndata.frame [5 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n\n\n\n\nMT[disp %between% c(200, 300)]\ndata.table [5 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n\n\n\n\n1.2.3 Filter with a pattern\n\nmtcars |&gt; filter(str_detect(disp, \"^\\\\d{3}\\\\.\"))\ndata.frame [9 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n21.5\n\n\n4\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n\n\n\n\nMT[disp %like% \"^\\\\d{3}\\\\.\"]\ndata.table [9 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n21.5\n\n\n4\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n\n\n\n\nVariantsIRIS[Species %flike% \"set\"] # Fixed (not regex)\n\nIRIS[Species %ilike% \"Set\"] # Ignore case\n\nIRIS[Species %plike% \"(?=set)\"] # Perl-like regex\n\n\n\n1.2.4 Filter on row number (slicing)\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |&gt; slice(1) # slice_head(n = 1)\ndata.frame [1 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n\n\n\nmtcars |&gt; slice(n()) # slice_tail(n = 1)\ndata.frame [1 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n\n\n\nSlice a random sample of rows:\n\nmtcars |&gt; slice_sample(n = 5)\ndata.frame [5 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21.5\n\n\n4\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n\n\n\n\n\nMT[1]\ndata.table [1 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n\n\n\nMT[.N]\ndata.table [1 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n\n\n\nSlice a random sample of rows:\n\nMT[sample(.N, 5)]\ndata.table [5 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n\n\n\n\n\n\n\n1.2.5 Filter distinct/unique rows\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |&gt; distinct(mpg, hp, .keep_all = TRUE)\ndata.frame [31 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n10.4\n\n\n8\n\n\n460\n\n\n215\n\n\n3\n\n\n5.424\n\n\n17.82\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 16 entries ]\n\n\n\n\n\n\n\nNumber of unique rows/values\n\nn_distinct(mtcars$gear)\n[1] 3\n\n\n\n\nunique(MT, by = c(\"mpg\", \"hp\")) # cols = other_cols_to_keep\ndata.table [31 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n10.4\n\n\n8\n\n\n460\n\n\n215\n\n\n3\n\n\n5.424\n\n\n17.82\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 16 entries ]\n\n\n\n\n\n\n\nNumber of unique rows/values\n\nuniqueN(MT, by = \"gear\")\n[1] 3\n\n\n\n\n\n1.2.6 Filter by keys\nWhen keys or indices are defined, we can filter based on them, which is often a lot faster.\n\n\n\n\n\n\nTip\n\n\n\nWe do not even need to specify the column name we are filtering on: the values will be attributed to the keys in order.\n\n\n\nsetkey(MT, cyl)\n\nMT[.(6)] # Equivalent to MT[cyl == 6]\ndata.table [7 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n19.7\n\n\n6\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n\n\n\n\n\n\nsetkey(MT, cyl, gear)\n\nMT[.(6, 4)] # Equivalent to MT[cyl == 6 & gear == 4]\ndata.table [4 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n\n\n\n\n1.2.7 Filter by indices\nTo filter by indices, we can use the on argument, which creates a temporary secondary index on the fly (if it doesn’t already exist).\n\nIRIS[\"setosa\", on = \"Species\"]\ndata.table [50 x 5]\n\n\n\n\nSepal.Length\n\n\nSepal.Width\n\n\nPetal.Length\n\n\nPetal.Width\n\n\nSpecies\n\n\n\n\n\n5.1\n\n\n3.5\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.7\n\n\n3.2\n\n\n1.3\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.1\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5\n\n\n3.6\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.9\n\n\n1.7\n\n\n0.4\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.4\n\n\n1.4\n\n\n0.3\n\n\nsetosa\n\n\n\n\n5\n\n\n3.4\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.4\n\n\n2.9\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3.1\n\n\n1.5\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.7\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3.4\n\n\n1.6\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3\n\n\n1.4\n\n\n0.1\n\n\nsetosa\n\n\n\n\n4.3\n\n\n3\n\n\n1.1\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.8\n\n\n4\n\n\n1.2\n\n\n0.2\n\n\nsetosa\n\n\n\n\n\n[ omitted 35 entries ]\n\n\n\n\n\n\nSince the time to compute the secondary indices is quite small, we don’t have to use setindex, unless the task involves repeated subsetting on the same columns.\n\n\n\n\n\n\nTip\n\n\n\nWhen using on with multiple values, the nomatch = NULL argument avoids creating combinations that do not exist in the original data (i.e. for cyl == 5 here)\n\n\n\nMT[.(4:6, 4), on = c(\"cyl\", \"gear\"), nomatch = NULL]\ndata.table [12 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n32.4\n\n\n4\n\n\n78.7\n\n\n66\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n30.4\n\n\n4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n33.9\n\n\n4\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n27.3\n\n\n4\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n\n\n\n\n1.2.8 Filtering on multiple columns\nFiltering with one function taking multiple columns:\n\nf_dat &lt;- \\(d) with(d, gear &gt; cyl) # Function taking the data and comparing fix columns\n\nf_dyn &lt;- \\(x, y) x &gt; y # Function taking dynamic columns and comparing them\n\n\ncols &lt;- c(\"gear\", \"cyl\")\n\n\n\nTidyverse\ndata.table\n\n\n\nManually:\n\nmtcars |&gt; filter(f_dyn(gear, cyl))\ndata.frame [2 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n\n\n\n\nDynamically:\nTaking column names:\n\nmtcars |&gt; filter(f_dyn(!!!syms(cols)))\ndata.frame [2 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n\n\n\nTaking the data:\n\nmtcars |&gt; filter(f_dat(cur_data()))\ndata.frame [2 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n\n\n\n\n\nManually:\n\nMT[f_dyn(gear, cyl),]\ndata.table [2 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n\n\n\n\nDynamically:\nTaking column names:\n\nMT[do.call(f_dyn, args), env = list(args = as.list(cols))] # exec(f_dyn, !!!args)\ndata.table [2 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n\n\n\nTaking the data:\n\nMT[f_dat(MT),] # Can't use .SD in i\ndata.table [2 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n\n\n\nIn two steps:\n\n\n\n\n\n\nNoteWe can’t use .SD in the i clause of a data.table\n\n\n\nBut we can bypass that constraint by doing the operation in two steps:\n- Obtaining a vector stating if each row of the table matches or not the conditions\n- Filtering the original table based on the vector\n\n\n\nMT[MT[, f_dat(.SD)]]\ndata.table [2 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n\n\n\n\n\n\nCombining multiple filtering functions:\nThis function filters rows that have 2 or more non-zero decimals, and we’re going to call it on multiple columns:\n\ndecp &lt;- \\(x) str_length(str_remove(as.character(abs(x)), \".*\\\\.\")) &gt;= 2\n\n\ncols &lt;- c(\"drat\", \"wt\", \"qsec\")\n\n\n\nTidyverse\ndata.table\n\n\n\nManually:\n\nmtcars |&gt; filter(decp(drat) & decp(wt) & decp(qsec))\ndata.frame [13 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.7\n\n\n8\n\n\n440\n\n\n230\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n30.4\n\n\n4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n15.5\n\n\n8\n\n\n318\n\n\n150\n\n\n2.76\n\n\n3.52\n\n\n16.87\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n\n\n\n\nDynamically:\n\nmtcars |&gt; filter(if_all(cols, decp))\ndata.frame [13 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.7\n\n\n8\n\n\n440\n\n\n230\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n30.4\n\n\n4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n15.5\n\n\n8\n\n\n318\n\n\n150\n\n\n2.76\n\n\n3.52\n\n\n16.87\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n\n\n\n\n\nManually:\n\nMT[decp(drat) & decp(wt) & decp(qsec), ]\ndata.table [13 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.7\n\n\n8\n\n\n440\n\n\n230\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n15.5\n\n\n8\n\n\n318\n\n\n150\n\n\n2.76\n\n\n3.52\n\n\n16.87\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n\n\n\n\nDynamically:\n\nMT[Reduce(`&`, lapply(mget(cols), decp)), ]\ndata.table [13 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.7\n\n\n8\n\n\n440\n\n\n230\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n15.5\n\n\n8\n\n\n318\n\n\n150\n\n\n2.76\n\n\n3.52\n\n\n16.87\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n\n\n\n\nAlternativesMT[Reduce(`&`, lapply(MT[, ..cols], decp)), ]\n\nMT[Reduce(`&`, lapply(v1, decp)), env = list(v1 = as.list(cols))]\n\n\nIn two steps:\n\nMT[MT[, Reduce(`&`, lapply(.SD, decp)), .SDcols = cols]]\ndata.table [13 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.7\n\n\n8\n\n\n440\n\n\n230\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n15.5\n\n\n8\n\n\n318\n\n\n150\n\n\n2.76\n\n\n3.52\n\n\n16.87\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2"
  },
  {
    "objectID": "content/blog/posts/data.table/index.html#rename",
    "href": "content/blog/posts/data.table/index.html#rename",
    "title": "Data wrangling with data.table and the Tidyverse",
    "section": "\n1.3 Rename",
    "text": "1.3 Rename\n\n\n\n\n\n\nNote\n\n\n\nsetnames changes column names in-place\n\n\n\n\nTidyverse\ndata.table\n\n\n\nManually:\n\nmtcars |&gt; rename(CYL = cyl, MPG = mpg)\ndata.frame [32 x 11]\n\n\n\n\nMPG\n\n\nCYL\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nDynamically:\n\nmtcars |&gt; rename_with(\\(c) toupper(c), .cols = matches(\"^d\"))\ndata.frame [32 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\nDISP\n\n\nhp\n\n\nDRAT\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\nManually:\n\nsetnames(copy(MT), c(\"cyl\", \"mpg\"), c(\"CYL\", \"MPG\"))[]\ndata.table [32 x 11]\n\n\n\n\nMPG\n\n\nCYL\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nDynamically:\n\nsetnames(copy(MT), grep(\"^d\", colnames(MT)), toupper)[]\ndata.table [32 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\nDISP\n\n\nhp\n\n\nDRAT\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]"
  },
  {
    "objectID": "content/blog/posts/data.table/index.html#select",
    "href": "content/blog/posts/data.table/index.html#select",
    "title": "Data wrangling with data.table and the Tidyverse",
    "section": "\n1.4 Select",
    "text": "1.4 Select\n\n1.4.1 Basic selection\n\n\nTidyverse\ndata.table\n\n\n\n\nMT |&gt; select(matches(\"cyl|disp\"))\ndata.table [32 x 2]\n\n\n\n\ncyl\n\n\ndisp\n\n\n\n\n\n6\n\n\n160\n\n\n\n\n6\n\n\n160\n\n\n\n\n4\n\n\n108\n\n\n\n\n6\n\n\n258\n\n\n\n\n8\n\n\n360\n\n\n\n\n6\n\n\n225\n\n\n\n\n8\n\n\n360\n\n\n\n\n4\n\n\n146.7\n\n\n\n\n4\n\n\n140.8\n\n\n\n\n6\n\n\n167.6\n\n\n\n\n6\n\n\n167.6\n\n\n\n\n8\n\n\n275.8\n\n\n\n\n8\n\n\n275.8\n\n\n\n\n8\n\n\n275.8\n\n\n\n\n8\n\n\n472\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\nRemove a column:\n\nmtcars |&gt; select(!cyl) # select(-cyl)\ndata.frame [32 x 10]\n\n\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\nMT[, .(mpg, disp)]\ndata.table [32 x 2]\n\n\n\n\nmpg\n\n\ndisp\n\n\n\n\n\n21\n\n\n160\n\n\n\n\n21\n\n\n160\n\n\n\n\n22.8\n\n\n108\n\n\n\n\n21.4\n\n\n258\n\n\n\n\n18.7\n\n\n360\n\n\n\n\n18.1\n\n\n225\n\n\n\n\n14.3\n\n\n360\n\n\n\n\n24.4\n\n\n146.7\n\n\n\n\n22.8\n\n\n140.8\n\n\n\n\n19.2\n\n\n167.6\n\n\n\n\n17.8\n\n\n167.6\n\n\n\n\n16.4\n\n\n275.8\n\n\n\n\n17.3\n\n\n275.8\n\n\n\n\n15.2\n\n\n275.8\n\n\n\n\n10.4\n\n\n472\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nAlternativesMT[ , .SD, .SDcols = c(\"mpg\", \"disp\")]\n\nMT[, .SD, .SDcols = patterns(\"mpg|disp\")]\n\n\n\nRemove a column:\n\nMT[, !\"cyl\"] # MT[, -\"cyl\"]\ndata.table [32 x 10]\n\n\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\nIn-place:\n\ncopy(MT)[, cyl := NULL][]\ndata.table [32 x 10]\n\n\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\n\n\nTidyverse\ndata.table\n\n\n\nSelect & Extract:\n\nmtcars |&gt; pull(disp)\n\n [1] 160.0 160.0 108.0 258.0 360.0 225.0 360.0 146.7 140.8 167.6 167.6 275.8\n[13] 275.8 275.8 472.0 460.0 440.0  78.7  75.7  71.1 120.1 318.0 304.0 350.0\n[25] 400.0  79.0 120.3  95.1 351.0 145.0 301.0 121.0\n\n\n\nSelect & Rename:\n\nmtcars |&gt; select(dispp = disp)\ndata.frame [32 x 1]\n\n\n\n\ndispp\n\n\n\n\n\n160\n\n\n\n\n160\n\n\n\n\n108\n\n\n\n\n258\n\n\n\n\n360\n\n\n\n\n225\n\n\n\n\n360\n\n\n\n\n146.7\n\n\n\n\n140.8\n\n\n\n\n167.6\n\n\n\n\n167.6\n\n\n\n\n275.8\n\n\n\n\n275.8\n\n\n\n\n275.8\n\n\n\n\n472\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\nSelect & Extract:\n\nMT[, disp]\n\n [1] 160.0 160.0 108.0 258.0 360.0 225.0 360.0 146.7 140.8 167.6 167.6 275.8\n[13] 275.8 275.8 472.0 460.0 440.0  78.7  75.7  71.1 120.1 318.0 304.0 350.0\n[25] 400.0  79.0 120.3  95.1 351.0 145.0 301.0 121.0\n\n\n\nSelect & Rename:\n\nMT[, .(dispp = disp)]\ndata.table [32 x 1]\n\n\n\n\ndispp\n\n\n\n\n\n160\n\n\n\n\n160\n\n\n\n\n108\n\n\n\n\n258\n\n\n\n\n360\n\n\n\n\n225\n\n\n\n\n360\n\n\n\n\n146.7\n\n\n\n\n140.8\n\n\n\n\n167.6\n\n\n\n\n167.6\n\n\n\n\n275.8\n\n\n\n\n275.8\n\n\n\n\n275.8\n\n\n\n\n472\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\n\n1.4.2 Dynamic selection\n\n1.4.2.1 By name\n\ncols &lt;- c(\"cyl\", \"disp\")\n\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |&gt; select(all_of(cols)) # select(!!cols)\ndata.frame [32 x 2]\n\n\n\n\ncyl\n\n\ndisp\n\n\n\n\n\n6\n\n\n160\n\n\n\n\n6\n\n\n160\n\n\n\n\n4\n\n\n108\n\n\n\n\n6\n\n\n258\n\n\n\n\n8\n\n\n360\n\n\n\n\n6\n\n\n225\n\n\n\n\n8\n\n\n360\n\n\n\n\n4\n\n\n146.7\n\n\n\n\n4\n\n\n140.8\n\n\n\n\n6\n\n\n167.6\n\n\n\n\n6\n\n\n167.6\n\n\n\n\n8\n\n\n275.8\n\n\n\n\n8\n\n\n275.8\n\n\n\n\n8\n\n\n275.8\n\n\n\n\n8\n\n\n472\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\nRemoving a column:\n\nmtcars |&gt; select(!{{cols}}) # select(-matches(cols))\ndata.frame [32 x 9]\n\n\n\n\nmpg\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\nMT[, ..cols]\ndata.table [32 x 2]\n\n\n\n\ncyl\n\n\ndisp\n\n\n\n\n\n6\n\n\n160\n\n\n\n\n6\n\n\n160\n\n\n\n\n4\n\n\n108\n\n\n\n\n6\n\n\n258\n\n\n\n\n8\n\n\n360\n\n\n\n\n6\n\n\n225\n\n\n\n\n8\n\n\n360\n\n\n\n\n4\n\n\n146.7\n\n\n\n\n4\n\n\n140.8\n\n\n\n\n6\n\n\n167.6\n\n\n\n\n6\n\n\n167.6\n\n\n\n\n8\n\n\n275.8\n\n\n\n\n8\n\n\n275.8\n\n\n\n\n8\n\n\n275.8\n\n\n\n\n8\n\n\n472\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nAlternativesMT[, mget(cols)] # Retired\n\nMT[, cols, with = FALSE] # Retired\n\nMT[, .SD, .SDcols = cols]\n\nMT[, j, env = list(j = as.list(cols))]\n\n\n\nRemoving a column:\n\nMT[, !..cols]\ndata.table [32 x 9]\n\n\n\n\nmpg\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nAlternativesMT[, .SD, .SDcols = !cols]\n\nMT[, -j, env = list(j = I(cols))]\n\n\nIn-place:\n\ncopy(MT)[, (cols) := NULL][]\ndata.table [32 x 9]\n\n\n\n\nmpg\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\n\n1.4.2.2 By pattern\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |&gt; select(-matches(\"^d\"))\ndata.frame [32 x 9]\n\n\n\n\nmpg\n\n\ncyl\n\n\nhp\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n110\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n110\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n93\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n110\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n175\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n105\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n245\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n62\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n95\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n123\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n123\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n180\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n180\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n180\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n205\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nmtcars |&gt; select(where(\\(x) all(x != 0))) # Only keep columns where no value == 0\ndata.frame [32 x 9]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\nMT[, .SD, .SDcols = !patterns(\"^d\")]\ndata.table [32 x 9]\n\n\n\n\nmpg\n\n\ncyl\n\n\nhp\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n110\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n110\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n93\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n110\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n175\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n105\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n245\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n62\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n95\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n123\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n123\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n180\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n180\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n180\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n205\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nMT[, .SD, .SDcols = \\(x) all(x != 0)] # Only keep columns where no value == 0\ndata.table [32 x 9]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nAlternativescopy(MT)[, grep(\"^d\", colnames(MT)) := NULL][] # In place (column deletion)\n\nMT[, MT[, sapply(.SD, \\(x) all(x != 0))], with = FALSE]\n\n\n\n\n\n\n1.4.2.3 By column type\n\niris |&gt; select(where(\\(x) !is.numeric(x)))\ndata.frame [150 x 1]\n\n\n\n\nSpecies\n\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\n\n[ omitted 135 entries ]\n\n\n\n\n\n\n\nIRIS[, .SD, .SDcols = !is.numeric]\ndata.table [150 x 1]\n\n\n\n\nSpecies\n\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\nsetosa\n\n\n\n\n\n[ omitted 135 entries ]"
  },
  {
    "objectID": "content/blog/posts/data.table/index.html#mutate-transmute",
    "href": "content/blog/posts/data.table/index.html#mutate-transmute",
    "title": "Data wrangling with data.table and the Tidyverse",
    "section": "\n1.5 Mutate / Transmute",
    "text": "1.5 Mutate / Transmute\ndata.table can mutate in 2 ways:\n- Using = creates a new DT with the new columns only (like dplyr::transmute)\n- Using := (or let) modifies the current dt in place (like dplyr::mutate)\nThe function modifying a column should be the same size as the original column (or group).\nIf only one value is provided with :=, it will be recycled to the whole column/group.\nIf the number of values provided is smaller than the original column/group:\n- With := or let, an error will be raised, asking to manually specify how to recycle the values.\n- With =, it will behave like dplyr::summarize (if a grouping has been specified).\n\n1.5.1 Basic transmute\nOnly keeping the transformed columns.\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |&gt; transmute(cyl = cyl * 2)\ndata.frame [32 x 1]\n\n\n\n\ncyl\n\n\n\n\n\n12\n\n\n\n\n12\n\n\n\n\n8\n\n\n\n\n12\n\n\n\n\n16\n\n\n\n\n12\n\n\n\n\n16\n\n\n\n\n8\n\n\n\n\n8\n\n\n\n\n12\n\n\n\n\n12\n\n\n\n\n16\n\n\n\n\n16\n\n\n\n\n16\n\n\n\n\n16\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\nMT[, .(cyl = cyl * 2)]\ndata.table [32 x 1]\n\n\n\n\ncyl\n\n\n\n\n\n12\n\n\n\n\n12\n\n\n\n\n8\n\n\n\n\n12\n\n\n\n\n16\n\n\n\n\n12\n\n\n\n\n16\n\n\n\n\n8\n\n\n\n\n8\n\n\n\n\n12\n\n\n\n\n12\n\n\n\n\n16\n\n\n\n\n16\n\n\n\n\n16\n\n\n\n\n16\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nTransmute & Extract:\n\nMT[, (cyl = cyl * 2)]\n\n [1] 12 12  8 12 16 12 16  8  8 12 12 16 16 16 16 16 16  8  8  8  8 16 16 16 16\n[26]  8  8  8 16 12 16  8\n\n\n\n\n\n\n1.5.2 Basic mutate\nModifies the transformed column in-place and keeps every other column as-is.\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |&gt; mutate(cyl = 200)\ndata.frame [32 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n200\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n200\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n200\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n200\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n200\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n200\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n200\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n200\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n200\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n200\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n200\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n200\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n200\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n200\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n200\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nmtcars |&gt; mutate(cyl = 200, gear = 5)\ndata.frame [32 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n200\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n21\n\n\n200\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n22.8\n\n\n200\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n5\n\n\n1\n\n\n\n\n21.4\n\n\n200\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n5\n\n\n1\n\n\n\n\n18.7\n\n\n200\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n5\n\n\n2\n\n\n\n\n18.1\n\n\n200\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n5\n\n\n1\n\n\n\n\n14.3\n\n\n200\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n5\n\n\n4\n\n\n\n\n24.4\n\n\n200\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n5\n\n\n2\n\n\n\n\n22.8\n\n\n200\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n5\n\n\n2\n\n\n\n\n19.2\n\n\n200\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n5\n\n\n4\n\n\n\n\n17.8\n\n\n200\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n5\n\n\n4\n\n\n\n\n16.4\n\n\n200\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n5\n\n\n3\n\n\n\n\n17.3\n\n\n200\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n5\n\n\n3\n\n\n\n\n15.2\n\n\n200\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n5\n\n\n3\n\n\n\n\n10.4\n\n\n200\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n5\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\nmtcars |&gt; mutate(mean_cyl = mean(cyl, na.rm = TRUE))\ndata.frame [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmean_cyl\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n6.188\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n6.188\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n6.188\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n6.188\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n6.188\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n6.188\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n6.188\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n6.188\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n6.188\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n6.188\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n6.188\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n6.188\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n6.188\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n6.188\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n6.188\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nmtcars |&gt; mutate(gear_plus = lead(gear))\ndata.frame [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\ngear_plus\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n3\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n3\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n3\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n3\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n3\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n3\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\ncopy(MT)[, cyl := 200][]\ndata.table [32 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n200\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n200\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n200\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n200\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n200\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n200\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n200\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n200\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n200\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n200\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n200\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n200\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n200\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n200\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n200\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\ncopy(MT)[, let(cyl = 200, gear = 5)][]\ndata.table [32 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n200\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n21\n\n\n200\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n22.8\n\n\n200\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n5\n\n\n1\n\n\n\n\n21.4\n\n\n200\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n5\n\n\n1\n\n\n\n\n18.7\n\n\n200\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n5\n\n\n2\n\n\n\n\n18.1\n\n\n200\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n5\n\n\n1\n\n\n\n\n14.3\n\n\n200\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n5\n\n\n4\n\n\n\n\n24.4\n\n\n200\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n5\n\n\n2\n\n\n\n\n22.8\n\n\n200\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n5\n\n\n2\n\n\n\n\n19.2\n\n\n200\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n5\n\n\n4\n\n\n\n\n17.8\n\n\n200\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n5\n\n\n4\n\n\n\n\n16.4\n\n\n200\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n5\n\n\n3\n\n\n\n\n17.3\n\n\n200\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n5\n\n\n3\n\n\n\n\n15.2\n\n\n200\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n5\n\n\n3\n\n\n\n\n10.4\n\n\n200\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n5\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nAlternativescopy(MT)[, `:=`(cyl = 200, gear = 5)][]\n\ncopy(MT)[, c(\"cyl\", \"gear\") := .(200, 5)][]\n\n\n\ncopy(MT)[, mean_cyl := mean(cyl, na.rm = TRUE)][]\ndata.table [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmean_cyl\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n6.188\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n6.188\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n6.188\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n6.188\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n6.188\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n6.188\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n6.188\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n6.188\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n6.188\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n6.188\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n6.188\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n6.188\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n6.188\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n6.188\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n6.188\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\ncopy(MT)[, gearplus := shift(gear, 1, type = \"lead\")][] # lead, lag, cyclic\ndata.table [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\ngearplus\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n3\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n3\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n3\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n3\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n3\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n3\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\n\n1.5.3 Dynamic trans/mutate\n\nLHS &lt;- \"mean_mpg\"\nRHS &lt;- \"mpg\"\n\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |&gt; mutate({{LHS}} := mean(mpg))\ndata.frame [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmean_mpg\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n20.091\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n20.091\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nmtcars |&gt; mutate(\"{LHS}\" := mean(.data[[RHS]]))\ndata.frame [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmean_mpg\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n20.091\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n20.091\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nmtcars |&gt; mutate({{LHS}} := cur_data()[[RHS]] |&gt; mean())\ndata.frame [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmean_mpg\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n20.091\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n20.091\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nmtcars |&gt; mutate({{LHS}} := pick({{ RHS }}) |&gt; unlist() |&gt; mean())\ndata.frame [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmean_mpg\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n20.091\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n20.091\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\ncopy(MT)[, (LHS) := mean(mpg)][] # (LHS) &lt;=&gt; c(LHS)\ndata.table [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmean_mpg\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n20.091\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n20.091\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\ncopy(MT)[, j := mean(mpg), env = list(j = LHS)][]\ndata.table [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmean_mpg\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n20.091\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n20.091\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\ncopy(MT)[, c(LHS) := mean(get(RHS))][]\ndata.table [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmean_mpg\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n20.091\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n20.091\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\ncopy(MT)[, x := mean(y), env = list(x = LHS, y = RHS)][]\ndata.table [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmean_mpg\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n20.091\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n20.091\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n20.091\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n20.091\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n20.091\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n20.091\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n20.091\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\n\n1.5.4 Conditional trans/mutate\n\n\nTidyverse\ndata.table\n\n\n\nMutate everything based on multiple conditions:\nOne condition:\n\nmtcars |&gt; mutate(Size = if_else(cyl &gt;= 6, \"BIG\", \"small\", missing = \"Unk\"))\ndata.frame [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nSize\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\nsmall\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\nBIG\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\nBIG\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\nBIG\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\nBIG\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\nsmall\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\nsmall\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nBIG\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nBIG\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nBIG\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\nBIG\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\nNested conditions:\n\nmtcars |&gt; mutate(Size = case_when(\n  cyl %between% c(2,4) ~ \"small\",\n  cyl %between% c(4,8) ~ \"BIG\",\n  .default = \"Unk\"\n))\ndata.frame [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nSize\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\nsmall\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\nBIG\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\nBIG\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\nBIG\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\nBIG\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\nsmall\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\nsmall\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nBIG\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nBIG\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nBIG\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\nBIG\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nMutate only rows meeting conditions:\n\nmtcars |&gt; mutate(BIG = case_when(am == 1 ~ cyl &gt;= 6))\ndata.frame [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nBIG\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\nTRUE\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\nTRUE\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\nFALSE\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\nNA\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\nNA\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\nNA\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\nNA\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\nNA\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\nNA\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\nNA\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\nNA\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nNA\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nNA\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nNA\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\nNA\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\nMutate everything based on multiple conditions:\nOne condition:\n\ncopy(MT)[, Size := fifelse(cyl &gt;= 6, \"BIG\", \"small\", na = \"Unk\")][]\ndata.table [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nSize\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\nsmall\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\nBIG\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\nBIG\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\nBIG\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\nBIG\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\nsmall\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\nsmall\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nBIG\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nBIG\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nBIG\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\nBIG\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\nNested conditions:\n\ncopy(MT)[, Size := fcase(\n  cyl %between% c(2,4), \"small\", \n  cyl %between% c(4,8), \"BIG\",\n  default = \"Unk\"\n)][]\ndata.table [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nSize\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\nsmall\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\nBIG\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\nBIG\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\nBIG\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\nBIG\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\nsmall\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\nsmall\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\nBIG\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nBIG\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nBIG\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nBIG\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\nBIG\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nMutate only rows meeting conditions:\n\ncopy(MT)[am == 1, BIG := cyl &gt;= 6][]\ndata.table [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nBIG\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\nTRUE\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\nTRUE\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\nFALSE\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\nNA\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\nNA\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\nNA\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\nNA\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\nNA\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\nNA\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\nNA\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\nNA\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nNA\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nNA\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\nNA\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\nNA\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\n\n1.5.5 Complex trans/mutate\n\n1.5.5.1 Column-wise operations\n\nnew &lt;- c(\"min_mpg\", \"min_disp\")\nold &lt;- c(\"mpg\", \"disp\")\n\nApply one function to multiple columns:\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |&gt; mutate(across(c(\"mpg\", \"disp\"), min, .names = \"min_{col}\"))\ndata.frame [32 x 13]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmin_mpg\n\n\nmin_disp\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\nAs a transmute:\n\nmtcars |&gt; transmute(across(c(\"mpg\", \"disp\"), min, .names = \"min_{col}\"))\ndata.frame [32 x 2]\n\n\n\n\nmin_mpg\n\n\nmin_disp\n\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\nDynamically:\n\nmtcars |&gt; mutate(across(all_of(old), min, .names = \"min_{col}\"))\ndata.frame [32 x 13]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmin_mpg\n\n\nmin_disp\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\ncopy(MT)[\n    , c(\"min_mpg\", \"min_disp\") := lapply(.SD, min), .SDcols = c(\"mpg\", \"disp\")\n  ][]\ndata.table [32 x 13]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmin_mpg\n\n\nmin_disp\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\ncopy(MT)[, c(\"min_mpg\", \"min_disp\") := lapply(.(mpg, disp), min)][]\n\n\nAs a transmute:\nA second step is needed to add min_ before the names:\n\n(MT[, lapply(.SD[, .(mpg, disp)], min)] |&gt; bind(d, setnames(d, names(d), \\(x) paste0(\"min_\", x))))[]\ndata.table [1 x 2]\n\n\n\n\nmin_mpg\n\n\nmin_disp\n\n\n\n\n10.4\n\n\n71.1\n\n\n\n\n\n\n\nDynamically:\n\ncopy(MT)[, c(new) := lapply(mget(old), min)][]\ndata.table [32 x 13]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmin_mpg\n\n\nmin_disp\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\ncopy(MT)[, c(new) := lapply(x, min), env = list(x = as.list(old))][]\n\n\n\n\nApply multiple functions to one or multiple column:\n\ncol &lt;- \"mpg\"\ncols &lt;- c(\"mpg\", \"disp\")\n\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |&gt; mutate(min_mpg = min(mpg), max_mpg = max(mpg))\ndata.frame [32 x 13]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmin_mpg\n\n\nmax_mpg\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nmtcars |&gt; mutate(across(mpg, list(min = min, max = max), .names = \"{fn}_{col}\"))\ndata.frame [32 x 13]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmin_mpg\n\n\nmax_mpg\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\nMultiple columns:\n\nmtcars |&gt; mutate(across(matches(\"mpg|disp\"), list(min = min, max = max), .names = \"{fn}_{col}\"))\ndata.frame [32 x 15]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmin_mpg\n\n\nmax_mpg\n\n\nmin_disp\n\n\nmax_disp\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nmtcars |&gt; mutate(across(cols, list(min = \\(x) min(x), max = \\(x) max(x)), .names = \"{fn}_{col}\"))\ndata.frame [32 x 15]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmin_mpg\n\n\nmax_mpg\n\n\nmin_disp\n\n\nmax_disp\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n71.1\n\n\n472\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\ncopy(MT)[, let(min_mpg = min(mpg), max_mpg = max(mpg))][]\ndata.table [32 x 13]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmin_mpg\n\n\nmax_mpg\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\ncopy(MT)[, c(\"min_mpg\", \"max_mpg\") := .(min(mpg), max(mpg))][]\ndata.table [32 x 13]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmin_mpg\n\n\nmax_mpg\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n33.9\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n33.9\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n33.9\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n33.9\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nAlternativescopy(MT)[, c(\"min_mpg\", \"max_mpg\") := \n           lapply(.(mpg), \\(x) list(min(x), max(x))) |&gt; do.call(rbind, args = _)\n        ][]\n\ncopy(MT)[, c(\"min_mpg\", \"max_mpg\") := \n           lapply(.(get(col)), \\(x) list(min(x), max(x))) |&gt; unlist(recursive = FALSE)\n        ][]\n\n\n\nMultiple columns:\n\ncopy(MT)[, c(\"min_mpg\", \"min_disp\", \"max_mpg\", \"max_disp\") := \n           lapply(.SD, \\(x) list(min(x), max(x))) |&gt; do.call(rbind, args = _), \n         .SDcols = cols][]\ndata.table [32 x 15]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmin_mpg\n\n\nmin_disp\n\n\nmax_mpg\n\n\nmax_disp\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\ncopy(MT)[, outer(c(\"min\", \"max\"), cols, str_c, sep = \"_\") |&gt; t() |&gt; as.vector() := \n           lapply(.SD, \\(x) list(min(x), max(x))) |&gt; do.call(rbind, args = _), \n         .SDcols = cols][]\ndata.table [32 x 15]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmin_mpg\n\n\nmin_disp\n\n\nmax_mpg\n\n\nmax_disp\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n10.4\n\n\n71.1\n\n\n33.9\n\n\n472\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\n\n1.5.5.2 Row-wise operations\nApply one function to multiple columns (row-wise):\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |&gt; rowwise() |&gt; mutate(rsum = sum(c_across(where(is.numeric)))) |&gt; ungroup()\ndata.frame [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nrsum\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n328.98\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n329.795\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n259.58\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n426.135\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n590.31\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n385.54\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n656.92\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n270.98\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n299.57\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n350.46\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n349.66\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n510.74\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n511.5\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n509.85\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n728.56\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nmtcars |&gt; mutate(rsum = pmap_dbl(across(where(is.numeric)), \\(...) sum(c(...))))\ndata.frame [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nrsum\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n328.98\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n329.795\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n259.58\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n426.135\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n590.31\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n385.54\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n656.92\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n270.98\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n299.57\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n350.46\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n349.66\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n510.74\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n511.5\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n509.85\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n728.56\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\nHybrid base R-Tidyverse:\n\nmtcars |&gt; mutate(rsum = apply(across(where(is.numeric)), 1, sum))\ndata.frame [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nrsum\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n328.98\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n329.795\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n259.58\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n426.135\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n590.31\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n385.54\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n656.92\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n270.98\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n299.57\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n350.46\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n349.66\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n510.74\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n511.5\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n509.85\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n728.56\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nmtcars |&gt; mutate(rsum = rowSums(across(where(is.numeric))))\ndata.frame [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nrsum\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n328.98\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n329.795\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n259.58\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n426.135\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n590.31\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n385.54\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n656.92\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n270.98\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n299.57\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n350.46\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n349.66\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n510.74\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n511.5\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n509.85\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n728.56\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\ncopy(MT)[, rsum := rowSums(.SD), .SDcols = is.numeric][]\ndata.table [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nrsum\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n328.98\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n329.795\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n259.58\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n426.135\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n590.31\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n385.54\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n656.92\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n270.98\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n299.57\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n350.46\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n349.66\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n510.74\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n511.5\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n509.85\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n728.56\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\ncopy(MT)[, rsum := apply(.SD, 1, sum), .SDcols = is.numeric][]\ndata.table [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nrsum\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n328.98\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n329.795\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n259.58\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n426.135\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n590.31\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n385.54\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n656.92\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n270.98\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n299.57\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n350.46\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n349.66\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n510.74\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n511.5\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n509.85\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n728.56\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\nApply multiple functions to multiple columns (row-wise)\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |&gt; \n  mutate(pmap_dfr(across(where(is.numeric)), \\(...) list(mean = mean(c(...)), sum = sum(c(...)))))\ndata.frame [32 x 13]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmean\n\n\nsum\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n29.907\n\n\n328.98\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n29.981\n\n\n329.795\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n23.598\n\n\n259.58\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n38.74\n\n\n426.135\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n53.665\n\n\n590.31\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n35.049\n\n\n385.54\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n59.72\n\n\n656.92\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n24.635\n\n\n270.98\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n27.234\n\n\n299.57\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n31.86\n\n\n350.46\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n31.787\n\n\n349.66\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n46.431\n\n\n510.74\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n46.5\n\n\n511.5\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n46.35\n\n\n509.85\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n66.233\n\n\n728.56\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nAlternativesmtcars |&gt; \n  mutate(\n    pmap(across(where(is.numeric)), \\(...) list(mean = mean(c(...)), sum = sum(c(...)))) |&gt; \n      bind_rows()\n  )\n\n\nHybrid base R-Tidyverse:\n\nmtcars |&gt; \n  mutate(apply(across(where(is.numeric)), 1, \\(x) list(mean = mean(x), sum = sum(x))) |&gt; bind_rows())\ndata.frame [32 x 13]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nmean\n\n\nsum\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n29.907\n\n\n328.98\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n29.981\n\n\n329.795\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n23.598\n\n\n259.58\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n38.74\n\n\n426.135\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n53.665\n\n\n590.31\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n35.049\n\n\n385.54\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n59.72\n\n\n656.92\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n24.635\n\n\n270.98\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n27.234\n\n\n299.57\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n31.86\n\n\n350.46\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n31.787\n\n\n349.66\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n46.431\n\n\n510.74\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n46.5\n\n\n511.5\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n46.35\n\n\n509.85\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n66.233\n\n\n728.56\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\ncopy(MT)[, c(\"rmean\", \"rsum\") := \n           apply(.SD, 1, \\(x) list(mean(x), sum(x))) |&gt; rbindlist(), \n         .SDcols = is.numeric][]\ndata.table [32 x 13]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nrmean\n\n\nrsum\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n29.907\n\n\n328.98\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n29.981\n\n\n329.795\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n23.598\n\n\n259.58\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n38.74\n\n\n426.135\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n53.665\n\n\n590.31\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n35.049\n\n\n385.54\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n59.72\n\n\n656.92\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n24.635\n\n\n270.98\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n27.234\n\n\n299.57\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n31.86\n\n\n350.46\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n31.787\n\n\n349.66\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n46.431\n\n\n510.74\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n46.5\n\n\n511.5\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n46.35\n\n\n509.85\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n66.233\n\n\n728.56\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\nApply an anonymous function inside the DT:\n\nMT[, {\n    print(summary(mpg))\n    x &lt;- cyl + gear\n    .(RN = 1:.N, CG = x)\n  }\n]\nMin. 1st Qu. Median Mean 3rd Qu. Max. 10.40 15.43 19.20 20.09 22.80 33.90\ndata.table [32 x 2]\n\n\n\n\nRN\n\n\nCG\n\n\n\n\n\n1\n\n\n10\n\n\n\n\n2\n\n\n10\n\n\n\n\n3\n\n\n8\n\n\n\n\n4\n\n\n9\n\n\n\n\n5\n\n\n11\n\n\n\n\n6\n\n\n9\n\n\n\n\n7\n\n\n11\n\n\n\n\n8\n\n\n8\n\n\n\n\n9\n\n\n8\n\n\n\n\n10\n\n\n10\n\n\n\n\n11\n\n\n10\n\n\n\n\n12\n\n\n11\n\n\n\n\n13\n\n\n11\n\n\n\n\n14\n\n\n11\n\n\n\n\n15\n\n\n11\n\n\n\n\n\n[ omitted 17 entries ]"
  },
  {
    "objectID": "content/blog/posts/data.table/index.html#group-aggregate",
    "href": "content/blog/posts/data.table/index.html#group-aggregate",
    "title": "Data wrangling with data.table and the Tidyverse",
    "section": "\n1.6 Group / Aggregate",
    "text": "1.6 Group / Aggregate\n\n\n\n\n\n\nNote\n\n\n\nThe examples listed apply a grouping but do nothing (using .SD to simply keep all columns as is)\n\n\n\ncols &lt;- c(\"cyl\", \"disp\")\ncols_missing &lt;- c(\"cyl\", \"disp\", \"missing_col\")\n\n\n1.6.1 Basic grouping\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |&gt; group_by(cyl, gear)\ndata.frame [32 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nDynamic grouping:\n\nmtcars |&gt; group_by(across(all_of(cols)))\ndata.frame [32 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\nUse any_of if you expect some columns to be missing in the data.\n\nmtcars |&gt; group_by(across(any_of(cols_missing)))\ndata.frame [32 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\nMT[, .SD, by = .(cyl, gear)]\ndata.table [32 x 11]\n\n\n\n\ncyl\n\n\ngear\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ncarb\n\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n\n\n6\n\n\n4\n\n\n19.2\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n\n\n6\n\n\n4\n\n\n17.8\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n32.4\n\n\n78.7\n\n\n66\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n30.4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n33.9\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n27.3\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n21.4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n2\n\n\n\n\n6\n\n\n3\n\n\n21.4\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n6\n\n\n3\n\n\n18.1\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n8\n\n\n3\n\n\n18.7\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n2\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nDynamic grouping:\n\nMT[, .SD, by = cols]\ndata.table [32 x 11]\n\n\n\n\ncyl\n\n\ndisp\n\n\nmpg\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n6\n\n\n160\n\n\n21\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n6\n\n\n160\n\n\n21\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n4\n\n\n108\n\n\n22.8\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n6\n\n\n258\n\n\n21.4\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n8\n\n\n360\n\n\n18.7\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n8\n\n\n360\n\n\n14.3\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n6\n\n\n225\n\n\n18.1\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n4\n\n\n146.7\n\n\n24.4\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n140.8\n\n\n22.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n6\n\n\n167.6\n\n\n19.2\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n6\n\n\n167.6\n\n\n17.8\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n8\n\n\n275.8\n\n\n16.4\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n8\n\n\n275.8\n\n\n17.3\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n8\n\n\n275.8\n\n\n15.2\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n8\n\n\n472\n\n\n10.4\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\nTo handle potentially missing columns:\n\nMT[, .SD, by = intersect(cols_missing, colnames(MT))]\ndata.table [32 x 11]\n\n\n\n\ncyl\n\n\ndisp\n\n\nmpg\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n6\n\n\n160\n\n\n21\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n6\n\n\n160\n\n\n21\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n4\n\n\n108\n\n\n22.8\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n6\n\n\n258\n\n\n21.4\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n8\n\n\n360\n\n\n18.7\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n8\n\n\n360\n\n\n14.3\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n6\n\n\n225\n\n\n18.1\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n4\n\n\n146.7\n\n\n24.4\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n140.8\n\n\n22.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n6\n\n\n167.6\n\n\n19.2\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n6\n\n\n167.6\n\n\n17.8\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n8\n\n\n275.8\n\n\n16.4\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n8\n\n\n275.8\n\n\n17.3\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n8\n\n\n275.8\n\n\n15.2\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n8\n\n\n472\n\n\n10.4\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\n\n1.6.2 Current group info\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |&gt; \n  group_by(cyl) |&gt; \n  filter(cur_group_id() == 1) |&gt; # To only keep one plot\n  group_walk(\\(d, g) with(d, plot(hp, mpg, main = paste(\"Cyl:\", g$cyl))))\n\n\n\n\n\n\n\nUse the .BY argument to get the current group name:\n\nMT[, with(.SD, plot(hp, mpg, main = paste(\"Cyl:\", .BY))), keyby = cyl]"
  },
  {
    "objectID": "content/blog/posts/data.table/index.html#row-numbers-indices",
    "href": "content/blog/posts/data.table/index.html#row-numbers-indices",
    "title": "Data wrangling with data.table and the Tidyverse",
    "section": "\n1.7 Row numbers & indices",
    "text": "1.7 Row numbers & indices\n\n1.7.1 Adding row or group indices\n.I: Row indices.N: Number of rows\n.GRP: Group indices.NGRP: Number of groups\n\n1.7.1.1 Adding rows indices:\n\nmtcars |&gt; mutate(I = row_number())\ndata.frame [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nI\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n1\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n3\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n4\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n5\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n6\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n7\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n8\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n9\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n11\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n12\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n13\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n14\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n15\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\ncopy(MT)[ , I := .I][]\ndata.table [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nI\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n1\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n3\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n4\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n5\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n6\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n7\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n8\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n9\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n10\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n11\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n12\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n13\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n14\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n15\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n1.7.1.2 Adding group indices:\n\n\nTidyverse\ndata.table\n\n\n\nAdding group indices (same index for each group):\n\nmtcars |&gt; summarize(GRP = cur_group_id(), .by = cyl)\ndata.frame [3 x 2]\n\n\n\n\ncyl\n\n\nGRP\n\n\n\n\n\n6\n\n\n1\n\n\n\n\n4\n\n\n2\n\n\n\n\n8\n\n\n3\n\n\n\n\n\n\n\nMutate instead of summarize:\n\nmtcars |&gt; mutate(GRP = cur_group_id(), .by = cyl)\ndata.frame [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nGRP\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n1\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n1\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n2\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n3\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n3\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n1\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n1\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n3\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nAdding row numbers within each group:\n\nmtcars |&gt; mutate(I_GRP = row_number(), .by = gear)\ndata.frame [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nI_GRP\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n1\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n3\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n3\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n5\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n6\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n7\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n5\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n6\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n7\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n8\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\nAdding group indices (same index for each group):\n\nMT[, .GRP, by = cyl]\ndata.table [3 x 2]\n\n\n\n\ncyl\n\n\nGRP\n\n\n\n\n\n6\n\n\n1\n\n\n\n\n4\n\n\n2\n\n\n\n\n8\n\n\n3\n\n\n\n\n\n\n\nMutate instead of summarize:\n\ncopy(MT)[, GRP := .GRP, by = cyl][]\ndata.table [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nGRP\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n1\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n1\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n2\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n3\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n3\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n1\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n1\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n3\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nAdding row numbers within each group:\n\ncopy(MT)[, I_GRP := 1:.N, by = gear][]\ndata.table [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nI_GRP\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n1\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n3\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n3\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n5\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n6\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n7\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n5\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n6\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n7\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n8\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\ncopy(MT)[, I_GRP := rowid(gear)][]\ndata.table [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nI_GRP\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n1\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n3\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n3\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n5\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n6\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n7\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n5\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n6\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n7\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n8\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\n\n1.7.2 Filtering based on row numbers (slicing)\n\n1.7.2.1 Extracting a specific row\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |&gt; dplyr::first()\ndata.frame [1 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\nmtcars |&gt; dplyr::last()\ndata.frame [1 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\nmtcars |&gt; dplyr::nth(5)\ndata.frame [1 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n\n\n\n\n\nMT[1,] # data.table::first(MT)\ndata.table [1 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\nMT[.N,] # data.table::last(MT)\ndata.table [1 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\nMT[5,]\ndata.table [1 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n\n\n\n\n\n\n1.7.2.2 Slicing rows\n\n\nTidyverse\ndata.table\n\n\n\n\ntail(mtcars, 10)\ndata.frame [10 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n15.2\n\n\n8\n\n\n304\n\n\n150\n\n\n3.15\n\n\n3.435\n\n\n17.3\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n27.3\n\n\n4\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n15.8\n\n\n8\n\n\n351\n\n\n264\n\n\n4.22\n\n\n3.17\n\n\n14.5\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n19.7\n\n\n6\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n\n\n15\n\n\n8\n\n\n301\n\n\n335\n\n\n3.54\n\n\n3.57\n\n\n14.6\n\n\n0\n\n\n1\n\n\n5\n\n\n8\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n\nmtcars |&gt; slice((n()-9):n())\ndata.frame [10 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n15.2\n\n\n8\n\n\n304\n\n\n150\n\n\n3.15\n\n\n3.435\n\n\n17.3\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n27.3\n\n\n4\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n15.8\n\n\n8\n\n\n351\n\n\n264\n\n\n4.22\n\n\n3.17\n\n\n14.5\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n19.7\n\n\n6\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n\n\n15\n\n\n8\n\n\n301\n\n\n335\n\n\n3.54\n\n\n3.57\n\n\n14.6\n\n\n0\n\n\n1\n\n\n5\n\n\n8\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n\nmtcars |&gt; slice_tail(n = 10)\ndata.frame [10 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n15.2\n\n\n8\n\n\n304\n\n\n150\n\n\n3.15\n\n\n3.435\n\n\n17.3\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n27.3\n\n\n4\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n15.8\n\n\n8\n\n\n351\n\n\n264\n\n\n4.22\n\n\n3.17\n\n\n14.5\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n19.7\n\n\n6\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n\n\n15\n\n\n8\n\n\n301\n\n\n335\n\n\n3.54\n\n\n3.57\n\n\n14.6\n\n\n0\n\n\n1\n\n\n5\n\n\n8\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n\n\n\n\n\n\ntail(MT, 10)\ndata.table [10 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n15.2\n\n\n8\n\n\n304\n\n\n150\n\n\n3.15\n\n\n3.435\n\n\n17.3\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n27.3\n\n\n4\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n15.8\n\n\n8\n\n\n351\n\n\n264\n\n\n4.22\n\n\n3.17\n\n\n14.5\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n19.7\n\n\n6\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n\n\n15\n\n\n8\n\n\n301\n\n\n335\n\n\n3.54\n\n\n3.57\n\n\n14.6\n\n\n0\n\n\n1\n\n\n5\n\n\n8\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n\nMT[(.N-9):.N]\ndata.table [10 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n15.2\n\n\n8\n\n\n304\n\n\n150\n\n\n3.15\n\n\n3.435\n\n\n17.3\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n27.3\n\n\n4\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n15.8\n\n\n8\n\n\n351\n\n\n264\n\n\n4.22\n\n\n3.17\n\n\n14.5\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n19.7\n\n\n6\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n\n\n15\n\n\n8\n\n\n301\n\n\n335\n\n\n3.54\n\n\n3.57\n\n\n14.6\n\n\n0\n\n\n1\n\n\n5\n\n\n8\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n\nMT[MT[, .I[(.N-9):.N]]] # Gets the last 10 rows' indices and filters based on them\ndata.table [10 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n15.2\n\n\n8\n\n\n304\n\n\n150\n\n\n3.15\n\n\n3.435\n\n\n17.3\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n19.2\n\n\n8\n\n\n400\n\n\n175\n\n\n3.08\n\n\n3.845\n\n\n17.05\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n27.3\n\n\n4\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n30.4\n\n\n4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n15.8\n\n\n8\n\n\n351\n\n\n264\n\n\n4.22\n\n\n3.17\n\n\n14.5\n\n\n0\n\n\n1\n\n\n5\n\n\n4\n\n\n\n\n19.7\n\n\n6\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n\n\n15\n\n\n8\n\n\n301\n\n\n335\n\n\n3.54\n\n\n3.57\n\n\n14.6\n\n\n0\n\n\n1\n\n\n5\n\n\n8\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n\n\n\n\n\n\n\n1.7.2.3 Slicing groups\n\n\nTidyverse\ndata.table\n\n\n\nRandom sample by group:\n\nmtcars |&gt; slice_sample(n = 5, by = cyl)\ndata.frame [15 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n19.7\n\n\n6\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21.5\n\n\n4\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n26\n\n\n4\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n30.4\n\n\n4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n13.3\n\n\n8\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n15.2\n\n\n8\n\n\n304\n\n\n150\n\n\n3.15\n\n\n3.435\n\n\n17.3\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n10.4\n\n\n8\n\n\n460\n\n\n215\n\n\n3\n\n\n5.424\n\n\n17.82\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n\n\n\n\nFilter groups by condition:\n\nmtcars |&gt; filter(n() &gt;= 8, .by = cyl)\ndata.frame [25 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n10.4\n\n\n8\n\n\n460\n\n\n215\n\n\n3\n\n\n5.424\n\n\n17.82\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.7\n\n\n8\n\n\n440\n\n\n230\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n32.4\n\n\n4\n\n\n78.7\n\n\n66\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n30.4\n\n\n4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n33.9\n\n\n4\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.5\n\n\n4\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n\n[ omitted 10 entries ]\n\n\n\n\nmtcars |&gt; group_by(cyl) |&gt; group_modify(\\(d,g) if (nrow(d) &gt;= 8) d else data.frame())\ndata.frame [25 x 11]\n\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n4\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n32.4\n\n\n78.7\n\n\n66\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n30.4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n33.9\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n21.5\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n4\n\n\n27.3\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n26\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n4\n\n\n30.4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n4\n\n\n21.4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n8\n\n\n18.7\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n8\n\n\n14.3\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n8\n\n\n16.4\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n8\n\n\n17.3\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n\n[ omitted 10 entries ]\n\n\n\n\n\n\n\n\nRandom sample by group:\n\nMT[, .SD[sample(.N, 5)], keyby = cyl]\ndata.table [15 x 11]\n\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n4\n\n\n27.3\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n26\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n4\n\n\n21.4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n6\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n6\n\n\n19.7\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n\n\n6\n\n\n19.2\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n6\n\n\n18.1\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n6\n\n\n17.8\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n8\n\n\n14.7\n\n\n440\n\n\n230\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n8\n\n\n13.3\n\n\n350\n\n\n245\n\n\n3.73\n\n\n3.84\n\n\n15.41\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n8\n\n\n16.4\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n8\n\n\n15.2\n\n\n304\n\n\n150\n\n\n3.15\n\n\n3.435\n\n\n17.3\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n8\n\n\n17.3\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n\n\n\n\nFilter groups by condition:\n\nMT[, if(.N &gt;= 8) .SD, by = cyl]\ndata.table [25 x 11]\n\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n4\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n32.4\n\n\n78.7\n\n\n66\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n30.4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n33.9\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n21.5\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n4\n\n\n27.3\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n26\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n4\n\n\n30.4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n4\n\n\n21.4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n8\n\n\n18.7\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n8\n\n\n14.3\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n8\n\n\n16.4\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n8\n\n\n17.3\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n\n[ omitted 10 entries ]\n\n\n\n\nMT[, .SD[.N &gt;= 8], by = cyl]\ndata.table [25 x 11]\n\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n4\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n32.4\n\n\n78.7\n\n\n66\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n30.4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n33.9\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n21.5\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n4\n\n\n27.3\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n26\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n4\n\n\n30.4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n4\n\n\n21.4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n8\n\n\n18.7\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n8\n\n\n14.3\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n8\n\n\n16.4\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n8\n\n\n17.3\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n\n[ omitted 10 entries ]\n\n\n\n\n\n\n\n\n\n\n1.7.3 Extracting row indices\n\n1.7.3.1 Getting the row numbers of specific observations:\n\n\nTidyverse\ndata.table\n\n\n\nRow number of the first and last observation of each group:\n\nmtcars |&gt; reframe(I = cur_group_rows()[c(1, n())], .by = cyl)\ndata.frame [6 x 2]\n\n\n\n\ncyl\n\n\nI\n\n\n\n\n\n6\n\n\n1\n\n\n\n\n6\n\n\n30\n\n\n\n\n4\n\n\n3\n\n\n\n\n4\n\n\n32\n\n\n\n\n8\n\n\n5\n\n\n\n\n8\n\n\n31\n\n\n\n\n\n\n\n… while keeping all other columns:\n\nmtcars |&gt; mutate(I = row_number()) |&gt; slice(c(1, n()), .by = cyl)\ndata.frame [6 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nI\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n1\n\n\n\n\n19.7\n\n\n6\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n30\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n3\n\n\n\n\n21.4\n\n\n4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n32\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n5\n\n\n\n\n15\n\n\n8\n\n\n301\n\n\n335\n\n\n3.54\n\n\n3.57\n\n\n14.6\n\n\n0\n\n\n1\n\n\n5\n\n\n8\n\n\n31\n\n\n\n\n\n\n\n\n\nRow number of the first and last observation of each group:\n\nMT[, .I[c(1, .N)], by = cyl]\ndata.table [6 x 2]\n\n\n\n\ncyl\n\n\nV1\n\n\n\n\n\n6\n\n\n1\n\n\n\n\n6\n\n\n30\n\n\n\n\n4\n\n\n3\n\n\n\n\n4\n\n\n32\n\n\n\n\n8\n\n\n5\n\n\n\n\n8\n\n\n31\n\n\n\n\n\n\n\n… while keeping all other columns:\n\ncopy(MT)[, I := .I][, .SD[c(1, .N)], by = cyl]\ndata.table [6 x 12]\n\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nI\n\n\n\n\n\n6\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n1\n\n\n\n\n6\n\n\n19.7\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n30\n\n\n\n\n4\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n3\n\n\n\n\n4\n\n\n21.4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n32\n\n\n\n\n8\n\n\n18.7\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n5\n\n\n\n\n8\n\n\n15\n\n\n301\n\n\n335\n\n\n3.54\n\n\n3.57\n\n\n14.6\n\n\n0\n\n\n1\n\n\n5\n\n\n8\n\n\n31\n\n\n\n\n\n\n\n\n\n\n\n1.7.3.2 Extracting row indices after filtering\n\n\nTidyverse\ndata.table\n\n\n\n\nExtracting row numbers in the original dataset:\n\nmtcars |&gt; mutate(I = row_number()) |&gt; filter(gear == 4) |&gt; pull(I)\n[1] 1 2 3 8 9 10 11 18 19 20 26 32\n\nExtracting row numbers in the new dataset (after filtering):\n\nmtcars |&gt; filter(gear == 4) |&gt; mutate(I = row_number()) |&gt; pull(I)\n[1] 1 2 3 4 5 6 7 8 9 10 11 12\n\n\n\n\n\n\n\n\n\nWarning\n\n\n\n.I gives the vector of row numbers after any subsetting/filtering has been done\n\n\nExtracting row numbers in the original dataset:\n\nMT[, .I[gear == 4]]\n[1] 1 2 3 8 9 10 11 18 19 20 26 32\n\nExtracting row numbers in the new dataset (after filtering):\n\nMT[gear == 4, .I]\n[1] 1 2 3 4 5 6 7 8 9 10 11 12"
  },
  {
    "objectID": "content/blog/posts/data.table/index.html#relocate",
    "href": "content/blog/posts/data.table/index.html#relocate",
    "title": "Data wrangling with data.table and the Tidyverse",
    "section": "\n1.8 Relocate",
    "text": "1.8 Relocate\n\n1.8.1 Basic reordering\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |&gt; relocate(cyl, .after = last_col())\ndata.frame [32 x 11]\n\n\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\ncyl\n\n\n\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n6\n\n\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n6\n\n\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n4\n\n\n\n\n21.4\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n6\n\n\n\n\n18.7\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n8\n\n\n\n\n18.1\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n6\n\n\n\n\n14.3\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n8\n\n\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4\n\n\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4\n\n\n\n\n19.2\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n6\n\n\n\n\n17.8\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n6\n\n\n\n\n16.4\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n8\n\n\n\n\n17.3\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n8\n\n\n\n\n15.2\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n8\n\n\n\n\n10.4\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n8\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nRelocate a new column (mutate + relocate):\n\nmtcars |&gt; mutate(GRP = cur_group_id(), .by = cyl, .before = 1)\ndata.frame [32 x 12]\n\n\n\n\nGRP\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n1\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n1\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n2\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n1\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n3\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n1\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n3\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n2\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n2\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n1\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n1\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n3\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n3\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n3\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n3\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\nsetcolorder(copy(MT), \"cyl\", after = last(colnames(MT)))[]\ndata.table [32 x 11]\n\n\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\ncyl\n\n\n\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n6\n\n\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n6\n\n\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n4\n\n\n\n\n21.4\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n6\n\n\n\n\n18.7\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n8\n\n\n\n\n18.1\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n6\n\n\n\n\n14.3\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n8\n\n\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4\n\n\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4\n\n\n\n\n19.2\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n6\n\n\n\n\n17.8\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n6\n\n\n\n\n16.4\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n8\n\n\n\n\n17.3\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n8\n\n\n\n\n15.2\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n8\n\n\n\n\n10.4\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n8\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\nsetcolorder(copy(MT), c(setdiff(colnames(MT), \"cyl\"), \"cyl\"))[]\ndata.table [32 x 11]\n\n\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\ncyl\n\n\n\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n6\n\n\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n6\n\n\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n4\n\n\n\n\n21.4\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n6\n\n\n\n\n18.7\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n8\n\n\n\n\n18.1\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n6\n\n\n\n\n14.3\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n8\n\n\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4\n\n\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4\n\n\n\n\n19.2\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n6\n\n\n\n\n17.8\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n6\n\n\n\n\n16.4\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n8\n\n\n\n\n17.3\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n8\n\n\n\n\n15.2\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n8\n\n\n\n\n10.4\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n8\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\nRelocate a new column (mutate + relocate):\n\nsetcolorder(copy(MT)[ , GRP := .GRP, by = cyl], \"GRP\")[]\ndata.table [32 x 12]\n\n\n\n\nGRP\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n1\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n1\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n2\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n1\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n3\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n1\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n3\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n2\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n2\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n1\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n1\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n3\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n3\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n3\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n3\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\n\n1.8.2 Reordering by column names\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |&gt; select(sort(tidyselect::peek_vars()))\ndata.frame [32 x 11]\n\n\n\n\nam\n\n\ncarb\n\n\ncyl\n\n\ndisp\n\n\ndrat\n\n\ngear\n\n\nhp\n\n\nmpg\n\n\nqsec\n\n\nvs\n\n\nwt\n\n\n\n\n\n1\n\n\n4\n\n\n6\n\n\n160\n\n\n3.9\n\n\n4\n\n\n110\n\n\n21\n\n\n16.46\n\n\n0\n\n\n2.62\n\n\n\n\n1\n\n\n4\n\n\n6\n\n\n160\n\n\n3.9\n\n\n4\n\n\n110\n\n\n21\n\n\n17.02\n\n\n0\n\n\n2.875\n\n\n\n\n1\n\n\n1\n\n\n4\n\n\n108\n\n\n3.85\n\n\n4\n\n\n93\n\n\n22.8\n\n\n18.61\n\n\n1\n\n\n2.32\n\n\n\n\n0\n\n\n1\n\n\n6\n\n\n258\n\n\n3.08\n\n\n3\n\n\n110\n\n\n21.4\n\n\n19.44\n\n\n1\n\n\n3.215\n\n\n\n\n0\n\n\n2\n\n\n8\n\n\n360\n\n\n3.15\n\n\n3\n\n\n175\n\n\n18.7\n\n\n17.02\n\n\n0\n\n\n3.44\n\n\n\n\n0\n\n\n1\n\n\n6\n\n\n225\n\n\n2.76\n\n\n3\n\n\n105\n\n\n18.1\n\n\n20.22\n\n\n1\n\n\n3.46\n\n\n\n\n0\n\n\n4\n\n\n8\n\n\n360\n\n\n3.21\n\n\n3\n\n\n245\n\n\n14.3\n\n\n15.84\n\n\n0\n\n\n3.57\n\n\n\n\n0\n\n\n2\n\n\n4\n\n\n146.7\n\n\n3.69\n\n\n4\n\n\n62\n\n\n24.4\n\n\n20\n\n\n1\n\n\n3.19\n\n\n\n\n0\n\n\n2\n\n\n4\n\n\n140.8\n\n\n3.92\n\n\n4\n\n\n95\n\n\n22.8\n\n\n22.9\n\n\n1\n\n\n3.15\n\n\n\n\n0\n\n\n4\n\n\n6\n\n\n167.6\n\n\n3.92\n\n\n4\n\n\n123\n\n\n19.2\n\n\n18.3\n\n\n1\n\n\n3.44\n\n\n\n\n0\n\n\n4\n\n\n6\n\n\n167.6\n\n\n3.92\n\n\n4\n\n\n123\n\n\n17.8\n\n\n18.9\n\n\n1\n\n\n3.44\n\n\n\n\n0\n\n\n3\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3\n\n\n180\n\n\n16.4\n\n\n17.4\n\n\n0\n\n\n4.07\n\n\n\n\n0\n\n\n3\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3\n\n\n180\n\n\n17.3\n\n\n17.6\n\n\n0\n\n\n3.73\n\n\n\n\n0\n\n\n3\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3\n\n\n180\n\n\n15.2\n\n\n18\n\n\n0\n\n\n3.78\n\n\n\n\n0\n\n\n4\n\n\n8\n\n\n472\n\n\n2.93\n\n\n3\n\n\n205\n\n\n10.4\n\n\n17.98\n\n\n0\n\n\n5.25\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nmtcars |&gt; select(carb, sort(tidyselect::peek_vars()))\ndata.frame [32 x 11]\n\n\n\n\ncarb\n\n\nam\n\n\ncyl\n\n\ndisp\n\n\ndrat\n\n\ngear\n\n\nhp\n\n\nmpg\n\n\nqsec\n\n\nvs\n\n\nwt\n\n\n\n\n\n4\n\n\n1\n\n\n6\n\n\n160\n\n\n3.9\n\n\n4\n\n\n110\n\n\n21\n\n\n16.46\n\n\n0\n\n\n2.62\n\n\n\n\n4\n\n\n1\n\n\n6\n\n\n160\n\n\n3.9\n\n\n4\n\n\n110\n\n\n21\n\n\n17.02\n\n\n0\n\n\n2.875\n\n\n\n\n1\n\n\n1\n\n\n4\n\n\n108\n\n\n3.85\n\n\n4\n\n\n93\n\n\n22.8\n\n\n18.61\n\n\n1\n\n\n2.32\n\n\n\n\n1\n\n\n0\n\n\n6\n\n\n258\n\n\n3.08\n\n\n3\n\n\n110\n\n\n21.4\n\n\n19.44\n\n\n1\n\n\n3.215\n\n\n\n\n2\n\n\n0\n\n\n8\n\n\n360\n\n\n3.15\n\n\n3\n\n\n175\n\n\n18.7\n\n\n17.02\n\n\n0\n\n\n3.44\n\n\n\n\n1\n\n\n0\n\n\n6\n\n\n225\n\n\n2.76\n\n\n3\n\n\n105\n\n\n18.1\n\n\n20.22\n\n\n1\n\n\n3.46\n\n\n\n\n4\n\n\n0\n\n\n8\n\n\n360\n\n\n3.21\n\n\n3\n\n\n245\n\n\n14.3\n\n\n15.84\n\n\n0\n\n\n3.57\n\n\n\n\n2\n\n\n0\n\n\n4\n\n\n146.7\n\n\n3.69\n\n\n4\n\n\n62\n\n\n24.4\n\n\n20\n\n\n1\n\n\n3.19\n\n\n\n\n2\n\n\n0\n\n\n4\n\n\n140.8\n\n\n3.92\n\n\n4\n\n\n95\n\n\n22.8\n\n\n22.9\n\n\n1\n\n\n3.15\n\n\n\n\n4\n\n\n0\n\n\n6\n\n\n167.6\n\n\n3.92\n\n\n4\n\n\n123\n\n\n19.2\n\n\n18.3\n\n\n1\n\n\n3.44\n\n\n\n\n4\n\n\n0\n\n\n6\n\n\n167.6\n\n\n3.92\n\n\n4\n\n\n123\n\n\n17.8\n\n\n18.9\n\n\n1\n\n\n3.44\n\n\n\n\n3\n\n\n0\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3\n\n\n180\n\n\n16.4\n\n\n17.4\n\n\n0\n\n\n4.07\n\n\n\n\n3\n\n\n0\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3\n\n\n180\n\n\n17.3\n\n\n17.6\n\n\n0\n\n\n3.73\n\n\n\n\n3\n\n\n0\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3\n\n\n180\n\n\n15.2\n\n\n18\n\n\n0\n\n\n3.78\n\n\n\n\n4\n\n\n0\n\n\n8\n\n\n472\n\n\n2.93\n\n\n3\n\n\n205\n\n\n10.4\n\n\n17.98\n\n\n0\n\n\n5.25\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\nsetcolorder(copy(MT), sort(colnames(MT)))[]\ndata.table [32 x 11]\n\n\n\n\nam\n\n\ncarb\n\n\ncyl\n\n\ndisp\n\n\ndrat\n\n\ngear\n\n\nhp\n\n\nmpg\n\n\nqsec\n\n\nvs\n\n\nwt\n\n\n\n\n\n1\n\n\n4\n\n\n6\n\n\n160\n\n\n3.9\n\n\n4\n\n\n110\n\n\n21\n\n\n16.46\n\n\n0\n\n\n2.62\n\n\n\n\n1\n\n\n4\n\n\n6\n\n\n160\n\n\n3.9\n\n\n4\n\n\n110\n\n\n21\n\n\n17.02\n\n\n0\n\n\n2.875\n\n\n\n\n1\n\n\n1\n\n\n4\n\n\n108\n\n\n3.85\n\n\n4\n\n\n93\n\n\n22.8\n\n\n18.61\n\n\n1\n\n\n2.32\n\n\n\n\n0\n\n\n1\n\n\n6\n\n\n258\n\n\n3.08\n\n\n3\n\n\n110\n\n\n21.4\n\n\n19.44\n\n\n1\n\n\n3.215\n\n\n\n\n0\n\n\n2\n\n\n8\n\n\n360\n\n\n3.15\n\n\n3\n\n\n175\n\n\n18.7\n\n\n17.02\n\n\n0\n\n\n3.44\n\n\n\n\n0\n\n\n1\n\n\n6\n\n\n225\n\n\n2.76\n\n\n3\n\n\n105\n\n\n18.1\n\n\n20.22\n\n\n1\n\n\n3.46\n\n\n\n\n0\n\n\n4\n\n\n8\n\n\n360\n\n\n3.21\n\n\n3\n\n\n245\n\n\n14.3\n\n\n15.84\n\n\n0\n\n\n3.57\n\n\n\n\n0\n\n\n2\n\n\n4\n\n\n146.7\n\n\n3.69\n\n\n4\n\n\n62\n\n\n24.4\n\n\n20\n\n\n1\n\n\n3.19\n\n\n\n\n0\n\n\n2\n\n\n4\n\n\n140.8\n\n\n3.92\n\n\n4\n\n\n95\n\n\n22.8\n\n\n22.9\n\n\n1\n\n\n3.15\n\n\n\n\n0\n\n\n4\n\n\n6\n\n\n167.6\n\n\n3.92\n\n\n4\n\n\n123\n\n\n19.2\n\n\n18.3\n\n\n1\n\n\n3.44\n\n\n\n\n0\n\n\n4\n\n\n6\n\n\n167.6\n\n\n3.92\n\n\n4\n\n\n123\n\n\n17.8\n\n\n18.9\n\n\n1\n\n\n3.44\n\n\n\n\n0\n\n\n3\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3\n\n\n180\n\n\n16.4\n\n\n17.4\n\n\n0\n\n\n4.07\n\n\n\n\n0\n\n\n3\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3\n\n\n180\n\n\n17.3\n\n\n17.6\n\n\n0\n\n\n3.73\n\n\n\n\n0\n\n\n3\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3\n\n\n180\n\n\n15.2\n\n\n18\n\n\n0\n\n\n3.78\n\n\n\n\n0\n\n\n4\n\n\n8\n\n\n472\n\n\n2.93\n\n\n3\n\n\n205\n\n\n10.4\n\n\n17.98\n\n\n0\n\n\n5.25\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nsetcolorder(copy(MT), c(\"carb\", sort(setdiff(colnames(MT), \"carb\"))))[]\ndata.table [32 x 11]\n\n\n\n\ncarb\n\n\nam\n\n\ncyl\n\n\ndisp\n\n\ndrat\n\n\ngear\n\n\nhp\n\n\nmpg\n\n\nqsec\n\n\nvs\n\n\nwt\n\n\n\n\n\n4\n\n\n1\n\n\n6\n\n\n160\n\n\n3.9\n\n\n4\n\n\n110\n\n\n21\n\n\n16.46\n\n\n0\n\n\n2.62\n\n\n\n\n4\n\n\n1\n\n\n6\n\n\n160\n\n\n3.9\n\n\n4\n\n\n110\n\n\n21\n\n\n17.02\n\n\n0\n\n\n2.875\n\n\n\n\n1\n\n\n1\n\n\n4\n\n\n108\n\n\n3.85\n\n\n4\n\n\n93\n\n\n22.8\n\n\n18.61\n\n\n1\n\n\n2.32\n\n\n\n\n1\n\n\n0\n\n\n6\n\n\n258\n\n\n3.08\n\n\n3\n\n\n110\n\n\n21.4\n\n\n19.44\n\n\n1\n\n\n3.215\n\n\n\n\n2\n\n\n0\n\n\n8\n\n\n360\n\n\n3.15\n\n\n3\n\n\n175\n\n\n18.7\n\n\n17.02\n\n\n0\n\n\n3.44\n\n\n\n\n1\n\n\n0\n\n\n6\n\n\n225\n\n\n2.76\n\n\n3\n\n\n105\n\n\n18.1\n\n\n20.22\n\n\n1\n\n\n3.46\n\n\n\n\n4\n\n\n0\n\n\n8\n\n\n360\n\n\n3.21\n\n\n3\n\n\n245\n\n\n14.3\n\n\n15.84\n\n\n0\n\n\n3.57\n\n\n\n\n2\n\n\n0\n\n\n4\n\n\n146.7\n\n\n3.69\n\n\n4\n\n\n62\n\n\n24.4\n\n\n20\n\n\n1\n\n\n3.19\n\n\n\n\n2\n\n\n0\n\n\n4\n\n\n140.8\n\n\n3.92\n\n\n4\n\n\n95\n\n\n22.8\n\n\n22.9\n\n\n1\n\n\n3.15\n\n\n\n\n4\n\n\n0\n\n\n6\n\n\n167.6\n\n\n3.92\n\n\n4\n\n\n123\n\n\n19.2\n\n\n18.3\n\n\n1\n\n\n3.44\n\n\n\n\n4\n\n\n0\n\n\n6\n\n\n167.6\n\n\n3.92\n\n\n4\n\n\n123\n\n\n17.8\n\n\n18.9\n\n\n1\n\n\n3.44\n\n\n\n\n3\n\n\n0\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3\n\n\n180\n\n\n16.4\n\n\n17.4\n\n\n0\n\n\n4.07\n\n\n\n\n3\n\n\n0\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3\n\n\n180\n\n\n17.3\n\n\n17.6\n\n\n0\n\n\n3.73\n\n\n\n\n3\n\n\n0\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3\n\n\n180\n\n\n15.2\n\n\n18\n\n\n0\n\n\n3.78\n\n\n\n\n4\n\n\n0\n\n\n8\n\n\n472\n\n\n2.93\n\n\n3\n\n\n205\n\n\n10.4\n\n\n17.98\n\n\n0\n\n\n5.25\n\n\n\n\n\n[ omitted 17 entries ]"
  },
  {
    "objectID": "content/blog/posts/data.table/index.html#summarizereframe",
    "href": "content/blog/posts/data.table/index.html#summarizereframe",
    "title": "Data wrangling with data.table and the Tidyverse",
    "section": "\n1.9 Summarize/Reframe",
    "text": "1.9 Summarize/Reframe\nWith data.table, one needs to use the = operator to summarize. It takes a function that returns a list of values smaller than the original column (or group) size. By default, it will only keep the modified columns (like a transmute).\n\n1.9.1 Basic summary\n\nmtcars |&gt; summarize(mean_cyl = mean(cyl))\ndata.frame [1 x 1]\n\n\n\n\nmean_cyl\n\n\n\n\n6.188\n\n\n\n\n\n\n\nMT[, .(mean_cyl = mean(cyl))]\ndata.table [1 x 1]\n\n\n\n\nmean_cyl\n\n\n\n\n6.188\n\n\n\n\n\n\n\n1.9.2 Grouped summary\n\n\nTidyverse\ndata.table\n\n\n\nBy default, dplyr::summarize will arrange the result by the grouping factor:\n\nmtcars |&gt; summarize(N = n(), .by = cyl)\ndata.frame [3 x 2]\n\n\n\n\ncyl\n\n\nN\n\n\n\n\n\n6\n\n\n7\n\n\n\n\n4\n\n\n11\n\n\n\n\n8\n\n\n14\n\n\n\n\n\n\n\nTo order by the grouping factor, use group_by() instead of .by:\n\nmtcars |&gt; group_by(cyl) |&gt; summarize(N = n())\ndata.frame [3 x 2]\n\n\n\n\ncyl\n\n\nN\n\n\n\n\n\n4\n\n\n11\n\n\n\n\n6\n\n\n7\n\n\n\n\n8\n\n\n14\n\n\n\n\n\n\n\n\n\nBy default, data.table keeps the order the groups originally appear in:\n\nMT[, .N, by = cyl]\ndata.table [3 x 2]\n\n\n\n\ncyl\n\n\nN\n\n\n\n\n\n6\n\n\n7\n\n\n\n\n4\n\n\n11\n\n\n\n\n8\n\n\n14\n\n\n\n\n\n\n\nTo order by the grouping factor, use keyby instead of by:\n\nMT[, .N, keyby = cyl]\ndata.table [3 x 2]\n\n\n\n\ncyl\n\n\nN\n\n\n\n\n\n4\n\n\n11\n\n\n\n\n6\n\n\n7\n\n\n\n\n8\n\n\n14\n\n\n\n\n\n\n\n\n\n\nGrouped on a temporary variable:\n\nmtcars |&gt; group_by(cyl &gt; 6) |&gt; summarize(N = n())\ndata.frame [2 x 2]\n\n\n\n\ncyl &gt; 6\n\n\nN\n\n\n\n\n\nFALSE\n\n\n18\n\n\n\n\nTRUE\n\n\n14\n\n\n\n\n\n\n\n\nMT[, .N, by = .(cyl &gt; 6)]\ndata.table [2 x 2]\n\n\n\n\ncyl\n\n\nN\n\n\n\n\n\nFALSE\n\n\n18\n\n\n\n\nTRUE\n\n\n14\n\n\n\n\n\n\n\n\n1.9.3 Column-wise summary\n\n1.9.3.1 Apply one function to multiple columns:\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |&gt; summarize(across(everything(), mean), .by = cyl)\ndata.frame [3 x 11]\n\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n6\n\n\n19.743\n\n\n183.314\n\n\n122.286\n\n\n3.586\n\n\n3.117\n\n\n17.977\n\n\n0.571\n\n\n0.429\n\n\n3.857\n\n\n3.429\n\n\n\n\n4\n\n\n26.664\n\n\n105.136\n\n\n82.636\n\n\n4.071\n\n\n2.286\n\n\n19.137\n\n\n0.909\n\n\n0.727\n\n\n4.091\n\n\n1.545\n\n\n\n\n8\n\n\n15.1\n\n\n353.1\n\n\n209.214\n\n\n3.229\n\n\n3.999\n\n\n16.772\n\n\n0\n\n\n0.143\n\n\n3.286\n\n\n3.5\n\n\n\n\n\n\n\nBy column type:\n\nmtcars |&gt; summarize(across(where(is.double), mean), .by = cyl)\ndata.frame [3 x 11]\n\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n6\n\n\n19.743\n\n\n183.314\n\n\n122.286\n\n\n3.586\n\n\n3.117\n\n\n17.977\n\n\n0.571\n\n\n0.429\n\n\n3.857\n\n\n3.429\n\n\n\n\n4\n\n\n26.664\n\n\n105.136\n\n\n82.636\n\n\n4.071\n\n\n2.286\n\n\n19.137\n\n\n0.909\n\n\n0.727\n\n\n4.091\n\n\n1.545\n\n\n\n\n8\n\n\n15.1\n\n\n353.1\n\n\n209.214\n\n\n3.229\n\n\n3.999\n\n\n16.772\n\n\n0\n\n\n0.143\n\n\n3.286\n\n\n3.5\n\n\n\n\n\n\n\nBy matching column names:\n\nmtcars |&gt; summarize(across(matches(\"^d\"), mean), .by = cyl)\ndata.frame [3 x 3]\n\n\n\n\ncyl\n\n\ndisp\n\n\ndrat\n\n\n\n\n\n6\n\n\n183.314\n\n\n3.586\n\n\n\n\n4\n\n\n105.136\n\n\n4.071\n\n\n\n\n8\n\n\n353.1\n\n\n3.229\n\n\n\n\n\n\n\n\n\n\nMT[, lapply(.SD, mean), by = cyl]\ndata.table [3 x 11]\n\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n6\n\n\n19.743\n\n\n183.314\n\n\n122.286\n\n\n3.586\n\n\n3.117\n\n\n17.977\n\n\n0.571\n\n\n0.429\n\n\n3.857\n\n\n3.429\n\n\n\n\n4\n\n\n26.664\n\n\n105.136\n\n\n82.636\n\n\n4.071\n\n\n2.286\n\n\n19.137\n\n\n0.909\n\n\n0.727\n\n\n4.091\n\n\n1.545\n\n\n\n\n8\n\n\n15.1\n\n\n353.1\n\n\n209.214\n\n\n3.229\n\n\n3.999\n\n\n16.772\n\n\n0\n\n\n0.143\n\n\n3.286\n\n\n3.5\n\n\n\n\n\n\n\nBy column type:\n\nMT[, lapply(.SD[, -\"cyl\"], mean), by = cyl, .SDcols = is.double]\ndata.table [3 x 11]\n\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n6\n\n\n19.743\n\n\n183.314\n\n\n122.286\n\n\n3.586\n\n\n3.117\n\n\n17.977\n\n\n0.571\n\n\n0.429\n\n\n3.857\n\n\n3.429\n\n\n\n\n4\n\n\n26.664\n\n\n105.136\n\n\n82.636\n\n\n4.071\n\n\n2.286\n\n\n19.137\n\n\n0.909\n\n\n0.727\n\n\n4.091\n\n\n1.545\n\n\n\n\n8\n\n\n15.1\n\n\n353.1\n\n\n209.214\n\n\n3.229\n\n\n3.999\n\n\n16.772\n\n\n0\n\n\n0.143\n\n\n3.286\n\n\n3.5\n\n\n\n\n\n\n\nBy matching column names:\n\nMT[, lapply(.SD, mean), by = cyl, .SDcols = patterns(\"^d\")]\ndata.table [3 x 3]\n\n\n\n\ncyl\n\n\ndisp\n\n\ndrat\n\n\n\n\n\n6\n\n\n183.314\n\n\n3.586\n\n\n\n\n4\n\n\n105.136\n\n\n4.071\n\n\n\n\n8\n\n\n353.1\n\n\n3.229\n\n\n\n\n\n\n\n\n\n\n\n1.9.3.2 Applying multiple functions to one column:\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |&gt; summarize(mean(mpg), sd(mpg), .by = cyl)\ndata.frame [3 x 3]\n\n\n\n\ncyl\n\n\nmean(mpg)\n\n\nsd(mpg)\n\n\n\n\n\n6\n\n\n19.743\n\n\n1.454\n\n\n\n\n4\n\n\n26.664\n\n\n4.51\n\n\n\n\n8\n\n\n15.1\n\n\n2.56\n\n\n\n\n\n\n\n\nWith column names:\n\nmtcars |&gt; summarize(mean = mean(mpg), sd = sd(mpg), .by = cyl)\ndata.frame [3 x 3]\n\n\n\n\ncyl\n\n\nmean\n\n\nsd\n\n\n\n\n\n6\n\n\n19.743\n\n\n1.454\n\n\n\n\n4\n\n\n26.664\n\n\n4.51\n\n\n\n\n8\n\n\n15.1\n\n\n2.56\n\n\n\n\n\n\n\n\nmtcars |&gt; summarize(across(mpg, list(mean = mean, sd = sd), .names = \"{fn}\"), .by = cyl)\ndata.frame [3 x 3]\n\n\n\n\ncyl\n\n\nmean\n\n\nsd\n\n\n\n\n\n6\n\n\n19.743\n\n\n1.454\n\n\n\n\n4\n\n\n26.664\n\n\n4.51\n\n\n\n\n8\n\n\n15.1\n\n\n2.56\n\n\n\n\n\n\n\n\n\n\nMT[, .(mean(mpg), sd(mpg)), by = cyl]\ndata.table [3 x 3]\n\n\n\n\ncyl\n\n\nV1\n\n\nV2\n\n\n\n\n\n6\n\n\n19.743\n\n\n1.454\n\n\n\n\n4\n\n\n26.664\n\n\n4.51\n\n\n\n\n8\n\n\n15.1\n\n\n2.56\n\n\n\n\n\n\n\n\nMT[, lapply(.(mpg), \\(x) list(mean(x), sd(x))) |&gt; rbindlist(), by = cyl]\ndata.table [3 x 3]\n\n\n\n\ncyl\n\n\nV1\n\n\nV2\n\n\n\n\n\n6\n\n\n19.743\n\n\n1.454\n\n\n\n\n4\n\n\n26.664\n\n\n4.51\n\n\n\n\n8\n\n\n15.1\n\n\n2.56\n\n\n\n\n\n\n\nWith column names:\n\nMT[, .(mean = mean(mpg), sd = sd(mpg)), by = cyl]\ndata.table [3 x 3]\n\n\n\n\ncyl\n\n\nmean\n\n\nsd\n\n\n\n\n\n6\n\n\n19.743\n\n\n1.454\n\n\n\n\n4\n\n\n26.664\n\n\n4.51\n\n\n\n\n8\n\n\n15.1\n\n\n2.56\n\n\n\n\n\n\n\n\nMT[, lapply(.SD, \\(x) list(mean = mean(x), sd = sd(x))) |&gt; rbindlist(), by = cyl, .SDcols = \"mpg\"]\ndata.table [3 x 3]\n\n\n\n\ncyl\n\n\nmean\n\n\nsd\n\n\n\n\n\n6\n\n\n19.743\n\n\n1.454\n\n\n\n\n4\n\n\n26.664\n\n\n4.51\n\n\n\n\n8\n\n\n15.1\n\n\n2.56\n\n\n\n\n\n\n\n\n\n\n\n1.9.3.3 Apply multiple functions to multiple columns:\n\n\n\n\n\n\nNote\n\n\n\nDepending on the output we want (i.e. having the function’s output as columns or rows), we can either provide a list of functions to apply (list_of_fns), or a function returning a list (fn_returning_list).\n\n\n\ncols &lt;- c(\"mpg\", \"hp\")\n\nlist_of_fns &lt;- list(mean = \\(x) mean(x), sd = \\(x) sd(x))\n\nfn_returning_list &lt;- \\(x) list(mean = mean(x), sd = sd(x))\n\n\n\nTidyverse\ndata.table\n\n\n\nOne column per function, one row per variable:\n\nreframe(mtcars, map_dfr(pick(all_of(cols)), fn_returning_list, .id = \"Var\"), .by = cyl)\ndata.frame [6 x 4]\n\n\n\n\ncyl\n\n\nVar\n\n\nmean\n\n\nsd\n\n\n\n\n\n6\n\n\nmpg\n\n\n19.743\n\n\n1.454\n\n\n\n\n6\n\n\nhp\n\n\n122.286\n\n\n24.26\n\n\n\n\n4\n\n\nmpg\n\n\n26.664\n\n\n4.51\n\n\n\n\n4\n\n\nhp\n\n\n82.636\n\n\n20.935\n\n\n\n\n8\n\n\nmpg\n\n\n15.1\n\n\n2.56\n\n\n\n\n8\n\n\nhp\n\n\n209.214\n\n\n50.977\n\n\n\n\n\n\n\n\nAlternativesreframe(mtcars, map(pick(all_of(cols)), fn_returning_list) |&gt; bind_rows(.id = \"Var\"), .by = cyl)\n\n\n\nOne column per variable, one row per function:\n\nreframe(mtcars, map_dfr(list_of_fns, \\(f) map(pick(all_of(cols)), f), .id = \"Fn\"), .by = cyl)\ndata.frame [6 x 4]\n\n\n\n\ncyl\n\n\nFn\n\n\nmpg\n\n\nhp\n\n\n\n\n\n6\n\n\nmean\n\n\n19.743\n\n\n122.286\n\n\n\n\n6\n\n\nsd\n\n\n1.454\n\n\n24.26\n\n\n\n\n4\n\n\nmean\n\n\n26.664\n\n\n82.636\n\n\n\n\n4\n\n\nsd\n\n\n4.51\n\n\n20.935\n\n\n\n\n8\n\n\nmean\n\n\n15.1\n\n\n209.214\n\n\n\n\n8\n\n\nsd\n\n\n2.56\n\n\n50.977\n\n\n\n\n\n\n\n\nOne column per function/variable combination:\n\nsummarize(mtcars, across(all_of(cols), list_of_fns, .names = \"{col}.{fn}\"), .by = cyl)\ndata.frame [3 x 5]\n\n\n\n\ncyl\n\n\nmpg.mean\n\n\nmpg.sd\n\n\nhp.mean\n\n\nhp.sd\n\n\n\n\n\n6\n\n\n19.743\n\n\n1.454\n\n\n122.286\n\n\n24.26\n\n\n\n\n4\n\n\n26.664\n\n\n4.51\n\n\n82.636\n\n\n20.935\n\n\n\n\n8\n\n\n15.1\n\n\n2.56\n\n\n209.214\n\n\n50.977\n\n\n\n\n\n\n\n\n\nOne column per function, one row per variable:\n\nMT[, lapply(.SD, fn_returning_list) |&gt; rbindlist(idcol = \"Var\"), by = cyl, .SDcols = cols]\ndata.table [6 x 4]\n\n\n\n\ncyl\n\n\nVar\n\n\nmean\n\n\nsd\n\n\n\n\n\n6\n\n\nmpg\n\n\n19.743\n\n\n1.454\n\n\n\n\n6\n\n\nhp\n\n\n122.286\n\n\n24.26\n\n\n\n\n4\n\n\nmpg\n\n\n26.664\n\n\n4.51\n\n\n\n\n4\n\n\nhp\n\n\n82.636\n\n\n20.935\n\n\n\n\n8\n\n\nmpg\n\n\n15.1\n\n\n2.56\n\n\n\n\n8\n\n\nhp\n\n\n209.214\n\n\n50.977\n\n\n\n\n\n\n\n\n\nOne column per variable, one row per function:\n\nMT[, lapply(list_of_fns, \\(f) lapply(.SD, f)) |&gt; rbindlist(idcol = \"Fn\"), by = cyl, .SDcols = cols]\ndata.table [6 x 4]\n\n\n\n\ncyl\n\n\nFn\n\n\nmpg\n\n\nhp\n\n\n\n\n\n6\n\n\nmean\n\n\n19.743\n\n\n122.286\n\n\n\n\n6\n\n\nsd\n\n\n1.454\n\n\n24.26\n\n\n\n\n4\n\n\nmean\n\n\n26.664\n\n\n82.636\n\n\n\n\n4\n\n\nsd\n\n\n4.51\n\n\n20.935\n\n\n\n\n8\n\n\nmean\n\n\n15.1\n\n\n209.214\n\n\n\n\n8\n\n\nsd\n\n\n2.56\n\n\n50.977\n\n\n\n\n\n\n\n\nOne column per function/variable combination:\n\nMT[, lapply(.SD, fn_returning_list) |&gt; unlist(recursive = FALSE), by = cyl, .SDcols = cols]\ndata.table [3 x 5]\n\n\n\n\ncyl\n\n\nmpg.mean\n\n\nmpg.sd\n\n\nhp.mean\n\n\nhp.sd\n\n\n\n\n\n6\n\n\n19.743\n\n\n1.454\n\n\n122.286\n\n\n24.26\n\n\n\n\n4\n\n\n26.664\n\n\n4.51\n\n\n82.636\n\n\n20.935\n\n\n\n\n8\n\n\n15.1\n\n\n2.56\n\n\n209.214\n\n\n50.977\n\n\n\n\n\n\n\n\ndata.table [3 x 5]\n\n\n\n\ncyl\n\n\nmpg.mean\n\n\nmpg.sd\n\n\nhp.mean\n\n\nhp.sd\n\n\n\n\n\n6\n\n\n19.743\n\n\n1.454\n\n\n122.286\n\n\n24.26\n\n\n\n\n4\n\n\n26.664\n\n\n4.51\n\n\n82.636\n\n\n20.935\n\n\n\n\n8\n\n\n15.1\n\n\n2.56\n\n\n209.214\n\n\n50.977\n\n\n\n\n\n\n\nDifferent column order & naming scheme:\n\nMT[, \n  lapply(list_of_fns, \\(f) lapply(.SD, f)) |&gt; \n    unlist(recursive = FALSE),\n  by = cyl, .SDcols = cols\n]\ndata.table [3 x 5]\n\n\n\n\ncyl\n\n\nmean.mpg\n\n\nmean.hp\n\n\nsd.mpg\n\n\nsd.hp\n\n\n\n\n\n6\n\n\n19.743\n\n\n122.286\n\n\n1.454\n\n\n24.26\n\n\n\n\n4\n\n\n26.664\n\n\n82.636\n\n\n4.51\n\n\n20.935\n\n\n\n\n8\n\n\n15.1\n\n\n209.214\n\n\n2.56\n\n\n50.977\n\n\n\n\n\n\n\nUsing dcast (see next section for more on pivots):\n\ndcast(MT, cyl ~ ., fun.agg = list_of_fns, value.var = cols) # list(mean, sd)\ndata.table [3 x 5]\n\n\n\n\ncyl\n\n\nmpg_mean\n\n\nhp_mean\n\n\nmpg_sd\n\n\nhp_sd\n\n\n\n\n\n4\n\n\n26.664\n\n\n82.636\n\n\n4.51\n\n\n20.935\n\n\n\n\n6\n\n\n19.743\n\n\n122.286\n\n\n1.454\n\n\n24.26\n\n\n\n\n8\n\n\n15.1\n\n\n209.214\n\n\n2.56\n\n\n50.977"
  },
  {
    "objectID": "content/blog/posts/data.table/index.html#melt-longer",
    "href": "content/blog/posts/data.table/index.html#melt-longer",
    "title": "Data wrangling with data.table and the Tidyverse",
    "section": "\n2.1 Melt / Longer",
    "text": "2.1 Melt / Longer\nData:\n\n(fam1 &lt;- as.data.frame(FAM1))\ndata.frame [5 x 5]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\n(fam2 &lt;- as.data.frame(FAM2))\ndata.frame [5 x 8]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\ngender_child1\n\n\ngender_child2\n\n\ngender_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n1\n\n\n2\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n2\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n2\n\n\n2\n\n\n1\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n2\n\n\n1\n\n\nNA\n\n\n\n\n\n\n\n\n2.1.1 Basic Melt/Longer\n\n\n\n\n\n\nTip\n\n\n\ndata.table::melt does partial argument matching and thus accepts shortened versions of its arguments. E.g.: variable.name &lt;=&gt; variable (or var), value.name &lt;=&gt; value (or val), measure.vars &lt;=&gt; measure, id.vars &lt;=&gt; id, pattern &lt;=&gt; pat, …\n\n\nOne group of columns –&gt; single value column\n\n\nTidyverse\ndata.table\n\n\n\n\npivot_longer(FAM1, cols = matches(\"dob_\"), names_to = \"variable\")\ndata.frame [15 x 4]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\nvariable\n\n\nvalue\n\n\n\n\n\n1\n\n\n30\n\n\ndob_child1\n\n\n1998-11-26\n\n\n\n\n1\n\n\n30\n\n\ndob_child2\n\n\n2000-01-29\n\n\n\n\n1\n\n\n30\n\n\ndob_child3\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\ndob_child1\n\n\n1996-06-22\n\n\n\n\n2\n\n\n27\n\n\ndob_child2\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\ndob_child3\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\ndob_child1\n\n\n2002-07-11\n\n\n\n\n3\n\n\n26\n\n\ndob_child2\n\n\n2004-04-05\n\n\n\n\n3\n\n\n26\n\n\ndob_child3\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\ndob_child1\n\n\n2004-10-10\n\n\n\n\n4\n\n\n32\n\n\ndob_child2\n\n\n2009-08-27\n\n\n\n\n4\n\n\n32\n\n\ndob_child3\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\ndob_child1\n\n\n2000-12-05\n\n\n\n\n5\n\n\n29\n\n\ndob_child2\n\n\n2005-02-28\n\n\n\n\n5\n\n\n29\n\n\ndob_child3\n\n\nNA\n\n\n\n\n\n\n\n\n\n\nmelt(FAM1, measure.vars = c(\"dob_child1\", \"dob_child2\", \"dob_child3\"))\ndata.table [15 x 4]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\nvariable\n\n\nvalue\n\n\n\n\n\n1\n\n\n30\n\n\ndob_child1\n\n\n1998-11-26\n\n\n\n\n2\n\n\n27\n\n\ndob_child1\n\n\n1996-06-22\n\n\n\n\n3\n\n\n26\n\n\ndob_child1\n\n\n2002-07-11\n\n\n\n\n4\n\n\n32\n\n\ndob_child1\n\n\n2004-10-10\n\n\n\n\n5\n\n\n29\n\n\ndob_child1\n\n\n2000-12-05\n\n\n\n\n1\n\n\n30\n\n\ndob_child2\n\n\n2000-01-29\n\n\n\n\n2\n\n\n27\n\n\ndob_child2\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\ndob_child2\n\n\n2004-04-05\n\n\n\n\n4\n\n\n32\n\n\ndob_child2\n\n\n2009-08-27\n\n\n\n\n5\n\n\n29\n\n\ndob_child2\n\n\n2005-02-28\n\n\n\n\n1\n\n\n30\n\n\ndob_child3\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\ndob_child3\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\ndob_child3\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\ndob_child3\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\ndob_child3\n\n\nNA\n\n\n\n\n\nmelt(FAM1, measure = patterns(\"^dob_\"))\ndata.table [15 x 4]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\nvariable\n\n\nvalue\n\n\n\n\n\n1\n\n\n30\n\n\ndob_child1\n\n\n1998-11-26\n\n\n\n\n2\n\n\n27\n\n\ndob_child1\n\n\n1996-06-22\n\n\n\n\n3\n\n\n26\n\n\ndob_child1\n\n\n2002-07-11\n\n\n\n\n4\n\n\n32\n\n\ndob_child1\n\n\n2004-10-10\n\n\n\n\n5\n\n\n29\n\n\ndob_child1\n\n\n2000-12-05\n\n\n\n\n1\n\n\n30\n\n\ndob_child2\n\n\n2000-01-29\n\n\n\n\n2\n\n\n27\n\n\ndob_child2\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\ndob_child2\n\n\n2004-04-05\n\n\n\n\n4\n\n\n32\n\n\ndob_child2\n\n\n2009-08-27\n\n\n\n\n5\n\n\n29\n\n\ndob_child2\n\n\n2005-02-28\n\n\n\n\n1\n\n\n30\n\n\ndob_child3\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\ndob_child3\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\ndob_child3\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\ndob_child3\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\ndob_child3\n\n\nNA\n\n\n\n\n\n\n\n\n\n\nOne group of columns –&gt; multiple value columns\n\n\nTidyverse\ndata.table\n\n\n\n\n# No direct equivalent\n\n\n\n\nmelt(FAM1, measure = patterns(child1 = \"child1$\", child2 = \"child2$|child3$\"))\ndata.table [10 x 5]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\nvariable\n\n\nchild1\n\n\nchild2\n\n\n\n\n\n1\n\n\n30\n\n\n1\n\n\n1998-11-26\n\n\n2000-01-29\n\n\n\n\n2\n\n\n27\n\n\n1\n\n\n1996-06-22\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n1\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n\n\n4\n\n\n32\n\n\n1\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n\n\n5\n\n\n29\n\n\n1\n\n\n2000-12-05\n\n\n2005-02-28\n\n\n\n\n1\n\n\n30\n\n\n2\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n2\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2\n\n\nNA\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2\n\n\nNA\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2\n\n\nNA\n\n\nNA\n\n\n\n\n\n\n\n\n\n\n\n2.1.2 Merging multiple yes/no columns\nMelting multiple presence/absence columns into a single variable:\nData:\n\n(MOVIES_WIDE &lt;- as.data.table(movies_wide))\ndata.table [3 x 4]\n\n\n\n\nID\n\n\naction\n\n\nadventure\n\n\nanimation\n\n\n\n\n\n1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n2\n\n\n1\n\n\n1\n\n\n0\n\n\n\n\n3\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n\n\n\n\n\nTidyverse\ndata.table\n\n\n\n\npivot_longer(\n    movies_wide, -ID, names_to = \"Genre\", \n    values_transform = \\(x) ifelse(x == 0, NA, x), values_drop_na = TRUE\n  ) |&gt; select(-value)\ndata.frame [6 x 2]\n\n\n\n\nID\n\n\nGenre\n\n\n\n\n\n1\n\n\naction\n\n\n\n\n2\n\n\naction\n\n\n\n\n2\n\n\nadventure\n\n\n\n\n3\n\n\naction\n\n\n\n\n3\n\n\nadventure\n\n\n\n\n3\n\n\nanimation\n\n\n\n\n\n\n\n\n\n\nmelt(MOVIES_WIDE, id.vars = \"ID\", var = \"Genre\")[value != 0][order(ID), -\"value\"]\ndata.table [6 x 2]\n\n\n\n\nID\n\n\nGenre\n\n\n\n\n\n1\n\n\naction\n\n\n\n\n2\n\n\naction\n\n\n\n\n2\n\n\nadventure\n\n\n\n\n3\n\n\naction\n\n\n\n\n3\n\n\nadventure\n\n\n\n\n3\n\n\nanimation\n\n\n\n\n\n\n\n\n\n\n\n2.1.3 Partial pivot\nMultiple groups of columns –&gt; Multiple value columns\n\n\nTidyverse\ndata.table\n\n\n\nUsing .value:\n\n\n\n\n\n\nTip\n\n\n\nUsing the .value special identifier allows to do a “half” pivot: the values that would be listed as rows under .value are instead used as columns.\n\n\n\npivot_longer(fam2, matches(\"^dob|^gender\"), names_to = c(\".value\", \"child\"), names_sep = \"_child\")\ndata.frame [15 x 5]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\nchild\n\n\ndob\n\n\ngender\n\n\n\n\n\n1\n\n\n30\n\n\n1\n\n\n1998-11-26\n\n\n1\n\n\n\n\n1\n\n\n30\n\n\n2\n\n\n2000-01-29\n\n\n2\n\n\n\n\n1\n\n\n30\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1\n\n\n1996-06-22\n\n\n2\n\n\n\n\n2\n\n\n27\n\n\n2\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n1\n\n\n2002-07-11\n\n\n2\n\n\n\n\n3\n\n\n26\n\n\n2\n\n\n2004-04-05\n\n\n2\n\n\n\n\n3\n\n\n26\n\n\n3\n\n\n2007-09-02\n\n\n1\n\n\n\n\n4\n\n\n32\n\n\n1\n\n\n2004-10-10\n\n\n1\n\n\n\n\n4\n\n\n32\n\n\n2\n\n\n2009-08-27\n\n\n1\n\n\n\n\n4\n\n\n32\n\n\n3\n\n\n2012-07-21\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n1\n\n\n2000-12-05\n\n\n2\n\n\n\n\n5\n\n\n29\n\n\n2\n\n\n2005-02-28\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n\n\n\n\n\nUsing .value:\n\nmelt(FAM2, measure = patterns(\"^dob\", \"^gender\"), val = c(\"dob\", \"gender\"), var = \"child\")\ndata.table [15 x 5]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\nchild\n\n\ndob\n\n\ngender\n\n\n\n\n\n1\n\n\n30\n\n\n1\n\n\n1998-11-26\n\n\n1\n\n\n\n\n2\n\n\n27\n\n\n1\n\n\n1996-06-22\n\n\n2\n\n\n\n\n3\n\n\n26\n\n\n1\n\n\n2002-07-11\n\n\n2\n\n\n\n\n4\n\n\n32\n\n\n1\n\n\n2004-10-10\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n1\n\n\n2000-12-05\n\n\n2\n\n\n\n\n1\n\n\n30\n\n\n2\n\n\n2000-01-29\n\n\n2\n\n\n\n\n2\n\n\n27\n\n\n2\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2\n\n\n2004-04-05\n\n\n2\n\n\n\n\n4\n\n\n32\n\n\n2\n\n\n2009-08-27\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n2\n\n\n2005-02-28\n\n\n1\n\n\n\n\n1\n\n\n30\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n3\n\n\n2007-09-02\n\n\n1\n\n\n\n\n4\n\n\n32\n\n\n3\n\n\n2012-07-21\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n\n\n\n\nManually:\n\ncolA &lt;- str_subset(colnames(FAM2), \"^dob\")\ncolB &lt;- str_subset(colnames(FAM2), \"^gender\")\n\nmelt(FAM2, measure = list(colA, colB), val = c(\"dob\", \"gender\"), var = \"child\")\ndata.table [15 x 5]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\nchild\n\n\ndob\n\n\ngender\n\n\n\n\n\n1\n\n\n30\n\n\n1\n\n\n1998-11-26\n\n\n1\n\n\n\n\n2\n\n\n27\n\n\n1\n\n\n1996-06-22\n\n\n2\n\n\n\n\n3\n\n\n26\n\n\n1\n\n\n2002-07-11\n\n\n2\n\n\n\n\n4\n\n\n32\n\n\n1\n\n\n2004-10-10\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n1\n\n\n2000-12-05\n\n\n2\n\n\n\n\n1\n\n\n30\n\n\n2\n\n\n2000-01-29\n\n\n2\n\n\n\n\n2\n\n\n27\n\n\n2\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2\n\n\n2004-04-05\n\n\n2\n\n\n\n\n4\n\n\n32\n\n\n2\n\n\n2009-08-27\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n2\n\n\n2005-02-28\n\n\n1\n\n\n\n\n1\n\n\n30\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n3\n\n\n2007-09-02\n\n\n1\n\n\n\n\n4\n\n\n32\n\n\n3\n\n\n2012-07-21\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n\n\n\n\nAlternativesmelt(FAM2, measure = list(a, b), val = c(\"dob\", \"gender\"), var = \"child\") |&gt; \n  substitute2(env = list(a = I(str_subset(colnames(FAM2), \"^dob\")), b = I(str_subset(colnames(FAM2), \"^gender\")))) |&gt; eval()\n\n\n\nUsing measure and value.name:\n\nmelt(FAM2, measure = measure(value.name, child = \\(x) as.integer(x), sep = \"_child\"))\ndata.table [15 x 5]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\nchild\n\n\ndob\n\n\ngender\n\n\n\n\n\n1\n\n\n30\n\n\n1\n\n\n1998-11-26\n\n\n1\n\n\n\n\n2\n\n\n27\n\n\n1\n\n\n1996-06-22\n\n\n2\n\n\n\n\n3\n\n\n26\n\n\n1\n\n\n2002-07-11\n\n\n2\n\n\n\n\n4\n\n\n32\n\n\n1\n\n\n2004-10-10\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n1\n\n\n2000-12-05\n\n\n2\n\n\n\n\n1\n\n\n30\n\n\n2\n\n\n2000-01-29\n\n\n2\n\n\n\n\n2\n\n\n27\n\n\n2\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2\n\n\n2004-04-05\n\n\n2\n\n\n\n\n4\n\n\n32\n\n\n2\n\n\n2009-08-27\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n2\n\n\n2005-02-28\n\n\n1\n\n\n\n\n1\n\n\n30\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n3\n\n\n2007-09-02\n\n\n1\n\n\n\n\n4\n\n\n32\n\n\n3\n\n\n2012-07-21\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n\n\n\n\nAlternativesmelt(FAM2, measure = measurev(list(value.name = NULL, child = as.integer), pat = \"(.*)_child(\\\\d)\"))"
  },
  {
    "objectID": "content/blog/posts/data.table/index.html#dcast-wider",
    "href": "content/blog/posts/data.table/index.html#dcast-wider",
    "title": "Data wrangling with data.table and the Tidyverse",
    "section": "\n2.2 Dcast / Wider",
    "text": "2.2 Dcast / Wider\nGeneral idea:\n- Pivot around the combination of id.vars (LHS of the formula)\n- The measure.vars (RHS of the formula) are the ones whose values become column names\n- The value.var are the ones the values are taken from to fill the new columns\nData:\n\n(fam1l &lt;- as.data.frame(FAM1L))\ndata.frame [15 x 4]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\nvariable\n\n\nvalue\n\n\n\n\n\n1\n\n\n30\n\n\ndob_child1\n\n\n1998-11-26\n\n\n\n\n2\n\n\n27\n\n\ndob_child1\n\n\n1996-06-22\n\n\n\n\n3\n\n\n26\n\n\ndob_child1\n\n\n2002-07-11\n\n\n\n\n4\n\n\n32\n\n\ndob_child1\n\n\n2004-10-10\n\n\n\n\n5\n\n\n29\n\n\ndob_child1\n\n\n2000-12-05\n\n\n\n\n1\n\n\n30\n\n\ndob_child2\n\n\n2000-01-29\n\n\n\n\n2\n\n\n27\n\n\ndob_child2\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\ndob_child2\n\n\n2004-04-05\n\n\n\n\n4\n\n\n32\n\n\ndob_child2\n\n\n2009-08-27\n\n\n\n\n5\n\n\n29\n\n\ndob_child2\n\n\n2005-02-28\n\n\n\n\n1\n\n\n30\n\n\ndob_child3\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\ndob_child3\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\ndob_child3\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\ndob_child3\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\ndob_child3\n\n\nNA\n\n\n\n\n\n(fam2l &lt;- as.data.frame(FAM2L))\ndata.frame [15 x 5]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\nchild\n\n\ndob\n\n\ngender\n\n\n\n\n\n1\n\n\n30\n\n\n1\n\n\n1998-11-26\n\n\n1\n\n\n\n\n2\n\n\n27\n\n\n1\n\n\n1996-06-22\n\n\n2\n\n\n\n\n3\n\n\n26\n\n\n1\n\n\n2002-07-11\n\n\n2\n\n\n\n\n4\n\n\n32\n\n\n1\n\n\n2004-10-10\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n1\n\n\n2000-12-05\n\n\n2\n\n\n\n\n1\n\n\n30\n\n\n2\n\n\n2000-01-29\n\n\n2\n\n\n\n\n2\n\n\n27\n\n\n2\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2\n\n\n2004-04-05\n\n\n2\n\n\n\n\n4\n\n\n32\n\n\n2\n\n\n2009-08-27\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n2\n\n\n2005-02-28\n\n\n1\n\n\n\n\n1\n\n\n30\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n3\n\n\n2007-09-02\n\n\n1\n\n\n\n\n4\n\n\n32\n\n\n3\n\n\n2012-07-21\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n3\n\n\nNA\n\n\nNA\n\n\n\n\n\n\n\n\n2.2.1 Basic Dcast/Wider\n\n\nTidyverse\ndata.table\n\n\n\n\npivot_wider(fam1l, id_cols = c(\"family_id\", \"age_mother\"), names_from = \"variable\")\ndata.frame [5 x 5]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\n\n\n\n\n\ndcast(FAM1L, family_id + age_mother ~ variable)\ndata.table [5 x 5]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\n\n\n\n\n\nUsing all the columns as IDs:\n\n\nTidyverse\ndata.table\n\n\n\n\npivot_wider(fam1l, names_from = variable)\ndata.frame [5 x 5]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\n\n\n\n\n\n\n\n\nNote\n\n\n\nBy default, id_cols = everything()\n\n\n\n\n\nFAM1L |&gt; dcast(... ~ variable)\ndata.table [5 x 5]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\n\n\n\n\n\n\n\n\nNote\n\n\n\n... &lt;=&gt; “every unused column”\n\n\n\n\n\nMultiple value columns –&gt; Multiple groups of columns:\n\n\nTidyverse\ndata.table\n\n\n\n\npivot_wider(\n  fam2l, id_cols = c(\"family_id\", \"age_mother\"), values_from = c(\"dob\", \"gender\"), \n  names_from = \"child\", names_sep = \"_child\"\n)\ndata.frame [5 x 8]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\ngender_child1\n\n\ngender_child2\n\n\ngender_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n1\n\n\n2\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n2\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n2\n\n\n2\n\n\n1\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n2\n\n\n1\n\n\nNA\n\n\n\n\n\n\n\n\n\n\ndcast(FAM2L, family_id + age_mother ~ child, value.var = c(\"dob\", \"gender\"), sep = \"_child\")\ndata.table [5 x 8]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\ngender_child1\n\n\ngender_child2\n\n\ngender_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n1\n\n\n2\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n2\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n2\n\n\n2\n\n\n1\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n2\n\n\n1\n\n\nNA\n\n\n\n\n\ndcast(FAM2L, ... ~ child, value.var = c(\"dob\", \"gender\"), sep = \"_child\")\ndata.table [5 x 8]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\ngender_child1\n\n\ngender_child2\n\n\ngender_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n1\n\n\n2\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n2\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n2\n\n\n2\n\n\n1\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n2\n\n\n1\n\n\nNA\n\n\n\n\n\n\n\n\n\n\nDynamic names in the formula:\n\nvar_name &lt;- \"variable\"\n\nid_vars &lt;- c(\"family_id\", \"age_mother\")\n\n\n\nTidyverse\ndata.table\n\n\n\n\npivot_wider(fam1l, id_cols = c(family_id, age_mother), names_from = {{ var_name }})\ndata.frame [5 x 5]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\n\n\n\nMultiple dynamic names:\n\npivot_wider(fam1l, id_cols = all_of(id_vars), names_from = variable)\ndata.frame [5 x 5]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\n\n\n\n\n\n\ndcast(FAM1L, family_id + age_mother ~ base::get(var_name))\ndata.table [5 x 5]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\ndcast(FAM1L, family_id + age_mother ~ x) |&gt; substitute2(env = list(x = var_name)) |&gt; eval()\ndata.table [5 x 5]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\n\n\nMultiple dynamic names:\n\ndcast(FAM1L, str_c(str_c(id_vars, collapse = \" + \"), \" ~ variable\"))\ndata.table [5 x 5]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\ndcast(FAM1L, x + y ~ variable) |&gt; substitute2(env = list(x = id_vars[1], y = id_vars[2])) |&gt; eval()\ndata.table [5 x 5]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\n\n\n\n\n\n\n2.2.2 Renaming (prefix/suffix) the columns\n\n\nTidyverse\ndata.table\n\n\n\n\npivot_wider(fam1l, names_from = variable, values_from = value, names_prefix = \"Attr: \")\ndata.frame [5 x 5]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\nAttr: dob_child1\n\n\nAttr: dob_child2\n\n\nAttr: dob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\npivot_wider(fam1l, names_from = variable, values_from = value, names_glue = \"Attr: {variable}\")\ndata.frame [5 x 5]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\nAttr: dob_child1\n\n\nAttr: dob_child2\n\n\nAttr: dob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\n\n\n\n\n\ndcast(FAM1L, family_id + age_mother ~ paste0(\"Attr: \", variable))\ndata.table [5 x 5]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\nAttr: dob_child1\n\n\nAttr: dob_child2\n\n\nAttr: dob_child3\n\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\n2000-12-05\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\n\n\n\n\n\n\n2.2.3 Unused combinations\n\n\n\n\n\n\nWarning\n\n\n\nThe logic is inverted between dplyr (keep) and data.table (drop):\n\n\n\n\nTidyverse\ndata.table\n\n\n\n\npivot_wider(fam1l, names_from = variable, values_from = value, id_expand = T, names_expand = F)\ndata.frame [25 x 5]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n1\n\n\n26\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n1\n\n\n27\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n1\n\n\n29\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n1\n\n\n32\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n26\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n29\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n30\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n32\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n3\n\n\n27\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n29\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n30\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n32\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n\n[ omitted 10 entries ]\n\n\n\n\n\n\n\n\n\ndcast(FAM1L, family_id + age_mother ~ variable, drop = c(FALSE, TRUE)) # (drop_LHS, drop_RHS)\ndata.table [25 x 5]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n1\n\n\n26\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n1\n\n\n27\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n1\n\n\n29\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n1\n\n\n30\n\n\n1998-11-26\n\n\n2000-01-29\n\n\nNA\n\n\n\n\n1\n\n\n32\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n26\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n27\n\n\n1996-06-22\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n29\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n30\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\n32\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n26\n\n\n2002-07-11\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n3\n\n\n27\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n29\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n30\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n3\n\n\n32\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n\n[ omitted 10 entries ]\n\n\n\n\n\n\n\n\n\n\n2.2.4 Subsetting\n\n\nTidyverse\ndata.table\n\n\n\n\nfam1l |&gt; filter(value &gt;= lubridate::ymd(20030101)) |&gt; \n  pivot_wider(id_cols = c(\"family_id\", \"age_mother\"), names_from = \"variable\")\ndata.frame [3 x 5]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n3\n\n\n26\n\n\nNA\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n5\n\n\n29\n\n\nNA\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\n\n\n\n\n\n\n\n\nWarning\n\n\n\nAFAIK, pivot_wider can’t do this on its own.\n\n\n\n\n\ndcast(FAM1L, family_id + age_mother ~ variable, subset = .(value &gt;= lubridate::ymd(20030101)))\ndata.table [3 x 5]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\ndob_child1\n\n\ndob_child2\n\n\ndob_child3\n\n\n\n\n\n3\n\n\n26\n\n\nNA\n\n\n2004-04-05\n\n\n2007-09-02\n\n\n\n\n4\n\n\n32\n\n\n2004-10-10\n\n\n2009-08-27\n\n\n2012-07-21\n\n\n\n\n5\n\n\n29\n\n\nNA\n\n\n2005-02-28\n\n\nNA\n\n\n\n\n\n\n\n\n\n\n\n2.2.5 Aggregating\nIn data.table, not specifying the column holding the measure vars (the names) will result in an empty column counting the number of columns that should have been created for all the measures (i.e. the length() of the result).\n\n\nTidyverse\ndata.table\n\n\n\n\n(pivot_wider(fam1l, id_cols = c(family_id, age_mother), names_from = variable, values_fn = length)\n  |&gt; mutate(length = apply(pick(matches(\"_child\")), 1, \\(x) sum(x))) \n  |&gt; select(-matches(\"^dob_\"))\n)\ndata.frame [5 x 3]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\nlength\n\n\n\n\n\n1\n\n\n30\n\n\n3\n\n\n\n\n2\n\n\n27\n\n\n3\n\n\n\n\n3\n\n\n26\n\n\n3\n\n\n\n\n4\n\n\n32\n\n\n3\n\n\n\n\n5\n\n\n29\n\n\n3\n\n\n\n\n\n\n\n\n\n\ndcast(FAM1L, family_id + age_mother ~ .)\ndata.table [5 x 3]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\n.\n\n\n\n\n\n1\n\n\n30\n\n\n3\n\n\n\n\n2\n\n\n27\n\n\n3\n\n\n\n\n3\n\n\n26\n\n\n3\n\n\n\n\n4\n\n\n32\n\n\n3\n\n\n\n\n5\n\n\n29\n\n\n3\n\n\n\n\n\n\n\n\n\n\nCustomizing the default behavior (length()) using the fun.aggregate (&lt;=&gt; fun.agg or fun) argument:\nHere, we count the number of child for each each combination of (family_id + age_mother) -&gt; sum all non-NA value\n\n\nTidyverse\ndata.table\n\n\n\n\n(pivot_wider(\n    fam1l, id_cols = c(family_id, age_mother), names_from = variable, values_fn = \\(x) !is.na(x)\n  ) \n  |&gt; mutate(child_count = apply(pick(matches(\"_child\")), 1, \\(x) sum(x)))\n  |&gt; select(-matches(\"^dob_\"))\n)\ndata.frame [5 x 3]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\nchild_count\n\n\n\n\n\n1\n\n\n30\n\n\n2\n\n\n\n\n2\n\n\n27\n\n\n1\n\n\n\n\n3\n\n\n26\n\n\n3\n\n\n\n\n4\n\n\n32\n\n\n3\n\n\n\n\n5\n\n\n29\n\n\n2\n\n\n\n\n\n\n\n\nAlternatives(pivot_wider(fam1l, id_cols = c(family_id, age_mother), names_from = variable, values_fn = \\(x) !is.na(x))\n  |&gt; mutate(child_count = pmap_int(pick(matches(\"_child\")), \\(...) sum(...)))\n  |&gt; select(-matches(\"^dob_\"))\n)\n\n(pivot_wider(fam1l, id_cols = c(family_id, age_mother), names_from = variable, values_fn = \\(x) !is.na(x))\n  |&gt; rowwise()\n  |&gt; mutate(child_count = sum(c_across(matches(\"_child\"))))\n  |&gt; ungroup()\n  |&gt; select(-matches(\"^dob_\"))\n)\n\n\n\n\n\n(dcast(FAM1L, family_id + age_mother ~ ., fun = \\(x) sum(!is.na(x))) |&gt; setnames(\".\", \"child_count\"))\ndata.table [5 x 3]\n\n\n\n\nfamily_id\n\n\nage_mother\n\n\nchild_count\n\n\n\n\n\n1\n\n\n30\n\n\n2\n\n\n\n\n2\n\n\n27\n\n\n1\n\n\n\n\n3\n\n\n26\n\n\n3\n\n\n\n\n4\n\n\n32\n\n\n3\n\n\n\n\n5\n\n\n29\n\n\n2\n\n\n\n\n\n\n\n\n\n\nApplying multiple fun.agg:\nData:\n\n(DTL &lt;- data.table(\n    id1 = sample(5, 20, TRUE), \n    id2 = sample(2, 20, TRUE), \n    group = sample(letters[1:2], 20, TRUE), \n    v1 = runif(20), \n    v2 = 1L\n  )\n)\ndata.table [20 x 5]\n\n\n\n\nid1\n\n\nid2\n\n\ngroup\n\n\nv1\n\n\nv2\n\n\n\n\n\n1\n\n\n2\n\n\na\n\n\n0.643\n\n\n1\n\n\n\n\n1\n\n\n2\n\n\na\n\n\n0.693\n\n\n1\n\n\n\n\n4\n\n\n1\n\n\nb\n\n\n0.2\n\n\n1\n\n\n\n\n2\n\n\n1\n\n\na\n\n\n0.91\n\n\n1\n\n\n\n\n3\n\n\n2\n\n\nb\n\n\n0.985\n\n\n1\n\n\n\n\n3\n\n\n1\n\n\nb\n\n\n0.58\n\n\n1\n\n\n\n\n2\n\n\n1\n\n\na\n\n\n0.558\n\n\n1\n\n\n\n\n1\n\n\n1\n\n\na\n\n\n0.03\n\n\n1\n\n\n\n\n4\n\n\n2\n\n\nb\n\n\n0.266\n\n\n1\n\n\n\n\n3\n\n\n2\n\n\nb\n\n\n0.368\n\n\n1\n\n\n\n\n2\n\n\n1\n\n\na\n\n\n0.726\n\n\n1\n\n\n\n\n2\n\n\n1\n\n\na\n\n\n0.181\n\n\n1\n\n\n\n\n2\n\n\n1\n\n\na\n\n\n0.085\n\n\n1\n\n\n\n\n5\n\n\n2\n\n\nb\n\n\n0.177\n\n\n1\n\n\n\n\n4\n\n\n1\n\n\nb\n\n\n0.467\n\n\n1\n\n\n\n\n\n[ omitted 5 entries ]\n\n\n\n\n\n\n\n\nTidyverse\ndata.table\n\n\n\n\nMultiple aggregation functions applied to one variable:\n\n\n(pivot_wider(\n    DTL, id_cols = c(\"id1\", \"id2\"), names_from = \"group\", values_from = \"v1\",\n    names_glue = \"{.value}_{.name}\", names_vary = \"slowest\", names_sort = TRUE,\n    values_fn = \\(x) tibble(\"sum\" = sum(x), \"mean\" = mean(x))\n  ) \n  |&gt; unnest(cols = starts_with(\"v1\"), names_sep = \"_\")\n)\ndata.frame [9 x 6]\n\n\n\n\nid1\n\n\nid2\n\n\nv1_a_sum\n\n\nv1_a_mean\n\n\nv1_b_sum\n\n\nv1_b_mean\n\n\n\n\n\n1\n\n\n2\n\n\n1.336\n\n\n0.668\n\n\n0.841\n\n\n0.841\n\n\n\n\n4\n\n\n1\n\n\nNA\n\n\nNA\n\n\n0.667\n\n\n0.334\n\n\n\n\n2\n\n\n1\n\n\n2.46\n\n\n0.492\n\n\n0.793\n\n\n0.793\n\n\n\n\n3\n\n\n2\n\n\nNA\n\n\nNA\n\n\n1.353\n\n\n0.676\n\n\n\n\n3\n\n\n1\n\n\nNA\n\n\nNA\n\n\n0.58\n\n\n0.58\n\n\n\n\n1\n\n\n1\n\n\n0.03\n\n\n0.03\n\n\n0.723\n\n\n0.723\n\n\n\n\n4\n\n\n2\n\n\nNA\n\n\nNA\n\n\n0.266\n\n\n0.266\n\n\n\n\n5\n\n\n2\n\n\nNA\n\n\nNA\n\n\n0.998\n\n\n0.499\n\n\n\n\n2\n\n\n2\n\n\nNA\n\n\nNA\n\n\n0.889\n\n\n0.889\n\n\n\n\n\n\n\n\n\nMultiple aggregation functions applied to multiple variables (all combinations):\n\n\n(DTL |&gt; pivot_wider(\n    id_cols = c(\"id1\", \"id2\"), names_from = \"group\", names_vary = \"slowest\", names_sort = TRUE,\n    values_from = c(\"v1\", \"v2\"), values_fn = \\(x) tibble(\"sum\" = sum(x), \"mean\" = mean(x))\n  ) \n  |&gt; unnest(cols = matches(\"^v1|^v2\"), names_sep = \"_\")\n)\ndata.frame [9 x 10]\n\n\n\n\nid1\n\n\nid2\n\n\nv1_a_sum\n\n\nv1_a_mean\n\n\nv2_a_sum\n\n\nv2_a_mean\n\n\nv1_b_sum\n\n\nv1_b_mean\n\n\nv2_b_sum\n\n\nv2_b_mean\n\n\n\n\n\n1\n\n\n2\n\n\n1.336\n\n\n0.668\n\n\n2\n\n\n1\n\n\n0.841\n\n\n0.841\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n1\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n0.667\n\n\n0.334\n\n\n2\n\n\n1\n\n\n\n\n2\n\n\n1\n\n\n2.46\n\n\n0.492\n\n\n5\n\n\n1\n\n\n0.793\n\n\n0.793\n\n\n1\n\n\n1\n\n\n\n\n3\n\n\n2\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n1.353\n\n\n0.676\n\n\n2\n\n\n1\n\n\n\n\n3\n\n\n1\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n0.58\n\n\n0.58\n\n\n1\n\n\n1\n\n\n\n\n1\n\n\n1\n\n\n0.03\n\n\n0.03\n\n\n1\n\n\n1\n\n\n0.723\n\n\n0.723\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n2\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n0.266\n\n\n0.266\n\n\n1\n\n\n1\n\n\n\n\n5\n\n\n2\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n0.998\n\n\n0.499\n\n\n2\n\n\n1\n\n\n\n\n2\n\n\n2\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n0.889\n\n\n0.889\n\n\n1\n\n\n1\n\n\n\n\n\n\n\n\n\nMultiple aggregation functions applied to multiple variables (one-to-one):\n\n\n# Not possible with pivot_wider AFAIK\n\n\n\n\nMultiple aggregation functions applied to one variable:\n\n\ndcast(DTL, id1 + id2 ~ group, fun = list(sum, mean), value.var = \"v1\")\ndata.table [9 x 6]\n\n\n\n\nid1\n\n\nid2\n\n\nv1_sum_a\n\n\nv1_sum_b\n\n\nv1_mean_a\n\n\nv1_mean_b\n\n\n\n\n\n1\n\n\n1\n\n\n0.03\n\n\n0.723\n\n\n0.03\n\n\n0.723\n\n\n\n\n1\n\n\n2\n\n\n1.336\n\n\n0.841\n\n\n0.668\n\n\n0.841\n\n\n\n\n2\n\n\n1\n\n\n2.46\n\n\n0.793\n\n\n0.492\n\n\n0.793\n\n\n\n\n2\n\n\n2\n\n\n0\n\n\n0.889\n\n\nNaN\n\n\n0.889\n\n\n\n\n3\n\n\n1\n\n\n0\n\n\n0.58\n\n\nNaN\n\n\n0.58\n\n\n\n\n3\n\n\n2\n\n\n0\n\n\n1.353\n\n\nNaN\n\n\n0.676\n\n\n\n\n4\n\n\n1\n\n\n0\n\n\n0.667\n\n\nNaN\n\n\n0.334\n\n\n\n\n4\n\n\n2\n\n\n0\n\n\n0.266\n\n\nNaN\n\n\n0.266\n\n\n\n\n5\n\n\n2\n\n\n0\n\n\n0.998\n\n\nNaN\n\n\n0.499\n\n\n\n\n\n\n\n\n\n\nMultiple aggregation functions applied to multiple variables (all combinations):\n\n\ndcast(DTL, id1 + id2 ~ group, fun = list(sum, mean), value.var = c(\"v1\", \"v2\"))\ndata.table [9 x 10]\n\n\n\n\nid1\n\n\nid2\n\n\nv1_sum_a\n\n\nv1_sum_b\n\n\nv2_sum_a\n\n\nv2_sum_b\n\n\nv1_mean_a\n\n\nv1_mean_b\n\n\nv2_mean_a\n\n\nv2_mean_b\n\n\n\n\n\n1\n\n\n1\n\n\n0.03\n\n\n0.723\n\n\n1\n\n\n1\n\n\n0.03\n\n\n0.723\n\n\n1\n\n\n1\n\n\n\n\n1\n\n\n2\n\n\n1.336\n\n\n0.841\n\n\n2\n\n\n1\n\n\n0.668\n\n\n0.841\n\n\n1\n\n\n1\n\n\n\n\n2\n\n\n1\n\n\n2.46\n\n\n0.793\n\n\n5\n\n\n1\n\n\n0.492\n\n\n0.793\n\n\n1\n\n\n1\n\n\n\n\n2\n\n\n2\n\n\n0\n\n\n0.889\n\n\n0\n\n\n1\n\n\nNaN\n\n\n0.889\n\n\nNaN\n\n\n1\n\n\n\n\n3\n\n\n1\n\n\n0\n\n\n0.58\n\n\n0\n\n\n1\n\n\nNaN\n\n\n0.58\n\n\nNaN\n\n\n1\n\n\n\n\n3\n\n\n2\n\n\n0\n\n\n1.353\n\n\n0\n\n\n2\n\n\nNaN\n\n\n0.676\n\n\nNaN\n\n\n1\n\n\n\n\n4\n\n\n1\n\n\n0\n\n\n0.667\n\n\n0\n\n\n2\n\n\nNaN\n\n\n0.334\n\n\nNaN\n\n\n1\n\n\n\n\n4\n\n\n2\n\n\n0\n\n\n0.266\n\n\n0\n\n\n1\n\n\nNaN\n\n\n0.266\n\n\nNaN\n\n\n1\n\n\n\n\n5\n\n\n2\n\n\n0\n\n\n0.998\n\n\n0\n\n\n2\n\n\nNaN\n\n\n0.499\n\n\nNaN\n\n\n1\n\n\n\n\n\n\n\n\n\n\nMultiple aggregation functions applied to multiple variables (one-to-one):\n\nHere, we apply sum to v1 (for both group a & b), and mean to v2 (for both group a & b)\n\ndcast(DTL, id1 + id2 ~ group, fun = list(sum, mean), value.var = list(\"v1\", \"v2\"))\ndata.table [9 x 6]\n\n\n\n\nid1\n\n\nid2\n\n\nv1_sum_a\n\n\nv1_sum_b\n\n\nv2_mean_a\n\n\nv2_mean_b\n\n\n\n\n\n1\n\n\n1\n\n\n0.03\n\n\n0.723\n\n\n1\n\n\n1\n\n\n\n\n1\n\n\n2\n\n\n1.336\n\n\n0.841\n\n\n1\n\n\n1\n\n\n\n\n2\n\n\n1\n\n\n2.46\n\n\n0.793\n\n\n1\n\n\n1\n\n\n\n\n2\n\n\n2\n\n\n0\n\n\n0.889\n\n\nNaN\n\n\n1\n\n\n\n\n3\n\n\n1\n\n\n0\n\n\n0.58\n\n\nNaN\n\n\n1\n\n\n\n\n3\n\n\n2\n\n\n0\n\n\n1.353\n\n\nNaN\n\n\n1\n\n\n\n\n4\n\n\n1\n\n\n0\n\n\n0.667\n\n\nNaN\n\n\n1\n\n\n\n\n4\n\n\n2\n\n\n0\n\n\n0.266\n\n\nNaN\n\n\n1\n\n\n\n\n5\n\n\n2\n\n\n0\n\n\n0.998\n\n\nNaN\n\n\n1\n\n\n\n\n\n\n\n\n\n\n\n2.2.6 One-hot encoding\nMaking each level of a variable into a presence/absence column:\n\nmovies_long\ndata.frame [6 x 3]\n\n\n\n\nID\n\n\nGenre\n\n\nOtherCol\n\n\n\n\n\n1\n\n\naction\n\n\n0.122\n\n\n\n\n2\n\n\naction\n\n\n0.943\n\n\n\n\n2\n\n\nadventure\n\n\n0.092\n\n\n\n\n3\n\n\naction\n\n\n0.806\n\n\n\n\n3\n\n\nadventure\n\n\n0.049\n\n\n\n\n3\n\n\nanimation\n\n\n0.97\n\n\n\n\n\n\n\n\n\nTidyverse\ndata.table\n\n\n\n\npivot_wider(\n  movies_long, names_from = \"Genre\", values_from = \"Genre\", \n  values_fn = \\(x) !is.na(x), values_fill = FALSE\n)\ndata.frame [6 x 5]\n\n\n\n\nID\n\n\nOtherCol\n\n\naction\n\n\nadventure\n\n\nanimation\n\n\n\n\n\n1\n\n\n0.122\n\n\nTRUE\n\n\nFALSE\n\n\nFALSE\n\n\n\n\n2\n\n\n0.943\n\n\nTRUE\n\n\nFALSE\n\n\nFALSE\n\n\n\n\n2\n\n\n0.092\n\n\nFALSE\n\n\nTRUE\n\n\nFALSE\n\n\n\n\n3\n\n\n0.806\n\n\nTRUE\n\n\nFALSE\n\n\nFALSE\n\n\n\n\n3\n\n\n0.049\n\n\nFALSE\n\n\nTRUE\n\n\nFALSE\n\n\n\n\n3\n\n\n0.97\n\n\nFALSE\n\n\nFALSE\n\n\nTRUE\n\n\n\n\n\n\n\n\n\n\ndcast(MOVIES_LONG, ... ~ Genre, value.var = \"Genre\", fun = \\(x) !is.na(x), fill = FALSE)\ndata.table [6 x 5]\n\n\n\n\nID\n\n\nOtherCol\n\n\naction\n\n\nadventure\n\n\nanimation\n\n\n\n\n\n1\n\n\n0.122\n\n\nTRUE\n\n\nFALSE\n\n\nFALSE\n\n\n\n\n2\n\n\n0.092\n\n\nFALSE\n\n\nTRUE\n\n\nFALSE\n\n\n\n\n2\n\n\n0.943\n\n\nTRUE\n\n\nFALSE\n\n\nFALSE\n\n\n\n\n3\n\n\n0.049\n\n\nFALSE\n\n\nTRUE\n\n\nFALSE\n\n\n\n\n3\n\n\n0.806\n\n\nTRUE\n\n\nFALSE\n\n\nFALSE\n\n\n\n\n3\n\n\n0.97\n\n\nFALSE\n\n\nFALSE\n\n\nTRUE"
  },
  {
    "objectID": "content/blog/posts/data.table/index.html#mutating-joins",
    "href": "content/blog/posts/data.table/index.html#mutating-joins",
    "title": "Data wrangling with data.table and the Tidyverse",
    "section": "\n3.1 Mutating Joins",
    "text": "3.1 Mutating Joins\nThe purpose of mutating joins is to add columns/information from one table to another, by matching their rows.\nData:\n\n(CITIES &lt;- as.data.table(cities))\ndata.table [10 x 3]\n\n\n\n\ncity_id\n\n\ncity\n\n\ncountry_id\n\n\n\n\n\n1\n\n\nBarcelona\n\n\n9\n\n\n\n\n2\n\n\nBergen\n\n\n8\n\n\n\n\n3\n\n\nBern\n\n\n10\n\n\n\n\n4\n\n\nHelsinki\n\n\n4\n\n\n\n\n5\n\n\nLinz\n\n\n1\n\n\n\n\n6\n\n\nPunaauia\n\n\n6\n\n\n\n\n7\n\n\nQueenstown\n\n\n7\n\n\n\n\n8\n\n\nRouen\n\n\n5\n\n\n\n\n9\n\n\nSosua\n\n\n3\n\n\n\n\n10\n\n\nTrondheim\n\n\n8\n\n\n\n\n\n(COUNTRIES &lt;- as.data.table(countries))\ndata.table [9 x 2]\n\n\n\n\ncountry_id\n\n\ncountry\n\n\n\n\n\n1\n\n\nAustria\n\n\n\n\n2\n\n\nCanada\n\n\n\n\n3\n\n\nDominican Republic\n\n\n\n\n4\n\n\nFinland\n\n\n\n\n5\n\n\nFrance\n\n\n\n\n6\n\n\nFrench Polynesia\n\n\n\n\n7\n\n\nNew-Zealand\n\n\n\n\n8\n\n\nNorway\n\n\n\n\n9\n\n\nSpain\n\n\n\n\n\n\n\n\n3.1.1 Left/Right Join\nBoth left & right joins append the columns of one table to those of another, in the order they are given (i.e. columns of the first table will appear first in the result). However, how rows are matched (and how the ones not finding a match are handled) depends on the type of join:\n- Left joins match on the rows of the first (left) table. Unmatched rows from the left table will be kept, but not the right’s.\n- Right joins match on the rows of the second (right) table. Unmatched rows from the right table will be kept, but not the left’s.\n\n\n\n\n\n\nTipExample\n\n\n\nTo find out which country each city belongs to, we’re going to merge countries into cities.\nHere, we want to add data to the cities table by matching each city to a country (by their country_id). The ideal output would have the columns of cities first, and keep all rows from cities, even if unmatched: thus we will use a left join.\n\n\n\nAs a left join:\n\n\n\nTidyverse\ndata.table\n\n\n\n\nleft_join(cities, countries, by = \"country_id\", multiple = \"all\")\ndata.frame [10 x 4]\n\n\n\n\ncity_id\n\n\ncity\n\n\ncountry_id\n\n\ncountry\n\n\n\n\n\n1\n\n\nBarcelona\n\n\n9\n\n\nSpain\n\n\n\n\n2\n\n\nBergen\n\n\n8\n\n\nNorway\n\n\n\n\n3\n\n\nBern\n\n\n10\n\n\nNA\n\n\n\n\n4\n\n\nHelsinki\n\n\n4\n\n\nFinland\n\n\n\n\n5\n\n\nLinz\n\n\n1\n\n\nAustria\n\n\n\n\n6\n\n\nPunaauia\n\n\n6\n\n\nFrench Polynesia\n\n\n\n\n7\n\n\nQueenstown\n\n\n7\n\n\nNew-Zealand\n\n\n\n\n8\n\n\nRouen\n\n\n5\n\n\nFrance\n\n\n\n\n9\n\n\nSosua\n\n\n3\n\n\nDominican Republic\n\n\n\n\n10\n\n\nTrondheim\n\n\n8\n\n\nNorway\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWarningdata.table natively only supports right joins\n\n\n\nIt filters the rows of the first table by those of the second (FIRST[SECOND]), but only keeps the unmatched rows from the second table.\n\nThe normal output of the joinCITIES[COUNTRIES, on = .(country_id)]\ndata.table [10 x 4]\n\n\n\n\ncity_id\n\n\ncity\n\n\ncountry_id\n\n\ncountry\n\n\n\n\n\n5\n\n\nLinz\n\n\n1\n\n\nAustria\n\n\n\n\nNA\n\n\nNA\n\n\n2\n\n\nCanada\n\n\n\n\n9\n\n\nSosua\n\n\n3\n\n\nDominican Republic\n\n\n\n\n4\n\n\nHelsinki\n\n\n4\n\n\nFinland\n\n\n\n\n8\n\n\nRouen\n\n\n5\n\n\nFrance\n\n\n\n\n6\n\n\nPunaauia\n\n\n6\n\n\nFrench Polynesia\n\n\n\n\n7\n\n\nQueenstown\n\n\n7\n\n\nNew-Zealand\n\n\n\n\n2\n\n\nBergen\n\n\n8\n\n\nNorway\n\n\n\n\n10\n\n\nTrondheim\n\n\n8\n\n\nNorway\n\n\n\n\n1\n\n\nBarcelona\n\n\n9\n\n\nSpain\n\n\n\n\n\n\n\nThe unmatched rows from countries were kept, but not the ones from cities. Here are two possible workarounds:\n\n\nInverting the two tables (countries first), and then inverting the order of the columns in the result:\n\nCOUNTRIES[CITIES, .(city_id, city, country_id, country), on = .(country_id)]\ndata.table [10 x 4]\n\n\n\n\ncity_id\n\n\ncity\n\n\ncountry_id\n\n\ncountry\n\n\n\n\n\n1\n\n\nBarcelona\n\n\n9\n\n\nSpain\n\n\n\n\n2\n\n\nBergen\n\n\n8\n\n\nNorway\n\n\n\n\n3\n\n\nBern\n\n\n10\n\n\nNA\n\n\n\n\n4\n\n\nHelsinki\n\n\n4\n\n\nFinland\n\n\n\n\n5\n\n\nLinz\n\n\n1\n\n\nAustria\n\n\n\n\n6\n\n\nPunaauia\n\n\n6\n\n\nFrench Polynesia\n\n\n\n\n7\n\n\nQueenstown\n\n\n7\n\n\nNew-Zealand\n\n\n\n\n8\n\n\nRouen\n\n\n5\n\n\nFrance\n\n\n\n\n9\n\n\nSosua\n\n\n3\n\n\nDominican Republic\n\n\n\n\n10\n\n\nTrondheim\n\n\n8\n\n\nNorway\n\n\n\n\n\n\n\nAdding the columns of countries (in-place) to cities during the join:\n\ncopy(CITIES)[COUNTRIES, c(\"country_id\", \"country\") := list(i.country_id, i.country), on = .(country_id)][]\ndata.table [10 x 4]\n\n\n\n\ncity_id\n\n\ncity\n\n\ncountry_id\n\n\ncountry\n\n\n\n\n\n1\n\n\nBarcelona\n\n\n9\n\n\nSpain\n\n\n\n\n2\n\n\nBergen\n\n\n8\n\n\nNorway\n\n\n\n\n3\n\n\nBern\n\n\n10\n\n\nNA\n\n\n\n\n4\n\n\nHelsinki\n\n\n4\n\n\nFinland\n\n\n\n\n5\n\n\nLinz\n\n\n1\n\n\nAustria\n\n\n\n\n6\n\n\nPunaauia\n\n\n6\n\n\nFrench Polynesia\n\n\n\n\n7\n\n\nQueenstown\n\n\n7\n\n\nNew-Zealand\n\n\n\n\n8\n\n\nRouen\n\n\n5\n\n\nFrance\n\n\n\n\n9\n\n\nSosua\n\n\n3\n\n\nDominican Republic\n\n\n\n\n10\n\n\nTrondheim\n\n\n8\n\n\nNorway\n\n\n\n\n\n\n\n\n\n\nWe could accomplish a similar result with a right join by inverting the order of appearance of the columns. But the order of the columns in the result will be less ideal (countries first):\n\nAs a right join:\n\n\n\n\nTidyverse\ndata.table\n\n\n\n\nright_join(countries, cities, by = \"country_id\", multiple = \"all\")\ndata.frame [10 x 4]\n\n\n\n\ncountry_id\n\n\ncountry\n\n\ncity_id\n\n\ncity\n\n\n\n\n\n1\n\n\nAustria\n\n\n5\n\n\nLinz\n\n\n\n\n3\n\n\nDominican Republic\n\n\n9\n\n\nSosua\n\n\n\n\n4\n\n\nFinland\n\n\n4\n\n\nHelsinki\n\n\n\n\n5\n\n\nFrance\n\n\n8\n\n\nRouen\n\n\n\n\n6\n\n\nFrench Polynesia\n\n\n6\n\n\nPunaauia\n\n\n\n\n7\n\n\nNew-Zealand\n\n\n7\n\n\nQueenstown\n\n\n\n\n8\n\n\nNorway\n\n\n2\n\n\nBergen\n\n\n\n\n8\n\n\nNorway\n\n\n10\n\n\nTrondheim\n\n\n\n\n9\n\n\nSpain\n\n\n1\n\n\nBarcelona\n\n\n\n\n10\n\n\nNA\n\n\n3\n\n\nBern\n\n\n\n\n\n\n\n\n\n\nCOUNTRIES[CITIES, on = .(country_id)][order(country_id)]\ndata.table [10 x 4]\n\n\n\n\ncountry_id\n\n\ncountry\n\n\ncity_id\n\n\ncity\n\n\n\n\n\n1\n\n\nAustria\n\n\n5\n\n\nLinz\n\n\n\n\n3\n\n\nDominican Republic\n\n\n9\n\n\nSosua\n\n\n\n\n4\n\n\nFinland\n\n\n4\n\n\nHelsinki\n\n\n\n\n5\n\n\nFrance\n\n\n8\n\n\nRouen\n\n\n\n\n6\n\n\nFrench Polynesia\n\n\n6\n\n\nPunaauia\n\n\n\n\n7\n\n\nNew-Zealand\n\n\n7\n\n\nQueenstown\n\n\n\n\n8\n\n\nNorway\n\n\n2\n\n\nBergen\n\n\n\n\n8\n\n\nNorway\n\n\n10\n\n\nTrondheim\n\n\n\n\n9\n\n\nSpain\n\n\n1\n\n\nBarcelona\n\n\n\n\n10\n\n\nNA\n\n\n3\n\n\nBern\n\n\n\n\n\n\n\n\n\n\n\n3.1.2 Full Join\nFully merges the two tables, keeping the unmatched rows from both tables.\n\n\nTidyverse\ndata.table\n\n\n\n\nfull_join(cities, countries, by = join_by(country_id))\ndata.frame [11 x 4]\n\n\n\n\ncity_id\n\n\ncity\n\n\ncountry_id\n\n\ncountry\n\n\n\n\n\n1\n\n\nBarcelona\n\n\n9\n\n\nSpain\n\n\n\n\n2\n\n\nBergen\n\n\n8\n\n\nNorway\n\n\n\n\n3\n\n\nBern\n\n\n10\n\n\nNA\n\n\n\n\n4\n\n\nHelsinki\n\n\n4\n\n\nFinland\n\n\n\n\n5\n\n\nLinz\n\n\n1\n\n\nAustria\n\n\n\n\n6\n\n\nPunaauia\n\n\n6\n\n\nFrench Polynesia\n\n\n\n\n7\n\n\nQueenstown\n\n\n7\n\n\nNew-Zealand\n\n\n\n\n8\n\n\nRouen\n\n\n5\n\n\nFrance\n\n\n\n\n9\n\n\nSosua\n\n\n3\n\n\nDominican Republic\n\n\n\n\n10\n\n\nTrondheim\n\n\n8\n\n\nNorway\n\n\n\n\nNA\n\n\nNA\n\n\n2\n\n\nCanada\n\n\n\n\n\n\n\n\n\n\nmerge(CITIES, COUNTRIES, by = \"country_id\", all = TRUE)[order(city_id), .(city_id, city, country_id, country)]\ndata.table [11 x 4]\n\n\n\n\ncity_id\n\n\ncity\n\n\ncountry_id\n\n\ncountry\n\n\n\n\n\n1\n\n\nBarcelona\n\n\n9\n\n\nSpain\n\n\n\n\n2\n\n\nBergen\n\n\n8\n\n\nNorway\n\n\n\n\n3\n\n\nBern\n\n\n10\n\n\nNA\n\n\n\n\n4\n\n\nHelsinki\n\n\n4\n\n\nFinland\n\n\n\n\n5\n\n\nLinz\n\n\n1\n\n\nAustria\n\n\n\n\n6\n\n\nPunaauia\n\n\n6\n\n\nFrench Polynesia\n\n\n\n\n7\n\n\nQueenstown\n\n\n7\n\n\nNew-Zealand\n\n\n\n\n8\n\n\nRouen\n\n\n5\n\n\nFrance\n\n\n\n\n9\n\n\nSosua\n\n\n3\n\n\nDominican Republic\n\n\n\n\n10\n\n\nTrondheim\n\n\n8\n\n\nNorway\n\n\n\n\nNA\n\n\nNA\n\n\n2\n\n\nCanada\n\n\n\n\n\n\n\n\n\n\n\n3.1.3 Cross Join\nGenerating all combinations of the IDs of both tables.\n\n\nTidyverse\ndata.table\n\n\n\n\ncross_join(select(cities, city), select(countries, country))\ndata.frame [90 x 2]\n\n\n\n\ncity\n\n\ncountry\n\n\n\n\n\nBarcelona\n\n\nAustria\n\n\n\n\nBarcelona\n\n\nCanada\n\n\n\n\nBarcelona\n\n\nDominican Republic\n\n\n\n\nBarcelona\n\n\nFinland\n\n\n\n\nBarcelona\n\n\nFrance\n\n\n\n\nBarcelona\n\n\nFrench Polynesia\n\n\n\n\nBarcelona\n\n\nNew-Zealand\n\n\n\n\nBarcelona\n\n\nNorway\n\n\n\n\nBarcelona\n\n\nSpain\n\n\n\n\nBergen\n\n\nAustria\n\n\n\n\nBergen\n\n\nCanada\n\n\n\n\nBergen\n\n\nDominican Republic\n\n\n\n\nBergen\n\n\nFinland\n\n\n\n\nBergen\n\n\nFrance\n\n\n\n\nBergen\n\n\nFrench Polynesia\n\n\n\n\n\n[ omitted 75 entries ]\n\n\n\n\n\n\n\n\n\nCJ(city = CITIES[, city], country = COUNTRIES[, country])\ndata.table [90 x 2]\n\n\n\n\ncity\n\n\ncountry\n\n\n\n\n\nBarcelona\n\n\nAustria\n\n\n\n\nBarcelona\n\n\nCanada\n\n\n\n\nBarcelona\n\n\nDominican Republic\n\n\n\n\nBarcelona\n\n\nFinland\n\n\n\n\nBarcelona\n\n\nFrance\n\n\n\n\nBarcelona\n\n\nFrench Polynesia\n\n\n\n\nBarcelona\n\n\nNew-Zealand\n\n\n\n\nBarcelona\n\n\nNorway\n\n\n\n\nBarcelona\n\n\nSpain\n\n\n\n\nBergen\n\n\nAustria\n\n\n\n\nBergen\n\n\nCanada\n\n\n\n\nBergen\n\n\nDominican Republic\n\n\n\n\nBergen\n\n\nFinland\n\n\n\n\nBergen\n\n\nFrance\n\n\n\n\nBergen\n\n\nFrench Polynesia\n\n\n\n\n\n[ omitted 75 entries ]\n\n\n\n\n\n\n\n\n\n\n3.1.4 Inner Join\nMerges the columns of both tables and only returns the rows that matched between both tables (no unmatched rows are kept).\n\n\nTidyverse\ndata.table\n\n\n\n\ninner_join(countries, cities, by = \"country_id\", multiple = \"all\")\ndata.frame [9 x 4]\n\n\n\n\ncountry_id\n\n\ncountry\n\n\ncity_id\n\n\ncity\n\n\n\n\n\n1\n\n\nAustria\n\n\n5\n\n\nLinz\n\n\n\n\n3\n\n\nDominican Republic\n\n\n9\n\n\nSosua\n\n\n\n\n4\n\n\nFinland\n\n\n4\n\n\nHelsinki\n\n\n\n\n5\n\n\nFrance\n\n\n8\n\n\nRouen\n\n\n\n\n6\n\n\nFrench Polynesia\n\n\n6\n\n\nPunaauia\n\n\n\n\n7\n\n\nNew-Zealand\n\n\n7\n\n\nQueenstown\n\n\n\n\n8\n\n\nNorway\n\n\n2\n\n\nBergen\n\n\n\n\n8\n\n\nNorway\n\n\n10\n\n\nTrondheim\n\n\n\n\n9\n\n\nSpain\n\n\n1\n\n\nBarcelona\n\n\n\n\n\n\n\n\n\n\nCOUNTRIES[CITIES, on = .(country_id), nomatch = NULL]\ndata.table [9 x 4]\n\n\n\n\ncountry_id\n\n\ncountry\n\n\ncity_id\n\n\ncity\n\n\n\n\n\n9\n\n\nSpain\n\n\n1\n\n\nBarcelona\n\n\n\n\n8\n\n\nNorway\n\n\n2\n\n\nBergen\n\n\n\n\n4\n\n\nFinland\n\n\n4\n\n\nHelsinki\n\n\n\n\n1\n\n\nAustria\n\n\n5\n\n\nLinz\n\n\n\n\n6\n\n\nFrench Polynesia\n\n\n6\n\n\nPunaauia\n\n\n\n\n7\n\n\nNew-Zealand\n\n\n7\n\n\nQueenstown\n\n\n\n\n5\n\n\nFrance\n\n\n8\n\n\nRouen\n\n\n\n\n3\n\n\nDominican Republic\n\n\n9\n\n\nSosua\n\n\n\n\n8\n\n\nNorway\n\n\n10\n\n\nTrondheim\n\n\n\n\n\n\n\n\n\n\n\n3.1.5 Self join\nMerging the table with itself. Typically used on graph-type data represented as a flat table (e.g. hierarchies).\nData:\n\ndata.frame [5 x 4]\n\n\n\n\nid\n\n\nfirst_name\n\n\nlast_name\n\n\nmanager_id\n\n\n\n\n\n1\n\n\nMaisy\n\n\nBloom\n\n\nNA\n\n\n\n\n2\n\n\nCaine\n\n\nFarrow\n\n\n1\n\n\n\n\n3\n\n\nWaqar\n\n\nJarvis\n\n\n2\n\n\n\n\n4\n\n\nLacey-Mai\n\n\nRahman\n\n\n2\n\n\n\n\n5\n\n\nMerryn\n\n\nFrench\n\n\n3\n\n\n\n\n\n\n\nThe goal here is to find the identity of everyone’s n+1 by merging the table on itself:\n\n\nTidyverse\ndata.table\n\n\n\n\nleft_join(hiera, hiera, by = join_by(manager_id == id))\ndata.frame [5 x 7]\n\n\n\n\nid\n\n\nfirst_name.x\n\n\nlast_name.x\n\n\nmanager_id\n\n\nfirst_name.y\n\n\nlast_name.y\n\n\nmanager_id.y\n\n\n\n\n\n1\n\n\nMaisy\n\n\nBloom\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n\n\n2\n\n\nCaine\n\n\nFarrow\n\n\n1\n\n\nMaisy\n\n\nBloom\n\n\nNA\n\n\n\n\n3\n\n\nWaqar\n\n\nJarvis\n\n\n2\n\n\nCaine\n\n\nFarrow\n\n\n1\n\n\n\n\n4\n\n\nLacey-Mai\n\n\nRahman\n\n\n2\n\n\nCaine\n\n\nFarrow\n\n\n1\n\n\n\n\n5\n\n\nMerryn\n\n\nFrench\n\n\n3\n\n\nWaqar\n\n\nJarvis\n\n\n2\n\n\n\n\n\n\n\n\n\n\nHIERA[HIERA, on = .(manager_id = id), nomatch = NULL]\ndata.table [4 x 7]\n\n\n\n\nid\n\n\nfirst_name\n\n\nlast_name\n\n\nmanager_id\n\n\ni.first_name\n\n\ni.last_name\n\n\ni.manager_id\n\n\n\n\n\n2\n\n\nCaine\n\n\nFarrow\n\n\n1\n\n\nMaisy\n\n\nBloom\n\n\nNA\n\n\n\n\n3\n\n\nWaqar\n\n\nJarvis\n\n\n2\n\n\nCaine\n\n\nFarrow\n\n\n1\n\n\n\n\n4\n\n\nLacey-Mai\n\n\nRahman\n\n\n2\n\n\nCaine\n\n\nFarrow\n\n\n1\n\n\n\n\n5\n\n\nMerryn\n\n\nFrench\n\n\n3\n\n\nWaqar\n\n\nJarvis\n\n\n2"
  },
  {
    "objectID": "content/blog/posts/data.table/index.html#filtering-joins",
    "href": "content/blog/posts/data.table/index.html#filtering-joins",
    "title": "Data wrangling with data.table and the Tidyverse",
    "section": "\n3.2 Filtering Joins",
    "text": "3.2 Filtering Joins\nUse to filter one table (left) based on another (right): it will only keep the columns from the left table and will either keep (semi join) or discard (anti join) the rows where IDs match between both tables.\n\n3.2.1 Semi join\n\n\n\n\n\n\nNote\n\n\n\nWill give the same result as an inner join, but will only keep the columns of the first table (no information is added).\n\n\nHere, it will filter countries to only keep the countries having a matching country_id in the cities table.\n\n\nTidyverse\ndata.table\n\n\n\n\nsemi_join(countries, cities, by = join_by(country_id))\ndata.frame [8 x 2]\n\n\n\n\ncountry_id\n\n\ncountry\n\n\n\n\n\n1\n\n\nAustria\n\n\n\n\n3\n\n\nDominican Republic\n\n\n\n\n4\n\n\nFinland\n\n\n\n\n5\n\n\nFrance\n\n\n\n\n6\n\n\nFrench Polynesia\n\n\n\n\n7\n\n\nNew-Zealand\n\n\n\n\n8\n\n\nNorway\n\n\n\n\n9\n\n\nSpain\n\n\n\n\n\n\n\n\n\n\nCOUNTRIES[country_id %in% CITIES[, unique(country_id)]]\ndata.table [8 x 2]\n\n\n\n\ncountry_id\n\n\ncountry\n\n\n\n\n\n1\n\n\nAustria\n\n\n\n\n3\n\n\nDominican Republic\n\n\n\n\n4\n\n\nFinland\n\n\n\n\n5\n\n\nFrance\n\n\n\n\n6\n\n\nFrench Polynesia\n\n\n\n\n7\n\n\nNew-Zealand\n\n\n\n\n8\n\n\nNorway\n\n\n\n\n9\n\n\nSpain\n\n\n\n\n\n\n\n\nAlternativesfsetdiff(COUNTRIES, COUNTRIES[!CITIES, on = \"country_id\"])\n\nCOUNTRIES[!eval(COUNTRIES[!CITIES, on = .(country_id)])]\n\n\n\n\n\n\n3.2.2 Anti join\nHere, it will filter countries to only keep the countries having no matching country_id in the cities table.\n\n\nTidyverse\ndata.table\n\n\n\n\nanti_join(countries, cities, by = join_by(country_id))\ndata.frame [1 x 2]\n\n\n\n\ncountry_id\n\n\ncountry\n\n\n\n\n2\n\n\nCanada\n\n\n\n\n\n\n\n\n\nCOUNTRIES[!CITIES, on = .(country_id)]\ndata.table [1 x 2]\n\n\n\n\ncountry_id\n\n\ncountry\n\n\n\n\n2\n\n\nCanada\n\n\n\n\n\n\n\nAlternativesCOUNTRIES[fsetdiff(COUNTRIES[, .(country_id)], CITIES[, .(country_id)])]"
  },
  {
    "objectID": "content/blog/posts/data.table/index.html#non-equi-joins",
    "href": "content/blog/posts/data.table/index.html#non-equi-joins",
    "title": "Data wrangling with data.table and the Tidyverse",
    "section": "\n3.3 Non-equi joins",
    "text": "3.3 Non-equi joins\nNon-equi joins are joins where the the condition to match rows are no longer strict equalities between the tables’ ID columns.\nWe can divide non-equi joins between:\n- Unequality joins: a general unequality condition between IDs, that could result in multiple matches.\n- Rolling joins: only keep the match that minimizes the distance between the IDs (i.e. the closest to perfect equality).\n- Overlap joins: matching to all values within a range.\n\n\n\n\n\n\nTip\n\n\n\nPlease refer to this page of the second edition of R4DS for more detailed explanations.\n\n\nData:\nEvents:\n\ndata.table [3 x 4]\n\n\n\n\ne.id\n\n\nevent\n\n\ne.start\n\n\ne.end\n\n\n\n\n\n1\n\n\nAlice’s graduation\n\n\n2023-06-05 10:00:00\n\n\n2023-06-05 13:00:00\n\n\n\n\n2\n\n\nJohn’s birthday\n\n\n2023-06-05 12:00:00\n\n\n2023-06-05 22:00:00\n\n\n\n\n3\n\n\nAlice & Mark’s wedding\n\n\n2023-06-07 13:00:00\n\n\n2023-06-07 18:00:00\n\n\n\n\n\n\n\nStrikes:\n\ndata.table [4 x 4]\n\n\n\n\ns.id\n\n\nstrike_motive\n\n\ns.start\n\n\ns.end\n\n\n\n\n\n1\n\n\nNot enough cheese\n\n\n2023-06-05 11:00:00\n\n\n2023-06-05 20:00:00\n\n\n\n\n2\n\n\nNot enough wine\n\n\n2023-06-05 14:00:00\n\n\n2023-06-05 16:00:00\n\n\n\n\n3\n\n\nLife’s too expensive\n\n\n2023-06-08 09:00:00\n\n\n2023-06-08 20:00:00\n\n\n\n\n4\n\n\nOur team lost some sport event\n\n\n2023-07-05 16:00:00\n\n\n2023-07-05 22:00:00\n\n\n\n\n\n\n\n\n3.3.1 Unequality join\nInequality joins are joins (left, right, inner, …) that use inequalities (&lt;, &lt;=, &gt;=, or &gt;) to specify the matching criteria.\n\n\n\n\n\n\nWarning\n\n\n\nThe condition has to be a simple inequality between existing columns: it cannot be an arbitrary function (e.g. date.x &lt;= min(date.y) * 2 will not work).\n\n\n\nFor each event, which strikes occurred (finished) before the event ?\n\n\n\nTidyverse\ndata.table\n\n\n\n\ninner_join(events, strikes, join_by(e.start &gt;= s.end))\ndata.frame [2 x 8]\n\n\n\n\ne.id\n\n\nevent\n\n\ne.start\n\n\ne.end\n\n\ns.id\n\n\nstrike_motive\n\n\ns.start\n\n\ns.end\n\n\n\n\n\n3\n\n\nAlice & Mark’s wedding\n\n\n2023-06-07 13:00:00\n\n\n2023-06-07 18:00:00\n\n\n1\n\n\nNot enough cheese\n\n\n2023-06-05 11:00:00\n\n\n2023-06-05 20:00:00\n\n\n\n\n3\n\n\nAlice & Mark’s wedding\n\n\n2023-06-07 13:00:00\n\n\n2023-06-07 18:00:00\n\n\n2\n\n\nNot enough wine\n\n\n2023-06-05 14:00:00\n\n\n2023-06-05 16:00:00\n\n\n\n\n\n\n\n\n\n\nEVENTS[STRIKES, on = .(e.start &gt;= s.end), nomatch = NULL]\ndata.table [2 x 7]\n\n\n\n\ne.id\n\n\nevent\n\n\ne.start\n\n\ne.end\n\n\ns.id\n\n\nstrike_motive\n\n\ns.start\n\n\n\n\n\n3\n\n\nAlice & Mark’s wedding\n\n\n2023-06-05 20:00:00\n\n\n2023-06-07 18:00:00\n\n\n1\n\n\nNot enough cheese\n\n\n2023-06-05 11:00:00\n\n\n\n\n3\n\n\nAlice & Mark’s wedding\n\n\n2023-06-05 16:00:00\n\n\n2023-06-07 18:00:00\n\n\n2\n\n\nNot enough wine\n\n\n2023-06-05 14:00:00\n\n\n\n\n\n\n\n\n\n\n\n\n\nCaution\n\n\n\nWhen specifying an equality or inequality condition, data.table will merge the two columns: only one will remain, with the values of the second column and the name of the first. Here, e.start will have the values of s.end (which will be removed).\nI’m not sure if this is a bug or not.\n\n\n\n\n\n\n\n\n\n\n\nTipA useful use-case for un-equality joins is to avoid duplicates when generating combinations of items in cross joins:\n\n\n\nData:\n\ndata.frame [3 x 2]\n\n\n\n\nid\n\n\nname\n\n\n\n\n\n1\n\n\nAlice\n\n\n\n\n2\n\n\nMark\n\n\n\n\n3\n\n\nJohn\n\n\n\n\n\n\n\n\n\nAll permutations: with duplicates (order matters)\n\ncross_join(people, people)\ndata.frame [9 x 4]\n\n\n\n\nid.x\n\n\nname.x\n\n\nid.y\n\n\nname.y\n\n\n\n\n\n1\n\n\nAlice\n\n\n1\n\n\nAlice\n\n\n\n\n1\n\n\nAlice\n\n\n2\n\n\nMark\n\n\n\n\n1\n\n\nAlice\n\n\n3\n\n\nJohn\n\n\n\n\n2\n\n\nMark\n\n\n1\n\n\nAlice\n\n\n\n\n2\n\n\nMark\n\n\n2\n\n\nMark\n\n\n\n\n2\n\n\nMark\n\n\n3\n\n\nJohn\n\n\n\n\n3\n\n\nJohn\n\n\n1\n\n\nAlice\n\n\n\n\n3\n\n\nJohn\n\n\n2\n\n\nMark\n\n\n\n\n3\n\n\nJohn\n\n\n3\n\n\nJohn\n\n\n\n\n\n\n\n\n\n\nAll combinations: without duplicates (order doesn’t matter)\n\ninner_join(people, people, join_by(id &lt; id))\ndata.frame [3 x 4]\n\n\n\n\nid.x\n\n\nname.x\n\n\nid.y\n\n\nname.y\n\n\n\n\n\n1\n\n\nAlice\n\n\n2\n\n\nMark\n\n\n\n\n1\n\n\nAlice\n\n\n3\n\n\nJohn\n\n\n\n\n2\n\n\nMark\n\n\n3\n\n\nJohn\n\n\n\n\n\n\n\n\n\n\n\n\n3.3.2 Rolling joins\nRolling joins are a special type of inequality join where instead of getting every row that satisfies the inequality, we get the one where the IDs are the closest to equality.\n\n\nTidyverse\ndata.table\n\n\n\n\nWhich strike started the soonest after the beginning an event ?\n\n\ninner_join(events, strikes, join_by(closest(e.start &lt;= s.start)))\ndata.frame [3 x 8]\n\n\n\n\ne.id\n\n\nevent\n\n\ne.start\n\n\ne.end\n\n\ns.id\n\n\nstrike_motive\n\n\ns.start\n\n\ns.end\n\n\n\n\n\n1\n\n\nAlice’s graduation\n\n\n2023-06-05 10:00:00\n\n\n2023-06-05 13:00:00\n\n\n1\n\n\nNot enough cheese\n\n\n2023-06-05 11:00:00\n\n\n2023-06-05 20:00:00\n\n\n\n\n2\n\n\nJohn’s birthday\n\n\n2023-06-05 12:00:00\n\n\n2023-06-05 22:00:00\n\n\n2\n\n\nNot enough wine\n\n\n2023-06-05 14:00:00\n\n\n2023-06-05 16:00:00\n\n\n\n\n3\n\n\nAlice & Mark’s wedding\n\n\n2023-06-07 13:00:00\n\n\n2023-06-07 18:00:00\n\n\n3\n\n\nLife’s too expensive\n\n\n2023-06-08 09:00:00\n\n\n2023-06-08 20:00:00\n\n\n\n\n\n\n\n\n\nWhich strike ended the soonest before the start an event ?\n\n\ninner_join(events, strikes, join_by(closest(e.start &gt;= s.end)))\ndata.frame [1 x 8]\n\n\n\n\ne.id\n\n\nevent\n\n\ne.start\n\n\ne.end\n\n\ns.id\n\n\nstrike_motive\n\n\ns.start\n\n\ns.end\n\n\n\n\n3\n\n\nAlice & Mark’s wedding\n\n\n2023-06-07 13:00:00\n\n\n2023-06-07 18:00:00\n\n\n1\n\n\nNot enough cheese\n\n\n2023-06-05 11:00:00\n\n\n2023-06-05 20:00:00\n\n\n\n\n\n\n\n\n\nWhich strike started the soonest after the beginning an event ?\n\n\nEVENTS[STRIKES, on = .(e.start == s.start), roll = \"nearest\"\n     ][, .SD[which.min(abs(e.start - e.end))], by = \"e.id\"]\ndata.table [3 x 7]\n\n\n\n\ne.id\n\n\nevent\n\n\ne.start\n\n\ne.end\n\n\ns.id\n\n\nstrike_motive\n\n\ns.end\n\n\n\n\n\n1\n\n\nAlice’s graduation\n\n\n2023-06-05 11:00:00\n\n\n2023-06-05 13:00:00\n\n\n1\n\n\nNot enough cheese\n\n\n2023-06-05 20:00:00\n\n\n\n\n2\n\n\nJohn’s birthday\n\n\n2023-06-05 14:00:00\n\n\n2023-06-05 22:00:00\n\n\n2\n\n\nNot enough wine\n\n\n2023-06-05 16:00:00\n\n\n\n\n3\n\n\nAlice & Mark’s wedding\n\n\n2023-06-08 09:00:00\n\n\n2023-06-07 18:00:00\n\n\n3\n\n\nLife’s too expensive\n\n\n2023-06-08 20:00:00\n\n\n\n\n\n\n\n\n\n\n\n\n\nNote\n\n\n\nUsing the roll argument relaxes the equality constraint of the join (e.start == s.end).\n\n\n\n\nWhich strike ended the soonest before the start an event ?\n\n\nEVENTS[STRIKES, on = .(e.start == s.end), roll = -Inf\n      ][, .SD[which.min(abs(e.start - e.end))], by = \"e.id\"]\ndata.table [1 x 7]\n\n\n\n\ne.id\n\n\nevent\n\n\ne.start\n\n\ne.end\n\n\ns.id\n\n\nstrike_motive\n\n\ns.start\n\n\n\n\n3\n\n\nAlice & Mark’s wedding\n\n\n2023-06-05 20:00:00\n\n\n2023-06-07 18:00:00\n\n\n1\n\n\nNot enough cheese\n\n\n2023-06-05 11:00:00\n\n\n\n\n\n\n\n\n\n\n3.3.3 Overlap joins\n\n\nTidyverse\ndata.table\n\n\n\n\n\n\n\n\n\nNotedplyr helper functions\n\n\n\n\n\ndplyr provides three helper functions to make it easier to work with intervals:\n- between(x, y_min, y_max) &lt;=&gt; x &gt;= y_min, x &lt;= y_max: a value of the first table is within a given range of the second\n- within(x_min, x_max, y_min, y_max) &lt;=&gt; x_min &gt;= y_min, x_max &lt;= y_max: the ranges of the first table are contained within the second’s\n- overlaps(x_min, x_max, y_min, y_max) &lt;=&gt; x_min &lt;= y_max, x_max &gt;= y_min: the two ranges overlap partially or totally, in any direction\n\n\n\n\n\nBetween: Which events had a strike staring in the two hours before the beginning of the event ?\n\n\n\n\n\n\n\nTip\n\n\n\nFirst, we need to create the new “2 hours after the beginning of the event” column since we cannot use arbitrary functions in join_by() (e.g. we cannot do between(s.start, e.start, e.start + hours(2)))\n\n\n\nevents2 &lt;- mutate(events, e.start_minus2 = e.start - hours(2))\n\n\ninner_join(strikes, events2, join_by(between(s.start, e.start_minus2, e.start))) |&gt; \n  select(colnames(events), colnames(strikes)) # Re-ordering the columns\ndata.frame [1 x 8]\n\n\n\n\ne.id\n\n\nevent\n\n\ne.start\n\n\ne.end\n\n\ns.id\n\n\nstrike_motive\n\n\ns.start\n\n\ns.end\n\n\n\n\n2\n\n\nJohn’s birthday\n\n\n2023-06-05 12:00:00\n\n\n2023-06-05 22:00:00\n\n\n1\n\n\nNot enough cheese\n\n\n2023-06-05 11:00:00\n\n\n2023-06-05 20:00:00\n\n\n\n\n\n\n\n\n\n\n\n\nNote\n\n\n\nBy default, the value to match needs to be from the first table, and the range it falls within needs to be from the second table. Depending on the column order we need, this can force us to reorder the columns post-join (as in the above example).\nThis can be alleviated by manually specifying from which table each column comes from, using x$col and y$col (x referring the to first column).\n\n\n\ninner_join(events2, strikes, join_by(between(y$s.start, x$e.start_minus2, x$e.start))) |&gt; \n  select(-e.start_minus2)\ndata.frame [1 x 8]\n\n\n\n\ne.id\n\n\nevent\n\n\ne.start\n\n\ne.end\n\n\ns.id\n\n\nstrike_motive\n\n\ns.start\n\n\ns.end\n\n\n\n\n2\n\n\nJohn’s birthday\n\n\n2023-06-05 12:00:00\n\n\n2023-06-05 22:00:00\n\n\n1\n\n\nNot enough cheese\n\n\n2023-06-05 11:00:00\n\n\n2023-06-05 20:00:00\n\n\n\n\n\n\nManually:\n\ninner_join(events2, strikes, join_by(e.start_minus2 &lt;= s.start, e.start &gt;= s.start)) |&gt; \n  select(-e.start_minus2)\ndata.frame [1 x 8]\n\n\n\n\ne.id\n\n\nevent\n\n\ne.start\n\n\ne.end\n\n\ns.id\n\n\nstrike_motive\n\n\ns.start\n\n\ns.end\n\n\n\n\n2\n\n\nJohn’s birthday\n\n\n2023-06-05 12:00:00\n\n\n2023-06-05 22:00:00\n\n\n1\n\n\nNot enough cheese\n\n\n2023-06-05 11:00:00\n\n\n2023-06-05 20:00:00\n\n\n\n\n\n\n\n\n\nWithin: Which strikes occurred entirely within the period of an event ?\n\n\ninner_join(strikes, events, join_by(within(s.start, s.end, e.start, e.end)), multiple = \"all\") |&gt; \n  select(colnames(events), colnames(strikes)) # Re-ordering the columns\ndata.frame [1 x 8]\n\n\n\n\ne.id\n\n\nevent\n\n\ne.start\n\n\ne.end\n\n\ns.id\n\n\nstrike_motive\n\n\ns.start\n\n\ns.end\n\n\n\n\n2\n\n\nJohn’s birthday\n\n\n2023-06-05 12:00:00\n\n\n2023-06-05 22:00:00\n\n\n2\n\n\nNot enough wine\n\n\n2023-06-05 14:00:00\n\n\n2023-06-05 16:00:00\n\n\n\n\n\n\n\n\n\n\n\n\nNote\n\n\n\nAs before, within() requires the first range to be within the second by default, meaning the first table must be the one with the smaller range. Using x$col and y$col resolves the issue of column order.\n\n\n\ninner_join(events, strikes, join_by(within(y$s.start, y$s.end, x$e.start, x$e.end)), multiple = \"all\")\ndata.frame [1 x 8]\n\n\n\n\ne.id\n\n\nevent\n\n\ne.start\n\n\ne.end\n\n\ns.id\n\n\nstrike_motive\n\n\ns.start\n\n\ns.end\n\n\n\n\n2\n\n\nJohn’s birthday\n\n\n2023-06-05 12:00:00\n\n\n2023-06-05 22:00:00\n\n\n2\n\n\nNot enough wine\n\n\n2023-06-05 14:00:00\n\n\n2023-06-05 16:00:00\n\n\n\n\n\n\nManually:\n\ninner_join(events, strikes, join_by(e.start &lt;= s.start, e.end &gt;= s.end), multiple = \"all\")\ndata.frame [1 x 8]\n\n\n\n\ne.id\n\n\nevent\n\n\ne.start\n\n\ne.end\n\n\ns.id\n\n\nstrike_motive\n\n\ns.start\n\n\ns.end\n\n\n\n\n2\n\n\nJohn’s birthday\n\n\n2023-06-05 12:00:00\n\n\n2023-06-05 22:00:00\n\n\n2\n\n\nNot enough wine\n\n\n2023-06-05 14:00:00\n\n\n2023-06-05 16:00:00\n\n\n\n\n\n\n\n\n\nOverlaps: Which events overlap with each-other ?\n\n\ninner_join(events, events, join_by(e.id &lt; e.id, overlaps(e.start, e.end, e.start, e.end)))\ndata.frame [1 x 8]\n\n\n\n\ne.id.x\n\n\nevent.x\n\n\ne.start.x\n\n\ne.end.x\n\n\ne.id.y\n\n\nevent.y\n\n\ne.start.y\n\n\ne.end.y\n\n\n\n\n1\n\n\nAlice’s graduation\n\n\n2023-06-05 10:00:00\n\n\n2023-06-05 13:00:00\n\n\n2\n\n\nJohn’s birthday\n\n\n2023-06-05 12:00:00\n\n\n2023-06-05 22:00:00\n\n\n\n\n\n\nManually:\n\ninner_join(events, events, join_by(e.id &lt; e.id, e.start &lt;= e.end, e.end &gt;= e.start))\ndata.frame [1 x 8]\n\n\n\n\ne.id.x\n\n\nevent.x\n\n\ne.start.x\n\n\ne.end.x\n\n\ne.id.y\n\n\nevent.y\n\n\ne.start.y\n\n\ne.end.y\n\n\n\n\n1\n\n\nAlice’s graduation\n\n\n2023-06-05 10:00:00\n\n\n2023-06-05 13:00:00\n\n\n2\n\n\nJohn’s birthday\n\n\n2023-06-05 12:00:00\n\n\n2023-06-05 22:00:00\n\n\n\n\n\n\n\n\n\n\n\nBetween: Which events had a strike staring in the two hours before the beginning of the event ?\n\n\ncopy(EVENTS)[, e.start_minus2 := e.start - hours(2)\n           ][STRIKES, on = .(e.start_minus2 &lt;= s.start, e.start &gt;= s.start), nomatch = NULL\n           ][, -\"e.start_minus2\"]\ndata.table [1 x 7]\n\n\n\n\ne.id\n\n\nevent\n\n\ne.start\n\n\ne.end\n\n\ns.id\n\n\nstrike_motive\n\n\ns.end\n\n\n\n\n2\n\n\nJohn’s birthday\n\n\n2023-06-05 11:00:00\n\n\n2023-06-05 22:00:00\n\n\n1\n\n\nNot enough cheese\n\n\n2023-06-05 20:00:00\n\n\n\n\n\n\n\n\n\n\nWithin: Which strikes occurred entirely within the period of an event ?\n\n\nEVENTS[STRIKES, on = .(e.start &lt;= s.start, e.end &gt;= s.end), nomatch = NULL]\ndata.table [1 x 6]\n\n\n\n\ne.id\n\n\nevent\n\n\ne.start\n\n\ne.end\n\n\ns.id\n\n\nstrike_motive\n\n\n\n\n2\n\n\nJohn’s birthday\n\n\n2023-06-05 14:00:00\n\n\n2023-06-05 16:00:00\n\n\n2\n\n\nNot enough wine\n\n\n\n\n\n\n\n\n\n\nOverlaps: Which events overlap with each-other ?\n\n\nEVENTS[EVENTS, on = .(e.id &lt; e.id, e.start &lt;= e.end, e.end &gt;= e.start), nomatch = NULL]\ndata.table [1 x 5]\n\n\n\n\ne.id\n\n\nevent\n\n\ne.start\n\n\ne.end\n\n\ni.event\n\n\n\n\n2\n\n\nAlice’s graduation\n\n\n2023-06-05 22:00:00\n\n\n2023-06-05 12:00:00\n\n\nJohn’s birthday\n\n\n\n\n\n\n\nsetkey(EVENTS, e.start, e.end)\n\nfoverlaps(EVENTS, EVENTS, type = \"any\", mult = \"first\", nomatch = NULL)[e.id != i.e.id]\ndata.table [1 x 8]\n\n\n\n\ne.id\n\n\nevent\n\n\ne.start\n\n\ne.end\n\n\ni.e.id\n\n\ni.event\n\n\ni.e.start\n\n\ni.e.end\n\n\n\n\n1\n\n\nAlice’s graduation\n\n\n2023-06-05 10:00:00\n\n\n2023-06-05 13:00:00\n\n\n2\n\n\nJohn’s birthday\n\n\n2023-06-05 12:00:00\n\n\n2023-06-05 22:00:00"
  },
  {
    "objectID": "content/blog/posts/data.table/index.html#remove-na",
    "href": "content/blog/posts/data.table/index.html#remove-na",
    "title": "Data wrangling with data.table and the Tidyverse",
    "section": "\n4.1 Remove NA",
    "text": "4.1 Remove NA\n\n\nTidyverse\ndata.table\n\n\n\n\ntidyr::drop_na(IRIS, Species)\ndata.table [150 x 5]\n\n\n\n\nSepal.Length\n\n\nSepal.Width\n\n\nPetal.Length\n\n\nPetal.Width\n\n\nSpecies\n\n\n\n\n\n5.1\n\n\n3.5\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.7\n\n\n3.2\n\n\n1.3\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.1\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5\n\n\n3.6\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.9\n\n\n1.7\n\n\n0.4\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.4\n\n\n1.4\n\n\n0.3\n\n\nsetosa\n\n\n\n\n5\n\n\n3.4\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.4\n\n\n2.9\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3.1\n\n\n1.5\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.7\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3.4\n\n\n1.6\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3\n\n\n1.4\n\n\n0.1\n\n\nsetosa\n\n\n\n\n4.3\n\n\n3\n\n\n1.1\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.8\n\n\n4\n\n\n1.2\n\n\n0.2\n\n\nsetosa\n\n\n\n\n\n[ omitted 135 entries ]\n\n\n\n\ntidyr::drop_na(IRIS, matches(\"Sepal\"))\ndata.table [150 x 5]\n\n\n\n\nSepal.Length\n\n\nSepal.Width\n\n\nPetal.Length\n\n\nPetal.Width\n\n\nSpecies\n\n\n\n\n\n5.1\n\n\n3.5\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.7\n\n\n3.2\n\n\n1.3\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.1\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5\n\n\n3.6\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.9\n\n\n1.7\n\n\n0.4\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.4\n\n\n1.4\n\n\n0.3\n\n\nsetosa\n\n\n\n\n5\n\n\n3.4\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.4\n\n\n2.9\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3.1\n\n\n1.5\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.7\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3.4\n\n\n1.6\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3\n\n\n1.4\n\n\n0.1\n\n\nsetosa\n\n\n\n\n4.3\n\n\n3\n\n\n1.1\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.8\n\n\n4\n\n\n1.2\n\n\n0.2\n\n\nsetosa\n\n\n\n\n\n[ omitted 135 entries ]\n\n\n\n\n\n\n\n\n\nna.omit(IRIS, cols = \"Species\")\ndata.table [150 x 5]\n\n\n\n\nSepal.Length\n\n\nSepal.Width\n\n\nPetal.Length\n\n\nPetal.Width\n\n\nSpecies\n\n\n\n\n\n5.1\n\n\n3.5\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.7\n\n\n3.2\n\n\n1.3\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.1\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5\n\n\n3.6\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.9\n\n\n1.7\n\n\n0.4\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.4\n\n\n1.4\n\n\n0.3\n\n\nsetosa\n\n\n\n\n5\n\n\n3.4\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.4\n\n\n2.9\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3.1\n\n\n1.5\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.7\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3.4\n\n\n1.6\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3\n\n\n1.4\n\n\n0.1\n\n\nsetosa\n\n\n\n\n4.3\n\n\n3\n\n\n1.1\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.8\n\n\n4\n\n\n1.2\n\n\n0.2\n\n\nsetosa\n\n\n\n\n\n[ omitted 135 entries ]\n\n\n\n\nna.omit(IRIS, cols = str_subset(colnames(IRIS), \"Sepal\"))\ndata.table [150 x 5]\n\n\n\n\nSepal.Length\n\n\nSepal.Width\n\n\nPetal.Length\n\n\nPetal.Width\n\n\nSpecies\n\n\n\n\n\n5.1\n\n\n3.5\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.7\n\n\n3.2\n\n\n1.3\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.1\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5\n\n\n3.6\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.9\n\n\n1.7\n\n\n0.4\n\n\nsetosa\n\n\n\n\n4.6\n\n\n3.4\n\n\n1.4\n\n\n0.3\n\n\nsetosa\n\n\n\n\n5\n\n\n3.4\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.4\n\n\n2.9\n\n\n1.4\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.9\n\n\n3.1\n\n\n1.5\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.4\n\n\n3.7\n\n\n1.5\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3.4\n\n\n1.6\n\n\n0.2\n\n\nsetosa\n\n\n\n\n4.8\n\n\n3\n\n\n1.4\n\n\n0.1\n\n\nsetosa\n\n\n\n\n4.3\n\n\n3\n\n\n1.1\n\n\n0.1\n\n\nsetosa\n\n\n\n\n5.8\n\n\n4\n\n\n1.2\n\n\n0.2\n\n\nsetosa\n\n\n\n\n\n[ omitted 135 entries ]"
  },
  {
    "objectID": "content/blog/posts/data.table/index.html#unite",
    "href": "content/blog/posts/data.table/index.html#unite",
    "title": "Data wrangling with data.table and the Tidyverse",
    "section": "\n4.2 Unite",
    "text": "4.2 Unite\nCombine multiple columns into a single one:\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |&gt; tidyr::unite(\"x\", gear, carb, sep = \"_\")\ndata.frame [32 x 10]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\nx\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4_4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4_4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4_1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3_1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3_2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3_1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3_4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4_2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4_2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4_4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4_4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3_3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3_3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3_3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3_4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\ncopy(MT)[, x := paste(gear, carb, sep = \"_\")][]\ndata.table [32 x 12]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nx\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n4_4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n4_4\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n4_1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n3_1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n3_2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n3_1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n3_4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4_2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n4_2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n4_4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n4_4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n3_3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n3_3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n3_3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n3_4\n\n\n\n\n\n[ omitted 17 entries ]"
  },
  {
    "objectID": "content/blog/posts/data.table/index.html#separate-extract",
    "href": "content/blog/posts/data.table/index.html#separate-extract",
    "title": "Data wrangling with data.table and the Tidyverse",
    "section": "\n4.3 Separate / Extract",
    "text": "4.3 Separate / Extract\n\n4.3.1 Separate wider (extract)\n\n(MT.ext &lt;- MT[, .(x = str_c(gear, carb, sep = \"_\"))])\ndata.table [32 x 1]\n\n\n\n\nx\n\n\n\n\n\n4_4\n\n\n\n\n4_4\n\n\n\n\n4_1\n\n\n\n\n3_1\n\n\n\n\n3_2\n\n\n\n\n3_1\n\n\n\n\n3_4\n\n\n\n\n4_2\n\n\n\n\n4_2\n\n\n\n\n4_4\n\n\n\n\n4_4\n\n\n\n\n3_3\n\n\n\n\n3_3\n\n\n\n\n3_3\n\n\n\n\n3_4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\nTidyverse\ndata.table\n\n\n\nBased on a delimiter:\n\nMT.ext |&gt; separate_wider_delim(x, delim = \"_\", names = c(\"gear\", \"carb\"))\ndata.frame [32 x 2]\n\n\n\n\ngear\n\n\ncarb\n\n\n\n\n\n4\n\n\n4\n\n\n\n\n4\n\n\n4\n\n\n\n\n4\n\n\n1\n\n\n\n\n3\n\n\n1\n\n\n\n\n3\n\n\n2\n\n\n\n\n3\n\n\n1\n\n\n\n\n3\n\n\n4\n\n\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n\n\n4\n\n\n4\n\n\n\n\n3\n\n\n3\n\n\n\n\n3\n\n\n3\n\n\n\n\n3\n\n\n3\n\n\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\nBased on a regex:\n\nMT.ext |&gt; separate_wider_regex(x, patterns = c(gear = \"\\\\d{1}\", \"_\", carb = \"\\\\d{1}\"))\ndata.frame [32 x 2]\n\n\n\n\ngear\n\n\ncarb\n\n\n\n\n\n4\n\n\n4\n\n\n\n\n4\n\n\n4\n\n\n\n\n4\n\n\n1\n\n\n\n\n3\n\n\n1\n\n\n\n\n3\n\n\n2\n\n\n\n\n3\n\n\n1\n\n\n\n\n3\n\n\n4\n\n\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n\n\n4\n\n\n4\n\n\n\n\n3\n\n\n3\n\n\n\n\n3\n\n\n3\n\n\n\n\n3\n\n\n3\n\n\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\nBased on position:\n\nMT.ext |&gt; separate_wider_position(x, widths  = c(gear = 1, delim = 1, carb = 1))\ndata.frame [32 x 3]\n\n\n\n\ngear\n\n\ndelim\n\n\ncarb\n\n\n\n\n\n4\n\n\n_\n\n\n4\n\n\n\n\n4\n\n\n_\n\n\n4\n\n\n\n\n4\n\n\n_\n\n\n1\n\n\n\n\n3\n\n\n_\n\n\n1\n\n\n\n\n3\n\n\n_\n\n\n2\n\n\n\n\n3\n\n\n_\n\n\n1\n\n\n\n\n3\n\n\n_\n\n\n4\n\n\n\n\n4\n\n\n_\n\n\n2\n\n\n\n\n4\n\n\n_\n\n\n2\n\n\n\n\n4\n\n\n_\n\n\n4\n\n\n\n\n4\n\n\n_\n\n\n4\n\n\n\n\n3\n\n\n_\n\n\n3\n\n\n\n\n3\n\n\n_\n\n\n3\n\n\n\n\n3\n\n\n_\n\n\n3\n\n\n\n\n3\n\n\n_\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\n\n\n\nNote\n\n\n\nseparate_wider_* supersedes both extract and separate.\n\n\n\nOld syntaxtidyr::separate(MT.ext, x, into = c(\"gear\", \"carb\"), sep = \"_\", remove = TRUE)\n\ntidyr::extract(MT.ext, x, into = c(\"gear\", \"carb\"), regex = \"(.*)_(.*)\", remove = TRUE)\n\n\n\n\nBased on a delimiter:\n\ncopy(MT.ext)[, c(\"gear\", \"carb\") := tstrsplit(x, \"_\", fixed = TRUE)][] \ndata.table [32 x 3]\n\n\n\n\nx\n\n\ngear\n\n\ncarb\n\n\n\n\n\n4_4\n\n\n4\n\n\n4\n\n\n\n\n4_4\n\n\n4\n\n\n4\n\n\n\n\n4_1\n\n\n4\n\n\n1\n\n\n\n\n3_1\n\n\n3\n\n\n1\n\n\n\n\n3_2\n\n\n3\n\n\n2\n\n\n\n\n3_1\n\n\n3\n\n\n1\n\n\n\n\n3_4\n\n\n3\n\n\n4\n\n\n\n\n4_2\n\n\n4\n\n\n2\n\n\n\n\n4_2\n\n\n4\n\n\n2\n\n\n\n\n4_4\n\n\n4\n\n\n4\n\n\n\n\n4_4\n\n\n4\n\n\n4\n\n\n\n\n3_3\n\n\n3\n\n\n3\n\n\n\n\n3_3\n\n\n3\n\n\n3\n\n\n\n\n3_3\n\n\n3\n\n\n3\n\n\n\n\n3_4\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\nBased on a regex:\n\ncopy(MT.ext)[, c(\"gear\", \"carb\") := str_extract_all(x, \"\\\\d\") |&gt; list_transpose()][]\ndata.table [32 x 3]\n\n\n\n\nx\n\n\ngear\n\n\ncarb\n\n\n\n\n\n4_4\n\n\n4\n\n\n4\n\n\n\n\n4_4\n\n\n4\n\n\n4\n\n\n\n\n4_1\n\n\n4\n\n\n1\n\n\n\n\n3_1\n\n\n3\n\n\n1\n\n\n\n\n3_2\n\n\n3\n\n\n2\n\n\n\n\n3_1\n\n\n3\n\n\n1\n\n\n\n\n3_4\n\n\n3\n\n\n4\n\n\n\n\n4_2\n\n\n4\n\n\n2\n\n\n\n\n4_2\n\n\n4\n\n\n2\n\n\n\n\n4_4\n\n\n4\n\n\n4\n\n\n\n\n4_4\n\n\n4\n\n\n4\n\n\n\n\n3_3\n\n\n3\n\n\n3\n\n\n\n\n3_3\n\n\n3\n\n\n3\n\n\n\n\n3_3\n\n\n3\n\n\n3\n\n\n\n\n3_4\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\n\n4.3.2 Separate longer/rows\nSeparating a row into multiple rows, duplicating the rest of the values.\nData\n\n(SP &lt;- data.table(\n  val = c(1,\"2,3\",4), \n  date = as.Date(c(\"2020-01-01\", \"2020-01-02\", \"2020-01-03\"), origin = \"1970-01-01\")\n  )\n)\ndata.table [3 x 2]\n\n\n\n\nval\n\n\ndate\n\n\n\n\n\n1\n\n\n2020-01-01\n\n\n\n\n2,3\n\n\n2020-01-02\n\n\n\n\n4\n\n\n2020-01-03\n\n\n\n\n\n\n\n\n\nTidyverse\ndata.table\n\n\n\nBased on a delimiter:\n\nSP |&gt; separate_longer_delim(val, delim = \",\")\ndata.frame [4 x 2]\n\n\n\n\nval\n\n\ndate\n\n\n\n\n\n1\n\n\n2020-01-01\n\n\n\n\n2\n\n\n2020-01-02\n\n\n\n\n3\n\n\n2020-01-02\n\n\n\n\n4\n\n\n2020-01-03\n\n\n\n\n\n\n\nBased on position:\n\nSP |&gt; separate_longer_position(val, width = 1) |&gt; filter(val != \",\")\ndata.frame [4 x 2]\n\n\n\n\nval\n\n\ndate\n\n\n\n\n\n1\n\n\n2020-01-01\n\n\n\n\n2\n\n\n2020-01-02\n\n\n\n\n3\n\n\n2020-01-02\n\n\n\n\n4\n\n\n2020-01-03\n\n\n\n\n\n\n\n\n\n\n\n\n\nWarning\n\n\n\nseparate_longer_* now supersedes separate_rows\n\n\n\nOld syntaxSP |&gt; separate_rows(val, sep = \",\", convert = TRUE)\n\n\n\n\nSolution 1:\n\ncopy(SP)[, c(V1 = strsplit(val, \",\", fixed = TRUE), .SD), by = val][, let(val = V1, V1 = NULL)][]\ndata.table [4 x 2]\n\n\n\n\nval\n\n\ndate\n\n\n\n\n\n1\n\n\n2020-01-01\n\n\n\n\n2\n\n\n2020-01-02\n\n\n\n\n3\n\n\n2020-01-02\n\n\n\n\n4\n\n\n2020-01-03\n\n\n\n\n\n\n\nSolution 2:\n\nSP[, strsplit(val, \",\", fixed = TRUE), by = val][SP, on = \"val\"][, let(val = V1, V1 = NULL)][]\ndata.table [4 x 2]\n\n\n\n\nval\n\n\ndate\n\n\n\n\n\n1\n\n\n2020-01-01\n\n\n\n\n2\n\n\n2020-01-02\n\n\n\n\n3\n\n\n2020-01-02\n\n\n\n\n4\n\n\n2020-01-03\n\n\n\n\n\n\n\nSolution 3:\n(With type conversion)\n\nSP[, unlist(tstrsplit(val, \",\", type.convert = TRUE)), by = val][SP, on = \"val\"][, let(val = V1, V1 = NULL)][]\ndata.table [4 x 2]\n\n\n\n\nval\n\n\ndate\n\n\n\n\n\n1\n\n\n2020-01-01\n\n\n\n\n2\n\n\n2020-01-02\n\n\n\n\n3\n\n\n2020-01-02\n\n\n\n\n4\n\n\n2020-01-03\n\n\n\n\n\n\n\nSolution 4:\n\ncopy(SP)[rep(1:.N, lengths(strsplit(val, \",\")))][, val := strsplit(val, \",\"), by = val][]\ndata.table [4 x 2]\n\n\n\n\nval\n\n\ndate\n\n\n\n\n\n1\n\n\n2020-01-01\n\n\n\n\n2\n\n\n2020-01-02\n\n\n\n\n3\n\n\n2020-01-02\n\n\n\n\n4\n\n\n2020-01-03\n\n\n\n\n\n\n\n(With type conversion)\n\ncopy(SP)[rep(1:.N, lengths(strsplit(val, \",\")))\n       ][, val := strsplit(val, \",\"), by = val\n       ][, val := utils::type.convert(val, as.is = T)][]\ndata.table [4 x 2]\n\n\n\n\nval\n\n\ndate\n\n\n\n\n\n1\n\n\n2020-01-01\n\n\n\n\n2\n\n\n2020-01-02\n\n\n\n\n3\n\n\n2020-01-02\n\n\n\n\n4\n\n\n2020-01-03"
  },
  {
    "objectID": "content/blog/posts/data.table/index.html#duplicates",
    "href": "content/blog/posts/data.table/index.html#duplicates",
    "title": "Data wrangling with data.table and the Tidyverse",
    "section": "\n4.4 Duplicates",
    "text": "4.4 Duplicates\n\n4.4.1 Duplicated rows\n\n4.4.1.1 Only keeping duplicated rows\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |&gt; filter(n() &gt; 1, .by = c(mpg, hp))\ndata.frame [2 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n6\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n\n\n\n\n\n\nMT[, if(.N &gt; 1) .SD, by = .(mpg, hp)]\ndata.table [2 x 11]\n\n\n\n\nmpg\n\n\nhp\n\n\ncyl\n\n\ndisp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n21\n\n\n110\n\n\n6\n\n\n160\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n21\n\n\n110\n\n\n6\n\n\n160\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n\n\n\n\n\n\n\n4.4.1.2 Removing duplicated rows\n\n\n\n\n\n\nNote\n\n\n\nThis is different from distinct/unique, which will keep one of the duplicated rows of each group.\nThis removes all groups which have duplicated rows.\n\n\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |&gt; filter(n() == 1, .by = c(mpg, hp))\ndata.frame [30 x 11]\n\n\n\n\nmpg\n\n\ncyl\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n22.8\n\n\n4\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n6\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n8\n\n\n360\n\n\n175\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n6\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n8\n\n\n360\n\n\n245\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n4\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n6\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n8\n\n\n275.8\n\n\n180\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n8\n\n\n472\n\n\n205\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n10.4\n\n\n8\n\n\n460\n\n\n215\n\n\n3\n\n\n5.424\n\n\n17.82\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.7\n\n\n8\n\n\n440\n\n\n230\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 15 entries ]\n\n\n\n\n\n\n\nAlternatives# More convoluted\n\nmtcars |&gt; filter(n() &gt; 1, .by = c(mpg, hp)) |&gt; anti_join(mtcars, y = _)\n\n\n\n\n\nMT[, if(.N == 1) .SD, by = .(mpg, hp)]\ndata.table [30 x 11]\n\n\n\n\nmpg\n\n\nhp\n\n\ncyl\n\n\ndisp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n22.8\n\n\n93\n\n\n4\n\n\n108\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n21.4\n\n\n110\n\n\n6\n\n\n258\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n18.7\n\n\n175\n\n\n8\n\n\n360\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n3\n\n\n2\n\n\n\n\n18.1\n\n\n105\n\n\n6\n\n\n225\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n14.3\n\n\n245\n\n\n8\n\n\n360\n\n\n3.21\n\n\n3.57\n\n\n15.84\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n24.4\n\n\n62\n\n\n4\n\n\n146.7\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n22.8\n\n\n95\n\n\n4\n\n\n140.8\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n19.2\n\n\n123\n\n\n6\n\n\n167.6\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n17.8\n\n\n123\n\n\n6\n\n\n167.6\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n16.4\n\n\n180\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n4.07\n\n\n17.4\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n17.3\n\n\n180\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3.73\n\n\n17.6\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n15.2\n\n\n180\n\n\n8\n\n\n275.8\n\n\n3.07\n\n\n3.78\n\n\n18\n\n\n0\n\n\n0\n\n\n3\n\n\n3\n\n\n\n\n10.4\n\n\n205\n\n\n8\n\n\n472\n\n\n2.93\n\n\n5.25\n\n\n17.98\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n10.4\n\n\n215\n\n\n8\n\n\n460\n\n\n3\n\n\n5.424\n\n\n17.82\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n14.7\n\n\n230\n\n\n8\n\n\n440\n\n\n3.23\n\n\n5.345\n\n\n17.42\n\n\n0\n\n\n0\n\n\n3\n\n\n4\n\n\n\n\n\n[ omitted 15 entries ]\n\n\n\n\n\n\n\nAlternatives# More convoluted\n\nMT[!MT[, if(.N &gt; 1) .SD, by = .(mpg, hp)], on = colnames(MT)]\n\nfsetdiff(MT, setcolorder(MT[, if(.N &gt; 1) .SD, by = .(mpg, hp)], colnames(MT)))\n\n\n\n\n\n\n4.4.2 Duplicated values (per row)\n\n(DUPED &lt;- data.table(\n    A = c(\"A1\", \"A2\", \"B3\", \"A4\"), \n    B = c(\"B1\", \"B2\", \"B3\", \"B4\"), \n    C = c(\"A1\", \"C2\", \"D3\", \"C4\"), \n    D = c(\"A1\", \"D2\", \"D3\", \"D4\")\n  )\n)\ndata.table [4 x 4]\n\n\n\n\nA\n\n\nB\n\n\nC\n\n\nD\n\n\n\n\n\nA1\n\n\nB1\n\n\nA1\n\n\nA1\n\n\n\n\nA2\n\n\nB2\n\n\nC2\n\n\nD2\n\n\n\n\nB3\n\n\nB3\n\n\nD3\n\n\nD3\n\n\n\n\nA4\n\n\nB4\n\n\nC4\n\n\nD4\n\n\n\n\n\n\n\n\n\nTidyverse\ndata.table\n\n\n\n\nmutate(DUPED, Repeats = apply(\n    pick(everything()), 1, \\(r) r[which(duplicated(r))] |&gt; unique() |&gt; str_c(collapse = \", \")\n  )\n)\ndata.table [4 x 5]\n\n\n\n\nA\n\n\nB\n\n\nC\n\n\nD\n\n\nRepeats\n\n\n\n\n\nA1\n\n\nB1\n\n\nA1\n\n\nA1\n\n\nA1\n\n\n\n\nA2\n\n\nB2\n\n\nC2\n\n\nD2\n\n\n\n\n\n\nB3\n\n\nB3\n\n\nD3\n\n\nD3\n\n\nB3, D3\n\n\n\n\nA4\n\n\nB4\n\n\nC4\n\n\nD4\n\n\n\n\n\n\n\n\n\n\n\n\ncopy(DUPED)[\n  , Repeats := apply(.SD, 1, \\(r) r[which(duplicated(r))] |&gt; unique() |&gt; str_c(collapse = \", \"))\n  ][]\ndata.table [4 x 5]\n\n\n\n\nA\n\n\nB\n\n\nC\n\n\nD\n\n\nRepeats\n\n\n\n\n\nA1\n\n\nB1\n\n\nA1\n\n\nA1\n\n\nA1\n\n\n\n\nA2\n\n\nB2\n\n\nC2\n\n\nD2\n\n\n\n\n\n\nB3\n\n\nB3\n\n\nD3\n\n\nD3\n\n\nB3, D3\n\n\n\n\nA4\n\n\nB4\n\n\nC4\n\n\nD4\n\n\n\n\n\n\n\n\n\n\n\n\nWith duplication counter:\n\ndup_counts &lt;- function(v) {\n  rles &lt;- as.data.table(unclass(rle(v[which(duplicated(v))])))[, lengths := lengths + 1]\n  paste(apply(rles, 1, \\(r) paste0(r[2], \" (\", r[1], \")\")), collapse = \", \")\n}\n\n\n\nTidyverse\ndata.table\n\n\n\n\nDUPED |&gt; mutate(Repeats = apply(pick(everything()), 1, \\(r) dup_counts(r)))\ndata.table [4 x 5]\n\n\n\n\nA\n\n\nB\n\n\nC\n\n\nD\n\n\nRepeats\n\n\n\n\n\nA1\n\n\nB1\n\n\nA1\n\n\nA1\n\n\nA1 (3)\n\n\n\n\nA2\n\n\nB2\n\n\nC2\n\n\nD2\n\n\n\n\n\n\nB3\n\n\nB3\n\n\nD3\n\n\nD3\n\n\nB3 (2), D3 (2)\n\n\n\n\nA4\n\n\nB4\n\n\nC4\n\n\nD4\n\n\n\n\n\n\n\n\n\n\n\n\nDUPED[, Repeats := apply(.SD, 1, \\(r) dup_counts(r))][]\ndata.table [4 x 5]\n\n\n\n\nA\n\n\nB\n\n\nC\n\n\nD\n\n\nRepeats\n\n\n\n\n\nA1\n\n\nB1\n\n\nA1\n\n\nA1\n\n\nA1 (3)\n\n\n\n\nA2\n\n\nB2\n\n\nC2\n\n\nD2\n\n\n\n\n\n\nB3\n\n\nB3\n\n\nD3\n\n\nD3\n\n\nB3 (2), D3 (2)\n\n\n\n\nA4\n\n\nB4\n\n\nC4\n\n\nD4"
  },
  {
    "objectID": "content/blog/posts/data.table/index.html#expand-complete",
    "href": "content/blog/posts/data.table/index.html#expand-complete",
    "title": "Data wrangling with data.table and the Tidyverse",
    "section": "\n4.5 Expand & Complete",
    "text": "4.5 Expand & Complete\nHere, we are missing an entry for person B on year 2010, that we want to fill:\n\n(CAR &lt;- data.table(\n    year = c(2010,2011,2012,2013,2014,2015,2011,2012,2013,2014,2015), \n    person = c(\"A\",\"A\",\"A\",\"A\",\"A\",\"A\", \"B\",\"B\",\"B\",\"B\",\"B\"),\n    car = c(\"BMW\", \"BMW\", \"AUDI\", \"AUDI\", \"AUDI\", \"Mercedes\", \"Citroen\",\"Citroen\", \"Citroen\", \"Toyota\", \"Toyota\")\n  )\n)\ndata.table [11 x 3]\n\n\n\n\nyear\n\n\nperson\n\n\ncar\n\n\n\n\n\n2 010\n\n\nA\n\n\nBMW\n\n\n\n\n2 011\n\n\nA\n\n\nBMW\n\n\n\n\n2 012\n\n\nA\n\n\nAUDI\n\n\n\n\n2 013\n\n\nA\n\n\nAUDI\n\n\n\n\n2 014\n\n\nA\n\n\nAUDI\n\n\n\n\n2 015\n\n\nA\n\n\nMercedes\n\n\n\n\n2 011\n\n\nB\n\n\nCitroen\n\n\n\n\n2 012\n\n\nB\n\n\nCitroen\n\n\n\n\n2 013\n\n\nB\n\n\nCitroen\n\n\n\n\n2 014\n\n\nB\n\n\nToyota\n\n\n\n\n2 015\n\n\nB\n\n\nToyota\n\n\n\n\n\n\n\n\n4.5.1 Expand\n\n\nTidyverse\ndata.table\n\n\n\n\ntidyr::expand(CAR, person, year)\ndata.frame [12 x 2]\n\n\n\n\nperson\n\n\nyear\n\n\n\n\n\nA\n\n\n2 010\n\n\n\n\nA\n\n\n2 011\n\n\n\n\nA\n\n\n2 012\n\n\n\n\nA\n\n\n2 013\n\n\n\n\nA\n\n\n2 014\n\n\n\n\nA\n\n\n2 015\n\n\n\n\nB\n\n\n2 010\n\n\n\n\nB\n\n\n2 011\n\n\n\n\nB\n\n\n2 012\n\n\n\n\nB\n\n\n2 013\n\n\n\n\nB\n\n\n2 014\n\n\n\n\nB\n\n\n2 015\n\n\n\n\n\n\n\n\n\n\nCJ(CAR$person, CAR$year, unique = TRUE)\ndata.table [12 x 2]\n\n\n\n\nV1\n\n\nV2\n\n\n\n\n\nA\n\n\n2 010\n\n\n\n\nA\n\n\n2 011\n\n\n\n\nA\n\n\n2 012\n\n\n\n\nA\n\n\n2 013\n\n\n\n\nA\n\n\n2 014\n\n\n\n\nA\n\n\n2 015\n\n\n\n\nB\n\n\n2 010\n\n\n\n\nB\n\n\n2 011\n\n\n\n\nB\n\n\n2 012\n\n\n\n\nB\n\n\n2 013\n\n\n\n\nB\n\n\n2 014\n\n\n\n\nB\n\n\n2 015\n\n\n\n\n\n\n\n\n\n\n\n4.5.2 Complete\nJoins the original dataset with the expanded one:\n\n\nTidyverse\ndata.table\n\n\n\n\nCAR |&gt; tidyr::complete(person, year)\ndata.frame [12 x 3]\n\n\n\n\nperson\n\n\nyear\n\n\ncar\n\n\n\n\n\nA\n\n\n2 010\n\n\nBMW\n\n\n\n\nA\n\n\n2 011\n\n\nBMW\n\n\n\n\nA\n\n\n2 012\n\n\nAUDI\n\n\n\n\nA\n\n\n2 013\n\n\nAUDI\n\n\n\n\nA\n\n\n2 014\n\n\nAUDI\n\n\n\n\nA\n\n\n2 015\n\n\nMercedes\n\n\n\n\nB\n\n\n2 010\n\n\nNA\n\n\n\n\nB\n\n\n2 011\n\n\nCitroen\n\n\n\n\nB\n\n\n2 012\n\n\nCitroen\n\n\n\n\nB\n\n\n2 013\n\n\nCitroen\n\n\n\n\nB\n\n\n2 014\n\n\nToyota\n\n\n\n\nB\n\n\n2 015\n\n\nToyota\n\n\n\n\n\n\n\n\n\n\nCAR[CJ(person, year, unique = TRUE), on = .(person, year)]\ndata.table [12 x 3]\n\n\n\n\nyear\n\n\nperson\n\n\ncar\n\n\n\n\n\n2 010\n\n\nA\n\n\nBMW\n\n\n\n\n2 011\n\n\nA\n\n\nBMW\n\n\n\n\n2 012\n\n\nA\n\n\nAUDI\n\n\n\n\n2 013\n\n\nA\n\n\nAUDI\n\n\n\n\n2 014\n\n\nA\n\n\nAUDI\n\n\n\n\n2 015\n\n\nA\n\n\nMercedes\n\n\n\n\n2 010\n\n\nB\n\n\nNA\n\n\n\n\n2 011\n\n\nB\n\n\nCitroen\n\n\n\n\n2 012\n\n\nB\n\n\nCitroen\n\n\n\n\n2 013\n\n\nB\n\n\nCitroen\n\n\n\n\n2 014\n\n\nB\n\n\nToyota\n\n\n\n\n2 015\n\n\nB\n\n\nToyota"
  },
  {
    "objectID": "content/blog/posts/data.table/index.html#uncount",
    "href": "content/blog/posts/data.table/index.html#uncount",
    "title": "Data wrangling with data.table and the Tidyverse",
    "section": "\n4.6 Uncount",
    "text": "4.6 Uncount\nDuplicating aggregated rows to get back the un-aggregated version.\nData\n\ncols &lt;- c(\"Mild\", \"Moderate\", \"Severe\")\n\ndat_agg\ndata.frame [10 x 6]\n\n\n\n\nID\n\n\nSite\n\n\nDomain\n\n\nMild\n\n\nModerate\n\n\nSevere\n\n\n\n\n\n1\n\n\n23\n\n\nA1\n\n\n4\n\n\n0\n\n\n0\n\n\n\n\n2\n\n\n27\n\n\nA1\n\n\n0\n\n\n1\n\n\n1\n\n\n\n\n3\n\n\n28\n\n\nA1\n\n\n0\n\n\n1\n\n\n0\n\n\n\n\n4\n\n\n29\n\n\nA1\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n5\n\n\n31\n\n\nA1\n\n\n0\n\n\n1\n\n\n0\n\n\n\n\n6\n\n\n33\n\n\nA1\n\n\n0\n\n\n1\n\n\n1\n\n\n\n\n7\n\n\n41\n\n\nA1\n\n\n3\n\n\n0\n\n\n1\n\n\n\n\n8\n\n\n48\n\n\nA1\n\n\n0\n\n\n2\n\n\n4\n\n\n\n\n9\n\n\n64\n\n\nA1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n10\n\n\n66\n\n\nA1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n\n\n\n\n\nTidyverse\ndata.table\n\n\n\n\ndat_agg |&gt; \n  pivot_longer(cols = all_of(cols), names_to = \"Severity\", values_to = \"Count\") |&gt; \n  uncount(Count) |&gt; \n  mutate(ID_new = row_number(), .after = \"ID\") |&gt;\n  pivot_wider(\n    names_from = \"Severity\", values_from = \"Severity\", \n    values_fn = \\(x) ifelse(is.na(x), 0, 1), values_fill = 0\n  )\ndata.frame [23 x 7]\n\n\n\n\nID\n\n\nID_new\n\n\nSite\n\n\nDomain\n\n\nMild\n\n\nModerate\n\n\nSevere\n\n\n\n\n\n1\n\n\n1\n\n\n23\n\n\nA1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n1\n\n\n2\n\n\n23\n\n\nA1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n1\n\n\n3\n\n\n23\n\n\nA1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n1\n\n\n4\n\n\n23\n\n\nA1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n2\n\n\n5\n\n\n27\n\n\nA1\n\n\n0\n\n\n1\n\n\n0\n\n\n\n\n2\n\n\n6\n\n\n27\n\n\nA1\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n3\n\n\n7\n\n\n28\n\n\nA1\n\n\n0\n\n\n1\n\n\n0\n\n\n\n\n4\n\n\n8\n\n\n29\n\n\nA1\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n5\n\n\n9\n\n\n31\n\n\nA1\n\n\n0\n\n\n1\n\n\n0\n\n\n\n\n6\n\n\n10\n\n\n33\n\n\nA1\n\n\n0\n\n\n1\n\n\n0\n\n\n\n\n6\n\n\n11\n\n\n33\n\n\nA1\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n7\n\n\n12\n\n\n41\n\n\nA1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n7\n\n\n13\n\n\n41\n\n\nA1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n7\n\n\n14\n\n\n41\n\n\nA1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n7\n\n\n15\n\n\n41\n\n\nA1\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n\n[ omitted 8 entries ]\n\n\n\n\n\n\n\n\nSolution 1:\n\n(melt(DAT_AGG, measure.vars = cols, variable.name = \"Severity\", value.name = \"Count\")\n  [rep(1:.N, Count)][, ID_new := .I] \n  |&gt; dcast(... ~ Severity, value.var = \"Severity\", fun.agg = \\(x) ifelse(is.na(x), 0, 1), fill = 0)\n  |&gt; _[, -\"Count\"]\n)\ndata.table [23 x 7]\n\n\n\n\nID\n\n\nSite\n\n\nDomain\n\n\nID_new\n\n\nMild\n\n\nModerate\n\n\nSevere\n\n\n\n\n\n1\n\n\n23\n\n\nA1\n\n\n1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n1\n\n\n23\n\n\nA1\n\n\n2\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n1\n\n\n23\n\n\nA1\n\n\n3\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n1\n\n\n23\n\n\nA1\n\n\n4\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n2\n\n\n27\n\n\nA1\n\n\n10\n\n\n0\n\n\n1\n\n\n0\n\n\n\n\n2\n\n\n27\n\n\nA1\n\n\n16\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n3\n\n\n28\n\n\nA1\n\n\n11\n\n\n0\n\n\n1\n\n\n0\n\n\n\n\n4\n\n\n29\n\n\nA1\n\n\n17\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n5\n\n\n31\n\n\nA1\n\n\n12\n\n\n0\n\n\n1\n\n\n0\n\n\n\n\n6\n\n\n33\n\n\nA1\n\n\n13\n\n\n0\n\n\n1\n\n\n0\n\n\n\n\n6\n\n\n33\n\n\nA1\n\n\n18\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n7\n\n\n41\n\n\nA1\n\n\n19\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n7\n\n\n41\n\n\nA1\n\n\n5\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n7\n\n\n41\n\n\nA1\n\n\n6\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n7\n\n\n41\n\n\nA1\n\n\n7\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n\n[ omitted 8 entries ]\n\n\n\n\n\n\nSolution 2:\n\nDAT_AGG[Reduce(`c`, sapply(mget(cols), \\(x) rep(1:.N, x)))\n      ][, (cols) := lapply(.SD, \\(x) ifelse(x &gt; 1, 1, x)), .SDcols = cols\n      ][order(ID)]\ndata.table [23 x 6]\n\n\n\n\nID\n\n\nSite\n\n\nDomain\n\n\nMild\n\n\nModerate\n\n\nSevere\n\n\n\n\n\n1\n\n\n23\n\n\nA1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n1\n\n\n23\n\n\nA1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n1\n\n\n23\n\n\nA1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n1\n\n\n23\n\n\nA1\n\n\n1\n\n\n0\n\n\n0\n\n\n\n\n2\n\n\n27\n\n\nA1\n\n\n0\n\n\n1\n\n\n1\n\n\n\n\n2\n\n\n27\n\n\nA1\n\n\n0\n\n\n1\n\n\n1\n\n\n\n\n3\n\n\n28\n\n\nA1\n\n\n0\n\n\n1\n\n\n0\n\n\n\n\n4\n\n\n29\n\n\nA1\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n5\n\n\n31\n\n\nA1\n\n\n0\n\n\n1\n\n\n0\n\n\n\n\n6\n\n\n33\n\n\nA1\n\n\n0\n\n\n1\n\n\n1\n\n\n\n\n6\n\n\n33\n\n\nA1\n\n\n0\n\n\n1\n\n\n1\n\n\n\n\n7\n\n\n41\n\n\nA1\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n7\n\n\n41\n\n\nA1\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n7\n\n\n41\n\n\nA1\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n7\n\n\n41\n\n\nA1\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n\n[ omitted 8 entries ]"
  },
  {
    "objectID": "content/blog/posts/data.table/index.html#list-unlist",
    "href": "content/blog/posts/data.table/index.html#list-unlist",
    "title": "Data wrangling with data.table and the Tidyverse",
    "section": "\n4.7 List / Unlist",
    "text": "4.7 List / Unlist\nWhen a column contains a simple vector/list of values (of the same type, without structure)\n\n4.7.1 One listed column\nSingle ID (grouping) column:\nData:\n\nMT_LIST\ndata.table [3 x 2]\n\n\n\n\ncyl\n\n\nmpg\n\n\n\n\n\n4\n\n\n&lt;numeric [11]&gt;\n\n\n\n\n6\n\n\n&lt;numeric [7]&gt;\n\n\n\n\n8\n\n\n&lt;numeric [14]&gt;\n\n\n\n\n\n\n\n\n\nTidyverse\ndata.table\n\n\n\n\nmt_list |&gt; unnest(cols = mpg)\ndata.frame [32 x 2]\n\n\n\n\ncyl\n\n\nmpg\n\n\n\n\n\n6\n\n\n21\n\n\n\n\n6\n\n\n21\n\n\n\n\n6\n\n\n21.4\n\n\n\n\n6\n\n\n18.1\n\n\n\n\n6\n\n\n19.2\n\n\n\n\n6\n\n\n17.8\n\n\n\n\n6\n\n\n19.7\n\n\n\n\n4\n\n\n22.8\n\n\n\n\n4\n\n\n24.4\n\n\n\n\n4\n\n\n22.8\n\n\n\n\n4\n\n\n32.4\n\n\n\n\n4\n\n\n30.4\n\n\n\n\n4\n\n\n33.9\n\n\n\n\n4\n\n\n21.5\n\n\n\n\n4\n\n\n27.3\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\nMT_LIST[, .(mpg = unlist(mpg)), keyby = cyl]\ndata.table [32 x 2]\n\n\n\n\ncyl\n\n\nmpg\n\n\n\n\n\n4\n\n\n22.8\n\n\n\n\n4\n\n\n24.4\n\n\n\n\n4\n\n\n22.8\n\n\n\n\n4\n\n\n32.4\n\n\n\n\n4\n\n\n30.4\n\n\n\n\n4\n\n\n33.9\n\n\n\n\n4\n\n\n21.5\n\n\n\n\n4\n\n\n27.3\n\n\n\n\n4\n\n\n26\n\n\n\n\n4\n\n\n30.4\n\n\n\n\n4\n\n\n21.4\n\n\n\n\n6\n\n\n21\n\n\n\n\n6\n\n\n21\n\n\n\n\n6\n\n\n21.4\n\n\n\n\n6\n\n\n18.1\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\nAlternative that bypasses the need of grouping when unlisting by growing the data.table back to its original number of rows before unlisting:\n\nMT_LIST[rep(MT_LIST[, .I], lengths(mpg))][, mpg := unlist(MT_LIST$mpg)][]\ndata.table [32 x 2]\n\n\n\n\ncyl\n\n\nmpg\n\n\n\n\n\n4\n\n\n22.8\n\n\n\n\n4\n\n\n24.4\n\n\n\n\n4\n\n\n22.8\n\n\n\n\n4\n\n\n32.4\n\n\n\n\n4\n\n\n30.4\n\n\n\n\n4\n\n\n33.9\n\n\n\n\n4\n\n\n21.5\n\n\n\n\n4\n\n\n27.3\n\n\n\n\n4\n\n\n26\n\n\n\n\n4\n\n\n30.4\n\n\n\n\n4\n\n\n21.4\n\n\n\n\n6\n\n\n21\n\n\n\n\n6\n\n\n21\n\n\n\n\n6\n\n\n21.4\n\n\n\n\n6\n\n\n18.1\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\nMultiple ID (grouping) columns:\nData:\n\nmt_list2\ndata.frame [8 x 3]\n\n\n\n\ncyl\n\n\ngear\n\n\nmpg\n\n\n\n\n\n6\n\n\n4\n\n\n&lt;numeric [4]&gt;\n\n\n\n\n4\n\n\n4\n\n\n&lt;numeric [8]&gt;\n\n\n\n\n6\n\n\n3\n\n\n&lt;numeric [2]&gt;\n\n\n\n\n8\n\n\n3\n\n\n&lt;numeric [12]&gt;\n\n\n\n\n4\n\n\n3\n\n\n&lt;numeric [1]&gt;\n\n\n\n\n4\n\n\n5\n\n\n&lt;numeric [2]&gt;\n\n\n\n\n8\n\n\n5\n\n\n&lt;numeric [2]&gt;\n\n\n\n\n6\n\n\n5\n\n\n&lt;numeric [1]&gt;\n\n\n\n\n\n\n\n\n\nTidyverse\ndata.table\n\n\n\n\nmt_list2 |&gt; unnest(cols = mpg) # group_by(cyl, gear) is optional\ndata.frame [32 x 3]\n\n\n\n\ncyl\n\n\ngear\n\n\nmpg\n\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n\n\n6\n\n\n4\n\n\n19.2\n\n\n\n\n6\n\n\n4\n\n\n17.8\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n\n\n4\n\n\n4\n\n\n24.4\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n\n\n4\n\n\n4\n\n\n32.4\n\n\n\n\n4\n\n\n4\n\n\n30.4\n\n\n\n\n4\n\n\n4\n\n\n33.9\n\n\n\n\n4\n\n\n4\n\n\n27.3\n\n\n\n\n4\n\n\n4\n\n\n21.4\n\n\n\n\n6\n\n\n3\n\n\n21.4\n\n\n\n\n6\n\n\n3\n\n\n18.1\n\n\n\n\n8\n\n\n3\n\n\n18.7\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\nSolution 1:\n\nMT_LIST2[, .(mpg = unlist(mpg)), by = setdiff(colnames(MT_LIST2), 'mpg')]\ndata.table [32 x 3]\n\n\n\n\ncyl\n\n\ngear\n\n\nmpg\n\n\n\n\n\n4\n\n\n3\n\n\n21.5\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n\n\n4\n\n\n4\n\n\n24.4\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n\n\n4\n\n\n4\n\n\n32.4\n\n\n\n\n4\n\n\n4\n\n\n30.4\n\n\n\n\n4\n\n\n4\n\n\n33.9\n\n\n\n\n4\n\n\n4\n\n\n27.3\n\n\n\n\n4\n\n\n4\n\n\n21.4\n\n\n\n\n4\n\n\n5\n\n\n26\n\n\n\n\n4\n\n\n5\n\n\n30.4\n\n\n\n\n6\n\n\n3\n\n\n21.4\n\n\n\n\n6\n\n\n3\n\n\n18.1\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\nSolution 2:\n\nMT_LIST2[rep(MT_LIST2[, .I], lengths(mpg))][, mpg := unlist(MT_LIST2$mpg)][]\ndata.table [32 x 3]\n\n\n\n\ncyl\n\n\ngear\n\n\nmpg\n\n\n\n\n\n4\n\n\n3\n\n\n21.5\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n\n\n4\n\n\n4\n\n\n24.4\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n\n\n4\n\n\n4\n\n\n32.4\n\n\n\n\n4\n\n\n4\n\n\n30.4\n\n\n\n\n4\n\n\n4\n\n\n33.9\n\n\n\n\n4\n\n\n4\n\n\n27.3\n\n\n\n\n4\n\n\n4\n\n\n21.4\n\n\n\n\n4\n\n\n5\n\n\n26\n\n\n\n\n4\n\n\n5\n\n\n30.4\n\n\n\n\n6\n\n\n3\n\n\n21.4\n\n\n\n\n6\n\n\n3\n\n\n18.1\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\n\n4.7.2 Multiple listed column\nData:\n\nmt_list_mult\ndata.frame [8 x 4]\n\n\n\n\ncyl\n\n\ngear\n\n\nmpg\n\n\ndisp\n\n\n\n\n\n6\n\n\n4\n\n\n&lt;numeric [4]&gt;\n\n\n&lt;numeric [4]&gt;\n\n\n\n\n4\n\n\n4\n\n\n&lt;numeric [8]&gt;\n\n\n&lt;numeric [8]&gt;\n\n\n\n\n6\n\n\n3\n\n\n&lt;numeric [2]&gt;\n\n\n&lt;numeric [2]&gt;\n\n\n\n\n8\n\n\n3\n\n\n&lt;numeric [12]&gt;\n\n\n&lt;numeric [12]&gt;\n\n\n\n\n4\n\n\n3\n\n\n&lt;numeric [1]&gt;\n\n\n&lt;numeric [1]&gt;\n\n\n\n\n4\n\n\n5\n\n\n&lt;numeric [2]&gt;\n\n\n&lt;numeric [2]&gt;\n\n\n\n\n8\n\n\n5\n\n\n&lt;numeric [2]&gt;\n\n\n&lt;numeric [2]&gt;\n\n\n\n\n6\n\n\n5\n\n\n&lt;numeric [1]&gt;\n\n\n&lt;numeric [1]&gt;\n\n\n\n\n\n\n\n\n\nTidyverse\ndata.table\n\n\n\n\nmt_list_mult |&gt; unnest(cols = c(mpg, disp)) # group_by(cyl, gear) is optional\ndata.frame [32 x 4]\n\n\n\n\ncyl\n\n\ngear\n\n\nmpg\n\n\ndisp\n\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n160\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n160\n\n\n\n\n6\n\n\n4\n\n\n19.2\n\n\n167.6\n\n\n\n\n6\n\n\n4\n\n\n17.8\n\n\n167.6\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n108\n\n\n\n\n4\n\n\n4\n\n\n24.4\n\n\n146.7\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n140.8\n\n\n\n\n4\n\n\n4\n\n\n32.4\n\n\n78.7\n\n\n\n\n4\n\n\n4\n\n\n30.4\n\n\n75.7\n\n\n\n\n4\n\n\n4\n\n\n33.9\n\n\n71.1\n\n\n\n\n4\n\n\n4\n\n\n27.3\n\n\n79\n\n\n\n\n4\n\n\n4\n\n\n21.4\n\n\n121\n\n\n\n\n6\n\n\n3\n\n\n21.4\n\n\n258\n\n\n\n\n6\n\n\n3\n\n\n18.1\n\n\n225\n\n\n\n\n8\n\n\n3\n\n\n18.7\n\n\n360\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\nMT_LIST_MULT[, lapply(.SD, \\(c) unlist(c)), by = setdiff(colnames(MT_LIST_MULT), c(\"mpg\", \"disp\"))]\ndata.table [32 x 4]\n\n\n\n\ncyl\n\n\ngear\n\n\nmpg\n\n\ndisp\n\n\n\n\n\n4\n\n\n3\n\n\n21.5\n\n\n120.1\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n108\n\n\n\n\n4\n\n\n4\n\n\n24.4\n\n\n146.7\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n140.8\n\n\n\n\n4\n\n\n4\n\n\n32.4\n\n\n78.7\n\n\n\n\n4\n\n\n4\n\n\n30.4\n\n\n75.7\n\n\n\n\n4\n\n\n4\n\n\n33.9\n\n\n71.1\n\n\n\n\n4\n\n\n4\n\n\n27.3\n\n\n79\n\n\n\n\n4\n\n\n4\n\n\n21.4\n\n\n121\n\n\n\n\n4\n\n\n5\n\n\n26\n\n\n120.3\n\n\n\n\n4\n\n\n5\n\n\n30.4\n\n\n95.1\n\n\n\n\n6\n\n\n3\n\n\n21.4\n\n\n258\n\n\n\n\n6\n\n\n3\n\n\n18.1\n\n\n225\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n160\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n160\n\n\n\n\n\n[ omitted 17 entries ]"
  },
  {
    "objectID": "content/blog/posts/data.table/index.html#nest-unnest",
    "href": "content/blog/posts/data.table/index.html#nest-unnest",
    "title": "Data wrangling with data.table and the Tidyverse",
    "section": "\n4.8 Nest / Unnest",
    "text": "4.8 Nest / Unnest\nWhen a column contains a data.table/data.frame (with multiple columns, structured)\n\n4.8.1 One nested column\nNesting\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars |&gt; tidyr::nest(data = -cyl) # Data is inside tibbles\ndata.frame [3 x 2]\n\n\n\n\ncyl\n\n\ndata\n\n\n\n\n\n6\n\n\n&lt;tbl_df [7 x 10]&gt;\n\n\n\n\n4\n\n\n&lt;tbl_df [11 x 10]&gt;\n\n\n\n\n8\n\n\n&lt;tbl_df [14 x 10]&gt;\n\n\n\n\n\n\n\n\nAlternativesmtcars |&gt; nest_by(cyl) |&gt; ungroup() # Data is inside vctrs_list_of. Returns a rowwise() df\n\n\nNesting while keeping the grouping variable inside the nested tables:\n\nmtcars |&gt; tidyr::nest(data = everything(), .by = cyl)\ndata.frame [3 x 2]\n\n\n\n\ncyl\n\n\ndata\n\n\n\n\n\n6\n\n\n&lt;tbl_df [7 x 11]&gt;\n\n\n\n\n4\n\n\n&lt;tbl_df [11 x 11]&gt;\n\n\n\n\n8\n\n\n&lt;tbl_df [14 x 11]&gt;\n\n\n\n\n\n\n\n\n\n\nMT[, .(data = .(.SD)), keyby = cyl]\ndata.table [3 x 2]\n\n\n\n\ncyl\n\n\ndata\n\n\n\n\n\n4\n\n\n&lt;data.table [11 x 10]&gt;&lt;/data.table&gt;\n\n\n\n\n6\n\n\n&lt;data.table [7 x 10]&gt;&lt;/data.table&gt;\n\n\n\n\n8\n\n\n&lt;data.table [14 x 10]&gt;&lt;/data.table&gt;\n\n\n\n\n\n\n\nNesting while keeping the grouping variable inside the nested tables:\n\nMT[, .(data = list(data.table(cyl, .SD))), keyby = cyl]\ndata.table [3 x 2]\n\n\n\n\ncyl\n\n\ndata\n\n\n\n\n\n4\n\n\n&lt;data.table [11 x 11]&gt;&lt;/data.table&gt;\n\n\n\n\n6\n\n\n&lt;data.table [7 x 11]&gt;&lt;/data.table&gt;\n\n\n\n\n8\n\n\n&lt;data.table [14 x 11]&gt;&lt;/data.table&gt;\n\n\n\n\n\n\n\n\n\n\nUnnesting\nData:\n\nmtcars_nest &lt;- mtcars |&gt; tidyr::nest(data = -cyl)\n\nMT_NEST &lt;- MT[, .(data = .(.SD)), keyby = cyl]\n\n\n\nTidyverse\ndata.table\n\n\n\n\nmtcars_nest |&gt; unnest(cols = data) |&gt; ungroup()\ndata.frame [32 x 11]\n\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n6\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n6\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n6\n\n\n21.4\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n6\n\n\n18.1\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n6\n\n\n19.2\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n6\n\n\n17.8\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n\n\n6\n\n\n19.7\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n\n\n4\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n32.4\n\n\n78.7\n\n\n66\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n30.4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n33.9\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n21.5\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n4\n\n\n27.3\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\nMT_NEST[, rbindlist(data), keyby = cyl] # MT_NEST[, do.call(c, data), keyby = cyl]\ndata.table [32 x 11]\n\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\n\n\n\n4\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n32.4\n\n\n78.7\n\n\n66\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n30.4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n4\n\n\n33.9\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n21.5\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n4\n\n\n27.3\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n\n\n4\n\n\n26\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n4\n\n\n30.4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n\n\n4\n\n\n21.4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n\n\n6\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n6\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n\n\n6\n\n\n21.4\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n6\n\n\n18.1\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\n\n4.8.2 Multiple nested column\nNesting:\n\n\nTidyverse\ndata.table\n\n\n\n\n(mtcars |&gt; nest(data1 = c(mpg, hp), data2 = !c(cyl, gear, mpg, hp), .by = c(cyl, gear)) -&gt; mt_nest_mult)\ndata.frame [8 x 4]\n\n\n\n\ncyl\n\n\ngear\n\n\ndata1\n\n\ndata2\n\n\n\n\n\n6\n\n\n4\n\n\n&lt;tbl_df [4 x 2]&gt;\n\n\n&lt;tbl_df [4 x 7]&gt;\n\n\n\n\n4\n\n\n4\n\n\n&lt;tbl_df [8 x 2]&gt;\n\n\n&lt;tbl_df [8 x 7]&gt;\n\n\n\n\n6\n\n\n3\n\n\n&lt;tbl_df [2 x 2]&gt;\n\n\n&lt;tbl_df [2 x 7]&gt;\n\n\n\n\n8\n\n\n3\n\n\n&lt;tbl_df [12 x 2]&gt;\n\n\n&lt;tbl_df [12 x 7]&gt;\n\n\n\n\n4\n\n\n3\n\n\n&lt;tbl_df [1 x 2]&gt;\n\n\n&lt;tbl_df [1 x 7]&gt;\n\n\n\n\n4\n\n\n5\n\n\n&lt;tbl_df [2 x 2]&gt;\n\n\n&lt;tbl_df [2 x 7]&gt;\n\n\n\n\n8\n\n\n5\n\n\n&lt;tbl_df [2 x 2]&gt;\n\n\n&lt;tbl_df [2 x 7]&gt;\n\n\n\n\n6\n\n\n5\n\n\n&lt;tbl_df [1 x 2]&gt;\n\n\n&lt;tbl_df [1 x 7]&gt;\n\n\n\n\n\n\n\n\n\n\n(MT[, .(data1 = .(.SD[, .(mpg, hp)]), data2 = .(.SD[, !c(\"mpg\", \"hp\")])), by = .(cyl, gear)] -&gt; MT_NEST_MULT)\ndata.table [8 x 4]\n\n\n\n\ncyl\n\n\ngear\n\n\ndata1\n\n\ndata2\n\n\n\n\n\n6\n\n\n4\n\n\n&lt;data.table [4 x 2]&gt;&lt;/data.table&gt;\n\n\n&lt;data.table [4 x 7]&gt;&lt;/data.table&gt;\n\n\n\n\n4\n\n\n4\n\n\n&lt;data.table [8 x 2]&gt;&lt;/data.table&gt;\n\n\n&lt;data.table [8 x 7]&gt;&lt;/data.table&gt;\n\n\n\n\n6\n\n\n3\n\n\n&lt;data.table [2 x 2]&gt;&lt;/data.table&gt;\n\n\n&lt;data.table [2 x 7]&gt;&lt;/data.table&gt;\n\n\n\n\n8\n\n\n3\n\n\n&lt;data.table [12 x 2]&gt;&lt;/data.table&gt;\n\n\n&lt;data.table [12 x 7]&gt;&lt;/data.table&gt;\n\n\n\n\n4\n\n\n3\n\n\n&lt;data.table [1 x 2]&gt;&lt;/data.table&gt;\n\n\n&lt;data.table [1 x 7]&gt;&lt;/data.table&gt;\n\n\n\n\n4\n\n\n5\n\n\n&lt;data.table [2 x 2]&gt;&lt;/data.table&gt;\n\n\n&lt;data.table [2 x 7]&gt;&lt;/data.table&gt;\n\n\n\n\n8\n\n\n5\n\n\n&lt;data.table [2 x 2]&gt;&lt;/data.table&gt;\n\n\n&lt;data.table [2 x 7]&gt;&lt;/data.table&gt;\n\n\n\n\n6\n\n\n5\n\n\n&lt;data.table [1 x 2]&gt;&lt;/data.table&gt;\n\n\n&lt;data.table [1 x 7]&gt;&lt;/data.table&gt;\n\n\n\n\n\n\n\n\n\n\nUnnesting:\n\n\nTidyverse\ndata.table\n\n\n\n\nmt_nest_mult |&gt; unnest(cols = c(data1, data2))\ndata.frame [32 x 11]\n\n\n\n\ncyl\n\n\ngear\n\n\nmpg\n\n\nhp\n\n\ndisp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ncarb\n\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n110\n\n\n160\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n110\n\n\n160\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n\n\n6\n\n\n4\n\n\n19.2\n\n\n123\n\n\n167.6\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n\n\n6\n\n\n4\n\n\n17.8\n\n\n123\n\n\n167.6\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n93\n\n\n108\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n24.4\n\n\n62\n\n\n146.7\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n95\n\n\n140.8\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n32.4\n\n\n66\n\n\n78.7\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n30.4\n\n\n52\n\n\n75.7\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n33.9\n\n\n65\n\n\n71.1\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n27.3\n\n\n66\n\n\n79\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n21.4\n\n\n109\n\n\n121\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n2\n\n\n\n\n6\n\n\n3\n\n\n21.4\n\n\n110\n\n\n258\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n6\n\n\n3\n\n\n18.1\n\n\n105\n\n\n225\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n8\n\n\n3\n\n\n18.7\n\n\n175\n\n\n360\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n2\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\nUsing a pattern to specify the columns to unnest:\n\nmt_nest_mult |&gt; unnest(cols = matches(\"data\"))\ndata.frame [32 x 11]\n\n\n\n\ncyl\n\n\ngear\n\n\nmpg\n\n\nhp\n\n\ndisp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ncarb\n\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n110\n\n\n160\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n110\n\n\n160\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n\n\n6\n\n\n4\n\n\n19.2\n\n\n123\n\n\n167.6\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n\n\n6\n\n\n4\n\n\n17.8\n\n\n123\n\n\n167.6\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n93\n\n\n108\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n24.4\n\n\n62\n\n\n146.7\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n95\n\n\n140.8\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n32.4\n\n\n66\n\n\n78.7\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n30.4\n\n\n52\n\n\n75.7\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n33.9\n\n\n65\n\n\n71.1\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n27.3\n\n\n66\n\n\n79\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n21.4\n\n\n109\n\n\n121\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n2\n\n\n\n\n6\n\n\n3\n\n\n21.4\n\n\n110\n\n\n258\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n6\n\n\n3\n\n\n18.1\n\n\n105\n\n\n225\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n8\n\n\n3\n\n\n18.7\n\n\n175\n\n\n360\n\n\n3.15\n\n\n3.44\n\n\n17.02\n\n\n0\n\n\n0\n\n\n2\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\nMT_NEST_MULT[, c(rbindlist(data1), rbindlist(data2)), keyby = .(cyl, gear)]\ndata.table [32 x 11]\n\n\n\n\ncyl\n\n\ngear\n\n\nmpg\n\n\nhp\n\n\ndisp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ncarb\n\n\n\n\n\n4\n\n\n3\n\n\n21.5\n\n\n97\n\n\n120.1\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n93\n\n\n108\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n24.4\n\n\n62\n\n\n146.7\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n95\n\n\n140.8\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n32.4\n\n\n66\n\n\n78.7\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n30.4\n\n\n52\n\n\n75.7\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n33.9\n\n\n65\n\n\n71.1\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n27.3\n\n\n66\n\n\n79\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n21.4\n\n\n109\n\n\n121\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n2\n\n\n\n\n4\n\n\n5\n\n\n26\n\n\n91\n\n\n120.3\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n2\n\n\n\n\n4\n\n\n5\n\n\n30.4\n\n\n113\n\n\n95.1\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n2\n\n\n\n\n6\n\n\n3\n\n\n21.4\n\n\n110\n\n\n258\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n6\n\n\n3\n\n\n18.1\n\n\n105\n\n\n225\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n110\n\n\n160\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n110\n\n\n160\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\nUsing a pattern to specify the columns to unnest:\n\nMT_NEST_MULT[, \n  do.call(c, unname(lapply(.SD, \\(c) rbindlist(c)))), .SDcols = patterns('data'), \n  keyby = .(cyl, gear)\n]\ndata.table [32 x 11]\n\n\n\n\ncyl\n\n\ngear\n\n\nmpg\n\n\nhp\n\n\ndisp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ncarb\n\n\n\n\n\n4\n\n\n3\n\n\n21.5\n\n\n97\n\n\n120.1\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n93\n\n\n108\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n24.4\n\n\n62\n\n\n146.7\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n95\n\n\n140.8\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n32.4\n\n\n66\n\n\n78.7\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n30.4\n\n\n52\n\n\n75.7\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n33.9\n\n\n65\n\n\n71.1\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n27.3\n\n\n66\n\n\n79\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n21.4\n\n\n109\n\n\n121\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n2\n\n\n\n\n4\n\n\n5\n\n\n26\n\n\n91\n\n\n120.3\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n2\n\n\n\n\n4\n\n\n5\n\n\n30.4\n\n\n113\n\n\n95.1\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n2\n\n\n\n\n6\n\n\n3\n\n\n21.4\n\n\n110\n\n\n258\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n6\n\n\n3\n\n\n18.1\n\n\n105\n\n\n225\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n110\n\n\n160\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n110\n\n\n160\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\ndata.table [32 x 11]\n\n\n\n\ncyl\n\n\ngear\n\n\nmpg\n\n\nhp\n\n\ndisp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ncarb\n\n\n\n\n\n4\n\n\n3\n\n\n21.5\n\n\n97\n\n\n120.1\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n93\n\n\n108\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n24.4\n\n\n62\n\n\n146.7\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n22.8\n\n\n95\n\n\n140.8\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n32.4\n\n\n66\n\n\n78.7\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n30.4\n\n\n52\n\n\n75.7\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n2\n\n\n\n\n4\n\n\n4\n\n\n33.9\n\n\n65\n\n\n71.1\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n27.3\n\n\n66\n\n\n79\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n1\n\n\n\n\n4\n\n\n4\n\n\n21.4\n\n\n109\n\n\n121\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n2\n\n\n\n\n4\n\n\n5\n\n\n26\n\n\n91\n\n\n120.3\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n2\n\n\n\n\n4\n\n\n5\n\n\n30.4\n\n\n113\n\n\n95.1\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n2\n\n\n\n\n6\n\n\n3\n\n\n21.4\n\n\n110\n\n\n258\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n6\n\n\n3\n\n\n18.1\n\n\n105\n\n\n225\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n1\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n110\n\n\n160\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n\n\n6\n\n\n4\n\n\n21\n\n\n110\n\n\n160\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\n\n\n\n4.8.3 Operate on nested/list columns\nData:\n\nmt_nest\ndata.frame [3 x 2]\n\n\n\n\ncyl\n\n\ndata\n\n\n\n\n\n6\n\n\n&lt;tbl_df [7 x 10]&gt;\n\n\n\n\n4\n\n\n&lt;tbl_df [11 x 10]&gt;\n\n\n\n\n8\n\n\n&lt;tbl_df [14 x 10]&gt;\n\n\n\n\n\n\n\nCreating a new column using the nested data:\n\n\nTidyverse\ndata.table\n\n\n\nKeeping the nested column:\n\nmt_nest |&gt; mutate(sum = sum(unlist(data)), .by = cyl)\ndata.frame [3 x 3]\n\n\n\n\ncyl\n\n\ndata\n\n\nsum\n\n\n\n\n\n6\n\n\n&lt;tbl_df [7 x 10]&gt;\n\n\n2 508.16\n\n\n\n\n4\n\n\n&lt;tbl_df [11 x 10]&gt;\n\n\n2 719.233\n\n\n\n\n8\n\n\n&lt;tbl_df [14 x 10]&gt;\n\n\n8 516.809\n\n\n\n\n\n\n\nDropping the nested column:\n\nmt_nest |&gt; summarize(sum = sum(unlist(data)), .by = cyl)\ndata.frame [3 x 2]\n\n\n\n\ncyl\n\n\nsum\n\n\n\n\n\n6\n\n\n2 508.16\n\n\n\n\n4\n\n\n2 719.233\n\n\n\n\n8\n\n\n8 516.809\n\n\n\n\n\n\n\n\n\nKeeping the nested column:\n\ncopy(MT_NEST)[, sum := sapply(data, \\(r) sum(r)), by = cyl][]\ndata.table [3 x 3]\n\n\n\n\ncyl\n\n\ndata\n\n\nsum\n\n\n\n\n\n6\n\n\n&lt;data.table [7 x 10]&gt;&lt;/data.table&gt;\n\n\n2 508.16\n\n\n\n\n4\n\n\n&lt;data.table [11 x 10]&gt;&lt;/data.table&gt;\n\n\n2 719.233\n\n\n\n\n8\n\n\n&lt;data.table [14 x 10]&gt;&lt;/data.table&gt;\n\n\n8 516.809\n\n\n\n\n\n\n\nDropping the nested column:\n\nMT_NEST[, .(sum = sapply(data, \\(r) sum(r))), by = cyl]\ndata.table [3 x 2]\n\n\n\n\ncyl\n\n\nsum\n\n\n\n\n\n6\n\n\n2 508.16\n\n\n\n\n4\n\n\n2 719.233\n\n\n\n\n8\n\n\n8 516.809\n\n\n\n\n\n\n\n\n\n\nCreating multiple new columns using the nested data:\n\nlinreg &lt;- \\(data) lm(mpg ~ hp, data = data) |&gt; broom::tidy()\n\n\n\nTidyverse\ndata.table\n\n\n\n\nmt_nest |&gt; group_by(cyl) |&gt; group_modify(\\(d, g) linreg(unnest(d, everything()))) |&gt; ungroup()\ndata.frame [6 x 6]\n\n\n\n\ncyl\n\n\nterm\n\n\nestimate\n\n\nstd.error\n\n\nstatistic\n\n\np.value\n\n\n\n\n\n4\n\n\n(Intercept)\n\n\n35.983\n\n\n5.201\n\n\n6.918\n\n\n0\n\n\n\n\n4\n\n\nhp\n\n\n−0.113\n\n\n0.061\n\n\n−1.843\n\n\n0.098\n\n\n\n\n6\n\n\n(Intercept)\n\n\n20.674\n\n\n3.304\n\n\n6.256\n\n\n0.002\n\n\n\n\n6\n\n\nhp\n\n\n−0.008\n\n\n0.027\n\n\n−0.286\n\n\n0.786\n\n\n\n\n8\n\n\n(Intercept)\n\n\n18.08\n\n\n2.988\n\n\n6.052\n\n\n0\n\n\n\n\n8\n\n\nhp\n\n\n−0.014\n\n\n0.014\n\n\n−1.025\n\n\n0.326\n\n\n\n\n\n\n\n\n\n\nMT_NEST[, rbindlist(lapply(data, \\(ndt) linreg(ndt))), keyby = cyl][]\ndata.table [6 x 6]\n\n\n\n\ncyl\n\n\nterm\n\n\nestimate\n\n\nstd.error\n\n\nstatistic\n\n\np.value\n\n\n\n\n\n4\n\n\n(Intercept)\n\n\n35.983\n\n\n5.201\n\n\n6.918\n\n\n0\n\n\n\n\n4\n\n\nhp\n\n\n−0.113\n\n\n0.061\n\n\n−1.843\n\n\n0.098\n\n\n\n\n6\n\n\n(Intercept)\n\n\n20.674\n\n\n3.304\n\n\n6.256\n\n\n0.002\n\n\n\n\n6\n\n\nhp\n\n\n−0.008\n\n\n0.027\n\n\n−0.286\n\n\n0.786\n\n\n\n\n8\n\n\n(Intercept)\n\n\n18.08\n\n\n2.988\n\n\n6.052\n\n\n0\n\n\n\n\n8\n\n\nhp\n\n\n−0.014\n\n\n0.014\n\n\n−1.025\n\n\n0.326\n\n\n\n\n\n\n\n\n\n\nOperating inside the nested data:\n\n\nTidyverse\ndata.table\n\n\n\n\nmt_nest |&gt; \n  mutate(data = map(data, \\(t) mutate(t, sum = pmap_dbl(pick(everything()), sum)))) |&gt; \n  unnest(data)\ndata.frame [32 x 12]\n\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nsum\n\n\n\n\n\n6\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n322.98\n\n\n\n\n6\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n323.795\n\n\n\n\n6\n\n\n21.4\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n420.135\n\n\n\n\n6\n\n\n18.1\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n379.54\n\n\n\n\n6\n\n\n19.2\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.3\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n344.46\n\n\n\n\n6\n\n\n17.8\n\n\n167.6\n\n\n123\n\n\n3.92\n\n\n3.44\n\n\n18.9\n\n\n1\n\n\n0\n\n\n4\n\n\n4\n\n\n343.66\n\n\n\n\n6\n\n\n19.7\n\n\n145\n\n\n175\n\n\n3.62\n\n\n2.77\n\n\n15.5\n\n\n0\n\n\n1\n\n\n5\n\n\n6\n\n\n373.59\n\n\n\n\n4\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n255.58\n\n\n\n\n4\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n266.98\n\n\n\n\n4\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n295.57\n\n\n\n\n4\n\n\n32.4\n\n\n78.7\n\n\n66\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n209.85\n\n\n\n\n4\n\n\n30.4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n191.165\n\n\n\n\n4\n\n\n33.9\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n202.955\n\n\n\n\n4\n\n\n21.5\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n269.775\n\n\n\n\n4\n\n\n27.3\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n204.215\n\n\n\n\n\n[ omitted 17 entries ]\n\n\n\n\n\n\n\nAlternativesmt_nest |&gt; \n  mutate(across(data, \\(ts) map(ts, \\(t) mutate(t, sum = apply(pick(everything()), 1, sum))))) |&gt; \n  unnest(data)\n\n\n\nUsing the nplyr packagelibrary(nplyr)\n\nmt_nest |&gt; \n  nplyr::nest_mutate(data, sum = apply(pick(everything()), 1, sum)) |&gt; \n  unnest(data)\n\n\n\n\n\ncopy(MT_NEST)[, data := lapply(data, \\(dt) dt[, sum := apply(.SD, 1, sum)])\n            ][, rbindlist(data), keyby = cyl]\ndata.table [32 x 12]\n\n\n\n\ncyl\n\n\nmpg\n\n\ndisp\n\n\nhp\n\n\ndrat\n\n\nwt\n\n\nqsec\n\n\nvs\n\n\nam\n\n\ngear\n\n\ncarb\n\n\nsum\n\n\n\n\n\n4\n\n\n22.8\n\n\n108\n\n\n93\n\n\n3.85\n\n\n2.32\n\n\n18.61\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n255.58\n\n\n\n\n4\n\n\n24.4\n\n\n146.7\n\n\n62\n\n\n3.69\n\n\n3.19\n\n\n20\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n266.98\n\n\n\n\n4\n\n\n22.8\n\n\n140.8\n\n\n95\n\n\n3.92\n\n\n3.15\n\n\n22.9\n\n\n1\n\n\n0\n\n\n4\n\n\n2\n\n\n295.57\n\n\n\n\n4\n\n\n32.4\n\n\n78.7\n\n\n66\n\n\n4.08\n\n\n2.2\n\n\n19.47\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n209.85\n\n\n\n\n4\n\n\n30.4\n\n\n75.7\n\n\n52\n\n\n4.93\n\n\n1.615\n\n\n18.52\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n191.165\n\n\n\n\n4\n\n\n33.9\n\n\n71.1\n\n\n65\n\n\n4.22\n\n\n1.835\n\n\n19.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n202.955\n\n\n\n\n4\n\n\n21.5\n\n\n120.1\n\n\n97\n\n\n3.7\n\n\n2.465\n\n\n20.01\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n269.775\n\n\n\n\n4\n\n\n27.3\n\n\n79\n\n\n66\n\n\n4.08\n\n\n1.935\n\n\n18.9\n\n\n1\n\n\n1\n\n\n4\n\n\n1\n\n\n204.215\n\n\n\n\n4\n\n\n26\n\n\n120.3\n\n\n91\n\n\n4.43\n\n\n2.14\n\n\n16.7\n\n\n0\n\n\n1\n\n\n5\n\n\n2\n\n\n268.57\n\n\n\n\n4\n\n\n30.4\n\n\n95.1\n\n\n113\n\n\n3.77\n\n\n1.513\n\n\n16.9\n\n\n1\n\n\n1\n\n\n5\n\n\n2\n\n\n269.683\n\n\n\n\n4\n\n\n21.4\n\n\n121\n\n\n109\n\n\n4.11\n\n\n2.78\n\n\n18.6\n\n\n1\n\n\n1\n\n\n4\n\n\n2\n\n\n284.89\n\n\n\n\n6\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.62\n\n\n16.46\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n322.98\n\n\n\n\n6\n\n\n21\n\n\n160\n\n\n110\n\n\n3.9\n\n\n2.875\n\n\n17.02\n\n\n0\n\n\n1\n\n\n4\n\n\n4\n\n\n323.795\n\n\n\n\n6\n\n\n21.4\n\n\n258\n\n\n110\n\n\n3.08\n\n\n3.215\n\n\n19.44\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n420.135\n\n\n\n\n6\n\n\n18.1\n\n\n225\n\n\n105\n\n\n2.76\n\n\n3.46\n\n\n20.22\n\n\n1\n\n\n0\n\n\n3\n\n\n1\n\n\n379.54\n\n\n\n\n\n[ omitted 17 entries ]"
  },
  {
    "objectID": "content/blog/posts/data.table/index.html#rotate-transpose",
    "href": "content/blog/posts/data.table/index.html#rotate-transpose",
    "title": "Data wrangling with data.table and the Tidyverse",
    "section": "\n4.9 Rotate / Transpose",
    "text": "4.9 Rotate / Transpose\n\n(MT_SUMMARY &lt;- MT[, tidy(summary(mpg)), by = cyl])\ndata.table [3 x 7]\n\n\n\n\ncyl\n\n\nminimum\n\n\nq1\n\n\nmedian\n\n\nmean\n\n\nq3\n\n\nmaximum\n\n\n\n\n\n6\n\n\n17.8\n\n\n18.65\n\n\n19.7\n\n\n19.743\n\n\n21\n\n\n21.4\n\n\n\n\n4\n\n\n21.4\n\n\n22.8\n\n\n26\n\n\n26.664\n\n\n30.4\n\n\n33.9\n\n\n\n\n8\n\n\n10.4\n\n\n14.4\n\n\n15.2\n\n\n15.1\n\n\n16.25\n\n\n19.2\n\n\n\n\n\n\n\nUsing pivots:\n\n\nTidyverse\ndata.table\n\n\n\n\nMT_SUMMARY |&gt; \n  pivot_longer(!cyl, names_to = \"Statistic\") |&gt; \n  pivot_wider(id_cols = \"Statistic\", names_from = \"cyl\", names_prefix = \"Cyl \")\ndata.frame [6 x 4]\n\n\n\n\nStatistic\n\n\nCyl 6\n\n\nCyl 4\n\n\nCyl 8\n\n\n\n\n\nminimum\n\n\n17.8\n\n\n21.4\n\n\n10.4\n\n\n\n\nq1\n\n\n18.65\n\n\n22.8\n\n\n14.4\n\n\n\n\nmedian\n\n\n19.7\n\n\n26\n\n\n15.2\n\n\n\n\nmean\n\n\n19.743\n\n\n26.664\n\n\n15.1\n\n\n\n\nq3\n\n\n21\n\n\n30.4\n\n\n16.25\n\n\n\n\nmaximum\n\n\n21.4\n\n\n33.9\n\n\n19.2\n\n\n\n\n\n\n\n\n\n\nMT_SUMMARY |&gt; \n  melt(id.vars = \"cyl\", variable.name = \"Statistic\") |&gt; \n  dcast(Statistic ~ paste0(\"Cyl \", cyl))\ndata.table [6 x 4]\n\n\n\n\nStatistic\n\n\nCyl 4\n\n\nCyl 6\n\n\nCyl 8\n\n\n\n\n\nminimum\n\n\n21.4\n\n\n17.8\n\n\n10.4\n\n\n\n\nq1\n\n\n22.8\n\n\n18.65\n\n\n14.4\n\n\n\n\nmedian\n\n\n26\n\n\n19.7\n\n\n15.2\n\n\n\n\nmean\n\n\n26.664\n\n\n19.743\n\n\n15.1\n\n\n\n\nq3\n\n\n30.4\n\n\n21\n\n\n16.25\n\n\n\n\nmaximum\n\n\n33.9\n\n\n21.4\n\n\n19.2\n\n\n\n\n\n\n\n\n\n\nWith dedicated functions:\n\n\nTidyverse\ndata.table\n\n\n\n\n# No function exists to do this AFAIK\n\n\n\n\ndata.table::transpose(MT_SUMMARY, keep.names = \"Statistic\", make.names = 1)\ndata.table [6 x 4]\n\n\n\n\nStatistic\n\n\n6\n\n\n4\n\n\n8\n\n\n\n\n\nminimum\n\n\n17.8\n\n\n21.4\n\n\n10.4\n\n\n\n\nq1\n\n\n18.65\n\n\n22.8\n\n\n14.4\n\n\n\n\nmedian\n\n\n19.7\n\n\n26\n\n\n15.2\n\n\n\n\nmean\n\n\n19.743\n\n\n26.664\n\n\n15.1\n\n\n\n\nq3\n\n\n21\n\n\n30.4\n\n\n16.25\n\n\n\n\nmaximum\n\n\n21.4\n\n\n33.9\n\n\n19.2\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nTip💻 Expand for Session Info\n\n\n\n\n\n\n\n─ Session info ───────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.5.1 (2025-06-13)\n os       Ubuntu 22.04.5 LTS\n system   x86_64, linux-gnu\n ui       X11\n language (EN)\n collate  C.UTF-8\n ctype    C.UTF-8\n tz       Europe/Oslo\n date     2025-09-21\n pandoc   2.9.2.1\n quarto   1.8.17 @ /opt/quarto/bin/quarto\n Quarto   1.8.17\n\n─ Packages ───────────────────────────────────────────────────────────────────\n ! package    * version date (UTC) lib source\n P broom      * 1.0.10  2025-09-13 [?] CRAN (R 4.5.1)\n P crayon     * 1.5.3   2024-06-20 [?] CRAN (R 4.5.1)\n P data.table * 1.17.8  2025-07-10 [?] CRAN (R 4.5.1)\n P dplyr      * 1.1.4   2023-11-17 [?] CRAN (R 4.5.1)\n P ggplot2    * 4.0.0   2025-09-11 [?] CRAN (R 4.5.1)\n P gt         * 1.0.0   2025-04-05 [?] CRAN (R 4.5.1)\n P here       * 1.0.2   2025-09-15 [?] CRAN (R 4.5.1)\n P knitr      * 1.50    2025-03-16 [?] CRAN (R 4.5.1)\n P lubridate  * 1.9.4   2024-12-08 [?] CRAN (R 4.5.1)\n P pipebind   * 0.1.2   2023-08-30 [?] CRAN (R 4.5.1)\n P purrr      * 1.1.0   2025-07-10 [?] CRAN (R 4.5.1)\n P stringr    * 1.5.2   2025-09-08 [?] CRAN (R 4.5.1)\n P tibble     * 3.3.0   2025-06-08 [?] CRAN (R 4.5.1)\n P tidyr      * 1.3.1   2024-01-24 [?] CRAN (R 4.5.1)\n\n [1] /home/mar/Dev/Projects/R/ma-riviere.com/renv/library/linux-ubuntu-jammy/R-4.5/x86_64-pc-linux-gnu\n [2] /home/mar/.cache/R/renv/sandbox/linux-ubuntu-jammy/R-4.5/x86_64-pc-linux-gnu/25ebdc09\n\n * ── Packages attached to the search path.\n P ── Loaded and on-disk path mismatch.\n\n──────────────────────────────────────────────────────────────────────────────"
  },
  {
    "objectID": "content/blog/posts/big-bayes/index.html#matches-data",
    "href": "content/blog/posts/big-bayes/index.html#matches-data",
    "title": "MCMC for ‘Big Data’ with Stan",
    "section": "\n1.1 Matches data",
    "text": "1.1 Matches data\n  Download the matches’ data \nLoading the matches’ data:\n\nmatches_data_raw &lt;- (\n  read_csv(dir_ls(matches_data_path, regexp = \"atp_matches_(.*).csv\"), show_col_types = FALSE)\n  |&gt; select(tourney_date, tourney_level, round, winner_id, winner_name, loser_id, loser_name, score)\n  |&gt; mutate(tourney_date = lubridate::ymd(tourney_date))\n)\n\nFiltering and cleaning the combined matches’ data (based on the original post’s data processing):\n\nround_numbers = list(\n  \"R128\" = 1,\n  \"RR\" = 1,\n  \"R64\" = 2,\n  \"R32\" = 3,\n  \"R16\" = 4,\n  \"QF\" = 5,\n  \"SF\" = 6,\n  \"F\" = 7\n)\n\n(matches_data_clean &lt;- matches_data_raw \n  |&gt; filter(\n    tourney_date %between% c(\"1968-01-01\", \"2021-06-20\"),\n    str_detect(score, \"RET|W/O|DEF|nbsp|Def.\", negate = TRUE),\n    str_length(score) &gt; 4,\n    tourney_level != \"D\",\n    round %in% names(round_numbers)\n  )\n  |&gt; mutate(\n    round_number = recode(round, !!!round_numbers),\n    label = 1\n  )\n  |&gt; arrange(tourney_date, round_number)\n  |&gt; select(-round, -tourney_level)\n)\ndata.frame [160,399 x 8]\n\n\n\n\ntourney_date\n\n\nwinner_id\n\n\nwinner_name\n\n\nloser_id\n\n\nloser_name\n\n\nscore\n\n\nround_number\n\n\nlabel\n\n\n\n\n\n1968-01-19\n\n\n110 023\n\n\nRichard Coulthard\n\n\n107 760\n\n\nMax Senior\n\n\n12-10 7-5 4-6 7-5\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n109 803\n\n\nJohn Brown\n\n\n106 964\n\n\nErnie Mccabe\n\n\n6-3 6-2 6-4\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n100 257\n\n\nRoss Case\n\n\n110 024\n\n\nGondo Widjojo\n\n\n6-4 3-6 6-3 7-5\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n100 105\n\n\nAllan Stone\n\n\n110 025\n\n\nRobert Layton\n\n\n6-4 6-2 6-1\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n109 966\n\n\nWarren Jacques\n\n\n110 026\n\n\nBert Kearney\n\n\n6-4 6-1 7-5\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n107 759\n\n\nMax Pettman\n\n\n110 027\n\n\nTakesji Tsujimoto\n\n\n6-4 6-1 6-2\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n100 101\n\n\nMike Belkin\n\n\n110 028\n\n\nM Marchment\n\n\n6-2 3-6 6-4 9-7\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n100 025\n\n\nBarry Phillips Moore\n\n\n108 430\n\n\nTony Dawson\n\n\n6-3 6-0 6-3\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n108 519\n\n\nWilliam Coghlan\n\n\n110 029\n\n\nPeter Oatey\n\n\n6-0 6-2 9-11 6-3\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n109 799\n\n\nGeoff Pollard\n\n\n110 030\n\n\nChristian Janssens\n\n\n6-4 6-2 6-4\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n100 146\n\n\nJun Kamiwazumi\n\n\n110 031\n\n\nBrian Connor\n\n\n8-6 6-4 6-2\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n100 180\n\n\nBill Lloyd\n\n\n110 032\n\n\nH Nielson\n\n\n6-2 7-5 6-4\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n100 013\n\n\nNeale Fraser\n\n\n110 033\n\n\nR Harvey\n\n\n6-1 6-1 6-0\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n110 034\n\n\nMerv Guse\n\n\n110 035\n\n\nJ May\n\n\n6-1 6-2 6-2\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n100 174\n\n\nManuel Orantes\n\n\n110 036\n\n\nL Weatherhog\n\n\n6-4 6-0 6-2\n\n\n2\n\n\n1\n\n\n\n\n\n[ omitted 160,384 entries ]"
  },
  {
    "objectID": "content/blog/posts/big-bayes/index.html#player-data",
    "href": "content/blog/posts/big-bayes/index.html#player-data",
    "title": "MCMC for ‘Big Data’ with Stan",
    "section": "\n1.2 Player data",
    "text": "1.2 Player data\n  Download the players’ data \nLoading the raw player data:\n\nplayer_data_path &lt;- here(\"res\", \"data\", \"tennis\", \"atp_players.csv\")\n\n(player_data_raw &lt;- read_csv(player_data_path, show_col_types = FALSE) \n |&gt; mutate(player_name = str_c(name_first, name_last, sep = \" \"))\n |&gt; select(player_id, player_name)\n)\ndata.frame [55,649 x 2]\n\n\n\n\nplayer_id\n\n\nplayer_name\n\n\n\n\n\n100 001\n\n\nGardnar Mulloy\n\n\n\n\n100 002\n\n\nPancho Segura\n\n\n\n\n100 003\n\n\nFrank Sedgman\n\n\n\n\n100 004\n\n\nGiuseppe Merlo\n\n\n\n\n100 005\n\n\nRichard Gonzalez\n\n\n\n\n100 006\n\n\nGrant Golden\n\n\n\n\n100 007\n\n\nAbe Segal\n\n\n\n\n100 008\n\n\nKurt Nielsen\n\n\n\n\n100 009\n\n\nIstvan Gulyas\n\n\n\n\n100 010\n\n\nLuis Ayala\n\n\n\n\n100 011\n\n\nTorben Ulrich\n\n\n\n\n100 012\n\n\nNicola Pietrangeli\n\n\n\n\n100 013\n\n\nNeale Fraser\n\n\n\n\n100 014\n\n\nTrevor Fancutt\n\n\n\n\n100 015\n\n\nSammy Giammalva\n\n\n\n\n\n[ omitted 55,634 entries ]\n\n\n\n\n\n\nFiltering player_data to only keep the players actually present in our data, and updating their IDs:\n\n(player_data &lt;- with(matches_data_clean, tibble(player_id = union(winner_id, loser_id)))\n |&gt; arrange(player_id)\n |&gt; summarize(player_idx = cur_group_id(), .by = player_id)\n |&gt; left_join(player_data_raw, join_by(player_id))\n)\ndata.frame [4,830 x 3]\n\n\n\n\nplayer_id\n\n\nplayer_idx\n\n\nplayer_name\n\n\n\n\n\n100 001\n\n\n1\n\n\nGardnar Mulloy\n\n\n\n\n100 002\n\n\n2\n\n\nPancho Segura\n\n\n\n\n100 003\n\n\n3\n\n\nFrank Sedgman\n\n\n\n\n100 004\n\n\n4\n\n\nGiuseppe Merlo\n\n\n\n\n100 005\n\n\n5\n\n\nRichard Gonzalez\n\n\n\n\n100 006\n\n\n6\n\n\nGrant Golden\n\n\n\n\n100 007\n\n\n7\n\n\nAbe Segal\n\n\n\n\n100 009\n\n\n8\n\n\nIstvan Gulyas\n\n\n\n\n100 010\n\n\n9\n\n\nLuis Ayala\n\n\n\n\n100 011\n\n\n10\n\n\nTorben Ulrich\n\n\n\n\n100 012\n\n\n11\n\n\nNicola Pietrangeli\n\n\n\n\n100 013\n\n\n12\n\n\nNeale Fraser\n\n\n\n\n100 014\n\n\n13\n\n\nTrevor Fancutt\n\n\n\n\n100 015\n\n\n14\n\n\nSammy Giammalva\n\n\n\n\n100 016\n\n\n15\n\n\nKen Rosewall\n\n\n\n\n\n[ omitted 4,815 entries ]"
  },
  {
    "objectID": "content/blog/posts/big-bayes/index.html#matches-player-data",
    "href": "content/blog/posts/big-bayes/index.html#matches-player-data",
    "title": "MCMC for ‘Big Data’ with Stan",
    "section": "\n1.3 Matches + Player data",
    "text": "1.3 Matches + Player data\nAllocating the new player IDs (player_idx) to the winner_id and loser_id from matches_data:\n\n(matches_data &lt;- left_join(matches_data_clean, player_data, by = c(\"winner_id\" = \"player_id\")) \n |&gt; rename(winner_idx = player_idx) \n |&gt; relocate(winner_idx, .after = winner_id) \n |&gt; left_join(player_data, by = c(\"loser_id\" = \"player_id\")) \n |&gt; rename(loser_idx = player_idx) \n |&gt; relocate(loser_idx, .after = loser_id)\n |&gt; drop_na(winner_idx, loser_idx)\n |&gt; select(-matches(\"player_name\"))\n)\ndata.frame [160,399 x 10]\n\n\n\n\ntourney_date\n\n\nwinner_id\n\n\nwinner_idx\n\n\nwinner_name\n\n\nloser_id\n\n\nloser_idx\n\n\nloser_name\n\n\nscore\n\n\nround_number\n\n\nlabel\n\n\n\n\n\n1968-01-19\n\n\n110 023\n\n\n3 655\n\n\nRichard Coulthard\n\n\n107 760\n\n\n3 129\n\n\nMax Senior\n\n\n12-10 7-5 4-6 7-5\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n109 803\n\n\n3 440\n\n\nJohn Brown\n\n\n106 964\n\n\n2 909\n\n\nErnie Mccabe\n\n\n6-3 6-2 6-4\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n100 257\n\n\n253\n\n\nRoss Case\n\n\n110 024\n\n\n3 656\n\n\nGondo Widjojo\n\n\n6-4 3-6 6-3 7-5\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n100 105\n\n\n103\n\n\nAllan Stone\n\n\n110 025\n\n\n3 657\n\n\nRobert Layton\n\n\n6-4 6-2 6-1\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n109 966\n\n\n3 600\n\n\nWarren Jacques\n\n\n110 026\n\n\n3 658\n\n\nBert Kearney\n\n\n6-4 6-1 7-5\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n107 759\n\n\n3 128\n\n\nMax Pettman\n\n\n110 027\n\n\n3 659\n\n\nTakesji Tsujimoto\n\n\n6-4 6-1 6-2\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n100 101\n\n\n99\n\n\nMike Belkin\n\n\n110 028\n\n\n3 660\n\n\nM Marchment\n\n\n6-2 3-6 6-4 9-7\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n100 025\n\n\n24\n\n\nBarry Phillips Moore\n\n\n108 430\n\n\n3 325\n\n\nTony Dawson\n\n\n6-3 6-0 6-3\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n108 519\n\n\n3 349\n\n\nWilliam Coghlan\n\n\n110 029\n\n\n3 661\n\n\nPeter Oatey\n\n\n6-0 6-2 9-11 6-3\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n109 799\n\n\n3 436\n\n\nGeoff Pollard\n\n\n110 030\n\n\n3 662\n\n\nChristian Janssens\n\n\n6-4 6-2 6-4\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n100 146\n\n\n144\n\n\nJun Kamiwazumi\n\n\n110 031\n\n\n3 663\n\n\nBrian Connor\n\n\n8-6 6-4 6-2\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n100 180\n\n\n178\n\n\nBill Lloyd\n\n\n110 032\n\n\n3 664\n\n\nH Nielson\n\n\n6-2 7-5 6-4\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n100 013\n\n\n12\n\n\nNeale Fraser\n\n\n110 033\n\n\n3 665\n\n\nR Harvey\n\n\n6-1 6-1 6-0\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n110 034\n\n\n3 666\n\n\nMerv Guse\n\n\n110 035\n\n\n3 667\n\n\nJ May\n\n\n6-1 6-2 6-2\n\n\n2\n\n\n1\n\n\n\n\n1968-01-19\n\n\n100 174\n\n\n172\n\n\nManuel Orantes\n\n\n110 036\n\n\n3 668\n\n\nL Weatherhog\n\n\n6-4 6-0 6-2\n\n\n2\n\n\n1\n\n\n\n\n\n[ omitted 160,384 entries ]"
  },
  {
    "objectID": "content/blog/posts/big-bayes/index.html#stan-code",
    "href": "content/blog/posts/big-bayes/index.html#stan-code",
    "title": "MCMC for ‘Big Data’ with Stan",
    "section": "\n2.1 Stan code",
    "text": "2.1 Stan code\n\n\n\n\n\n\nUpdated Stan code with within-chain parallelization\n\n\n\n\n\n\ntennis_model\n\nfunctions {\n  array[] int sequence(int start, int end) {\n    array[end - start + 1] int seq;\n    for (n in 1 : num_elements(seq)) {\n      seq[n] = n + start - 1;\n    }\n    return seq;\n  }\n\n  // Compute partial sums of the log-likelihood\n  real partial_log_lik_lpmf(array[] int seq, int start, int end,\n                            data array[] int labels, \n                            data array[] int winner_ids, \n                            data array[] int loser_ids, \n                            vector player_skills) {\n    real ptarget = 0;\n    int N = end - start + 1;\n\n    vector[N] mu = rep_vector(0.0, N);\n    for (n in 1 : N) {\n      int nn = n + start - 1;\n      mu[n] += player_skills[winner_ids[nn]] - player_skills[loser_ids[nn]];\n    }\n    ptarget += bernoulli_logit_lpmf(labels[start : end] | mu);\n    return ptarget;\n  }\n}\ndata {\n    int n_players;\n    int n_matches;\n    \n    array[n_matches] int&lt;lower=1, upper=n_players&gt; winner_ids; // Winner of game n\n    array[n_matches] int&lt;lower=1, upper=n_players&gt; loser_ids;  // Loser of game n\n    array[n_matches] int&lt;lower=0, upper=1&gt; labels;             // Always 1 in this model\n    \n    int grainsize;\n}\ntransformed data {\n    array[n_matches] int seq = sequence(1, n_matches);\n}\nparameters {\n    real&lt;lower=0&gt; player_sd;          // Scale of ability variation (hierarchical prior)\n    vector[n_players] player_skills;  // Ability of player k\n}\nmodel {   \n  player_sd ~ std_normal();\n  player_skills ~ normal(0, player_sd);\n    \n  target += reduce_sum(\n    partial_log_lik_lpmf, seq, grainsize, \n    labels, winner_ids, loser_ids, player_skills\n  );\n}"
  },
  {
    "objectID": "content/blog/posts/big-bayes/index.html#stan-data",
    "href": "content/blog/posts/big-bayes/index.html#stan-data",
    "title": "MCMC for ‘Big Data’ with Stan",
    "section": "\n2.2 Stan data",
    "text": "2.2 Stan data\n\ntennis_stan_data &lt;- list(\n  n_matches = nrow(matches_data),\n  n_players = with(matches_data, length(union(winner_id, loser_id))),\n  winner_ids = matches_data$winner_idx,\n  loser_ids = matches_data$loser_idx,\n  labels = matches_data$label,\n  grainsize = max(100L, round(nrow(matches_data) / 60))\n)"
  },
  {
    "objectID": "content/blog/posts/big-bayes/index.html#model-fit",
    "href": "content/blog/posts/big-bayes/index.html#model-fit",
    "title": "MCMC for ‘Big Data’ with Stan",
    "section": "\n2.3 Model fit",
    "text": "2.3 Model fit\n\ntennis_mod_fit &lt;- tennis_model$sample(\n  data = tennis_stan_data, seed = 256,\n  iter_warmup = 1000, iter_sampling = 1000, refresh = 0,\n  chains = 4, parallel_chains = 4, threads_per_chain = 7\n)\n\n\n\n\n\n\n\nNote\n\n\n\nSampling takes ~2.81 minutes on my CPU (Ryzen 5950X, 16 Cores/32 Threads), on WSL2 (Ubuntu 22)\n\ndata.table [4 x 2]\n\n\n\n\nChain\n\n\nTime\n\n\n\n\n\n1\n\n\n169.554s (~2.83 minutes)\n\n\n\n\n2\n\n\n169.567s (~2.83 minutes)\n\n\n\n\n3\n\n\n166.78s (~2.78 minutes)\n\n\n\n\n4\n\n\n168.79s (~2.81 minutes)"
  },
  {
    "objectID": "content/blog/posts/big-bayes/index.html#posterior-data",
    "href": "content/blog/posts/big-bayes/index.html#posterior-data",
    "title": "MCMC for ‘Big Data’ with Stan",
    "section": "\n4.1 Posterior data",
    "text": "4.1 Posterior data\nGetting our Posterior Predictions into long format and joining the result with player_data:\n\n(player_skills &lt;- tennis_mod_fit$draws(variables = \"player_skills\")\n  |&gt; bind(x, subset_draws(x, \"player_skills\", regex = TRUE, draw = sample.int(ndraws(x), size = 500)))\n  |&gt; as.data.table()\n  |&gt; _[, .(player_skills = list(value)), by = variable\n  ][, let(player_idx = as.integer(str_extract(variable, \"\\\\d{1,4}\")), variable = NULL)\n  ][, let(skill_mean = sapply(player_skills, mean), skill_sd = sapply(player_skills, sd))\n  ][as.data.table(player_data), on = \"player_idx\", nomatch = NULL\n  ][order(-skill_mean), .(player_name, player_id, player_idx, skill_mean, skill_sd, player_skills)]\n)\ndata.table [4,830 x 6]\n\n\n\n\nplayer_name\n\n\nplayer_id\n\n\nplayer_idx\n\n\nskill_mean\n\n\nskill_sd\n\n\nplayer_skills\n\n\n\n\n\nNovak Djokovic\n\n\n104 925\n\n\n2 415\n\n\n3.543\n\n\n0.095\n\n\n&lt;numeric [500]&gt;\n\n\n\n\nRafael Nadal\n\n\n104 745\n\n\n2 367\n\n\n3.426\n\n\n0.087\n\n\n&lt;numeric [500]&gt;\n\n\n\n\nRoger Federer\n\n\n103 819\n\n\n2 082\n\n\n3.316\n\n\n0.079\n\n\n&lt;numeric [500]&gt;\n\n\n\n\nBjorn Borg\n\n\n100 437\n\n\n423\n\n\n3.244\n\n\n0.103\n\n\n&lt;numeric [500]&gt;\n\n\n\n\nIvan Lendl\n\n\n100 656\n\n\n613\n\n\n3.218\n\n\n0.084\n\n\n&lt;numeric [500]&gt;\n\n\n\n\nJohn McEnroe\n\n\n100 581\n\n\n553\n\n\n3.181\n\n\n0.085\n\n\n&lt;numeric [500]&gt;\n\n\n\n\nJimmy Connors\n\n\n100 284\n\n\n280\n\n\n3.16\n\n\n0.076\n\n\n&lt;numeric [500]&gt;\n\n\n\n\nRod Laver\n\n\n100 029\n\n\n28\n\n\n3.007\n\n\n0.101\n\n\n&lt;numeric [500]&gt;\n\n\n\n\nAndy Murray\n\n\n104 918\n\n\n2 413\n\n\n2.924\n\n\n0.098\n\n\n&lt;numeric [500]&gt;\n\n\n\n\nPete Sampras\n\n\n101 948\n\n\n1 408\n\n\n2.92\n\n\n0.087\n\n\n&lt;numeric [500]&gt;\n\n\n\n\nBoris Becker\n\n\n101 414\n\n\n1 127\n\n\n2.828\n\n\n0.086\n\n\n&lt;numeric [500]&gt;\n\n\n\n\nAndre Agassi\n\n\n101 736\n\n\n1 310\n\n\n2.775\n\n\n0.081\n\n\n&lt;numeric [500]&gt;\n\n\n\n\nStefan Edberg\n\n\n101 222\n\n\n993\n\n\n2.733\n\n\n0.09\n\n\n&lt;numeric [500]&gt;\n\n\n\n\nAndy Roddick\n\n\n104 053\n\n\n2 157\n\n\n2.698\n\n\n0.093\n\n\n&lt;numeric [500]&gt;\n\n\n\n\nJuan Martin del Potro\n\n\n105 223\n\n\n2 503\n\n\n2.667\n\n\n0.108\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n\n[ omitted 4,815 entries ]"
  },
  {
    "objectID": "content/blog/posts/big-bayes/index.html#posterior-plots",
    "href": "content/blog/posts/big-bayes/index.html#posterior-plots",
    "title": "MCMC for ‘Big Data’ with Stan",
    "section": "\n4.2 Posterior plots",
    "text": "4.2 Posterior plots\n\nridgeline_plotridgeline_plot &lt;- function(dat, var) {\n  dat &lt;- dat[, .(player_skills = unlist(player_skills)), by = setdiff(names(dat), 'player_skills')\n     ][, player_name := factor(player_name, levels = rev(unique(player_name)))]\n  \n  return(\n    ggplot(dat, aes(player_skills, y = {{ var }}, fill = {{ var }}))\n    + geom_ribbon(\n      stat = \"density\", outline.type = \"upper\", color = \"grey30\",\n      aes(\n        fill = stage({{ var }}, after_scale = alpha(fill, 0.5)),\n        ymin = after_stat(group),\n        ymax = after_stat(group + ndensity * 1.6)\n      )\n    )\n    * ggblend::blend(\"multiply\")\n    + labs(x = \"Player Skills\", y = \"\")\n    + scale_y_discrete(position = \"right\", labels = \\(x) str_replace_all(x, \"\\\\s\", \"\\n\"))\n    + theme(legend.position = \"none\", axis.line.y = element_blank())\n  )\n}\n\n\nPlotting the player_skills posteriors of the top 10 players:\n\nhead(player_skills, 10) |&gt; ridgeline_plot(player_name)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nTip💻 Expand for Session Info\n\n\n\n\n\n\n\n─ Session info ───────────────────────────────────────────────────────────────\n setting        value\n version        R version 4.5.1 (2025-06-13)\n os             Ubuntu 22.04.5 LTS\n system         x86_64, linux-gnu\n ui             X11\n language       (EN)\n collate        C.UTF-8\n ctype          C.UTF-8\n tz             Europe/Oslo\n date           2025-09-21\n pandoc         2.9.2.1\n quarto         1.8.17 @ /opt/quarto/bin/quarto\n Quarto         1.8.17\n Stan (CmdStan) 2.37.0\n\n─ Packages ───────────────────────────────────────────────────────────────────\n ! package    * version     date (UTC) lib source\n P archive    * 1.1.12      2025-03-20 [?] CRAN (R 4.5.1)\n P bayesplot  * 1.14.0.9000 2025-09-08 [?] https://stan-dev.r-universe.dev (R 4.5.1)\n P cmdstanr   * 0.9.0       2025-03-30 [?] https://stan-dev.r-universe.dev (R 4.5.1)\n P crayon     * 1.5.3       2024-06-20 [?] CRAN (R 4.5.1)\n P data.table * 1.17.8      2025-07-10 [?] CRAN (R 4.5.1)\n P dplyr      * 1.1.4       2023-11-17 [?] CRAN (R 4.5.1)\n P fs         * 1.6.6       2025-04-12 [?] CRAN (R 4.5.1)\n P ggplot2    * 4.0.0       2025-09-11 [?] CRAN (R 4.5.1)\n P gt         * 1.0.0       2025-04-05 [?] CRAN (R 4.5.1)\n P here       * 1.0.2       2025-09-15 [?] CRAN (R 4.5.1)\n P htmltools  * 0.5.8.1     2024-04-04 [?] CRAN (R 4.5.1)\n P knitr      * 1.50        2025-03-16 [?] CRAN (R 4.5.1)\n P lubridate  * 1.9.4       2024-12-08 [?] CRAN (R 4.5.1)\n P patchwork  * 1.3.2       2025-08-25 [?] CRAN (R 4.5.1)\n P pipebind   * 0.1.2       2023-08-30 [?] CRAN (R 4.5.1)\n P posterior  * 1.6.1       2025-02-27 [?] CRAN (R 4.5.1)\n P purrr      * 1.1.0       2025-07-10 [?] CRAN (R 4.5.1)\n P reactable  * 0.4.4       2023-03-12 [?] CRAN (R 4.5.1)\n P readr      * 2.1.5       2024-01-10 [?] CRAN (R 4.5.1)\n P stringr    * 1.5.2       2025-09-08 [?] CRAN (R 4.5.1)\n P tibble     * 3.3.0       2025-06-08 [?] CRAN (R 4.5.1)\n P tidyr      * 1.3.1       2024-01-24 [?] CRAN (R 4.5.1)\n\n [1] /home/mar/Dev/Projects/R/ma-riviere.com/renv/library/linux-ubuntu-jammy/R-4.5/x86_64-pc-linux-gnu\n [2] /home/mar/.cache/R/renv/sandbox/linux-ubuntu-jammy/R-4.5/x86_64-pc-linux-gnu/25ebdc09\n\n * ── Packages attached to the search path.\n P ── Loaded and on-disk path mismatch.\n\n──────────────────────────────────────────────────────────────────────────────"
  },
  {
    "objectID": "content/about.html",
    "href": "content/about.html",
    "title": "\n About Me",
    "section": "",
    "text": "NoteIn a nutshell:\n\n\n\n◈ Building software and analyzing data for 7 years, with a focus on R and Shiny.\n◈ Designing, building, and deploying Web apps, APIs, packages, websites, and interactive dashboards.\n◈ Published Neuroscientist, involved in multiple interdisciplinary projects working with a wide range of data, mostly biological, but also behavioral, surveys, energy, geography/spatial, and sales/marketing."
  },
  {
    "objectID": "content/about.html#work-experience",
    "href": "content/about.html#work-experience",
    "title": "\n About Me",
    "section": "\n Work Experience",
    "text": "Work Experience\n\n\nR/Shiny Developer (2024-Present)Data Champ’, RemoteDesigned, coded & deployed Shiny apps and APIs for a dozen different projects, including:\n♦ A comprehensive HR management system for France’s development agency (AFD) to track thousands of employees across multiple branches, featuring recruitment campaign management, predictive workforce analytics, and role-based approval workflows.\n♦ An investment analytics platform for the AFD, to visualize and track their portfolio of billions in international development funding across thousands of projects in multiple developing countries, with cross-platform data integration, interactive geospatial visualizations, and automated impact reporting to support sustainable development decision-making.\n♦ A modular package for a branch of the French government, to integrate multiple sources of heterogeneous geo-spatial data, process them into multiple spatio-temporal indicators computed at various levels of spatial granularity, and archive them in a specially-designed DB, to be displayed in a public interactive web app.\n♦ An integrated construction site management system with tree-based cost estimation, multi-format document parsing using LLMs, bidirectional integration with the Odoo ERP, automated quote generation, and smart project scheduling.\n♦ An enterprise-scale energy Measurement & Verification API for the Belgian Government, automating standard and IPMVP methods for energy consumption modeling, statistical analyses at multiple levels of granularity, multi-platform data integration, and estimating the impact of renovations on energy consumption with comprehensive report generation.\n\n\nR/Data Science Consultant (2022-2024)Self-employed, RemoteSales/Marketing:\n♦ Developed a sales automation tool featuring automated web/social media scraping for lead enrichment, agentic AI workflows for prospect discovery and personalized email generation, and multi-CRM API integration\nBioinformatics:\n♦ Conducted the statistical analyses for 4 published papers in Biology (imaging, IHC, qPCR, and behavioral data) using generalized multilevel models\n♦ Automated pipelines to pull/enrich genetic data from entrez/NCBI\n♦ Created a Shiny app to allow team members to import, visualize and analyze their data\n♦ Built interactive dashboards to showcase results for select publications (R, Quarto, JS)\n\nResearch Engineer (2021-2023)LITIS Lab, Rouen, France (Hybrid)\n♦ Designed & developed an Augmented Reality platform in with motion tracking and spatialized sound feedback, to evaluate and train non-visual navigation (Unity/C#)\n♦ Designed a wearable vibrotactile belt for haptic-based navigation for blind people, and participated in the design of an interactive haptic tablet to display images (Java/Arduino)\n♦ Designed psychophysics experiments to evaluate the impact of spatial cues on navigation\n♦ Developed and tested camera-based solutions for indoor localization (Python/C++)\n♦ Formulated & wrote a 600k€ research grant proposal (ANR project “SAM-Guide”, 2021)\n♦ Co-organized an international (IHAW’20) and a regional (JED’17) scientific conference\nGraduate Teaching Fellow (2017-2020)University of Rouen-Normandy\n♦ Gave university classes on Web Development (JS), Image Processing (Python), GUI design (Java), and ML/DL for Computer Vision\nResearch & Engineering Intern (Nov 2018 – Jan 2019)The Smith-Kettlewell Eye Research Institute, San Francisco, CA, USA\n♦ Worked on an indoor localization solution using Visual Inertial Odometry, particle filtering, object detection, and real-time video streaming (Python/Husk, Swift, OpenCV)\nResearch & Engineering Intern (Feb 2016 – Sep 2016)Grenoble INP GIPSA-lab, Grenoble, France\n♦ Developed an image-to-sound conversion app for blind shape exploration on a tablet (C++)\n♦ Iteratively improved the app based on statistical analysis of users’ performance"
  },
  {
    "objectID": "content/about.html#contact-me",
    "href": "content/about.html#contact-me",
    "title": "\n About Me",
    "section": "\n Contact Me",
    "text": "Contact Me\nYou can send me an email, or directly message me on twitter."
  },
  {
    "objectID": "content/about.html#about-this-site",
    "href": "content/about.html#about-this-site",
    "title": "\n About Me",
    "section": "\n About this site",
    "text": "About this site\nThis website was made with Quarto and R.\n\n\n\n\n\n\nTipExpand for Session Info\n\n\n\n\n\n\n\n─ Session info ───────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.5.1 (2025-06-13)\n os       Ubuntu 22.04.5 LTS\n system   x86_64, linux-gnu\n ui       X11\n language (EN)\n collate  C.UTF-8\n ctype    C.UTF-8\n tz       Europe/Oslo\n date     2025-09-21\n pandoc   2.9.2.1\n quarto   1.8.17 @ /opt/quarto/bin/quarto\n Quarto   1.8.17\n\n─ Packages ───────────────────────────────────────────────────────────────────\n ! package     * version     date (UTC) lib source\n P archive     * 1.1.12      2025-03-20 [?] CRAN (R 4.5.1)\n P arrow       * 21.0.0.1    2025-08-18 [?] CRAN (R 4.5.1)\n P bayesplot   * 1.14.0.9000 2025-09-08 [?] https://stan-dev.r-universe.dev (R 4.5.1)\n P brms        * 2.23.0      2025-09-09 [?] CRAN (R 4.5.1)\n P broom       * 1.0.10      2025-09-13 [?] CRAN (R 4.5.1)\n P cmdstanr    * 0.9.0       2025-03-30 [?] https://stan-dev.r-universe.dev (R 4.5.1)\n P crayon      * 1.5.3       2024-06-20 [?] CRAN (R 4.5.1)\n P data.table  * 1.17.8      2025-07-10 [?] CRAN (R 4.5.1)\n P datawizard  * 1.2.0       2025-07-17 [?] CRAN (R 4.5.1)\n P DBI         * 1.2.3       2024-06-02 [?] CRAN (R 4.5.1)\n P dbplyr      * 2.5.1       2025-09-10 [?] CRAN (R 4.5.1)\n P downlit     * 0.4.4       2024-06-10 [?] CRAN (R 4.5.1)\n P dplyr       * 1.1.4       2023-11-17 [?] CRAN (R 4.5.1)\n P duckdb      * 1.4.0       2025-09-18 [?] CRAN (R 4.5.1)\n P fuzzyjoin   * 0.1.6.1     2025-07-10 [?] CRAN (R 4.5.1)\n P ggblend     * 0.1.0       2023-05-22 [?] CRAN (R 4.5.1)\n P ggplot2     * 4.0.0       2025-09-11 [?] CRAN (R 4.5.1)\n P ggtext      * 0.1.2       2022-09-16 [?] CRAN (R 4.5.1)\n P gt          * 1.0.0       2025-04-05 [?] CRAN (R 4.5.1)\n P gtools      * 3.9.5       2023-11-20 [?] CRAN (R 4.5.1)\n P here        * 1.0.2       2025-09-15 [?] CRAN (R 4.5.1)\n P leaflet     * 2.2.3       2025-09-04 [?] CRAN (R 4.5.1)\n P lubridate   * 1.9.4       2024-12-08 [?] CRAN (R 4.5.1)\n P patchwork   * 1.3.2       2025-08-25 [?] CRAN (R 4.5.1)\n P plotly      * 4.11.0      2025-06-19 [?] CRAN (R 4.5.1)\n P posterior   * 1.6.1       2025-02-27 [?] CRAN (R 4.5.1)\n P purrr       * 1.1.0       2025-07-10 [?] CRAN (R 4.5.1)\n P quarto      * 1.5.1       2025-09-04 [?] CRAN (R 4.5.1)\n P Rcpp        * 1.1.0       2025-07-02 [?] CRAN (R 4.5.1)\n P readr       * 2.1.5       2024-01-10 [?] CRAN (R 4.5.1)\n P sessioninfo * 1.2.3       2025-02-05 [?] CRAN (R 4.5.1)\n P sf          * 1.0-21      2025-05-15 [?] CRAN (R 4.5.1)\n P stringr     * 1.5.2       2025-09-08 [?] CRAN (R 4.5.1)\n P tibble      * 3.3.0       2025-06-08 [?] CRAN (R 4.5.1)\n P tidybayes   * 3.0.7       2024-09-15 [?] CRAN (R 4.5.1)\n P tidyr       * 1.3.1       2024-01-24 [?] CRAN (R 4.5.1)\n P xml2        * 1.4.0       2025-08-20 [?] CRAN (R 4.5.1)\n\n [1] /home/mar/Dev/Projects/R/ma-riviere.com/renv/library/linux-ubuntu-jammy/R-4.5/x86_64-pc-linux-gnu\n [2] /home/mar/.cache/R/renv/sandbox/linux-ubuntu-jammy/R-4.5/x86_64-pc-linux-gnu/25ebdc09\n\n * ── Packages attached to the search path.\n P ── Loaded and on-disk path mismatch.\n\n──────────────────────────────────────────────────────────────────────────────"
  },
  {
    "objectID": "content/blog/index.html",
    "href": "content/blog/index.html",
    "title": " Blog",
    "section": "",
    "text": "Order By\n      Default\n      \n        Date - Oldest\n      \n      \n        Date - Newest\n      \n      \n        Title\n      \n    \n  \n    \n      \n      \n    \n\n\n\n\n\nFast spatial data matching in R\n\n\nExploring different solutions to match locations based on their geographical distance\n\n\n\nR\n\nDuckDB\n\nSpatial\n\nGIS\n\nBig Data\n\nSQL\n\n\n\nThis post showcases various solutions to efficiently match unknown locations to known ones by their geographical proximity (using lat/long coordinates), on a dataset with millions of entries.\n\n\n\n\n\nJun 18, 2022\n\n42 min\n\n\n\n\n\n\nMCMC for ‘Big Data’ with Stan\n\n\nFaster sampling with CmdStan using within-chain parallelization\n\n\n\nR\n\nStatistics\n\nML\n\nBayesian Modeling\n\nStan\n\nBig Data\n\n\n\nThis post is an extension (and a translation to R) of PyMC-Labs’ benchmarking of MCMC for “Big Data”.\nThe Stan code was updated to use within-chain parallelization and compiler optimization for faster CPU sampling. Stan was able to achieve similar sampling speeds as PyMC’s JAX + GPU solution, purely on CPU.\n\n\n\n\n\nJun 5, 2022\n\n10 min\n\n\n\n\n\n\nData wrangling with data.table and the Tidyverse\n\n\nCommon data wrangling operations with both data.table and the Tidyverse.\n\n\n\nR\n\nTidyverse\n\ndata.table\n\n\n\nThis post showcases various ways to accomplish most data wrangling operations, from basic filtering/mutating to pivots and non-equi joins, with both data.table and the Tidyverse (dplyr, tidyr, purrr, stringr).\n\n\n\n\n\nMay 19, 2022\n\n45 min\n\n\n\n\n\n\nBayesian Rock Climbing Rankings\n\n\nWith R and Stan\n\n\n\nR\n\nStatistics\n\nML\n\nBayesian Modeling\n\nStan\n\n\n\nThis post is a transposition to R of Ethan Rosenthal’s blog post on modeling Rock Climbing route difficulty using a Bayesian IRT (Item Response Theory) model.\nThe original Stan code was updated to use within-chain parallelization and compiler optimization for faster CPU sampling.\nSeveral data processing solutions are showcased, using either data.table or dbplyr (with a DuckDB backend), with timings to compare their speed.\n\n\n\n\n\nApr 19, 2022\n\n16 min\n\n\n\n\nNo matching items\n Back to topReuseCC BY 4.0"
  },
  {
    "objectID": "content/blog/posts/climbing/index.html#extracting-the-data",
    "href": "content/blog/posts/climbing/index.html#extracting-the-data",
    "title": "Bayesian Rock Climbing Rankings",
    "section": "\n1.1 Extracting the data",
    "text": "1.1 Extracting the data\nConnecting to the .sqlite DB (using DuckDB instead of SQLite):\n\ncon &lt;- dbConnect(duckdb(), dbdir = \":memory:\")\n\ndb_path &lt;- here(\"res\", \"data\", \"climbers.sqlite\")\n\n\nINSTALL sqlite;\nLOAD sqlite;\nCALL sqlite_attach(?db_path);\n\n\n\n\n\n\n\n\ndbplyr automatically translates dplyr/tidyr code into SQL !\n\n\n\n\n\ndbplyr\nSQL\n\n\n\n\n\n(list(\n    ## Table 1: ascent\n    tbl(con, \"ascent\") \n    |&gt; filter(country %like% \"USA\") \n    |&gt; mutate(\n        route_id = str_c(\n          str_replace_all(crag, ' ', '_'), \"__\", \n          str_replace_all(name, ' ', '_'), \"__\", \n          if_else(climb_type == 1, 'boulder', 'rope')\n        ),\n        ascent_date = to_timestamp(date)\n    ) \n    |&gt; select(user_id, route_id, climb_type, grade_id, method_id, ascent_date),\n    ## Table 2: grade\n    tbl(con, \"grade\") |&gt; select(grade_id = id, usa_routes, usa_boulders),\n    ## Table 3: method\n    tbl(con, \"method\") |&gt; select(method_id = id, method_name = name)\n  )\n  |&gt; reduce(left_join)\n  |&gt; select(-grade_id, -method_id)\n  |&gt; compute(\"climbs\", overwrite = TRUE)\n)\n\n\nTime difference of 1.452 secs\n\n\n\n\nSELECT\n  ascent.user_id\n  , REPLACE(ascent.crag, ' ', '_')\n      || '__' || REPLACE(ascent.name, ' ', '_')\n      || '__' || CASE WHEN ascent.climb_type = 1 THEN 'boulder' ELSE 'rope' END\n      AS route_id\n  , ascent.climb_type as climb_type\n  , to_timestamp(ascent.date) AS ascent_date\n  , grade.usa_routes\n  , grade.usa_boulders\n  , method.name AS method_name\nFROM ascent\nJOIN grade ON grade.id = ascent.grade_id\nJOIN method ON method.id = ascent.method_id\nWHERE ascent.country = 'USA'\n\n\nTime difference of 0.8314 secs\n\n\n\n\n\ndata.frame [658,822 x 7]\n\n\n\n\nuser_id\n\n\nroute_id\n\n\nclimb_type\n\n\nascent_date\n\n\nusa_routes\n\n\nusa_boulders\n\n\nmethod_name\n\n\n\n\n\n9 431\n\n\nBoulder_Canyon__Cage_Free__boulder\n\n\n1\n\n\n2008-11-26 23:00:00\n\n\n5.13a\n\n\nV10\n\n\nRedpoint\n\n\n\n\n24 301\n\n\nPoudre_Canyon__Twilight__boulder\n\n\n1\n\n\n2008-03-04 23:00:00\n\n\n5.12d\n\n\nV9\n\n\nRedpoint\n\n\n\n\n24 301\n\n\nBishop__Freeze_all_Cylinders__boulder\n\n\n1\n\n\n2008-03-21 23:00:00\n\n\n5.12d\n\n\nV9\n\n\nRedpoint\n\n\n\n\n24 301\n\n\nsatellites__Toe_to_Toe__boulder\n\n\n1\n\n\n2008-07-29 22:00:00\n\n\n5.12d\n\n\nV9\n\n\nRedpoint\n\n\n\n\n24 301\n\n\nR.M.N.P.__Gang_Bang_Arete__boulder\n\n\n1\n\n\n2008-07-24 22:00:00\n\n\n5.12d\n\n\nV9\n\n\nRedpoint\n\n\n\n\n24 301\n\n\nR.M.N.P.__Handicapps__boulder\n\n\n1\n\n\n2008-07-27 22:00:00\n\n\n5.12d\n\n\nV9\n\n\nRedpoint\n\n\n\n\n24 301\n\n\nSuzuki_Bldrs.__Suzuki_9__boulder\n\n\n1\n\n\n2008-09-19 22:00:00\n\n\n5.12d\n\n\nV9\n\n\nRedpoint\n\n\n\n\n24 301\n\n\nMoore’s_Wall__Tsunami__boulder\n\n\n1\n\n\n2008-11-22 23:00:00\n\n\n5.12c\n\n\nV8/9\n\n\nRedpoint\n\n\n\n\n24 301\n\n\nMoraine_Park__Bread_Pudding??__boulder\n\n\n1\n\n\n2008-03-31 22:00:00\n\n\n5.12c\n\n\nV8/9\n\n\nRedpoint\n\n\n\n\n24 301\n\n\nBishop__Fly_Boy_Sit__boulder\n\n\n1\n\n\n2008-03-18 23:00:00\n\n\n5.12c\n\n\nV8/9\n\n\nRedpoint\n\n\n\n\n24 301\n\n\nBishop__Checkerboard__boulder\n\n\n1\n\n\n2008-03-19 23:00:00\n\n\n5.12c\n\n\nV8/9\n\n\nRedpoint\n\n\n\n\n24 301\n\n\nCarter_Lake__Dough_Boy__boulder\n\n\n1\n\n\n2008-01-31 23:00:00\n\n\n5.12c\n\n\nV8/9\n\n\nRedpoint\n\n\n\n\n24 301\n\n\nJoe’s_Valley__Anti-Future_Plan__boulder\n\n\n1\n\n\n2007-11-27 23:00:00\n\n\n5.12c\n\n\nV8/9\n\n\nRedpoint\n\n\n\n\n17 412\n\n\nAmerican_Fork__Speedball__boulder\n\n\n1\n\n\n2008-11-25 23:00:00\n\n\n5.12c\n\n\nV8/9\n\n\nRedpoint\n\n\n\n\n24 301\n\n\nMt_Evans__Seurat__boulder\n\n\n1\n\n\n2008-05-27 22:00:00\n\n\n5.12c\n\n\nV8/9\n\n\nRedpoint\n\n\n\n\n\n[ omitted 658,807 entries ]"
  },
  {
    "objectID": "content/blog/posts/climbing/index.html#processing-the-data",
    "href": "content/blog/posts/climbing/index.html#processing-the-data",
    "title": "Bayesian Rock Climbing Rankings",
    "section": "\n1.2 Processing the data",
    "text": "1.2 Processing the data\n\nroute_ratings &lt;- c(\n  str_c(\"5.\", 1:9), \n  map(str_c(\"5.\", 10:15), \\(x) str_c(x, letters[1:4])) |&gt; unlist()\n)\n\nbouldering_grades &lt;- str_c(\"V\", 0:20)\n\n## Mode for non-numerical data\nmode_cat &lt;- function(x) {\n  x &lt;- sort(na.omit(as.character(x)))\n  unique(x)[which.max(tabulate(match(x, unique(x))))]\n}\n\n\n\ndata.table\ndbplyr\n\n\n\n\nthreshold_ascents_dtclimbs &lt;- setDT(climbs_df) |&gt; setkey(route_id, user_id)\n\nthreshold_ascents_dt &lt;- function(current, lim = 20) {\n  new &lt;- current[, if(.N &gt;= lim) .SD, by = user_id][, if(.N &gt;= lim) .SD, by = route_id]\n  \n  if (nrow(current) != nrow(new)) threshold_ascents_dt(new, lim)\n  else return(new)\n}\n\n\n\nclimbs_clean &lt;- (\n  climbs[\n    order(user_id, route_id, ascent_date, usa_routes, usa_boulders, method_name), .SD[1], \n    by = .(user_id, route_id)\n  ][, let(\n      usa_boulders = factor(usa_boulders, levels = bouldering_grades),\n      usa_routes = factor(usa_routes, levels = route_ratings),\n      label = as.integer(method_name %chin% c(\"Onsight\", \"Flash\"))\n    )\n  ][, let(route_rating = mode_cat(usa_routes), bouldering_grade = mode_cat(usa_boulders)), by = route_id\n  ][, threshold_ascents_dt(.SD)\n  ][, let(\n      route_idx = frank(route_id, ties.method = \"dense\"),\n      user_idx = frank(user_id, ties.method = \"dense\")\n    )\n  ][order(route_idx, user_idx)\n    , .(route_idx, route_id, user_idx, climb_type, ascent_date, route_rating, bouldering_grade, label)\n  ]\n)\n\n\n\nTime difference of 11.98 secs\n\n\n\n\n\n\n\n\nTipAlternative\n\n\n\n\n\n\nclimbs_first &lt;- climbs[\n    order(user_id, route_id, ascent_date, usa_routes, usa_boulders, method_name), .SD[1], \n    by = .(user_id, route_id)\n  ]\n\nclimbs_clean &lt;- (\n  copy(climbs_first)[\n    , threshold_ascents_dt(.SD)\n  ][\n    ## Replacing all route_ratings for a given route_id by its mode\n    climbs_first[\n        usa_boulders %in% bouldering_grades\n      ][, .(bouldering_grade = mode_cat(usa_boulders)), by = route_id], \n    c(\"route_id\", \"bouldering_grade\") := list(i.route_id, i.bouldering_grade), \n    on = \"route_id\"\n  ][\n    ## Replacing all bouldering_grades for a given route_id by its mode\n    climbs_first[\n        usa_routes %in% route_ratings\n      ][, .(route_rating = mode_cat(usa_routes)), by = route_id], \n    c(\"route_id\", \"route_rating\") := list(i.route_id, i.route_rating), \n    on = \"route_id\"\n  ][, let(\n      route_idx = frank(route_id, ties.method = \"dense\"),\n      user_idx = frank(user_id, ties.method = \"dense\"),\n      label = as.integer(method_name %chin% c(\"Onsight\", \"Flash\"))\n  )\n  ][order(route_idx, user_idx)\n    , .(route_idx, route_id, user_idx, climb_type, ascent_date, route_rating, bouldering_grade, label)\n  ]\n)\n\n\n\nTime difference of 10.09 secs\n\n\n\n\n\n\n\n\nthreshold_ascents_dbpthreshold_ascents_dbp &lt;- function(current, lim = 20) {\n  new &lt;- current |&gt; filter(n() &gt;= lim, .by = user_id) |&gt; filter(n() &gt;= lim, .by = route_id) |&gt; collect()\n\n  if (pull(count(current), n) != nrow(new)) threshold_ascents_dbp(new, lim)\n  else {\n    duckdb_register(con, \"ascent_temp\", new)\n    return(tbl(con, \"ascent_temp\"))\n  }\n}\n\n\n\n(tbl(con, \"climbs\")\n  |&gt; slice_min(\n    tibble(ascent_date, usa_routes, usa_boulders, method_name), with_ties = FALSE, \n    by = c(user_id, route_id)\n  )\n  |&gt; compute(\"climbs_first\", overwrite = TRUE)\n)\n\n\n(tbl(con, \"climbs_first\")\n  |&gt; threshold_ascents_dbp()\n  ## Replacing all route_ratings for a given route_id by its mode\n  |&gt; left_join(\n    tbl(con, \"climbs_first\")\n      |&gt; filter(usa_routes %in% route_ratings)\n      |&gt; count(route_id, usa_routes)\n      |&gt; slice_max(n, by = route_id)\n      |&gt; summarize(route_rating = min(usa_routes), .by = route_id),\n    by = \"route_id\"\n  )\n  ## Replacing all bouldering_grades for a given route_id by its mode\n  |&gt; left_join(\n    tbl(con, \"climbs_first\")\n      |&gt; filter(usa_boulders %in% bouldering_grades)\n      |&gt; count(route_id, usa_boulders)\n      |&gt; slice_max(n, by = route_id)\n      |&gt; summarize(bouldering_grade = min(usa_boulders), .by = route_id),\n    by = \"route_id\"\n  )\n  |&gt; mutate(\n    route_idx = dense_rank(route_id), \n    user_idx = dense_rank(user_id),\n    label = as.integer(method_name %in% c(\"Onsight\", \"Flash\"))\n  )\n  |&gt; select(route_idx, route_id, user_idx, climb_type, ascent_date, route_rating, bouldering_grade, label)\n  |&gt; arrange(route_idx, user_idx)\n  |&gt; compute(\"climbs_clean\", overwrite = TRUE)\n)\n\n\n\nTime difference of 1.889 secs\n\n\n\n\n\n\n\ndata.table [232,887 x 8]\n\n\n\n\nroute_idx\n\n\nroute_id\n\n\nuser_idx\n\n\nclimb_type\n\n\nascent_date\n\n\nroute_rating\n\n\nbouldering_grade\n\n\nlabel\n\n\n\n\n\n1\n\n\n221__Be_awesome__boulder\n\n\n1 386\n\n\n1\n\n\n2017-06-09 22:00:00\n\n\n5.12a\n\n\nV7\n\n\n0\n\n\n\n\n1\n\n\n221__Be_awesome__boulder\n\n\n1 601\n\n\n1\n\n\n2015-03-18 23:00:00\n\n\n5.12a\n\n\nV7\n\n\n1\n\n\n\n\n1\n\n\n221__Be_awesome__boulder\n\n\n1 832\n\n\n1\n\n\n2013-06-29 22:00:00\n\n\n5.12a\n\n\nV7\n\n\n1\n\n\n\n\n1\n\n\n221__Be_awesome__boulder\n\n\n2 032\n\n\n1\n\n\n2013-12-26 23:00:00\n\n\n5.12a\n\n\nV7\n\n\n1\n\n\n\n\n1\n\n\n221__Be_awesome__boulder\n\n\n2 075\n\n\n1\n\n\n2013-06-21 22:00:00\n\n\n5.12a\n\n\nV7\n\n\n1\n\n\n\n\n1\n\n\n221__Be_awesome__boulder\n\n\n2 110\n\n\n1\n\n\n2013-07-16 22:00:00\n\n\n5.12a\n\n\nV7\n\n\n1\n\n\n\n\n1\n\n\n221__Be_awesome__boulder\n\n\n2 134\n\n\n1\n\n\n2013-10-23 22:00:00\n\n\n5.12a\n\n\nV7\n\n\n1\n\n\n\n\n1\n\n\n221__Be_awesome__boulder\n\n\n2 149\n\n\n1\n\n\n2013-06-21 22:00:00\n\n\n5.12a\n\n\nV7\n\n\n1\n\n\n\n\n1\n\n\n221__Be_awesome__boulder\n\n\n2 157\n\n\n1\n\n\n2013-07-11 22:00:00\n\n\n5.12a\n\n\nV7\n\n\n0\n\n\n\n\n1\n\n\n221__Be_awesome__boulder\n\n\n2 170\n\n\n1\n\n\n2014-05-26 22:00:00\n\n\n5.12a\n\n\nV7\n\n\n1\n\n\n\n\n1\n\n\n221__Be_awesome__boulder\n\n\n2 177\n\n\n1\n\n\n2013-06-28 22:00:00\n\n\n5.12a\n\n\nV7\n\n\n1\n\n\n\n\n1\n\n\n221__Be_awesome__boulder\n\n\n2 234\n\n\n1\n\n\n2013-08-02 22:00:00\n\n\n5.12a\n\n\nV7\n\n\n1\n\n\n\n\n1\n\n\n221__Be_awesome__boulder\n\n\n2 236\n\n\n1\n\n\n2013-10-20 22:00:00\n\n\n5.12a\n\n\nV7\n\n\n0\n\n\n\n\n1\n\n\n221__Be_awesome__boulder\n\n\n2 261\n\n\n1\n\n\n2012-09-23 22:00:00\n\n\n5.12a\n\n\nV7\n\n\n0\n\n\n\n\n1\n\n\n221__Be_awesome__boulder\n\n\n2 338\n\n\n1\n\n\n2013-06-21 22:00:00\n\n\n5.12a\n\n\nV7\n\n\n1\n\n\n\n\n\n[ omitted 232,872 entries ]\n\n\n\n\n\n\n\n\n\n\n\n\nNote🔍 Checking that both solutions give the same result\n\n\n\n\n\n\nall.equal(\n  collect(tbl(con, \"climbs_clean\")), \n  climbs_clean, \n  check.attributes = FALSE\n)\n\n[1] TRUE"
  },
  {
    "objectID": "content/blog/posts/climbing/index.html#stan-code",
    "href": "content/blog/posts/climbing/index.html#stan-code",
    "title": "Bayesian Rock Climbing Rankings",
    "section": "\n2.1 Stan code",
    "text": "2.1 Stan code\n\n\n\n\n\n\nUpdated Stan code using within-chain parallelization\n\n\n\n\n\n\nclimbing_model\n\nfunctions {\n  array[] int sequence(int start, int end) {\n    array[end - start + 1] int seq;\n    for (n in 1 : num_elements(seq)) {\n      seq[n] = n + start - 1;\n    }\n    return seq;\n  }\n\n  // Compute partial sums of the log-likelihood\n  real partial_log_lik_lpmf(array[] int seq, int start, int end,\n                            data array[] int labels, real mean_ability,\n                            data array[] int users, vector user_ability,\n                            data array[] int routes, vector route_difficulty) {\n    real ptarget = 0;\n    int N = end - start + 1;\n\n    vector[N] mu = mean_ability + rep_vector(0.0, N);\n    for (n in 1 : N) {\n      int nn = n + start - 1;\n      mu[n] += user_ability[users[nn]] - route_difficulty[routes[nn]];\n    }\n    ptarget += bernoulli_logit_lpmf(labels[start : end] | mu);\n    return ptarget;\n  }\n}\n\ndata {\n  int&lt;lower=1&gt; num_ascents;\n  int&lt;lower=1&gt; num_users;\n  int&lt;lower=1&gt; num_routes;\n  array[num_ascents] int&lt;lower=1, upper=num_users&gt; users;\n  array[num_ascents] int&lt;lower=1, upper=num_routes&gt; routes;\n  array[num_ascents] int&lt;lower=0, upper=1&gt; labels;\n\n  int grainsize;\n}\n\ntransformed data {\n  array[num_ascents] int seq = sequence(1, num_ascents);\n}\n\nparameters {\n  real mean_ability;\n  vector[num_users] user_ability;\n  vector[num_routes] route_difficulty;\n}\n\nmodel {\n  user_ability ~ std_normal();\n  route_difficulty ~ std_normal();\n  mean_ability ~ std_normal();\n\n  target += reduce_sum(\n    partial_log_lik_lpmf, seq, grainsize, \n    labels, mean_ability, users, user_ability, routes, route_difficulty\n  );\n}"
  },
  {
    "objectID": "content/blog/posts/climbing/index.html#stan-data",
    "href": "content/blog/posts/climbing/index.html#stan-data",
    "title": "Bayesian Rock Climbing Rankings",
    "section": "\n2.2 Stan data",
    "text": "2.2 Stan data\n\nclimbing_stan_data &lt;- list(\n  num_ascents = nrow(climbs_clean),\n  num_users = n_distinct(climbs_clean$user_id),\n  num_routes = n_distinct(climbs_clean$route_id),\n  routes = pull(climbs_clean, route_idx),\n  users = pull(climbs_clean, user_idx),\n  labels = pull(climbs_clean, label) |&gt; as.integer(),\n  grainsize = max(100, round(nrow(climbs_clean) / 50))\n)"
  },
  {
    "objectID": "content/blog/posts/climbing/index.html#model-fit",
    "href": "content/blog/posts/climbing/index.html#model-fit",
    "title": "Bayesian Rock Climbing Rankings",
    "section": "\n2.3 Model fit",
    "text": "2.3 Model fit\n\nclimbing_mod_fit &lt;- climbing_model$sample(\n  data = climbing_stan_data, seed = 666,\n  iter_warmup = 500, iter_sampling = 1000, refresh = 0,\n  chains = 6, parallel_chains = 6, threads_per_chain = 5\n)\n\n\n\n\n\n\n\nNote\n\n\n\nSampling takes ~4.81 minutes on my CPU (Ryzen 5950X, 16 Cores/32 Threads), on WSL2 (Ubuntu 22)\n\ndata.table [6 x 2]\n\n\n\n\nChain\n\n\nTime\n\n\n\n\n\n1\n\n\n282.858s (~4.71 minutes)\n\n\n\n\n2\n\n\n294.551s (~4.91 minutes)\n\n\n\n\n3\n\n\n293.979s (~4.9 minutes)\n\n\n\n\n4\n\n\n288.381s (~4.81 minutes)\n\n\n\n\n5\n\n\n285.559s (~4.76 minutes)\n\n\n\n\n6\n\n\n285.031s (~4.75 minutes)"
  },
  {
    "objectID": "content/blog/posts/climbing/index.html#posterior-data",
    "href": "content/blog/posts/climbing/index.html#posterior-data",
    "title": "Bayesian Rock Climbing Rankings",
    "section": "\n4.1 Posterior data",
    "text": "4.1 Posterior data\nGetting our Posterior Predictions (subset of 500 draws per route) into long format:\n\n\ndata.table\ndbplyr\ndplyr\n\n\n\n\ndraws &lt;- (\n  ## For each player, take a subsample of 500 draws from their posterior\n  climbing_mod_fit$draws(variables = \"route_difficulty\")\n  |&gt; bind(x, subset_draws(x, \"route_difficulty\", regex = TRUE, draw = sample.int(ndraws(x), size = 500)))\n  |&gt; as.data.table()\n  |&gt; _[, .(route_difficulty = list(value)), by = variable\n  ][, let(route_idx = as.integer(str_extract(variable, \"\\\\d{1,4}\")), variable = NULL)]\n)\n\nclimbs_pp &lt;- (climbs_clean[, .(route_idx, route_id, bouldering_grade, route_rating, climb_type)] \n  |&gt; unique(by = \"route_idx\")\n  |&gt; _[draws, on = \"route_idx\", nomatch = NULL\n  ][order(route_idx)]\n)\n\n\ndata.table [4,288 x 6]\n\n\n\n\nroute_idx\n\n\nroute_id\n\n\nbouldering_grade\n\n\nroute_rating\n\n\nclimb_type\n\n\nroute_difficulty\n\n\n\n\n\n1\n\n\n221__Be_awesome__boulder\n\n\nV7\n\n\n5.12a\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n2\n\n\n221__Black_Magic_Woman__boulder\n\n\nV7\n\n\n5.12a\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n3\n\n\n221__Doug_Reed_Roof__boulder\n\n\nV5\n\n\n5.11a\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n4\n\n\n221__Druid_Roof__boulder\n\n\nV7\n\n\n5.12a\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n5\n\n\n221__Dump_Arete__boulder\n\n\nV4\n\n\n5.10c\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n6\n\n\n221__Iceberg__boulder\n\n\nV5\n\n\n5.11a\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n7\n\n\n221__Instinct__boulder\n\n\nV9\n\n\n5.12d\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n8\n\n\n221__M1__boulder\n\n\nV3\n\n\n5.10a\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n9\n\n\n221__Ominous_Roof__boulder\n\n\nV9\n\n\n5.12d\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n10\n\n\n221__Senderella__boulder\n\n\nV8\n\n\n5.12c\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n11\n\n\n221__Sign_of_the_Times__boulder\n\n\nV5\n\n\n5.11a\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n12\n\n\n221__The_Iceberg__boulder\n\n\nV5\n\n\n5.11a\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n13\n\n\n221__West_Texas__boulder\n\n\nV3\n\n\n5.10a\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n14\n\n\n221__What_Up_Arete__boulder\n\n\nV6\n\n\n5.11d\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n15\n\n\nAmerican_Fork__39__rope\n\n\nV5\n\n\n5.11b\n\n\n0\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n\n[ omitted 4,273 entries ]\n\n\n\n\nTime difference of 2.064 secs\n\n\n\n\n## Getting the draws into DuckDB\n(climbing_mod_fit$draws(variables = \"route_difficulty\") \n  |&gt; bind(x, subset_draws(x, \"route_difficulty\", regex = TRUE, draw = sample.int(ndraws(x), size = 500))) \n  |&gt; as_draws_df()\n  |&gt; pivot_longer(everything(), names_to = \"route_idx\", names_pattern = \".*\\\\[(\\\\d{1,4})\\\\]\")\n  |&gt; duckdb_register(con, \"draws\", df = _)\n)\n\n## Generating out Posterior Predictions data\n(tbl(con, \"climbs_clean\")\n  |&gt; select(route_idx, route_id, bouldering_grade, route_rating, climb_type)\n  |&gt; distinct(route_idx, .keep_all = TRUE)\n  |&gt; inner_join(tbl(con, \"draws\"), by = \"route_idx\")\n  |&gt; summarize(\n    .by = route_idx,\n    across(c(bouldering_grade, route_rating, climb_type), first),\n    route_difficulty = list(value)\n  )\n  |&gt; arrange(route_idx)\n  |&gt; compute(\"climbs_pp\", overwrite = TRUE)\n)\n\n\ndata.frame [4,288 x 5]\n\n\n\n\nroute_idx\n\n\nbouldering_grade\n\n\nroute_rating\n\n\nclimb_type\n\n\nroute_difficulty\n\n\n\n\n\n1\n\n\nV7\n\n\n5.12a\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n2\n\n\nV7\n\n\n5.12a\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n3\n\n\nV5\n\n\n5.11a\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n4\n\n\nV7\n\n\n5.12a\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n5\n\n\nV4\n\n\n5.10c\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n6\n\n\nV5\n\n\n5.11a\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n7\n\n\nV9\n\n\n5.12d\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n8\n\n\nV3\n\n\n5.10a\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n9\n\n\nV9\n\n\n5.12d\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n10\n\n\nV8\n\n\n5.12c\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n11\n\n\nV5\n\n\n5.11a\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n12\n\n\nV5\n\n\n5.11a\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n13\n\n\nV3\n\n\n5.10a\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n14\n\n\nV6\n\n\n5.11d\n\n\n1\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n15\n\n\nV5\n\n\n5.11b\n\n\n0\n\n\n&lt;numeric [500]&gt;\n\n\n\n\n\n[ omitted 4,273 entries ]\n\n\n\n\nTime difference of 0.7239 secs\n\n\n\nWith dplyr, we can use the rvar format to encapsulate the samples from the model, which drastically reduces the size of the samples’ data.frame\n\n(inner_join(\n    as.data.frame(climbs_clean) |&gt; \n      select(route_idx, route_id, bouldering_grade, route_rating, climb_type) |&gt; \n      distinct(route_idx, .keep_all = TRUE),\n    tidybayes::spread_rvars(climbing_mod_fit, route_difficulty[route_idx], ndraws = 500),\n    by = \"route_idx\"\n  )\n  |&gt; arrange(route_idx)\n)\ndata.frame [4,288 x 6]\n\n\n\n\nroute_idx\n\n\nroute_id\n\n\nbouldering_grade\n\n\nroute_rating\n\n\nclimb_type\n\n\nroute_difficulty\n\n\n\n\n\n1\n\n\n221__Be_awesome__boulder\n\n\nV7\n\n\n5.12a\n\n\n1\n\n\n-1.94806 ± 0.46\n\n\n\n\n2\n\n\n221__Black_Magic_Woman__boulder\n\n\nV7\n\n\n5.12a\n\n\n1\n\n\n0.97778 ± 0.43\n\n\n\n\n3\n\n\n221__Doug_Reed_Roof__boulder\n\n\nV5\n\n\n5.11a\n\n\n1\n\n\n0.00092 ± 0.32\n\n\n\n\n4\n\n\n221__Druid_Roof__boulder\n\n\nV7\n\n\n5.12a\n\n\n1\n\n\n0.63989 ± 0.35\n\n\n\n\n5\n\n\n221__Dump_Arete__boulder\n\n\nV4\n\n\n5.10c\n\n\n1\n\n\n0.93265 ± 0.61\n\n\n\n\n6\n\n\n221__Iceberg__boulder\n\n\nV5\n\n\n5.11a\n\n\n1\n\n\n-0.51604 ± 0.47\n\n\n\n\n7\n\n\n221__Instinct__boulder\n\n\nV9\n\n\n5.12d\n\n\n1\n\n\n1.47766 ± 0.48\n\n\n\n\n8\n\n\n221__M1__boulder\n\n\nV3\n\n\n5.10a\n\n\n1\n\n\n-0.11431 ± 0.43\n\n\n\n\n9\n\n\n221__Ominous_Roof__boulder\n\n\nV9\n\n\n5.12d\n\n\n1\n\n\n2.02720 ± 0.52\n\n\n\n\n10\n\n\n221__Senderella__boulder\n\n\nV8\n\n\n5.12c\n\n\n1\n\n\n1.31122 ± 0.54\n\n\n\n\n11\n\n\n221__Sign_of_the_Times__boulder\n\n\nV5\n\n\n5.11a\n\n\n1\n\n\n0.49688 ± 0.44\n\n\n\n\n12\n\n\n221__The_Iceberg__boulder\n\n\nV5\n\n\n5.11a\n\n\n1\n\n\n0.33581 ± 0.55\n\n\n\n\n13\n\n\n221__West_Texas__boulder\n\n\nV3\n\n\n5.10a\n\n\n1\n\n\n-0.80732 ± 0.49\n\n\n\n\n14\n\n\n221__What_Up_Arete__boulder\n\n\nV6\n\n\n5.11d\n\n\n1\n\n\n0.84534 ± 0.47\n\n\n\n\n15\n\n\nAmerican_Fork__39__rope\n\n\nV5\n\n\n5.11b\n\n\n0\n\n\n-1.19568 ± 0.39\n\n\n\n\n\n[ omitted 4,273 entries ]\n\n\n\n\n\n\n\nTime difference of 0.952 secs"
  },
  {
    "objectID": "content/blog/posts/climbing/index.html#posterior-plots",
    "href": "content/blog/posts/climbing/index.html#posterior-plots",
    "title": "Bayesian Rock Climbing Rankings",
    "section": "\n4.2 Posterior plots",
    "text": "4.2 Posterior plots\n\n4.2.1 Ridgeline plots\n\nridgeline_plotridgeline_plot &lt;- function(dat, var, title) {\n  \n  ## Unlisting the route_difficulties and making sure the route_ratings/bouldering_grades are ordered properly\n  dat &lt;- dat[\n    , .(route_difficulty = unlist(route_difficulty)), by = setdiff(names(dat), 'route_difficulty')\n  ][, let(\n      bouldering_grade = factor(bouldering_grade, levels = bouldering_grades),\n      route_rating = factor(route_rating, levels = route_ratings)\n    )\n  ]\n  \n  return(\n    ggplot(dat, aes(route_difficulty, y = {{ var }}, fill = {{ var }}))\n    + geom_ribbon(\n      aes(\n        fill = stage({{ var }}, after_scale = alpha(fill, 0.5)),\n        ymin = after_stat(group),\n        ymax = after_stat(group + ndensity * 1.6)\n      ),\n      stat = \"density\", outline.type = \"upper\", color = \"grey30\"\n    )\n    * ggblend::blend(\"multiply\")\n    + geom_vline(xintercept = 0, linetype = \"dashed\", color = \"grey50\")\n    + labs(title = title, x = \"Route Difficulty\", y = \"\")\n    + scale_y_discrete(position = \"right\")\n    + theme(\n      legend.position = \"none\", \n      axis.line.y = element_blank(),\n      plot.title = element_text(hjust = 0.5)\n    )\n  )\n}\n\n\nRoute Ratings:\n\nclimbs_pp[climb_type == 0] |&gt; \n  ridgeline_plot(route_rating, \"Climbing Route Posteriors\")\n\n\n\n\n\n\n\nBouldering Grades:\n\nclimbs_pp[climb_type == 1 & bouldering_grade != \"V0\"] |&gt; \n  ridgeline_plot(bouldering_grade, \"Bouldering Problem Posteriors\")\n\n\n\n\n\n\n\n\n4.2.2 Strip plots\n\nstrip_plotstrip_plot &lt;- function(dat, var, title) {\n  \n  strip_plot &lt;- (dat \n    |&gt; separate_wider_delim(route_id, names = c(\"crag\", \"route_name\", NA), delim = \"__\")\n    |&gt; mutate(\n      route_difficulty = map_dbl(route_difficulty, mean),\n      bouldering_grade = factor(bouldering_grade, levels = bouldering_grades),\n      route_rating = factor(route_rating, levels = route_ratings),\n      across(c(crag, route_name), \\(x) str_replace_all(x, \"_\", \" \"))\n    )\n    |&gt; ggplot(aes(route_difficulty, y = {{ var }}, color = {{ var }}))\n      + geom_point(\n        aes(group = crag, linesize = route_name), # Adding unused aesthetics to get plotly's automated tooltips\n        position = position_jitter(height = 0.2), alpha = 0.6\n      )\n      + labs(\n        title = title,\n        x = \"Route Difficulty\", \n        y = str_to_title(str_replace_all(deparse(substitute(var)), \"_\", \" \"))\n      )\n      + theme(legend.position = \"none\")\n  )\n  \n  return(ggplotly(strip_plot, tooltip = c(\"group\", \"linesize\")))\n}\n\n\nRoute Ratings:\n\nclimbs_pp[climb_type == 0] |&gt; \n  strip_plot(route_rating, \"Climbing Route Difficulties\")\n\n\n\nBouldering Grades:\n\nclimbs_pp[climb_type == 1 & bouldering_grade != \"V0\"] |&gt; \n  strip_plot(bouldering_grade, \"Bouldering Problem Difficulties\")\n\n\n\n\n\n\n\n\n\n\n\n\nTip💻 Expand for Session Info\n\n\n\n\n\n\n\n─ Session info ───────────────────────────────────────────────────────────────\n setting        value\n version        R version 4.5.1 (2025-06-13)\n os             Ubuntu 22.04.5 LTS\n system         x86_64, linux-gnu\n ui             X11\n language       (EN)\n collate        C.UTF-8\n ctype          C.UTF-8\n tz             Europe/Oslo\n date           2025-09-21\n pandoc         2.9.2.1\n quarto         1.8.17 @ /opt/quarto/bin/quarto\n Quarto         1.8.17\n Stan (CmdStan) 2.37.0\n\n─ Packages ───────────────────────────────────────────────────────────────────\n ! package    * version     date (UTC) lib source\n P archive    * 1.1.12      2025-03-20 [?] CRAN (R 4.5.1)\n P bayesplot  * 1.14.0.9000 2025-09-08 [?] https://stan-dev.r-universe.dev (R 4.5.1)\n P cmdstanr   * 0.9.0       2025-03-30 [?] https://stan-dev.r-universe.dev (R 4.5.1)\n P crayon     * 1.5.3       2024-06-20 [?] CRAN (R 4.5.1)\n P data.table * 1.17.8      2025-07-10 [?] CRAN (R 4.5.1)\n P DBI        * 1.2.3       2024-06-02 [?] CRAN (R 4.5.1)\n P dbplyr     * 2.5.1       2025-09-10 [?] CRAN (R 4.5.1)\n P dplyr      * 1.1.4       2023-11-17 [?] CRAN (R 4.5.1)\n P duckdb     * 1.4.0       2025-09-18 [?] CRAN (R 4.5.1)\n P fs         * 1.6.6       2025-04-12 [?] CRAN (R 4.5.1)\n P ggplot2    * 4.0.0       2025-09-11 [?] CRAN (R 4.5.1)\n P gt         * 1.0.0       2025-04-05 [?] CRAN (R 4.5.1)\n P here       * 1.0.2       2025-09-15 [?] CRAN (R 4.5.1)\n P htmltools  * 0.5.8.1     2024-04-04 [?] CRAN (R 4.5.1)\n P knitr      * 1.50        2025-03-16 [?] CRAN (R 4.5.1)\n P lubridate  * 1.9.4       2024-12-08 [?] CRAN (R 4.5.1)\n P patchwork  * 1.3.2       2025-08-25 [?] CRAN (R 4.5.1)\n P pipebind   * 0.1.2       2023-08-30 [?] CRAN (R 4.5.1)\n P plotly     * 4.11.0      2025-06-19 [?] CRAN (R 4.5.1)\n P posterior  * 1.6.1       2025-02-27 [?] CRAN (R 4.5.1)\n P purrr      * 1.1.0       2025-07-10 [?] CRAN (R 4.5.1)\n P reactable  * 0.4.4       2023-03-12 [?] CRAN (R 4.5.1)\n P stringr    * 1.5.2       2025-09-08 [?] CRAN (R 4.5.1)\n P tidyr      * 1.3.1       2024-01-24 [?] CRAN (R 4.5.1)\n\n [1] /home/mar/Dev/Projects/R/ma-riviere.com/renv/library/linux-ubuntu-jammy/R-4.5/x86_64-pc-linux-gnu\n [2] /home/mar/.cache/R/renv/sandbox/linux-ubuntu-jammy/R-4.5/x86_64-pc-linux-gnu/25ebdc09\n\n * ── Packages attached to the search path.\n P ── Loaded and on-disk path mismatch.\n\n──────────────────────────────────────────────────────────────────────────────"
  },
  {
    "objectID": "content/projects/ACCESSPACE/index.html",
    "href": "content/projects/ACCESSPACE/index.html",
    "title": "ACCESSPACE",
    "section": "",
    "text": "Official homepage []\n  \n  \n    \n     Article (journal)\n  \n  \n    \n     Article (conference)\n  \n  \n      Slides []\n  \n  \n    \n     Poster []"
  },
  {
    "objectID": "content/projects/ACCESSPACE/index.html#our-interface-the-tactibelt",
    "href": "content/projects/ACCESSPACE/index.html#our-interface-the-tactibelt",
    "title": "ACCESSPACE",
    "section": "Our interface: the TactiBelt",
    "text": "Our interface: the TactiBelt\nTo provide the proposed egocentric encoding scheme to the user, we designed a vibro-tactile belt, the TactiBelt: it comprises of 46 ERM motors spread into three layers, controlled by an Arduino Mega, through a specialized software written in Java:\n\n\n\n\n\n\nFigure 2: First prototype of the TactiBelt"
  },
  {
    "objectID": "content/projects/ACCESSPACE/index.html#software-tools",
    "href": "content/projects/ACCESSPACE/index.html#software-tools",
    "title": "ACCESSPACE",
    "section": "Software tools",
    "text": "Software tools\nTo capture and extract the information we need from the VIP’s environment, we devised a series of software tools relying mostly on Computer Vision:\n1) Obstacle detection and indoor localisation using the ORB-SLAM algorithm:\n\n\n\n\n\n2) Depth estimation from a monocular RGB camera, using the MonoDepth algorithm:\n\n\n\n\n\n3) Generating a mobility graph of the environment during movement using Reinforcement Learning:\nApplied to an artificial agent exploring a virtual maze, looking for food:\n\nApplied to a real agent (human pushing a cart with a camera and the computer running the algorithm around a meeting table):\n\n\n\n\n\n4) A virtual environment to test the TactiBelt and our candidate spatial encoding schemes:"
  },
  {
    "objectID": "content/projects/ACCESSPACE/index.html#project-dissemination",
    "href": "content/projects/ACCESSPACE/index.html#project-dissemination",
    "title": "ACCESSPACE",
    "section": "Project dissemination",
    "text": "Project dissemination\nThe ACCESSPACE project was promoted in various mainstream and technical media, such as:\n- On RTL, a French national radio station ()\n- On PhDTalent, a platform and network for PhD Students who wish to transition to industry ()\n- On Guide Néret, a specialized website on Handicap in France ()\n- On Acuité, a specialized website dedicated to Opticians and news around visual impairment ()\n- On Oxytude, a weekly podcast reviewing news related to visual impairment ()\n- On FIRAH, the French Foundation on Applied Research for Handicap ()"
  },
  {
    "objectID": "content/projects/AdViS/index.html",
    "href": "content/projects/AdViS/index.html",
    "title": "AdViS",
    "section": "",
    "text": "Official homepage []\n  \n  \n      Article (2015)\n  \n  \n      Article (2018)\n  \n  \n    \n     Poster\n  \n\n      \n\n    \n    \n  \n\n\n\n\nSummary\n\n\n\n\n\n\nAdViS - Depth Map navigation\n\n\n\n\n\n\n\nAdViS - Motion Capture\n\n\n\n\n\n\n\n\n\n\n\nNoteMy role in this project\n\n\n\n1) Proposed a new model for image exploration relying on a touch-mediated visuo-auditive feedback loop, where a VIP explores an image by moving its finger across a screen and gets audio feedback based on the contents of the explored region.\n2) Modified the existing AdViS system to include the ability to transcode grey-scale images into soundscapes, based on captured finger-motion information on a touchscreen (C++/PureData).\n3) Organized experimental evaluations with blindfolded students, tasked with recognizing geometrical shapes on a touchscreen, and analyzed the results (R).\n\n\n\n\n\n4) Participated in implementing an occular-motion-to-audio-feedback loop in order to evaluate the possibility of exploring images (on a turned off screen) with eye-movements (which are still controllable by most of the non-congenital VIP) (C++/OpenCV).\n\n\n\n\n\n\n\n\n\n\n\n\n Back to top"
  },
  {
    "objectID": "content/projects/DE-AoP/index.html",
    "href": "content/projects/DE-AoP/index.html",
    "title": "DE-AoP",
    "section": "",
    "text": "Article\n  \n  \n    \n     Code\n  \n  \n      Documentation\n  \n\n      \n\n    \n    \n  \n\n\n\n\n\nSummary\nThe DE-AoP project included RT-qPCR and immunohistochemistry data, which were analysed in R (R Core Team, 2023). Data were modeled through the Generalized Linear Mixed Model (GLMM) framework, using the glmmTMB package (Brooks et al., 2017). Random intercepts were added to account for the correlation between pseudo-replicates. Temporally-dependent repeated measures were modeled using auto-regressive (AR1) terms.\nThe optimal likelihood families were selected based on our theoretical understanding of the variable’s properties, and to minimize Aikake’s Information Criterion (AIC). Count data (e.g., cell counts, number of maze entries, …) were modeled using a Generalized Poisson likelihood, measures bound at 0 (e.g., cell density, volumes, weights, …) were modeled using a Gamma likelihood, and proportions (e.g., ratios of areas) with a Beta likelihood.\nModel diagnostics were done using the DHARMa (Hartig, 2022) & performance (Lüdecke et al., 2021) packages, and estimated marginal means/contrasts were computed with the emmeans package (Lenth, 2022).\n\n\n\n\n\n\nNoteMy role in this project\n\n\n\n1) Handled the data processing, modeling, and analysis for both RT-qPCR and immunohistochemistry data (R/Markdown).\n1) Developed tools to assist the project’s researchers in exploring their data. Among those tools, I coded and hosted a modular Shiny dashboard to assist in the data exploration process (R/Shiny).\n3) Participated in writing the journal article summarizing the results of this project (Rodriguez-Duboc et al., 2023).\n4) Open-sourced the resulting code on GitHub and registered it on Zenodo.\n5) Made a website documenting and showcasing the project’s data, analyses, and results. The website uses Quarto and Javascript to provide an interactive dashboard to explore the data.\n\n\n\n\nQuarto website\nWe made a Quarto website to showcase the project’s data, analyses, and results with interactive plots and tables:\n  \n\n\n\n\n\n\n Back to topReferences\n\nBrooks, M. E., Kristensen, K., van Benthem, K. J., Magnusson, A., Berg, C. W., Nielsen, A., Skaug, H. J., Maechler, M., & Bolker, B. M. (2017). glmmTMB balances speed and flexibility among packages for zero-inflated generalized linear mixed modeling. The R Journal, 9(2), 378–400. https://journal.r-project.org/archive/2017/RJ-2017-066/index.html\n\n\nHartig, F. (2022). DHARMa: Residual diagnostics for hierarchical (multi-level / mixed) regression models. https://CRAN.R-project.org/package=DHARMa\n\n\nLenth, R. V. (2022). Emmeans: Estimated marginal means, aka least-squares means. https://CRAN.R-project.org/package=emmeans\n\n\nLüdecke, D., Ben-Shachar, M. S., Patil, I., Waggoner, P., & Makowski, D. (2021). performance: An R package for assessment, comparison and testing of statistical models. Journal of Open Source Software, 6(60), 3139. https://doi.org/10.21105/joss.03139\n\n\nR Core Team. (2023). R: A language and environment for statistical computing. R Foundation for Statistical Computing. https://www.R-project.org/\n\n\nRodriguez-Duboc, A., Basille-Dugay, M., Debonne, A., Rivière, M.-A., Vaudry, D., & Burel, D. (2023). Apnea of prematurity induces short and long-term development-related transcriptional changes in the murine cerebellum. Current Research in Neurobiology, 5, 100113. https://doi.org/10.1016/j.crneur.2023.100113"
  },
  {
    "objectID": "content/projects/NAV-VIR/index.html",
    "href": "content/projects/NAV-VIR/index.html",
    "title": "NAV-VIR / TETMOST",
    "section": "",
    "text": "Article (ICCHP’18)\n  \n  \n    \n     Article (NER’19)\n  \n  \n    \n     Article (ICISP’20)\n  \n  \n    \n     Poster\n  \n  \n    \n     Code"
  },
  {
    "objectID": "content/projects/NAV-VIR/index.html#our-interface-f2t-v2",
    "href": "content/projects/NAV-VIR/index.html#our-interface-f2t-v2",
    "title": "NAV-VIR",
    "section": "Our interface: F2T (v2)",
    "text": "Our interface: F2T (v2)\nDuring this project, we improved upon the first iteration of the Force Feedback Tablet (F2T) from the TETMOST project to design the finalized prototype of this interface:\n\n\n\n\n\n\n\n\n\n\n1) We developed a Java application to create or convert images into simplified tactile representations, which can then be explored using the F2T:\n\n2) We investigated and developed tools to automatically generate a navigation graph from a floor plan, which can then be converted into a tactile image and explored with the F2T:"
  },
  {
    "objectID": "content/projects/TETMOST/index.html",
    "href": "content/projects/TETMOST/index.html",
    "title": "TETMOST",
    "section": "",
    "text": "My role in this project\n\n1) Participated in the development of a Java app to control the F2T and display tactile “images”.\n2) Investigated existing haptic interfaces, classifying them based on our needs, and buying/lending a prototype from each category.\n3) Organized experimental evaluations with VIP to assess the strengths and weaknesses of each category of interfaces.\n4) Participated in writing a poster and two conference articles: one on the F2T, and one on the image segmentation.\n\n\n\n\n\n Back to top"
  },
  {
    "objectID": "content/projects/TETMOST/index.html#exploring-existing-haptic-interfaces",
    "href": "content/projects/TETMOST/index.html#exploring-existing-haptic-interfaces",
    "title": "TETMOST",
    "section": "Exploring existing haptic interfaces",
    "text": "Exploring existing haptic interfaces\nWe researched and tried different categories of haptic interfaces in order to asses their strengths and weaknesses for our purposes:\n\n\n\n\n\n\n\n\n\n\n\n(a) Taxel mechanical interfaces\n\n\n\n\n\n\n\n\n\n\n\n(b) Electro-friction interfaces\n\n\n\n\n\n\n\n\n\n\n\n(c) Vibrational interfaces\n\n\n\n\n\n\n\nFigure 1: The three main categories of haptic interfaces\n\n\n\nOur experience with the existing categories of haptic interfaces allowed us to designed one best adapted to our need: the Force-Feedback Tablet (F2T)"
  },
  {
    "objectID": "content/projects/TETMOST/index.html#our-interface-f2t-v1",
    "href": "content/projects/TETMOST/index.html#our-interface-f2t-v1",
    "title": "TETMOST",
    "section": "Our interface: F2T (v1)",
    "text": "Our interface: F2T (v1)\nThe first prototype of the F2T was assembled with legos and a camera to better asses the position of the joystick within the frame of the device."
  },
  {
    "objectID": "content/projects/TETMOST/index.html#software-tools",
    "href": "content/projects/TETMOST/index.html#software-tools",
    "title": "TETMOST",
    "section": "Software tools",
    "text": "Software tools\n1) We developed a Java application to create or convert images into simplified tactile representations, which can then be explored using the F2T:\n\n2) In order to display an image haptically, we first needed a way to simplify the image’s content without losing its meaning. To do so, we explored various Computer Vision techniques such as image segmentation and edge detection:"
  },
  {
    "objectID": "content/projects/index.html",
    "href": "content/projects/index.html",
    "title": " Past & Current Projects",
    "section": "",
    "text": "AD-McGill\n\n\nBnip3 expression in Alzheimer’s disease rat model\n\n\nR\nBioinformatics\nBiostatistics\nImmunohistochemistry\nImaging\n\n\nReproducible R analysis of immunohistochemistry data from an Alzheimer’s disease rat model, using mixed-effects models to test AD-control contrasts across brain regions and age-groups.\n\n\n\n\n\n\n\n\n\n\n\n\n\nVasc-AoP\n\n\nVascular effects of Apnea of Prematurity\n\n\nR\nBioinformatics\nBiostatistics\nImmunohistochemistry\nTranscriptomics\nRT-qPCR\n\n\nReproducible R analysis investigating the effects of intermittent hypoxia on cerebellar vascular development using 3D imaging and transcriptomics in a murine model of apnea of prematurity.\n\n\n\n\n\n\n\n\n\n\n\n\n\nSAM-Guide\n\n\nSpatial Awareness for Multimodal Guidance\n\n\nResearch\nSoftware Engineering\nC#\nUnity\nHuman-Computer Interaction\nAugmented Reality\n\n\nDesigning an efficient multi-modal interface to help VIP during spatial interactions and sports.\n\n\n\n\n\n\n\n\n\n\n\n\n\nDE-AoP\n\n\nDevelopmental effects of Apnea of Prematurity\n\n\nR\nBioinformatics\nBiostatistics\nSoftware Engineering\nImmunohistochemistry\nTranscriptomics\nRT-qPCR\n\n\nThis project studies the underlying molecular and cellular mechanisms of apnea of prematurity at play during cerebellar development, using intermittent hypoxia in a mouse model.\n\n\n\n\n\n\n\n\n\n\n\n\n\nNAV-VIR / TETMOST\n\n\nVirtual Image exploration for Visually Impaired People\n\n\nResearch\nSoftware Engineering\nJava\nPython\nHuman-Computer Interaction\nComputer Vision\n\n\nDevelopment of the Force Feedback Tablet (F2T) and multimodal audio-tactile interfaces for virtual exploration of images and maps by Visually Impaired People.\n\n\n\n\n\n\n\n\n\n\n\n\n\nCamIO\n\n\nCamera Input-Output\n\n\nResearch\nSoftware Engineering\nPython\nStatistics\nHuman-Computer Interaction\nAugmented Reality\nComputer Vision\n\n\nSmart assitive devices providing real-time audio-feedback on objects using the smartphone’s sensors.\n\n\n\n\n\n\n\n\n\n\n\n\n\nACCESSPACE\n\n\nHelping Visually Impaired People travel autonomously\n\n\nResearch\nSoftware Engineering\nJava\nArduino\nHuman-Computer Interaction\nAugmented Reality\nComputer Vision\n\n\nDeveloping a wearable vibro-tactile electronic wearable system for the autonomous navigation of visually impaired people through neuroscience-inspired spatial feedback.\n\n\n\n\n\n\n\n\n\n\n\n\n\nLT-AoP\n\n\nLong Term effects of Apnea of Prematurity\n\n\nR\nSoftware Engineering\nBioinformatics\nBiostatistics\nTranscriptomics\nRT-qPCR\n\n\nThis project studied the impact of apnea of prematurity on cerebellar development and the long-term functional deficits resulting from it, using intermittent hypoxia in a mouse model.\n\n\n\n\n\n\n\n\n\n\n\n\n\nAdViS\n\n\nAdaptative Visual Substitution\n\n\nResearch\nSoftware Engineering\nC++\nStatistics\nHuman-Computer Interaction\nAugmented Reality\nComputer Vision\n\n\nDeveloping a wearable device converting spatial information into auditory cues to assist visually impaired people with navigation and object-reaching through sensory substitution.\n\n\n\n\n\n\n\n\nNo matching items\n Back to top"
  },
  {
    "objectID": "content/pubs/ICCHP18-F2T/index.html",
    "href": "content/pubs/ICCHP18-F2T/index.html",
    "title": "Towards Haptic Surface Devices with Force Feedback for Visually Impaired People",
    "section": "",
    "text": "Article (PDF)\n  \n  \n      Project (TETMOST)\n  \n\n      \n\n    \n    \n  \n\n\n\n\n\n\n\n\n\n\n\n Back to topCitationBibTeX citation:@inproceedings{gay2018,\n  author = {Gay, Simon and Rivière, Marc-Aurèle and Pissaloux, Edwige},\n  editor = {Klaus, Miesenberger and Georgios, Kouroupetroglou},\n  publisher = {Springer International Publishing},\n  title = {Towards {Haptic} {Surface} {Devices} with {Force} {Feedback}\n    for {Visually} {Impaired} {People}},\n  booktitle = {Lecture Notes in Computer Science},\n  volume = {10897},\n  pages = {258-266},\n  date = {2018-07-12},\n  url = {http://link.springer.com/10.1007/978-3-319-94274-2_36},\n  doi = {10.1007/978-3-319-94274-2_36},\n  isbn = {978-3-319-94273-5 978-3-319-94274-2},\n  langid = {en},\n  abstract = {This paper presents a new haptic surface tablet that can\n    provide force feedback to the user. Force feedback means that the\n    device can react to the user’s movements and apply a force against\n    or in-line with these movements, according to the tactile properties\n    of a displayed image. The device consists of a frame attached to a\n    tactile tablet that generates a force feedback to user’s finger when\n    exploring the surface, providing haptic informations about the\n    displayed image. The experimental results suggest the relevance of\n    this tablet as an assistive device for visually impaired people in\n    perceiving and understanding the content of a displayed image.\n    Several potential applications are briefly presented.}\n}\nFor attribution, please cite this work as:\nGay, S., Rivière, M.-A., & Pissaloux, E. (2018). Towards Haptic\nSurface Devices with Force Feedback for Visually Impaired People. In M.\nKlaus & K. Georgios (Eds.), Lecture Notes in Computer\nScience (Vol. 10897, pp. 258–266). Springer International\nPublishing. https://doi.org/10.1007/978-3-319-94274-2_36"
  },
  {
    "objectID": "content/pubs/ICCHP20/index.html",
    "href": "content/pubs/ICCHP20/index.html",
    "title": "An Audio-Based 3D Spatial Guidance AR System for Blind Users",
    "section": "",
    "text": "Project (CamIO)\n  \n  \n    \n     Code\n  \n\n      \n\n    \n    \n  \n\n\n\n\n\n\n\n\n\n\n\n Back to topCitationBibTeX citation:@inproceedings{coughlan2020,\n  author = {Coughlan, James and Biggs, Brandon and Rivière, Marc-Aurèle\n    and Shen, Huiying},\n  editor = {Klaus, Miesenberger and Roberto, Manduchi and Rodriguez\n    Mario, Covarrubias and Petr, Peňáz},\n  publisher = {Springer International Publishing},\n  title = {An {Audio-Based} {3D} {Spatial} {Guidance} {AR} {System} for\n    {Blind} {Users}},\n  booktitle = {Lecture Notes in Computer Science},\n  volume = {12376},\n  pages = {475-484},\n  date = {2020-09-12},\n  url = {https://link.springer.com/chapter/10.1007/978-3-030-58796-3_55},\n  doi = {10.1007/978-3-030-58796-3_55},\n  isbn = {978-3-030-58795-6 978-3-030-58796-3},\n  langid = {en},\n  abstract = {Augmented reality (AR) has great potential for blind users\n    because it enables a range of applications that provide audio\n    information about specific locations or directions in the user’s\n    environment. For instance, the CamIO{]}(/content/projects/CamIO)\n    (“Camera Input-Output”) AR app makes physical objects (such as\n    documents, maps, devices and 3D models) accessible to blind and\n    visually impaired persons by providing real-time audio feedback in\n    response to the location on an object that the user is touching\n    (using an inexpensive stylus). An important feature needed by blind\n    users of AR apps such as CamIO is a 3D spatial guidance feature that\n    provides real-time audio feedback to help the user find a desired\n    location on an object. We have devised a simple audio interface to\n    provide verbal guidance towards a target of interest in 3D. The\n    experiment we report with blind participants using this guidance\n    interface demonstrates the feasibility of the approach and its\n    benefit for helping users find locations of interest.}\n}\nFor attribution, please cite this work as:\nCoughlan, J., Biggs, B., Rivière, M.-A., & Shen, H. (2020). An\nAudio-Based 3D Spatial Guidance AR System for Blind Users. In M. Klaus,\nM. Roberto, C. Rodriguez Mario, & P. Petr (Eds.), Lecture Notes\nin Computer Science (Vol. 12376, pp. 475–484). Springer\nInternational Publishing. https://doi.org/10.1007/978-3-030-58796-3_55"
  },
  {
    "objectID": "content/pubs/JEP22/index.html",
    "href": "content/pubs/JEP22/index.html",
    "title": "Spatiotemporal influences on the recognition of two-dimensional vibrotactile patterns on the abdomen",
    "section": "",
    "text": "Article (PDF)\n  \n  \n      Data\n  \n\n      \n\n    \n    \n  \n\n\n\n\n\n\n\n\n\n\n\n Back to topCitationBibTeX citation:@article{faugloire2022,\n  author = {Faugloire, Elise and Lejeune, Laure and Rivière, Marc-Aurèle\n    and Mantel, Bruno},\n  title = {Spatiotemporal Influences on the Recognition of\n    Two-Dimensional Vibrotactile Patterns on the Abdomen},\n  journal = {Journal of Experimental Psychology: Applied},\n  volume = {28},\n  number = {3},\n  pages = {606-628},\n  date = {2022-09-02},\n  url = {https://psycnet.apa.org/record/2022-01207-001},\n  doi = {10.1037/xap0000404},\n  issn = {1939-2192, 1076-898X},\n  langid = {en},\n  abstract = {Spatial and temporal factors are known to highly influence\n    tactile perception, but their role has been largely unexplored in\n    the case of two-dimensional (2D) pattern recognition. We\n    investigated whether recognition is facilitated by the spatial\n    and/or temporal separation of pattern elements, or by conditions\n    known to favor perceptual integration, such as the ones eliciting\n    apparent movement. 2D vibrotactile patterns were presented to the\n    abdomen of novice participants. In Experiment 1, we manipulated the\n    spatial (inter-tactor distance) and temporal (burst duration and\n    inter-burst interval) parameters applied to the tracing mode\n    (sequential activation of pattern elements). In Experiment 2, we\n    compared display modes differing in their level of temporal overlap\n    in the presentation of pattern elements: the static mode\n    (simultaneous activation of pattern elements), the slit-scan mode\n    (pattern revealed line by line), and the tracing mode. The results\n    of both experiments reveal that (a) recognition performance\n    increases with the isolation of pattern elements in space and/or in\n    time, (b) spatial and temporal factors interact in pattern\n    recognition, and (c) conditions leading to apparent movement tend to\n    be associated with lower recognition accuracy. These results further\n    our understanding of tactile perception and provide guidance for the\n    design of future vibrotactile communication systems.}\n}\nFor attribution, please cite this work as:\nFaugloire, E., Lejeune, L., Rivière, M.-A., & Mantel, B. (2022).\nSpatiotemporal influences on the recognition of two-dimensional\nvibrotactile patterns on the abdomen. Journal of Experimental\nPsychology: Applied, 28(3), 606–628. https://doi.org/10.1037/xap0000404"
  },
  {
    "objectID": "content/pubs/index.html",
    "href": "content/pubs/index.html",
    "title": " Scientific Publications",
    "section": "",
    "text": "Apnea of Prematurity induces short and long-term development-related transcriptional changes in the murine cerebellum\n\n\nCurrent Research in Neurobiology\n\n\nJournal\nMolecular Neuroscience\nNeurodevelopment\nCerebellum\nApnea of Prematurity\nRT-qPCR\n\n\nThis paper aims to present transcriptomic data that participates in understanding the molecular basis for the histological and behavioral abnormalities caused by intermittent hypoxia.\n\n\n\n\n\nOct 20, 2023\n\n\nAgalic Rodriguez-Duboc, Magali Basille-Duguay, Aurélien Debonne, Marc-Aurèle Rivière, David Vaudry, Delphine Burel\n\n\n\n\n\n\n\nSpatiotemporal influences on the recognition of two-dimensional vibrotactile patterns on the abdomen\n\n\nJournal of Experimental Psychology: Applied\n\n\nJournal\nPsychophysics\nSensory Substitution\nHaptic Interface\n\n\nThis study reveals that patterns made up of several vibration points are better recognized when pattern elements are clearly isolated in time and space. The feeling of a single point moving continuously along the skin, as if the pattern was manually drawn on the skin, does not appear to favor the recognition of patterns’ shape\n\n\n\n\n\nSep 2, 2022\n\n\nElise Faugloire, Laure Lejeune, Marc-Aurèle Rivière, Bruno Mantel\n\n\n\n\n\n\n\nAn Audio-Based 3D Spatial Guidance AR System for Blind Users\n\n\nLecture Notes in Computer Science\n\n\nProceedings\nEngineering\nComputer Vision\nAuditory Interface\nAugmented Reality\nSensory Substitution\n\n\nWe introduce CamIO, an AR app for Visually Impaired People (VIP) to reach objects in their immediate environment through real-time 3D audio guidance\n\n\n\n\n\nSep 12, 2020\n\n\nJames Coughlan, Brandon Biggs, Marc-Aurèle Rivière, Huiying Shen\n\n\n\n\n\n\n\nTowards the Tactile Discovery of Cultural Heritage with Multi-approach Segmentation\n\n\nLecture Notes in Computer Science\n\n\nProceedings\nEngineering\nComputer Vision\nHaptic Interface\nSensory Substitution\n\n\nWe introduce preliminary work on using multi-approach image segmentation, combined with a force-feedback interface, to provide access to Artworks to Visually Impaired People\n\n\n\n\n\nJul 8, 2020\n\n\nAli Souradi, Christele Lecomte, Katerine Romeo, Simon Gay, Marc-Aurèle Rivière, Abderrahim El Moataz, Edwige Pissaloux\n\n\n\n\n\n\n\nNAV-VIR: an audio-tactile virtual environment to assist visually impaired people\n\n\nInternational IEEE/EMBS Conference on Neural Engineering\n\n\nProceedings\nEngineering\nSensory Substitution\nAuditory Interface\nHaptic Interface\nAugmented Reality\n\n\nWe introduce NAV-VIR, a multimodal interface for the interactive exploration of maps by Visually Impaired People\n\n\n\n\n\nMay 20, 2019\n\n\nMarc-Aurèle Rivière, Simon Gay, Katerine Romeo, Edwige Pissaloux, Michal Bujacz, Piotr Skulimowski, Pawel Strumillo\n\n\n\n\n\n\n\nTactiBelt: integrating spatial cognition and mobility theories into the design of a novel orientation and mobility assistive device for the blind\n\n\nLecture Notes in Computer Science\n\n\nProceedings\nCognitive Neuroscience\nSpatial Cognition\nHaptic Interface\nSensory Substitution\nAugmented Reality\n\n\nWe introduce spatial cognition models as a framework to design novel mobility assistive devices for Visually Impaired People\n\n\n\n\n\nJul 12, 2018\n\n\nMarc-Aurèle Rivière, Simon Gay, Edwige Pissaloux\n\n\n\n\n\n\n\nTowards Haptic Surface Devices with Force Feedback for Visually Impaired People\n\n\nLecture Notes in Computer Science\n\n\nProceedings\nEngineering\nHaptic Interface\nAugmented Reality\nSensory Substitution\n\n\nWe introduce the principles of a haptic interface for finger-movement based exploration of image content through force-feedback\n\n\n\n\n\nJul 12, 2018\n\n\nSimon Gay, Marc-Aurèle Rivière, Edwige Pissaloux\n\n\n\n\n\nNo matching items\n Back to top"
  },
  {
    "objectID": "content/blog/posts/spatial/index.html#removing-rides-with-missing-coordinates",
    "href": "content/blog/posts/spatial/index.html#removing-rides-with-missing-coordinates",
    "title": "Fast spatial data matching in R",
    "section": "\n2.1 Removing rides with missing coordinates",
    "text": "2.1 Removing rides with missing coordinates\nFirst, since our ultimate goal is to use geographic information (lat/lng coordinates) to identify stations, we’ll get rid of rides that have missing geographic information:\n\n\nIn-RAM\nOut-of-RAM\n\n\n\n\nrides &lt;- rides[!is.na(start_lat) & !is.na(start_lng) & !is.na(end_lat) & !is.na(end_lng), ]\n\n\n\n\n(tbl(con, \"rides\")\n  |&gt; mutate(across(ends_with(\"_at\"), \\(x) strptime(x, \"%Y-%m-%d %H:%M:%S\"))) # String -&gt; Date object\n  |&gt; filter(if_all(matches(\"_lat$|_lng$\"), \\(x) !is.na(x)))\n  |&gt; copy_to(con, df = _, \"rides\", overwrite = TRUE)\n)"
  },
  {
    "objectID": "content/blog/posts/spatial/index.html#removing-implausible-rides",
    "href": "content/blog/posts/spatial/index.html#removing-implausible-rides",
    "title": "Fast spatial data matching in R",
    "section": "\n2.2 Removing implausible rides",
    "text": "2.2 Removing implausible rides\nThen, we are going to filter out rides that are implausible (i.e. too short, too long, made too quickly, etc). We will compute distances (and speeds), which we can do in one of two ways:\n\nAn accurate way where we turn our lat/lng coordinates into two 2D points on a projected coordinate system, which is a small version of the globe (flattened and corrected for distortion) that can be used for area and distance calculations.\nA quick and dirty way using the haversine function to compute the “distance on a sphere” between the two sets of coordinates.\n\nN.B.: The distances/time/speed thresholds I use here are arbitrary. Choose what makes sense depending on your domain knowledge.\n\n\nIn-RAM\nOut-of-RAM\n\n\n\nPrecise distance with sf::st_distance:\nFirst, let’s create a new dataset with a POINT geometry for both start and end stations’ positions:\n\nrides_geom &lt;- (\n  rides\n  |&gt; st_as_sf(coords = c(\"start_lng\", \"start_lat\"), remove = FALSE, crs = 4326)\n  |&gt; st_set_geometry(\"start_pos\")\n  |&gt; mutate(end_pos = map2(end_lng, end_lat, \\(x, y) st_point(c(x, y))) |&gt; st_sfc(crs = 4326))\n  |&gt; as.data.table()\n)\n\nThen, use those two points to compute an accurate distance between each rides’ start_pos and end_pos, and use that distance to filter implausible rides:\n\nrides_clean_geom &lt;- (\n  rides_geom[\n    , ride_dist_m := st_distance(st_transform(start_pos, 5069), st_transform(end_pos, 5069), by_element = TRUE)\n  ## Remove rides that loop on themselves, are too short (&lt;= 100 m), or too long (&gt;= 30 km)\n  ][start_station_id != end_station_id | as.numeric(ride_dist_m) %between% c(100, 30000)\n  ## Add ride duration and speed info\n  ][, ride_dur_min := difftime(ended_at, started_at, units = \"mins\") |&gt; abs() |&gt; as.numeric()\n  ][, ride_speed_km_h := fifelse(ride_dur_min == 0, NA, (as.numeric(ride_dist_m) / 1000) / (ride_dur_min / 60))\n  ## Remove rides that are too fast (&lt; 5 min) or too long (&gt; 1 day)\n  ][ride_dur_min %between% c(5, 1440)\n  ## Remove rides that have implausible speeds (&gt; 40 km/h for regular bikes, and 60 km/h for electric ones)\n  ][ (rideable_type == \"classic_bike\" & ride_speed_km_h &lt;= 40)\n     | (rideable_type == \"electric_bike\" & ride_speed_km_h &lt;= 60)\n  ## Removing the new columns now that the cleaning is done\n  ][, let(ride_dist_m = NULL, ride_dur_min = NULL, ride_speed_km_h = NULL)]\n)\n\n\n\nTime difference of 3.36 mins\n\n\nApproximate distance with the haversine:\nThe haversine function computes the distance between two points on a sphere, based on their coordinates. But the Earth isn’t a sphere, so the estimated distance will only be approximate. However, for small distances, it’s accurate enough for our goals. And it’s much faster !\n\nrides_clean_haversine &lt;- (\n  rides[\n    , ride_dist_m := geosphere::distHaversine(.SD[, .(start_lng, start_lat)], .SD[, .(end_lng, end_lat)])\n  ## Remove rides that loop on themselves, are too short (&lt;= 100 m), or too long (&gt;= 30 km)\n  ][start_station_id != end_station_id | ride_dist_m %between% c(100, 30000)\n  ## Add ride duration and speed info\n  ][, ride_dur_min := difftime(ended_at, started_at, units = \"mins\") |&gt; abs() |&gt; as.numeric()\n  ][, ride_speed_km_h := fifelse(ride_dur_min == 0, NA, (ride_dist_m / 1000) / (ride_dur_min / 60))\n  ## Remove rides that are too fast (&lt; 5 min) or too long (&gt; 1 day)\n  ][ride_dur_min %between% c(5, 1440)\n  ## Remove rides that have implausible speeds (&gt; 40 km/h for regular bikes, and 60 km/h for electric ones)\n  ][ (rideable_type == \"classic_bike\" & ride_speed_km_h &lt;= 40)\n     | (rideable_type == \"electric_bike\" & ride_speed_km_h &lt;= 60)\n  ## Removing the new columns now that the cleaning is done\n  ][, let(ride_dist_m = NULL, ride_dur_min = NULL, ride_speed_km_h = NULL)]\n)\n\n\n\nTime difference of 6.023 secs\n\n\nThe haversine solution is 33 times faster !\n\n\nPrecise distance with st_distance of the spatial extension:\n\nINSTALL spatial;\nLOAD spatial;\n\n\n(tbl(con, \"rides\")\n  |&gt; mutate(\n    start_pos = st_point(start_lat, start_lng) |&gt; st_transform(\"EPSG:4326\", \"EPSG:5069\"), \n    end_pos = st_point(end_lat, end_lng) |&gt; st_transform(\"EPSG:4326\", \"EPSG:5069\"),\n    ride_dist_m = st_distance(start_pos, end_pos)\n  )\n  ## Remove rides that loop on themselves, are too short (&lt;= 100 m), or too long (&gt;= 30 km)\n  |&gt; filter(between(ride_dist_m, 100, 30000))\n  ## Add ride duration and speed info\n  |&gt; mutate(\n    ride_dur_min = abs(date_sub(\"second\", started_at, ended_at) / 60),\n    ride_speed_km_h = if_else(ride_dur_min == 0, NA, (ride_dist_m / 1000) / (ride_dur_min / 60))\n  )\n  ## Remove rides that are too fast (&lt; 5 min) or too long (&gt; 1 day)\n  |&gt; filter(between(ride_dur_min, 5, 1440))\n  ## Rides with implausible speeds\n  |&gt; filter(\n    (rideable_type == \"classic_bike\" & ride_speed_km_h &lt;= 40)\n    | (rideable_type == \"electric_bike\" & ride_speed_km_h &lt;= 60)\n  )\n  ## Removing the new columns now that the cleaning is done\n  |&gt; select(-ride_dist_m, -ride_dur_min, -ride_speed_km_h)\n  ## Generating a new table from the result of the cleaning\n  |&gt; compute(\"rides_clean_geom\", overwrite = TRUE)\n)\n\n\n\nTime difference of 7.28 secs\n\n\nApproximate distance with the haversine:\n\nCREATE OR REPLACE FUNCTION haversine(lng1, lat1, lng2, lat2) \n  AS 6378137 * acos( \n    GREATEST(-1, LEAST(1, \n      cos(radians(lat1)) * cos(radians(lat2)) * cos(radians(lng2) - radians(lng1)) +\n      sin(radians(lat1)) * sin(radians(lat2))\n    ))\n  );\n\n\n(tbl(con, \"rides\")\n  |&gt; mutate(ride_dist_m = haversine(start_lng, start_lat, end_lng, end_lat))\n  ## Remove rides that loop on themselves, are too short (&lt;= 100 m), or too long (&gt;= 30 km)\n  |&gt; filter(between(ride_dist_m, 100, 30000))\n  ## Add ride duration and speed info\n  |&gt; mutate(\n    ride_dur_min = abs(date_sub(\"second\", started_at, ended_at) / 60),\n    ride_speed_km_h = if_else(ride_dur_min == 0, NA, (ride_dist_m / 1000) / (ride_dur_min / 60))\n  )\n  ## Remove rides that are too fast (&lt; 5 min) or too long (&gt; 1 day)\n  |&gt; filter(between(ride_dur_min, 5, 1440))\n  ## Rides with implausible speeds\n  |&gt; filter(\n    (rideable_type == \"classic_bike\" & ride_speed_km_h &lt;= 40)\n    | (rideable_type == \"electric_bike\" & ride_speed_km_h &lt;= 60)\n  )\n  ## Removing the new columns now that the cleaning is done\n  |&gt; select(-ride_dist_m, -ride_dur_min, -ride_speed_km_h)\n  ## Generating a new table from the result of the cleaning\n  |&gt; compute(\"rides_clean_haversine\", overwrite = TRUE)\n)\n\n\n\nTime difference of 1.704 secs\n\n\nThe haversine solution is 4 times faster !\n\n\n\n\nOutput:\n\ndata.table [4,383,020 x 15]\n\n\n\n\nride_id\n\n\nrideable_type\n\n\nstarted_at\n\n\nended_at\n\n\nstart_station_name\n\n\nstart_station_id\n\n\nend_station_name\n\n\nend_station_id\n\n\nstart_lat\n\n\nstart_lng\n\n\nend_lat\n\n\nend_lng\n\n\nmember_casual\n\n\nstart_pos\n\n\nend_pos\n\n\n\n\n\n06048DCFC8520CAF\n\n\nelectric_bike\n\n\n2021-06-04 11:18:02\n\n\n2021-06-04 11:24:19\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n41.79\n\n\n−87.59\n\n\n41.8\n\n\n−87.6\n\n\nmember\n\n\nc(-87.59, 41.79)\n\n\nc(-87.6, 41.8)\n\n\n\n\n9598066F68045DF2\n\n\nelectric_bike\n\n\n2021-06-04 09:49:35\n\n\n2021-06-04 09:55:34\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n41.8\n\n\n−87.6\n\n\n41.79\n\n\n−87.59\n\n\nmember\n\n\nc(-87.6, 41.8)\n\n\nc(-87.59, 41.79)\n\n\n\n\nB03C0FE48C412214\n\n\nelectric_bike\n\n\n2021-06-03 19:56:05\n\n\n2021-06-03 20:21:55\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n41.78\n\n\n−87.58\n\n\n41.8\n\n\n−87.6\n\n\nmember\n\n\nc(-87.58, 41.78)\n\n\nc(-87.6, 41.8)\n\n\n\n\n7E2546FBA79C46EE\n\n\nelectric_bike\n\n\n2021-06-10 16:30:10\n\n\n2021-06-10 16:36:21\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n41.79\n\n\n−87.6\n\n\n41.79\n\n\n−87.59\n\n\nmember\n\n\nc(-87.6, 41.79)\n\n\nc(-87.59, 41.79)\n\n\n\n\n3DDF3BBF6C4C3C89\n\n\nelectric_bike\n\n\n2021-06-10 17:00:30\n\n\n2021-06-10 17:06:48\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n41.79\n\n\n−87.59\n\n\n41.8\n\n\n−87.59\n\n\nmember\n\n\nc(-87.59, 41.79)\n\n\nc(-87.59, 41.8)\n\n\n\n\n2608805637155AB6\n\n\nelectric_bike\n\n\n2021-06-10 12:46:16\n\n\n2021-06-10 12:55:02\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n41.93\n\n\n−87.67\n\n\n41.94\n\n\n−87.68\n\n\nmember\n\n\nc(-87.67, 41.93)\n\n\nc(-87.68, 41.94)\n\n\n\n\nAF529C946F28ED42\n\n\nelectric_bike\n\n\n2021-06-23 17:57:29\n\n\n2021-06-23 18:06:40\n\n\nNA\n\n\nNA\n\n\nMichigan Ave & Oak St\n\n\n13042\n\n\n41.88\n\n\n−87.61\n\n\n41.901\n\n\n−87.624\n\n\nmember\n\n\nc(-87.61, 41.88)\n\n\nc(-87.623698, 41.9010521666667)\n\n\n\n\nE6010941FB92E4A6\n\n\nelectric_bike\n\n\n2021-06-22 19:28:02\n\n\n2021-06-22 19:39:48\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n41.87\n\n\n−87.62\n\n\n41.87\n\n\n−87.64\n\n\nmember\n\n\nc(-87.62, 41.87)\n\n\nc(-87.64, 41.87)\n\n\n\n\n1149C0723F7AFFD5\n\n\nelectric_bike\n\n\n2021-06-29 17:35:49\n\n\n2021-06-29 17:55:11\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n41.9\n\n\n−87.63\n\n\n41.9\n\n\n−87.68\n\n\nmember\n\n\nc(-87.63, 41.9)\n\n\nc(-87.68, 41.9)\n\n\n\n\n8762DB62099E6011\n\n\nelectric_bike\n\n\n2021-06-05 14:55:05\n\n\n2021-06-05 15:13:29\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n41.89\n\n\n−87.62\n\n\n41.88\n\n\n−87.62\n\n\nmember\n\n\nc(-87.62, 41.89)\n\n\nc(-87.62, 41.88)\n\n\n\n\n8E9F2CB0893B96A0\n\n\nelectric_bike\n\n\n2021-06-05 13:39:04\n\n\n2021-06-05 13:57:21\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n41.88\n\n\n−87.62\n\n\n41.89\n\n\n−87.62\n\n\nmember\n\n\nc(-87.62, 41.88)\n\n\nc(-87.62, 41.89)\n\n\n\n\n6344B71B7BB6E09E\n\n\nelectric_bike\n\n\n2021-06-22 18:52:53\n\n\n2021-06-22 18:59:13\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n41.79\n\n\n−87.59\n\n\n41.8\n\n\n−87.6\n\n\nmember\n\n\nc(-87.59, 41.79)\n\n\nc(-87.6, 41.8)\n\n\n\n\n59CE9444E2ED2530\n\n\nelectric_bike\n\n\n2021-06-02 10:30:11\n\n\n2021-06-02 10:37:03\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n41.79\n\n\n−87.6\n\n\n41.8\n\n\n−87.59\n\n\nmember\n\n\nc(-87.6, 41.79)\n\n\nc(-87.59, 41.8)\n\n\n\n\nF7107122A837A50B\n\n\nelectric_bike\n\n\n2021-06-08 18:31:31\n\n\n2021-06-08 18:38:25\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n41.78\n\n\n−87.6\n\n\n41.8\n\n\n−87.6\n\n\nmember\n\n\nc(-87.6, 41.78)\n\n\nc(-87.6, 41.8)\n\n\n\n\n45ABF9231CC02E3C\n\n\nelectric_bike\n\n\n2021-06-07 22:24:08\n\n\n2021-06-07 22:35:25\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n41.79\n\n\n−87.58\n\n\n41.78\n\n\n−87.6\n\n\nmember\n\n\nc(-87.58, 41.79)\n\n\nc(-87.6, 41.78)\n\n\n\n\n\n[ omitted 4,383,005 entries ]\n\n\n\n\n\n\nOur cleaning removed 1,472,720 entries !\n\n\n\n\n\n\nCaution🔍 How much do distances from haversine & st_distance differ ?\n\n\n\n\n\n\nCode(rides_clean_haversine[\n    , .(ride_id, dist_haversine = geosphere::distHaversine(.SD[, .(start_lng, start_lat)], .SD[, .(end_lng, end_lat)]))\n  ][rides_clean_geom[\n    , .(ride_id, dist_geom = st_distance(st_transform(start_pos, st_crs(5069)), st_transform(end_pos, st_crs(5069)), by_element = TRUE))]\n    , on = \"ride_id\"\n  ][, .(distance_diff = abs(dist_haversine - as.numeric(dist_geom))), by = ride_id]\n  |&gt; ggplot(aes(x = distance_diff))\n      + geom_histogram(bins = 100, color = NA, fill = \"lightblue\")\n      + labs(\n        title = \"Distribution of the differences in distance\",\n        subtitle = \"Between **sf::st_distance** and **haversine**\",\n        x = \"Difference in distance (in meters)\", y = \"\"\n      )\n      + theme(axis.text.y = element_blank())\n)"
  },
  {
    "objectID": "content/blog/posts/spatial/index.html#pivotingmelting-the-data",
    "href": "content/blog/posts/spatial/index.html#pivotingmelting-the-data",
    "title": "Fast spatial data matching in R",
    "section": "\n2.3 Pivoting/melting the data",
    "text": "2.3 Pivoting/melting the data\nSince we are interested in filling missing station information, we will first pivot the data in order to only have one station per row, to facilitate subsequent operations based on their coordinates.\n\n\nIn-RAM\nOut-of-RAM\n\n\n\n\nrides_clean_geom_long &lt;- (\n  rides_clean_geom\n  |&gt; melt(measure = measure(way, value.name, pattern = \"(end|start).*_(at|name|id|lat|lng|pos)\"))\n)\n\n\n\nTime difference of 0.361 secs\n\n\n\n\n\n(tbl(con, \"rides_clean_geom\")\n  |&gt; pivot_longer(\n    cols = matches(\"^end|^start\"), names_pattern = \"(end|start).*_(at|name|id|lat|lng|pos)\", \n    names_to = c(\"way\", \".value\")\n  )\n  |&gt; compute(\"rides_clean_geom_long\", overwrite = TRUE)\n)\n\n\n\nTime difference of 0.6868 secs\n\n\n\n\n\n\n\n\nTip┕ SQL\n\n\n\n\n\n\nCREATE OR REPLACE TABLE rides_clean_geom_long AS \nSELECT * FROM (\n  UNPIVOT rides_clean_geom\n  ON (started_at, start_station_name, start_station_id, start_lat, start_lng, start_pos) as 'start', \n     (ended_at, end_station_name, end_station_id, end_lat, end_lng, end_pos) as 'end'\n  INTO\n    NAME way\n    VALUE 'at', 'name', 'id', 'lat', 'lng', 'pos'\n);\n\n\n\nTime difference of 1.04 secs\n\n\n\n\n\n\n\n\nOutput:\n\n\ndata.frame [8,765,038 x 10]\n\n\n\n\nride_id\n\n\nrideable_type\n\n\nmember_casual\n\n\nway\n\n\nat\n\n\nname\n\n\nid\n\n\nlat\n\n\nlng\n\n\npos\n\n\n\n\n\n06048DCFC8520CAF\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2021-06-04 11:18:02\n\n\nNA\n\n\nNA\n\n\n41.79\n\n\n−87.59\n\n\n&lt;raw [32]&gt;\n\n\n\n\n9598066F68045DF2\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2021-06-04 09:49:35\n\n\nNA\n\n\nNA\n\n\n41.8\n\n\n−87.6\n\n\n&lt;raw [32]&gt;\n\n\n\n\nB03C0FE48C412214\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2021-06-03 19:56:05\n\n\nNA\n\n\nNA\n\n\n41.78\n\n\n−87.58\n\n\n&lt;raw [32]&gt;\n\n\n\n\n7E2546FBA79C46EE\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2021-06-10 16:30:10\n\n\nNA\n\n\nNA\n\n\n41.79\n\n\n−87.6\n\n\n&lt;raw [32]&gt;\n\n\n\n\n3DDF3BBF6C4C3C89\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2021-06-10 17:00:30\n\n\nNA\n\n\nNA\n\n\n41.79\n\n\n−87.59\n\n\n&lt;raw [32]&gt;\n\n\n\n\n2608805637155AB6\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2021-06-10 12:46:16\n\n\nNA\n\n\nNA\n\n\n41.93\n\n\n−87.67\n\n\n&lt;raw [32]&gt;\n\n\n\n\nAF529C946F28ED42\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2021-06-23 17:57:29\n\n\nNA\n\n\nNA\n\n\n41.88\n\n\n−87.61\n\n\n&lt;raw [32]&gt;\n\n\n\n\nE6010941FB92E4A6\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2021-06-22 19:28:02\n\n\nNA\n\n\nNA\n\n\n41.87\n\n\n−87.62\n\n\n&lt;raw [32]&gt;\n\n\n\n\n1149C0723F7AFFD5\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2021-06-29 17:35:49\n\n\nNA\n\n\nNA\n\n\n41.9\n\n\n−87.63\n\n\n&lt;raw [32]&gt;\n\n\n\n\n8762DB62099E6011\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2021-06-05 14:55:05\n\n\nNA\n\n\nNA\n\n\n41.89\n\n\n−87.62\n\n\n&lt;raw [32]&gt;\n\n\n\n\n\n[ omitted 8,765,023 entries ]"
  },
  {
    "objectID": "content/blog/posts/spatial/index.html#station-reference-table",
    "href": "content/blog/posts/spatial/index.html#station-reference-table",
    "title": "Fast spatial data matching in R",
    "section": "\n5.1 Station reference table",
    "text": "5.1 Station reference table\nOur rides data contains a small number of stations that each appear multiple times, either as the start or end of a ride. For each unique station, we will aggregate all the rides that start or end at that station, and set the station’s coordinates at the center of all the existing coordinates for that station. We have to way to go about this aggregation:\n\nAn accurate method such as st_centroid to find out the “center” of this set coordinates (using sf / the spatial extension).\nAn approximate method such as taking the average of all the lat/lng values we have in our rides data, for each station. This solution can be imprecise since it does not take the precision of each coordinate into account (e.g. giving more weight to more accurate coordinates), and the result will have a misleading level of accuracy due to the averaging process.\n\nLet’s do both and see how they compare !\n\n\n5.1.1 Using the accuracy-4 data\nHere, since we want to establish our “stations” lookup table from the “accuracy-4” data, we need to apply our has_acc4 function to rides_clean_geom_long to only keep entries (i.e. rides) with 4 or more decimals in their lat or lng coordinate:\n\n\nIn-RAM\nOut-of-RAM\n\n\n\n\nrides_clean_geom_long_acc4 &lt;- rides_clean_geom_long[has_acc4(lat) & has_acc4(lng), ]\n\n\n\nTime difference of 18.28 secs\n\n\n\n\n\n(tbl(con, \"rides_clean_geom_long\") \n  |&gt; filter(if_all(c(lat, lng), has_acc4))\n  |&gt; compute(\"rides_clean_geom_long_acc4\", overwrite = TRUE)\n)\n\n\n\nTime difference of 2.254 secs\n\n\n\n\n\n\nNow, let’s use the resulting table (rides_clean_geom_long_acc4) to build our stations lookup table:\n\n\nIn-RAM\nOut-of-RAM\n\n\n\nPrecise location with sf::st_centroid:\n\nstations_clean_acc4_geom &lt;- (\n  rides_clean_geom_long_acc4\n  ## Remove unknown stations\n  |&gt; na.omit(cols = c(\"id\", \"name\"))\n  ## For each id + name unique combination, find the centroid of the \"pos\" POINT\n  |&gt; _[, .(pos = st_centroid(st_combine(pos))), by = .(id, name)]\n  ## Order the result by station id\n  |&gt; setorder(id)\n)\n\n\n\nTime difference of 21.83 secs\n\n\nApproximate location by averaging the coordinates:\n\nstations_clean_acc4_mean &lt;- (\n  rides_clean_geom_long_acc4\n  ## Remove unknown stations\n  |&gt; na.omit(cols = c(\"id\", \"name\"))\n  ## For each id + name unique combination, average lat and lng values\n  |&gt; dcast(id + name ~ ., fun.aggregate = mean, value.var = c(\"lat\", \"lng\"))\n  ## Order the result by station id\n  |&gt; setorder(id)\n)\n\n\n\nTime difference of 0.7474 secs\n\n\n\n\nPrecise location using st_centroid from the spatial extension:\n\n(tbl(con, \"rides_clean_geom_long_acc4\")\n  |&gt; filter(!is.na(id), !is.na(name))\n  |&gt; summarize(\n      .by = c(id, name),\n      pos = list(pos) |&gt; st_collect() |&gt; st_centroid()\n  )\n  |&gt; arrange(id)\n  |&gt; compute(\"stations_clean_acc4_geom\", overwrite = TRUE)\n)\n\n\n\nTime difference of 1.226 secs\n\n\n\n\n\n\n\n\nTip┕ SQL\n\n\n\n\n\n\nCREATE OR REPLACE TABLE stations_clean_acc4_geom AS\nFROM rides_clean_geom_long_acc4\nSELECT id, 'name', st_centroid(st_collect(list(pos))) AS pos_centroid \nWHERE (id IS NOT NULL) AND ('name' IS NOT NULL)\nGROUP BY id, 'name'\nORDER BY id;\n\n\n\nTime difference of 0.2368 secs\n\n\n\n\n\nApproximate location by averaging the coordinates:\n\n(tbl(con, \"rides_clean_geom_long_acc4\")\n  |&gt; filter(!is.na(id), !is.na(name))\n  |&gt; summarize(\n      .by = c(id, name),\n      across(c(lat, lng), mean)\n  )\n  |&gt; arrange(id)\n  |&gt; compute(\"stations_clean_acc4_mean\", overwrite = TRUE)\n)\n\n\n\nTime difference of 0.1854 secs\n\n\n\n\n\n\n\n\n\n\n\n\nNote👀 Output\n\n\n\n\n\n\n\nGeometry\n\ndata.table [700 x 3]\n\n\n\n\nid\n\n\nname\n\n\npos\n\n\n\n\n\n13001\n\n\nMichigan Ave & Washington St\n\n\nc(-87.624608303352, 41.8839739921181)\n\n\n\n\n13006\n\n\nLaSalle St & Washington St\n\n\nc(-87.6325570579559, 41.8827048196346)\n\n\n\n\n13008\n\n\nMillennium Park\n\n\nc(-87.6240839243461, 41.8810511820254)\n\n\n\n\n13011\n\n\nCanal St & Adams St\n\n\nc(-87.6399264828786, 41.8793312329564)\n\n\n\n\n13016\n\n\nSt. Clair St & Erie St\n\n\nc(-87.6228155199715, 41.8943253700403)\n\n\n\n\n13017\n\n\nFranklin St & Chicago Ave\n\n\nc(-87.635691270916, 41.8967491893866)\n\n\n\n\n13021\n\n\nClinton St & Lake St\n\n\nc(-87.6418271678616, 41.8856048981661)\n\n\n\n\n13022\n\n\nStreeter Dr & Grand Ave\n\n\nc(-87.6120624843549, 41.8922700930906)\n\n\n\n\n13028\n\n\n900 W Harrison St\n\n\nc(-87.6498031272599, 41.8747486017636)\n\n\n\n\n13029\n\n\nField Museum\n\n\nc(-87.6179053613466, 41.8653188860571)\n\n\n\n\n13033\n\n\nMilwaukee Ave & Grand Ave\n\n\nc(-87.6483560756473, 41.8915921258399)\n\n\n\n\n13034\n\n\nMichigan Ave & Pearson St\n\n\nc(-87.6235541871001, 41.8975481429342)\n\n\n\n\n13036\n\n\nMichigan Ave & Madison St\n\n\nc(-87.6251647130149, 41.8821223263018)\n\n\n\n\n13037\n\n\nClinton St & Tilden St\n\n\nc(-87.6407754094505, 41.8758825068496)\n\n\n\n\n13042\n\n\nMichigan Ave & Oak St\n\n\nc(-87.6237787792645, 41.9009749388655)\n\n\n\n\n\n[ omitted 685 entries ]\n\n\n\n\n\n\n\n\n\nAverage\n\ndata.table [700 x 4]\n\n\n\n\nid\n\n\nname\n\n\nlat\n\n\nlng\n\n\n\n\n\n13001\n\n\nMichigan Ave & Washington St\n\n\n41.8839739908871\n\n\n-87.6246083065155\n\n\n\n\n13006\n\n\nLaSalle St & Washington St\n\n\n41.8827048071804\n\n\n-87.6325570732024\n\n\n\n\n13008\n\n\nMillennium Park\n\n\n41.8810511786992\n\n\n-87.6240839338728\n\n\n\n\n13011\n\n\nCanal St & Adams St\n\n\n41.8793312323952\n\n\n-87.6399264829988\n\n\n\n\n13016\n\n\nSt. Clair St & Erie St\n\n\n41.8943253676363\n\n\n-87.622815520661\n\n\n\n\n13017\n\n\nFranklin St & Chicago Ave\n\n\n41.89674918882\n\n\n-87.6356912707959\n\n\n\n\n13021\n\n\nClinton St & Lake St\n\n\n41.8856048974089\n\n\n-87.6418271677671\n\n\n\n\n13022\n\n\nStreeter Dr & Grand Ave\n\n\n41.892270090806\n\n\n-87.6120624881201\n\n\n\n\n13028\n\n\n900 W Harrison St\n\n\n41.8747486007635\n\n\n-87.6498031288495\n\n\n\n\n13029\n\n\nField Museum\n\n\n41.865318885576\n\n\n-87.6179053629858\n\n\n\n\n13033\n\n\nMilwaukee Ave & Grand Ave\n\n\n41.8915921241123\n\n\n-87.6483560767347\n\n\n\n\n13034\n\n\nMichigan Ave & Pearson St\n\n\n41.8975481425484\n\n\n-87.6235541868204\n\n\n\n\n13036\n\n\nMichigan Ave & Madison St\n\n\n41.8821223254923\n\n\n-87.6251647148276\n\n\n\n\n13037\n\n\nClinton St & Tilden St\n\n\n41.8758825065679\n\n\n-87.6407754093102\n\n\n\n\n13042\n\n\nMichigan Ave & Oak St\n\n\n41.9009749374364\n\n\n-87.6237787872266\n\n\n\n\n\n[ omitted 685 entries ]\n\n\n\n\n\n\n\n\n\n\n\n\n\n5.1.2 Using the unfiltered data\n\n\nIn-RAM\nOut-of-RAM\n\n\n\nPrecise location with sf::st_centroid:\n\nstations_clean_geom &lt;- (\n  rides_clean_geom_long\n  ## Remove unknown stations\n  |&gt; na.omit(cols = c(\"id\", \"name\"))\n  ## For each id + name unique combination, find the centroid of the \"pos\" POINT\n  |&gt; _[, .(pos = st_centroid(st_combine(pos))), by = .(id, name)]\n  ## Order the result by station id\n  |&gt; setorder(id)\n)\n\n\n\nTime difference of 20.43 secs\n\n\nApproximate location by averaging the coordinates:\n\nstations_clean_mean &lt;- (\n  rides_clean_geom_long\n  ## Remove unknown stations\n  |&gt; na.omit(cols = c(\"id\", \"name\"))\n  ## For each id + name unique combination, average lat and lng values\n  |&gt; dcast(id + name ~ ., fun.agg = mean, value.var = c(\"lat\", \"lng\"))\n  ## Order the result by station id\n  |&gt; setorder(id)\n)\n\n\n\nTime difference of 0.7008 secs\n\n\n\n\nPrecise location using st_centroid from the spatial extension:\n\n(tbl(con, \"rides_clean_geom_long\")\n  |&gt; filter(!is.na(id), !is.na(name))\n  |&gt; summarize(\n      .by = c(id, name),\n      pos = list(pos) |&gt; st_collect() |&gt; st_centroid()\n  )\n  |&gt; arrange(id)\n  |&gt; compute(\"stations_clean_geom\", overwrite = TRUE)\n)\n\n\n\nTime difference of 0.7986 secs\n\n\n\n\n\n\n\n\nTip┕ SQL\n\n\n\n\n\n\nCREATE OR REPLACE TABLE stations_clean_geom AS\nFROM rides_clean_geom_long\nSELECT id, 'name', st_centroid(st_collect(list(pos))) AS pos_centroid \nWHERE (id IS NOT NULL) AND ('name' IS NOT NULL)\nGROUP BY id, 'name'\nORDER BY id;\n\n\n\nTime difference of 0.2212 secs\n\n\n\n\n\nApproximate location by averaging the coordinates:\n\n(tbl(con, \"rides_clean_geom_long\")\n  |&gt; filter(!is.na(id), !is.na(name))\n  |&gt; summarize(\n      .by = c(id, name),\n      across(c(lat, lng), mean)\n  )\n  |&gt; arrange(id)\n  |&gt; compute(\"stations_clean_mean\", overwrite = TRUE)\n)\n\n\n\nTime difference of 0.1994 secs\n\n\n\n\n\n\n\n\n\n\n\n\nNote👀 Output\n\n\n\n\n\n\n\nGeometry\n\ndata.table [1,124 x 3]\n\n\n\n\nid\n\n\nname\n\n\npos\n\n\n\n\n\n021320\n\n\nMTV Hubbard St\n\n\nc(-87.68, 41.89)\n\n\n\n\n13001\n\n\nMichigan Ave & Washington St\n\n\nc(-87.624608297604, 41.8839739897761)\n\n\n\n\n13006\n\n\nLaSalle St & Washington St\n\n\nc(-87.632557037407, 41.8827048386161)\n\n\n\n\n13008\n\n\nMillennium Park\n\n\nc(-87.6240839190639, 41.8810511819097)\n\n\n\n\n13011\n\n\nCanal St & Adams St\n\n\nc(-87.6399264899551, 41.8793312145491)\n\n\n\n\n13016\n\n\nSt. Clair St & Erie St\n\n\nc(-87.6228155045237, 41.8943253499102)\n\n\n\n\n13017\n\n\nFranklin St & Chicago Ave\n\n\nc(-87.6356912705203, 41.8967492007012)\n\n\n\n\n13021\n\n\nClinton St & Lake St\n\n\nc(-87.6418271802395, 41.8856048845063)\n\n\n\n\n13022\n\n\nStreeter Dr & Grand Ave\n\n\nc(-87.6120624804387, 41.8922700897914)\n\n\n\n\n13028\n\n\n900 W Harrison St\n\n\nc(-87.6498031272599, 41.8747486017636)\n\n\n\n\n13029\n\n\nField Museum\n\n\nc(-87.6179053695639, 41.8653188837371)\n\n\n\n\n13033\n\n\nMilwaukee Ave & Grand Ave\n\n\nc(-87.6483560756473, 41.8915921258399)\n\n\n\n\n13034\n\n\nMichigan Ave & Pearson St\n\n\nc(-87.6235541982785, 41.8975481149106)\n\n\n\n\n13036\n\n\nMichigan Ave & Madison St\n\n\nc(-87.6251647026189, 41.882122307852)\n\n\n\n\n13037\n\n\nClinton St & Tilden St\n\n\nc(-87.6407754553424, 41.8758825305761)\n\n\n\n\n\n[ omitted 1,109 entries ]\n\n\n\n\n\n\n\n\n\nAverage\n\ndata.table [1,124 x 4]\n\n\n\n\nid\n\n\nname\n\n\nlat\n\n\nlng\n\n\n\n\n\n021320\n\n\nMTV Hubbard St\n\n\n41.89\n\n\n-87.68\n\n\n\n\n13001\n\n\nMichigan Ave & Washington St\n\n\n41.8839739885453\n\n\n-87.6246083007669\n\n\n\n\n13006\n\n\nLaSalle St & Washington St\n\n\n41.8827048261626\n\n\n-87.6325570526523\n\n\n\n\n13008\n\n\nMillennium Park\n\n\n41.8810511785838\n\n\n-87.62408392859\n\n\n\n\n13011\n\n\nCanal St & Adams St\n\n\n41.879331213988\n\n\n-87.6399264900752\n\n\n\n\n13016\n\n\nSt. Clair St & Erie St\n\n\n41.8943253475063\n\n\n-87.6228155052132\n\n\n\n\n13017\n\n\nFranklin St & Chicago Ave\n\n\n41.8967492001346\n\n\n-87.6356912704003\n\n\n\n\n13021\n\n\nClinton St & Lake St\n\n\n41.8856048837492\n\n\n-87.641827180145\n\n\n\n\n13022\n\n\nStreeter Dr & Grand Ave\n\n\n41.8922700875069\n\n\n-87.6120624842036\n\n\n\n\n13028\n\n\n900 W Harrison St\n\n\n41.8747486007635\n\n\n-87.6498031288495\n\n\n\n\n13029\n\n\nField Museum\n\n\n41.865318883256\n\n\n-87.617905371203\n\n\n\n\n13033\n\n\nMilwaukee Ave & Grand Ave\n\n\n41.8915921241123\n\n\n-87.6483560767347\n\n\n\n\n13034\n\n\nMichigan Ave & Pearson St\n\n\n41.8975481145247\n\n\n-87.6235541979986\n\n\n\n\n13036\n\n\nMichigan Ave & Madison St\n\n\n41.8821223070425\n\n\n-87.6251647044313\n\n\n\n\n13037\n\n\nClinton St & Tilden St\n\n\n41.8758825302944\n\n\n-87.6407754552023\n\n\n\n\n\n[ omitted 1,109 entries ]\n\n\n\n\n\n\n\n\n\n\n\nIt would seem that keeping the unfiltered data yields more stations in the lookup table.\nBut is this additional data any good ? Or did it lower the overall accuracy of the stations’ locations by introducing lower-precision coordinates in the mix ?\n\n\n\n\n\n\nCaution🔍 Comparing the location of each unique station\n\n\n\n\n\nLet’s compare both sources of data (filtered or not) and methods of combining locations (i.e. st_centroid vs simple average of lat/lng coordinates) by visualizing where they place the stations on a map:\n\nCodestations_locs &lt;- (\n  left_join(\n    ## Combining the results of geom & haversine stations from the unfiltered data\n    inner_join(tbl(con, \"stations_clean_geom\"), tbl(con, \"stations_clean_mean\"), join_by(id, name))\n    |&gt; mutate(\n      lat_unfiltered_mean = lat, lng_unfiltered_mean = lng,\n      lat_unfiltered_centroid = st_x(st_transform(pos, \"EPSG:5069\", \"EPSG:4326\")),\n      lng_unfiltered_centroid = st_y(st_transform(pos, \"EPSG:5069\", \"EPSG:4326\"))\n    )\n    |&gt; select(id, name, lat_unfiltered_mean, lng_unfiltered_mean, lat_unfiltered_centroid, lng_unfiltered_centroid),\n    ## Combining the results of geom & haversine stations from the filtered data\n    inner_join(tbl(con, \"stations_clean_acc4_geom\"), tbl(con, \"stations_clean_acc4_mean\"), join_by(id, name)) \n    |&gt; mutate(\n      lat_filtered_mean = lat, lng_filtered_mean = lng,\n      lat_filtered_centroid = st_x(st_transform(pos, \"EPSG:5069\", \"EPSG:4326\")), \n      lng_filtered_centroid = st_y(st_transform(pos, \"EPSG:5069\", \"EPSG:4326\"))\n    )\n    |&gt; select(id, name, lat_filtered_mean, lng_filtered_mean, lat_filtered_centroid, lng_filtered_centroid),\n    join_by(id, name)\n  )\n  |&gt; pivot_longer(cols = -c(id, name), names_sep = \"_\", names_to = c(\".value\", \"data_source\", \"method\"))\n  |&gt; collect()\n  |&gt; filter(!is.na(lat) & !is.na(lng))\n  |&gt; mutate(group = str_c(data_source, method, sep = \"_\"))\n)\n\nmy_markers &lt;- iconList(\n  filtered_centroid = makeIcon(\"C_green.png\", iconWidth = 45, iconHeight = 50),\n  filtered_mean = makeIcon(\"M_green.png\", iconWidth = 45, iconHeight = 50),\n  unfiltered_centroid = makeIcon(\"C_orange.png\", iconWidth = 45, iconHeight = 50),\n  unfiltered_mean = makeIcon(\"M_orange.png\", iconWidth = 45, iconHeight = 50)\n)\n\n(stations_locs\n  |&gt; st_as_sf(coords = c(\"lng\", \"lat\"), crs = 4326)\n  |&gt; leaflet()\n  |&gt; addTiles()\n  |&gt; fitBounds(-88.6, 41.8, -87, 42.1)\n  |&gt; addMarkers(\n    popup = ~sprintf(\"%s (id: %s)\", name, id),\n    icon = ~my_markers[group],\n    clusterOptions = markerClusterOptions()\n  )\n)\n\n\n\n\n\nIf you zoom on a specific station and click on its marker, you’ll see either 2 or 4 pins displayed. A station having only 2 pins is a station that was only present in the unfiltered data (i.e. only orange markers). For stations having 4 pins, they should have 2 orange and 2 green markers. In orange are the coordinates from the unfiltered data, while the filtered ones are in green. The M marker is for the mean method (average of lat/lng), while the C marker is for the centroid method.\nFirst, we can see that many of the stations with 4 pins line up pretty closely with a bike icon on the map, which should share the same name as the station closest to it. However, stations with only 2 orange pins are often much further away from any identifiable bike icon, or sometimes in the middle of a housing block. This suggest that stations only present in the unfiltered stations lookup table have unreliable locations.\nAs for stations present in both lookup tables, there seems to be virtually no differences in the 4 pins’ position. If we look at the lat/lng coordinates themselves, they only start differing at around the 8th or 9th digit after the decimal point, which is a difference in the range of a millimeter.\nTaken together, this means we should only use the filtered (accuracy-4) stations lookup table going forwards, but we use the average of lat/lng instead of the st_centroid if we want to save time on computations.\nPS: Abetter solution here would have been to query OpenStreetMap or Google Maps for the coordinates of each station, and build our lookup table with those."
  },
  {
    "objectID": "content/blog/posts/spatial/index.html#distance-based-join",
    "href": "content/blog/posts/spatial/index.html#distance-based-join",
    "title": "Fast spatial data matching in R",
    "section": "\n5.2 Distance-based join",
    "text": "5.2 Distance-based join\nNow that we have our station lookup table, let’s try matching the unknown stations from the rides data to the closest (by proximity) station in our reference table, using a distance-based join. Here, we will set the distance threshold to 11 meters, meaning that the match will only happen if both stations are within 11 meters of each other.\nN.B.: This is an arbitrary distance threshold, feel free to use one that makes sense to you.\n\n\n5.2.1 On the accuracy-4 data\nThere are 2 entries from rides_clean that could potentially be proximity-matched to a known station from our lookup table.\n\n\nIn-RAM\nOut-of-RAM\n\n\n\nPrecise geom-distance join using sf geometries:\n\nmatched_clean_acc4_geom &lt;- (\n   st_join(\n    st_sf(rides_clean_geom_long_unk_acc4) |&gt; mutate(pos = st_transform(pos, 5069)),\n    st_sf(stations_clean_acc4_geom) |&gt; mutate(pos = st_transform(pos, 5069)),\n    join = st_is_within_distance,\n    dist = 11, # In meters\n    left = FALSE # Does an inner_join\n  )\n  |&gt; as.data.frame()\n  |&gt; mutate(\n    name = coalesce(name.x, name.y), \n    id = coalesce(id.x, id.y)\n  )\n  ## Getting the distance info between each unknown station and the known ones matched to it\n  |&gt; left_join(stations_clean_acc4_geom, join_by(id, name))\n  |&gt; mutate(\n    dist = st_distance(\n      st_transform(pos.x, 5069), \n      st_transform(pos.y, 5069), \n      by_element = TRUE\n    ) |&gt; as.numeric(),\n    pos = pos.x\n  )\n  ## If multiple stations from the lookup table match a given unknown station, \n  ##  only keep the match with the shortest distance\n  |&gt; slice_min(dist, by = c(ride_id, way), with_ties = FALSE)\n  |&gt; select(colnames(rides_clean_geom_long_unk_acc4))\n  |&gt; arrange(ride_id)\n  |&gt; as.data.table()\n)\n\n\n\nTime difference of 0.05461 secs\n\n\nApproximate haversine-distance join using fuzzyjoin:\n\nmatched_clean_acc4_haversine &lt;- (\n   fuzzyjoin::geo_inner_join(\n    rides_clean_geom_long_unk_acc4,\n    stations_clean_acc4_mean,\n    by = c(\"lng\", \"lat\"),\n    method = \"haversine\",\n    unit = \"km\",\n    max_dist = 0.011, # 11 meters\n    distance_col = \"dist\"\n  )\n  ## If multiple stations from the lookup table match a given unknown station, \n  ##  only keep the match with the shortest distance\n  |&gt; slice_min(dist, by = c(ride_id, way), with_ties = FALSE)\n  |&gt; mutate(\n    name = coalesce(name.x, name.y), \n    id = coalesce(id.x, id.y), \n    lat = lat.x, lng = lng.x\n  )\n  |&gt; select(colnames(rides_clean_geom_long_unk_acc4))\n  |&gt; arrange(ride_id)\n  |&gt; as.data.table()\n)\n\n\n\nTime difference of 0.09228 secs\n\n\n\n\nPrecise geom-distance join using spatial geometries:\n\n(inner_join(\n    tbl(con, \"rides_clean_geom_long_unk_acc4\"),\n    tbl(con, \"stations_clean_acc4_geom\"),\n    sql_on = \"st_dwithin(RHS.pos, LHS.pos, 11)\"\n  )\n  ## Getting the distance info between each unknown station and the known ones matched to it\n  |&gt; mutate(\n    name = coalesce(name.x, name.y),\n    id = coalesce(id.x, id.y),\n    dist = st_distance(pos.x, pos.y) |&gt; as.numeric(),\n    pos = pos.x\n  )\n  ## If multiple stations from the lookup table match a given unknown station, \n  ##  only keep the match with the shortest distance\n  |&gt; slice_min(dist, by = c(ride_id, way), with_ties = FALSE)\n  |&gt; select(any_of(colnames(tbl(con, \"rides_clean_geom_long_unk_acc4\"))))\n  |&gt; arrange(ride_id)\n  |&gt; compute(\"matched_clean_acc4_geom\", overwrite = TRUE)\n)\n\n\n\nTime difference of 0.1756 secs\n\n\n\n\n\n\n\n\nTip┕ SQL\n\n\n\n\n\n\nCREATE OR REPLACE TABLE matched_clean_acc4_geom AS\nSELECT COLUMNS(c -&gt; c NOT SIMILAR TO '(.*\\.x|.*\\.y|dist.*)')\nFROM (\n  SELECT *, ROW_NUMBER() OVER (PARTITION BY ride_id, way ORDER BY dist) AS dist_rank\n  FROM (\n    SELECT\n      *\n      , COALESCE(\"name.x\", \"name.y\") AS \"name\"\n      , COALESCE(\"id.x\", \"id.y\") AS id\n      , CAST(st_distance(\"pos.x\", \"pos.y\") AS NUMERIC) AS dist\n      , \"pos.x\" AS pos\n    FROM (\n      SELECT\n        ride_id, rideable_type, member_casual, way\n        , r.name AS \"name.x\"\n        , r.id AS \"id.x\"\n        , 'at'\n        , lat\n        , lng\n        , r.pos AS \"pos.x\"\n        , s.id AS \"id.y\"\n        , s.name AS \"name.y\"\n        , s.pos AS \"pos.y\"\n      FROM (\n        SELECT *, st_transform(pos, 'EPSG:4326', 'EPSG:5069') AS pos\n        FROM rides_clean_geom_long_unk_acc4\n      ) r\n      INNER JOIN (\n        SELECT *, st_transform(pos, 'EPSG:4326', 'EPSG:5069') AS pos\n        FROM stations_clean_acc4_geom\n      ) s\n      ON st_dwithin(s.pos, r.pos, 11)\n    )\n  )\n)\nWHERE (dist_rank &lt;= 1)\nORDER BY ride_id;\n\n\n\nTime difference of 0.01171 secs\n\n\n\n\n\nApproximate haversine-distance join:\n\n(inner_join(\n    tbl(con, \"rides_clean_geom_long_unk_acc4\") |&gt; select(-pos),\n    tbl(con, \"stations_clean_acc4_mean\"),\n    sql_on = \"haversine(LHS.lng, LHS.lat, RHS.lng, RHS.lat) &lt;= 11\"\n  )\n  ## Getting the distance info between each unknown station and the known ones matched to it\n  |&gt; mutate(\n    dist = haversine(lng.x, lat.x, lng.y, lat.y),\n    name = coalesce(name.x, name.y),\n    id = coalesce(id.x, id.y),\n    lat = lat.x, lng = lng.x\n  )\n  ## If multiple stations from the lookup table match a given unknown station, \n  ##  only keep the match with the shortest distance\n  |&gt; slice_min(dist, by = c(ride_id, way), with_ties = FALSE)\n  |&gt; select(any_of(colnames(tbl(con, \"rides_clean_geom_long_unk_acc4\"))))\n  |&gt; arrange(ride_id)\n  |&gt; compute(\"matched_clean_acc4_haversine\", overwrite = TRUE)\n)\n\n\n\nTime difference of 0.2058 secs\n\n\n\n\n\n\n\n\n\n\n\n\nNote👀 Output\n\n\n\n\n\n From our 2 rows missing an id or name, 2 got matched !\nGeometry join:\n\ndata.frame [2 x 10]\n\n\n\n\nride_id\n\n\nrideable_type\n\n\nmember_casual\n\n\nway\n\n\nat\n\n\nname\n\n\nid\n\n\nlat\n\n\nlng\n\n\npos\n\n\n\n\n\n176105D1F8A1216B\n\n\nelectric_bike\n\n\ncasual\n\n\nstart\n\n\n2021-07-18 03:44:22\n\n\nWood St & Milwaukee Ave\n\n\n13221\n\n\n41.908\n\n\n−87.673\n\n\n&lt;raw [32]&gt;\n\n\n\n\nEE197EDA4CF8CFE5\n\n\nelectric_bike\n\n\ncasual\n\n\nstart\n\n\n2021-09-22 07:14:42\n\n\nClinton St & Roosevelt Rd\n\n\nWL-008\n\n\n41.867\n\n\n−87.641\n\n\n&lt;raw [32]&gt;\n\n\n\n\n\n\n\nHaversine join:\n\ndata.frame [2 x 9]\n\n\n\n\nride_id\n\n\nrideable_type\n\n\nmember_casual\n\n\nway\n\n\nat\n\n\nname\n\n\nid\n\n\nlat\n\n\nlng\n\n\n\n\n\n176105D1F8A1216B\n\n\nelectric_bike\n\n\ncasual\n\n\nstart\n\n\n2021-07-18 03:44:22\n\n\nWood St & Milwaukee Ave\n\n\n13221\n\n\n41.908\n\n\n−87.673\n\n\n\n\nEE197EDA4CF8CFE5\n\n\nelectric_bike\n\n\ncasual\n\n\nstart\n\n\n2021-09-22 07:14:42\n\n\nClinton St & Roosevelt Rd\n\n\nWL-008\n\n\n41.867\n\n\n−87.641\n\n\n\n\n\n\n\nAnd it seems both solution agree on the names of the 2 unidentified stations !\n\n\n\n\n\n\n\n\n\nCaution🔍 But did we really need a proximity join here ?\n\n\n\n\n\n If we look at the unidentified stations before the join (i.e. rides_clean_geom_long_unk_acc4), we can see that the two unknown stations had an id but no name:\n\ndata.table [2 x 10]\n\n\n\n\nride_id\n\n\nrideable_type\n\n\nmember_casual\n\n\nway\n\n\nat\n\n\nname\n\n\nid\n\n\nlat\n\n\nlng\n\n\npos\n\n\n\n\n\n176105D1F8A1216B\n\n\nelectric_bike\n\n\ncasual\n\n\nstart\n\n\n2021-07-18 03:44:22\n\n\nNA\n\n\n13221\n\n\n41.908\n\n\n−87.673\n\n\nc(-87.672552, 41.907655)\n\n\n\n\nEE197EDA4CF8CFE5\n\n\nelectric_bike\n\n\ncasual\n\n\nstart\n\n\n2021-09-22 07:14:42\n\n\nNA\n\n\nWL-008\n\n\n41.867\n\n\n−87.641\n\n\nc(-87.641087, 41.867117)\n\n\n\n\n\n\n\nSince they were only missing one of the two identifiers, we could have filled the other missing information with a regular join to stations_clean_acc4_geom, instead of a proximity-based join, which is more resource intensive and less accurate.\nLet’s check that both methods yield the same results:\n\nstations_clean_acc4_mean[\n    matched_clean_acc4_haversine, on = .(id)\n  ][, .(id, name_from_id = name, name_from_distance = i.name, lat, lng)]\ndata.table [2 x 5]\n\n\n\n\nid\n\n\nname_from_id\n\n\nname_from_distance\n\n\nlat\n\n\nlng\n\n\n\n\n\n13221\n\n\nWood St & Milwaukee Ave\n\n\nWood St & Milwaukee Ave\n\n\n41.908\n\n\n−87.673\n\n\n\n\nWL-008\n\n\nClinton St & Roosevelt Rd\n\n\nClinton St & Roosevelt Rd\n\n\n41.867\n\n\n−87.641\n\n\n\n\n\n\n\nAt least, we can see that the proximity-matched name and the id-matched one are the same, meaning our proximity-matching method works well !\n\n\n\n\n\n5.2.2 On the unfiltered data\nThere are 1,199,219 entries from rides_clean that could potentially be proximity-matched to a known station from our lookup table.\n\n\nIn-RAM\nOut-of-RAM\n\n\n\nPrecise geom-distance join using sf geometries:\n\nmatched_clean_geom &lt;- (\n   st_join(\n    st_sf(rides_clean_geom_long_unk) |&gt; mutate(pos = st_transform(pos, 5069)),\n    st_sf(stations_clean_acc4_geom) |&gt; mutate(pos = st_transform(pos, 5069)),\n    join = st_is_within_distance,\n    dist = 11, # In meters\n    left = FALSE # Does an inner_join\n  )\n  |&gt; as.data.frame()\n  |&gt; mutate(\n    name = coalesce(name.x, name.y), \n    id = coalesce(id.x, id.y)\n  )\n  ## Getting the distance info between each unknown station and the known ones matched to it\n  |&gt; left_join(stations_clean_acc4_geom, join_by(id, name))\n  |&gt; mutate(\n    dist = st_distance(\n      st_transform(pos.x, 5069), \n      st_transform(pos.y, 5069), \n      by_element = TRUE\n    ) |&gt; as.numeric(),\n    pos = pos.x\n  )\n  ## If multiple stations from the lookup table match a given unknown station, \n  ##  only keep the match with the shortest distance\n  |&gt; slice_min(dist, by = c(ride_id, way), with_ties = FALSE)\n  |&gt; select(colnames(rides_clean_geom_long_unk))\n  |&gt; arrange(ride_id)\n  |&gt; as.data.table()\n)\n\n\n\nTime difference of 2.215 mins\n\n\nApproximate haversine-distance join using fuzzyjoin:\n\nmatched_clean_haversine &lt;- (\n   fuzzyjoin::geo_inner_join(\n    rides_clean_geom_long_unk,\n    stations_clean_acc4_mean,\n    by = c(\"lng\", \"lat\"),\n    method = \"haversine\",\n    unit = \"km\",\n    max_dist = 0.011, # 11 meters\n    distance_col = \"dist\"\n  )\n  ## If multiple stations from the lookup table match a given unknown station, \n  ##  only keep the match with the shortest distance\n  |&gt; slice_min(dist, by = c(ride_id, way), with_ties = FALSE)\n  |&gt; mutate(\n    name = coalesce(name.x, name.y), \n    id = coalesce(id.x, id.y), \n    lat = lat.x, lng = lng.x\n  )\n  |&gt; select(colnames(rides_clean_geom_long_unk))\n  |&gt; arrange(ride_id)\n  |&gt; as.data.table()\n)\n\n\n\nTime difference of 1.243 secs\n\n\nThe haversine solution is 107 times faster !\n\n\nPrecise geom-distance join using spatial geometries:\n\n(inner_join(\n    tbl(con, \"rides_clean_geom_long_unk\"),\n    tbl(con, \"stations_clean_acc4_geom\"),\n    sql_on = \"st_dwithin(RHS.pos, LHS.pos, 11)\"\n  )\n  ## Getting the distance info between each unknown station and the known ones matched to it\n  |&gt; mutate(\n    name = coalesce(name.x, name.y),\n    id = coalesce(id.x, id.y),\n    dist = st_distance(pos.x, pos.y) |&gt; as.numeric(),\n    pos = pos.x\n  )\n  ## If multiple stations from the lookup table match a given unknown station, \n  ##  only keep the match with the shortest distance\n  |&gt; slice_min(dist, by = c(ride_id, way), with_ties = FALSE)\n  |&gt; select(any_of(colnames(tbl(con, \"rides_clean_geom_long_unk\"))))\n  |&gt; arrange(ride_id)\n  |&gt; compute(\"matched_clean_geom\", overwrite = TRUE)\n)\n\n\n\nTime difference of 0.3964 secs\n\n\n\n\n\n\n\n\nTip┕ SQL\n\n\n\n\n\n\nCREATE OR REPLACE TABLE matched_clean_geom AS\nSELECT COLUMNS(c -&gt; c NOT SIMILAR TO '(.*\\.x|.*\\.y|dist.*)')\nFROM (\n  SELECT *, ROW_NUMBER() OVER (PARTITION BY ride_id, way ORDER BY dist) AS dist_rank\n  FROM (\n    SELECT\n      *\n      , COALESCE(\"name.x\", \"name.y\") AS \"name\"\n      , COALESCE(\"id.x\", \"id.y\") AS id\n      , CAST(st_distance(\"pos.x\", \"pos.y\") AS NUMERIC) AS dist\n      , \"pos.x\" AS pos\n    FROM (\n      SELECT\n        ride_id, rideable_type, member_casual, way\n        , r.name AS \"name.x\"\n        , r.id AS \"id.x\"\n        , 'at'\n        , lat\n        , lng\n        , r.pos AS \"pos.x\"\n        , s.id AS \"id.y\"\n        , s.name AS \"name.y\"\n        , s.pos AS \"pos.y\"\n      FROM (\n        SELECT *, st_transform(pos, 'EPSG:4326', 'EPSG:5069') AS pos\n        FROM rides_clean_geom_long_unk\n      ) r\n      INNER JOIN (\n        SELECT *, st_transform(pos, 'EPSG:4326', 'EPSG:5069') AS pos\n        FROM stations_clean_acc4_geom\n      ) s\n      ON st_dwithin(s.pos, r.pos, 11)\n    )\n  )\n)\nWHERE (dist_rank &lt;= 1)\nORDER BY ride_id;\n\n\n\nTime difference of 0.04717 secs\n\n\n\n\n\nApproximate haversine-distance join:\n\n(inner_join(\n    tbl(con, \"rides_clean_geom_long_unk\"),\n    tbl(con, \"stations_clean_acc4_mean\"),\n    sql_on = \"haversine(LHS.lng, LHS.lat, RHS.lng, RHS.lat) &lt;= 11\"\n  )\n  ## Getting the distance info between each unknown station and the known ones matched to it\n  |&gt; mutate(\n    dist = haversine(lng.x, lat.x, lng.y, lat.y),\n    name = coalesce(name.x, name.y),\n    id = coalesce(id.x, id.y),\n    lat = lat.x, lng = lng.x\n  )\n  ## If multiple stations from the lookup table match a given unknown station, \n  ##  only keep the match with the shortest distance\n  |&gt; slice_min(dist, by = c(ride_id, way), with_ties = FALSE)\n  |&gt; select(any_of(colnames(tbl(con, \"rides_clean_geom_long_unk\"))))\n  |&gt; arrange(ride_id)\n  |&gt; compute(\"matched_clean_haversine\", overwrite = TRUE)\n)\n\n\n\nTime difference of 5.857 secs\n\n\nThe haversine solution is 0 times faster !\n\n\n\n\n\n\n\n\n\n\nNote👀 Output\n\n\n\n\n\n From our 1,199,219 unknown entries from rides_clean unfiltered table, 9,372 got matched to a station in the unfiltered lookup table.\nGeometry join:\n\ndata.frame [9,372 x 10]\n\n\n\n\nride_id\n\n\nrideable_type\n\n\nmember_casual\n\n\nway\n\n\nat\n\n\nname\n\n\nid\n\n\nlat\n\n\nlng\n\n\npos\n\n\n\n\n\n00153AFFF2694897\n\n\nelectric_bike\n\n\nmember\n\n\nend\n\n\n2021-10-01 17:59:01\n\n\nPaulina Ave & North Ave\n\n\nTA1305000037\n\n\n41.91\n\n\n−87.67\n\n\n&lt;raw [32]&gt;\n\n\n\n\n001C1860110767A5\n\n\nelectric_bike\n\n\nmember\n\n\nend\n\n\n2021-12-10 12:02:18\n\n\nPaulina Ave & North Ave\n\n\nTA1305000037\n\n\n41.91\n\n\n−87.67\n\n\n&lt;raw [32]&gt;\n\n\n\n\n0020CC9D9A259263\n\n\nelectric_bike\n\n\nmember\n\n\nend\n\n\n2021-10-28 11:26:55\n\n\nPaulina Ave & North Ave\n\n\nTA1305000037\n\n\n41.91\n\n\n−87.67\n\n\n&lt;raw [32]&gt;\n\n\n\n\n0025F9D0884ABA24\n\n\nelectric_bike\n\n\ncasual\n\n\nend\n\n\n2021-06-14 13:20:10\n\n\nPaulina Ave & North Ave\n\n\nTA1305000037\n\n\n41.91\n\n\n−87.67\n\n\n&lt;raw [32]&gt;\n\n\n\n\n0029A0DEC0285B5B\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2022-03-05 13:28:11\n\n\nPaulina Ave & North Ave\n\n\nTA1305000037\n\n\n41.91\n\n\n−87.67\n\n\n&lt;raw [32]&gt;\n\n\n\n\n002AA979F480C8F4\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2021-06-01 17:03:28\n\n\nPaulina Ave & North Ave\n\n\nTA1305000037\n\n\n41.91\n\n\n−87.67\n\n\n&lt;raw [32]&gt;\n\n\n\n\n002D9A9ABE21C1F9\n\n\nelectric_bike\n\n\nmember\n\n\nend\n\n\n2021-07-20 19:02:23\n\n\nPaulina Ave & North Ave\n\n\nTA1305000037\n\n\n41.91\n\n\n−87.67\n\n\n&lt;raw [32]&gt;\n\n\n\n\n003719B5F2312D44\n\n\nelectric_bike\n\n\ncasual\n\n\nstart\n\n\n2021-10-14 02:03:06\n\n\nPaulina Ave & North Ave\n\n\nTA1305000037\n\n\n41.91\n\n\n−87.67\n\n\n&lt;raw [32]&gt;\n\n\n\n\n003C8916AC164249\n\n\nelectric_bike\n\n\ncasual\n\n\nend\n\n\n2021-11-15 08:57:42\n\n\nPaulina Ave & North Ave\n\n\nTA1305000037\n\n\n41.91\n\n\n−87.67\n\n\n&lt;raw [32]&gt;\n\n\n\n\n00401080376FACDB\n\n\nelectric_bike\n\n\ncasual\n\n\nstart\n\n\n2022-01-09 18:12:05\n\n\nPaulina Ave & North Ave\n\n\nTA1305000037\n\n\n41.91\n\n\n−87.67\n\n\n&lt;raw [32]&gt;\n\n\n\n\n\n[ omitted 9,357 entries ]\n\n\n\n\n\n\nHaversine join:\n\ndata.frame [9,372 x 10]\n\n\n\n\nride_id\n\n\nrideable_type\n\n\nmember_casual\n\n\nway\n\n\nat\n\n\nname\n\n\nid\n\n\nlat\n\n\nlng\n\n\npos\n\n\n\n\n\n00153AFFF2694897\n\n\nelectric_bike\n\n\nmember\n\n\nend\n\n\n2021-10-01 17:59:01\n\n\nPaulina Ave & North Ave\n\n\nTA1305000037\n\n\n41.91\n\n\n−87.67\n\n\n&lt;raw [32]&gt;\n\n\n\n\n001C1860110767A5\n\n\nelectric_bike\n\n\nmember\n\n\nend\n\n\n2021-12-10 12:02:18\n\n\nPaulina Ave & North Ave\n\n\nTA1305000037\n\n\n41.91\n\n\n−87.67\n\n\n&lt;raw [32]&gt;\n\n\n\n\n0020CC9D9A259263\n\n\nelectric_bike\n\n\nmember\n\n\nend\n\n\n2021-10-28 11:26:55\n\n\nPaulina Ave & North Ave\n\n\nTA1305000037\n\n\n41.91\n\n\n−87.67\n\n\n&lt;raw [32]&gt;\n\n\n\n\n0025F9D0884ABA24\n\n\nelectric_bike\n\n\ncasual\n\n\nend\n\n\n2021-06-14 13:20:10\n\n\nPaulina Ave & North Ave\n\n\nTA1305000037\n\n\n41.91\n\n\n−87.67\n\n\n&lt;raw [32]&gt;\n\n\n\n\n0029A0DEC0285B5B\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2022-03-05 13:28:11\n\n\nPaulina Ave & North Ave\n\n\nTA1305000037\n\n\n41.91\n\n\n−87.67\n\n\n&lt;raw [32]&gt;\n\n\n\n\n002AA979F480C8F4\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2021-06-01 17:03:28\n\n\nPaulina Ave & North Ave\n\n\nTA1305000037\n\n\n41.91\n\n\n−87.67\n\n\n&lt;raw [32]&gt;\n\n\n\n\n002D9A9ABE21C1F9\n\n\nelectric_bike\n\n\nmember\n\n\nend\n\n\n2021-07-20 19:02:23\n\n\nPaulina Ave & North Ave\n\n\nTA1305000037\n\n\n41.91\n\n\n−87.67\n\n\n&lt;raw [32]&gt;\n\n\n\n\n003719B5F2312D44\n\n\nelectric_bike\n\n\ncasual\n\n\nstart\n\n\n2021-10-14 02:03:06\n\n\nPaulina Ave & North Ave\n\n\nTA1305000037\n\n\n41.91\n\n\n−87.67\n\n\n&lt;raw [32]&gt;\n\n\n\n\n003C8916AC164249\n\n\nelectric_bike\n\n\ncasual\n\n\nend\n\n\n2021-11-15 08:57:42\n\n\nPaulina Ave & North Ave\n\n\nTA1305000037\n\n\n41.91\n\n\n−87.67\n\n\n&lt;raw [32]&gt;\n\n\n\n\n00401080376FACDB\n\n\nelectric_bike\n\n\ncasual\n\n\nstart\n\n\n2022-01-09 18:12:05\n\n\nPaulina Ave & North Ave\n\n\nTA1305000037\n\n\n41.91\n\n\n−87.67\n\n\n&lt;raw [32]&gt;\n\n\n\n\n\n[ omitted 9,357 entries ]\n\n\n\n\n\n\n\n\n\nWe have filled many more rides here, but surprisingly, all those rides only correspond to 3 stations:\n\n(tbl(con, \"matched_clean_haversine\")\n  |&gt; select(name, id, lat, lng)\n  |&gt; distinct()\n  |&gt; collect()\n)\ndata.frame [3 x 4]\n\n\n\n\nname\n\n\nid\n\n\nlat\n\n\nlng\n\n\n\n\n\nPaulina Ave & North Ave\n\n\nTA1305000037\n\n\n41.91\n\n\n−87.67\n\n\n\n\nClinton St & Roosevelt Rd\n\n\nWL-008\n\n\n41.867\n\n\n−87.641\n\n\n\n\nWood St & Milwaukee Ave\n\n\n13221\n\n\n41.908\n\n\n−87.673\n\n\n\n\n\n\n\nAnd 2 of those are the same as the ones matched from the accuracy-4 data.\n\n\n\n\n\n\nCaution🔍 Comparing the results of both types of joins:\n\n\n\n\n\nAre some stations identified differently between the haversine and geom-based join ?\n\nCodebind_rows(\n  anti_join(\n    tbl(con, \"matched_clean_haversine\"),\n    tbl(con, \"matched_clean_geom\"),\n    by = tbl(con, \"matched_clean_haversine\") |&gt; select(-pos, -name, -id) |&gt; colnames()\n  )\n  |&gt; rename(any_of(c(\n        name_from_geom = \"name.x\", id_from_geom = \"id.x\", \n        name_from_haversine = \"name.y\", id_from_haversine = \"id.y\"\n      )\n    )\n  )\n  |&gt; collect(),\n  anti_join(\n    tbl(con, \"matched_clean_geom\"),\n    tbl(con, \"matched_clean_haversine\"),\n    by = tbl(con, \"matched_clean_haversine\") |&gt; select(-pos, -name, -id) |&gt; colnames()\n  )\n  |&gt; rename(any_of(c(\n        name_from_geom = \"name.y\", id_from_geom = \"id.y\", \n        name_from_haversine = \"name.x\", id_from_haversine = \"id.x\"\n      )\n    )\n  )\n  |&gt; collect()\n)\ndata.frame [0 x 10]\n\n\n\n\nride_id\n\n\nrideable_type\n\n\nmember_casual\n\n\nway\n\n\nat\n\n\nname\n\n\nid\n\n\nlat\n\n\nlng\n\n\npos\n\n\n\n\n\n\n\nThe resulting table is empty, meaning that both solutions give the exact same matches here. But if you look at the distances both solutions compute (not shown here), you’ll notice they are slightly different. However, that difference is so small it does not impact the identification of the unknown stations at all."
  },
  {
    "objectID": "content/blog/posts/spatial/index.html#merging-the-two-datasets",
    "href": "content/blog/posts/spatial/index.html#merging-the-two-datasets",
    "title": "Fast spatial data matching in R",
    "section": "\n6.1 Merging the two datasets",
    "text": "6.1 Merging the two datasets\n\n\nIn-RAM\nOut-of-RAM\n\n\n\n\nrides_clean_geom_long_filled &lt;- (\n  matched_clean_acc4_geom[\n    rides_clean_geom_long, on = setdiff(colnames(rides_clean_geom_long), c(\"id\", \"name\", \"pos\"))\n  ][, let(name = fcoalesce(name, i.name), id = fcoalesce(id, i.id))\n  ][, nms, env = list(nms = I(setdiff(colnames(rides_clean_geom_long), c(\"pos\"))))]\n)\n\n\n\nTime difference of 5.144 secs\n\n\n\n\n\n(right_join(\n    tbl(con, \"matched_clean_acc4_geom\"),\n    tbl(con, \"rides_clean_geom_long\"),\n    by = tbl(con, \"rides_clean_geom_long\") |&gt; select(-name, -id, -pos) |&gt; colnames()\n  ) \n  |&gt; mutate(name = coalesce(name.x, name.y), id = coalesce(id.x, id.y))\n  |&gt; select(-matches(\"\\\\.x|\\\\.y\"))\n  |&gt; compute(\"rides_clean_geom_long_filled\", overwrite = TRUE)\n)\n\n\n\nTime difference of 0.5015 secs\n\n\n\n\n\n\n\n\nTip┕ SQL\n\n\n\n\n\n\nCREATE OR REPLACE TABLE rides_clean_geom_long_filled AS\nSELECT\n  COLUMNS(c -&gt; c NOT SIMILAR TO '(.*\\.x|.*\\.y)'),\n  COALESCE(\"name.x\", \"name.y\") AS \"name\",\n  COALESCE(\"id.x\", \"id.y\") AS id\nFROM (\n  SELECT\n    r.ride_id AS ride_id\n    , r.rideable_type AS rideable_type\n    , r.at AS 'at'\n    , r.member_casual AS member_casual\n    , r.way AS way\n    , m.name AS \"name.x\"\n    , m.id AS \"id.x\"\n    , r.lat AS lat\n    , r.lng AS lng\n    , r.name AS \"name.y\"\n    , r.id AS \"id.y\"\n  FROM matched_clean_acc4_geom m\n  RIGHT JOIN rides_clean_geom_long r\n    ON m.ride_id = r.ride_id AND m.way = r.way\n)\n\n\n\nTime difference of 0.5559 secs\n\n\n\n\n\n\n\n\n\nOutput:\n\ndata.table [8,766,040 x 9]\n\n\n\n\nride_id\n\n\nrideable_type\n\n\nmember_casual\n\n\nway\n\n\nat\n\n\nname\n\n\nid\n\n\nlat\n\n\nlng\n\n\n\n\n\n06048DCFC8520CAF\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2021-06-04 11:18:02\n\n\nNA\n\n\nNA\n\n\n41.79\n\n\n−87.59\n\n\n\n\n9598066F68045DF2\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2021-06-04 09:49:35\n\n\nNA\n\n\nNA\n\n\n41.8\n\n\n−87.6\n\n\n\n\nB03C0FE48C412214\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2021-06-03 19:56:05\n\n\nNA\n\n\nNA\n\n\n41.78\n\n\n−87.58\n\n\n\n\n7E2546FBA79C46EE\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2021-06-10 16:30:10\n\n\nNA\n\n\nNA\n\n\n41.79\n\n\n−87.6\n\n\n\n\n3DDF3BBF6C4C3C89\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2021-06-10 17:00:30\n\n\nNA\n\n\nNA\n\n\n41.79\n\n\n−87.59\n\n\n\n\n2608805637155AB6\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2021-06-10 12:46:16\n\n\nNA\n\n\nNA\n\n\n41.93\n\n\n−87.67\n\n\n\n\nAF529C946F28ED42\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2021-06-23 17:57:29\n\n\nNA\n\n\nNA\n\n\n41.88\n\n\n−87.61\n\n\n\n\nE6010941FB92E4A6\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2021-06-22 19:28:02\n\n\nNA\n\n\nNA\n\n\n41.87\n\n\n−87.62\n\n\n\n\n1149C0723F7AFFD5\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2021-06-29 17:35:49\n\n\nNA\n\n\nNA\n\n\n41.9\n\n\n−87.63\n\n\n\n\n8762DB62099E6011\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2021-06-05 14:55:05\n\n\nNA\n\n\nNA\n\n\n41.89\n\n\n−87.62\n\n\n\n\n8E9F2CB0893B96A0\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2021-06-05 13:39:04\n\n\nNA\n\n\nNA\n\n\n41.88\n\n\n−87.62\n\n\n\n\n6344B71B7BB6E09E\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2021-06-22 18:52:53\n\n\nNA\n\n\nNA\n\n\n41.79\n\n\n−87.59\n\n\n\n\n59CE9444E2ED2530\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2021-06-02 10:30:11\n\n\nNA\n\n\nNA\n\n\n41.79\n\n\n−87.6\n\n\n\n\nF7107122A837A50B\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2021-06-08 18:31:31\n\n\nNA\n\n\nNA\n\n\n41.78\n\n\n−87.6\n\n\n\n\n45ABF9231CC02E3C\n\n\nelectric_bike\n\n\nmember\n\n\nstart\n\n\n2021-06-07 22:24:08\n\n\nNA\n\n\nNA\n\n\n41.79\n\n\n−87.58\n\n\n\n\n\n[ omitted 8,766,025 entries ]"
  },
  {
    "objectID": "content/blog/posts/spatial/index.html#validating-the-merge",
    "href": "content/blog/posts/spatial/index.html#validating-the-merge",
    "title": "Fast spatial data matching in R",
    "section": "\n6.2 Validating the merge",
    "text": "6.2 Validating the merge\n\nrides_clean_geom_long_filled[has_acc4(lat) & has_acc4(lng) & (is.na(id) | is.na(name)),]\ndata.table [0 x 9]\n\n\n\n\nride_id\n\n\nrideable_type\n\n\nmember_casual\n\n\nway\n\n\nat\n\n\nname\n\n\nid\n\n\nlat\n\n\nlng\n\n\n\n\n\n\n\nWe can see that the resulting dataset no longer has any entries that miss either their name or id (at least among the entries that have 4 or more decimals on their coordinates), whereas there were 2 before. We have successfully updated them !\nA lot of effort for very little gains in data if you ask me …"
  },
  {
    "objectID": "content/blog/posts/spatial/index.html#pivoting-back-to-the-original-wide-format",
    "href": "content/blog/posts/spatial/index.html#pivoting-back-to-the-original-wide-format",
    "title": "Fast spatial data matching in R",
    "section": "\n6.3 Pivoting back to the original (wide) format",
    "text": "6.3 Pivoting back to the original (wide) format\nTo finish, let’s pivot the resulting data back into the wider format it was originally in:\n\n\nIn-RAM\nOut-of-RAM\n\n\n\n\nrides_clean_geom_filled &lt;- (\n  rides_clean_geom_long_filled\n  |&gt; dcast(... ~ way, sep = \"_station_\", value.var = c(\"at\", \"name\", \"id\", \"lat\", \"lng\"))\n)\n\n\n\nTime difference of 10.71 secs\n\n\n\n\n\n(tbl(con, \"rides_clean_geom_long_filled\")\n  |&gt; pivot_wider(names_from = \"way\", names_glue = \"{way}_station_{.value}\", values_from = c(\"at\", \"name\", \"id\", \"lat\", \"lng\"))\n  |&gt; compute(\"rides_clean_geom_filled\", overwrite = TRUE)\n)\n\n\n\nTime difference of 4.33 secs\n\n\n\n\n\n\n\n\nTip┕ SQL\n\n\n\n\n\n\nCREATE OR REPLACE TABLE rides_clean_geom_filled AS\nSELECT ride_id, rideable_type, member_casual, * LIKE 'start_%', * LIKE 'end_%'\nFROM (\n  PIVOT rides_clean_geom_long_filled\n  ON way || '_station' \n  USING MAX('at') as 'at', MAX('name') as 'name', MAX(id) as 'id', MAX(lat) as lat, MAX(lng) as lng\n  GROUP BY ride_id, rideable_type, member_casual\n)\n\n\n\nTime difference of 1.835 secs\n\n\n\n\n\n\n\n\n\nOutput:\n\ndata.table [4,383,020 x 13]\n\n\n\n\nride_id\n\n\nrideable_type\n\n\nmember_casual\n\n\nat_station_end\n\n\nat_station_start\n\n\nname_station_end\n\n\nname_station_start\n\n\nid_station_end\n\n\nid_station_start\n\n\nlat_station_end\n\n\nlat_station_start\n\n\nlng_station_end\n\n\nlng_station_start\n\n\n\n\n\n000002EBE159AE82\n\n\nelectric_bike\n\n\nmember\n\n\n2021-06-22 17:31:34\n\n\n2021-06-22 17:25:15\n\n\nMilwaukee Ave & Grand Ave\n\n\nClinton St & Jackson Blvd\n\n\n13033\n\n\n638\n\n\n41.891\n\n\n41.878\n\n\n−87.648\n\n\n−87.641\n\n\n\n\n0000080D43BAA9E4\n\n\nclassic_bike\n\n\ncasual\n\n\n2021-08-29 16:24:03\n\n\n2021-08-29 15:38:05\n\n\nFederal St & Polk St\n\n\nDearborn St & Van Buren St\n\n\nSL-008\n\n\n624\n\n\n41.872\n\n\n41.876\n\n\n−87.63\n\n\n−87.629\n\n\n\n\n00000B4F1F71F9C2\n\n\nelectric_bike\n\n\nmember\n\n\n2021-09-08 16:37:54\n\n\n2021-09-08 16:31:38\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n41.91\n\n\n41.91\n\n\n−87.7\n\n\n−87.69\n\n\n\n\n00000CAE95438C9D\n\n\nclassic_bike\n\n\ncasual\n\n\n2021-07-20 17:38:17\n\n\n2021-07-20 15:40:46\n\n\nFairbanks Ct & Grand Ave\n\n\nStreeter Dr & Grand Ave\n\n\nTA1305000003\n\n\n13022\n\n\n41.892\n\n\n41.892\n\n\n−87.621\n\n\n−87.612\n\n\n\n\n00000E22FBA89D81\n\n\nelectric_bike\n\n\nmember\n\n\n2022-05-19 14:54:03\n\n\n2022-05-19 14:42:55\n\n\nClark St & Armitage Ave\n\n\nNA\n\n\n13146\n\n\nNA\n\n\n41.918\n\n\n41.9\n\n\n−87.636\n\n\n−87.62\n\n\n\n\n00000EBBC119168C\n\n\nclassic_bike\n\n\nmember\n\n\n2021-10-31 11:39:27\n\n\n2021-10-31 11:30:37\n\n\nKimbark Ave & 53rd St\n\n\nDorchester Ave & 49th St\n\n\nTA1309000037\n\n\nKA1503000069\n\n\n41.8\n\n\n41.806\n\n\n−87.595\n\n\n−87.592\n\n\n\n\n000018B1D040DB44\n\n\nelectric_bike\n\n\nmember\n\n\n2022-04-25 10:44:19\n\n\n2022-04-25 10:37:22\n\n\nNA\n\n\nNA\n\n\nNA\n\n\nNA\n\n\n41.79\n\n\n41.79\n\n\n−87.59\n\n\n−87.6\n\n\n\n\n000019B7F053D461\n\n\nclassic_bike\n\n\nmember\n\n\n2021-08-13 20:02:56\n\n\n2021-08-13 19:57:28\n\n\nSheffield Ave & Webster Ave\n\n\nLarrabee St & Webster Ave\n\n\nTA1309000033\n\n\n13193\n\n\n41.922\n\n\n41.922\n\n\n−87.654\n\n\n−87.644\n\n\n\n\n00001B4F79D102B5\n\n\nclassic_bike\n\n\ncasual\n\n\n2021-07-28 08:05:00\n\n\n2021-07-28 07:58:27\n\n\nBroadway & Waveland Ave\n\n\nDuSable Lake Shore Dr & Belmont Ave\n\n\n13325\n\n\nTA1309000049\n\n\n41.949\n\n\n41.941\n\n\n−87.649\n\n\n−87.639\n\n\n\n\n00001BEE76AB24E0\n\n\nelectric_bike\n\n\nmember\n\n\n2021-11-30 17:08:53\n\n\n2021-11-30 16:55:38\n\n\nAshland Ave & Division St\n\n\nDaley Center Plaza\n\n\n13061\n\n\nTA1306000010\n\n\n41.903\n\n\n41.884\n\n\n−87.668\n\n\n−87.629\n\n\n\n\n000020C92AA9D6F7\n\n\nclassic_bike\n\n\ncasual\n\n\n2021-09-12 10:12:52\n\n\n2021-09-12 09:53:00\n\n\nDusable Harbor\n\n\nClark St & North Ave\n\n\nKA1503000064\n\n\n13128\n\n\n41.887\n\n\n41.912\n\n\n−87.613\n\n\n−87.632\n\n\n\n\n0000228A4B430869\n\n\nelectric_bike\n\n\nmember\n\n\n2021-10-18 10:47:58\n\n\n2021-10-18 10:42:20\n\n\nCalumet Ave & 18th St\n\n\nMLK Jr Dr & 29th St\n\n\n13102\n\n\nTA1307000139\n\n\n41.857\n\n\n41.842\n\n\n−87.619\n\n\n−87.617\n\n\n\n\n000022C3D3CE7DD5\n\n\nclassic_bike\n\n\ncasual\n\n\n2022-04-30 10:03:12\n\n\n2022-04-30 09:57:39\n\n\nSheffield Ave & Willow St\n\n\nHalsted St & Clybourn Ave\n\n\nTA1306000032\n\n\n331\n\n\n41.914\n\n\n41.91\n\n\n−87.653\n\n\n−87.648\n\n\n\n\n0000278F02EFFEF9\n\n\nclassic_bike\n\n\nmember\n\n\n2021-09-18 16:32:06\n\n\n2021-09-18 16:09:39\n\n\nMichigan Ave & Washington St\n\n\nBurnham Harbor\n\n\n13001\n\n\n15545\n\n\n41.884\n\n\n41.856\n\n\n−87.625\n\n\n−87.613\n\n\n\n\n00002D2793DB63D4\n\n\nclassic_bike\n\n\nmember\n\n\n2022-04-04 07:56:11\n\n\n2022-04-04 07:42:18\n\n\nHalsted St & Clybourn Ave\n\n\nClark St & Wrightwood Ave\n\n\n331\n\n\nTA1305000014\n\n\n41.91\n\n\n41.93\n\n\n−87.648\n\n\n−87.643\n\n\n\n\n\n[ omitted 4,383,005 entries ]\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nTip💻 Expand for Session Info\n\n\n\n\n\n\n\n─ Session info ───────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.5.1 (2025-06-13)\n os       Ubuntu 22.04.5 LTS\n system   x86_64, linux-gnu\n ui       X11\n language (EN)\n collate  C.UTF-8\n ctype    C.UTF-8\n tz       Europe/Oslo\n date     2025-09-21\n pandoc   2.9.2.1\n quarto   1.8.17 @ /opt/quarto/bin/quarto\n Quarto   1.8.17\n\n─ Packages ───────────────────────────────────────────────────────────────────\n ! package    * version  date (UTC) lib source\n P arrow      * 21.0.0.1 2025-08-18 [?] CRAN (R 4.5.1)\n P crayon     * 1.5.3    2024-06-20 [?] CRAN (R 4.5.1)\n P data.table * 1.17.8   2025-07-10 [?] CRAN (R 4.5.1)\n P DBI        * 1.2.3    2024-06-02 [?] CRAN (R 4.5.1)\n P dbplyr     * 2.5.1    2025-09-10 [?] CRAN (R 4.5.1)\n P dplyr      * 1.1.4    2023-11-17 [?] CRAN (R 4.5.1)\n P duckdb     * 1.4.0    2025-09-18 [?] CRAN (R 4.5.1)\n P fs         * 1.6.6    2025-04-12 [?] CRAN (R 4.5.1)\n P fuzzyjoin  * 0.1.6.1  2025-07-10 [?] CRAN (R 4.5.1)\n P ggplot2    * 4.0.0    2025-09-11 [?] CRAN (R 4.5.1)\n P gt         * 1.0.0    2025-04-05 [?] CRAN (R 4.5.1)\n P here       * 1.0.2    2025-09-15 [?] CRAN (R 4.5.1)\n P knitr      * 1.50     2025-03-16 [?] CRAN (R 4.5.1)\n P leaflet    * 2.2.3    2025-09-04 [?] CRAN (R 4.5.1)\n P lubridate  * 1.9.4    2024-12-08 [?] CRAN (R 4.5.1)\n P pipebind   * 0.1.2    2023-08-30 [?] CRAN (R 4.5.1)\n P purrr      * 1.1.0    2025-07-10 [?] CRAN (R 4.5.1)\n P readr      * 2.1.5    2024-01-10 [?] CRAN (R 4.5.1)\n P sf         * 1.0-21   2025-05-15 [?] CRAN (R 4.5.1)\n P stringr    * 1.5.2    2025-09-08 [?] CRAN (R 4.5.1)\n P tidyr      * 1.3.1    2024-01-24 [?] CRAN (R 4.5.1)\n\n [1] /home/mar/Dev/Projects/R/ma-riviere.com/renv/library/linux-ubuntu-jammy/R-4.5/x86_64-pc-linux-gnu\n [2] /home/mar/.cache/R/renv/sandbox/linux-ubuntu-jammy/R-4.5/x86_64-pc-linux-gnu/25ebdc09\n\n * ── Packages attached to the search path.\n P ── Loaded and on-disk path mismatch.\n\n──────────────────────────────────────────────────────────────────────────────"
  },
  {
    "objectID": "content/projects/NAV-VIR/index.html#technical-implementation",
    "href": "content/projects/NAV-VIR/index.html#technical-implementation",
    "title": "NAV-VIR / TETMOST",
    "section": "Technical Implementation",
    "text": "Technical Implementation\n\nAudio-Tactile Integration\nThe NAV-VIR system leverages a sophisticated multimodal approach combining:\n\nHaptic Feedback: The F2T provides force feedback with up to 1000Hz refresh rate, allowing users to “feel” walls, obstacles, and pathways through varying resistance levels\n3D Spatial Audio: HRTF-based binaural audio simulation creates immersive soundscapes that correspond to the tactile exploration, providing auditory landmarks and spatial cues\nReal-time Synchronization: Tight coupling between tactile and auditory feedback ensures consistent spatial representation across modalities\n\n\n\nMap Processing Pipeline\nThe system implements a complete pipeline for converting architectural plans into accessible formats:\n\nImage Preprocessing: Automatic detection and extraction of walls, doors, and key architectural features from floor plan images\nGraph Generation: Algorithmic creation of navigation graphs representing walkable paths, decision points, and spatial relationships\nTactile Simplification: Intelligent reduction of visual complexity while preserving essential spatial information for haptic exploration\nAudio Mapping: Association of spatial locations with corresponding audio cues and environmental sounds\n\n\n\nUser Interaction Design\nThe interface prioritizes intuitive exploration patterns:\n\nNatural Gesture Support: Recognition of common exploration behaviors (wall-following, systematic scanning)\nAdaptive Feedback: Dynamic adjustment of haptic and audio intensity based on user preferences and exploration context\nMulti-scale Navigation: Support for both detailed local exploration and broader spatial overview modes"
  },
  {
    "objectID": "content/projects/NAV-VIR/index.html#our-interface-f2t",
    "href": "content/projects/NAV-VIR/index.html#our-interface-f2t",
    "title": "NAV-VIR / TETMOST",
    "section": "Our interface: F2T",
    "text": "Our interface: F2T\nForce Feedback Tablet (F2T)\nThe Force Feedback Tablet (F2T) is a novel haptic interface designed to make visual content accessible to Visually Impaired People through touch. The F2T allows users to explore digital images and maps by feeling varying levels of resistance and texture through a stylus-based interaction system.\nThe device combines precise force feedback mechanisms with real-time image processing to convert visual information into tactile sensations. Users navigate the tablet surface with a stylus that provides haptic feedback corresponding to different visual elements (e.g. walls feel solid and resistant, pathways offer smooth movement, and key landmarks are marked with distinct tactile signatures).\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n1) We developed a Java application to create or convert images into simplified tactile representations, which can then be explored using the F2T:\n\nTODO:\nThe goal of the TETMOST project was to make Art more accessible to Visually Impaired People. The project had two main axes: (1) researching and experimenting to find the most intuitive way to transcode an image into haptic sensations whilst retaining its original meaning and peculiarities, and (2) developping a novel haptic interface allowing VIP to explore images with their fingers.\n\n3) In order to display an image haptically, we first needed a way to simplify the image’s content without losing its meaning. To do so, we explored various Computer Vision techniques such as image segmentation and edge detection:"
  },
  {
    "objectID": "content/projects/NAV-VIR/index.html#the-force-feedback-tablet-f2t",
    "href": "content/projects/NAV-VIR/index.html#the-force-feedback-tablet-f2t",
    "title": "NAV-VIR / TETMOST",
    "section": "The Force Feedback Tablet (F2T)",
    "text": "The Force Feedback Tablet (F2T)\nThe Force Feedback Tablet (F2T) is a novel haptic interface designed to make visual content accessible to Visually Impaired People through touch. The F2T allows users to explore digital images and maps by feeling varying levels of resistance and texture through a stylus-based interaction system.\nThe device provides force feedback with up to 1000Hz refresh rate, combining precise haptic mechanisms with real-time image processing to convert visual information into tactile sensations. Users navigate the tablet surface with an integrated joystick that provides haptic feedback corresponding to different visual elements (e.g. walls feel solid and resistant, pathways offer smooth movement, and key landmarks are marked with distinct tactile signatures). The interface supports natural gesture recognition for common exploration behaviors like wall-following and systematic scanning, with adaptive feedback that adjusts haptic intensity based on user preferences."
  },
  {
    "objectID": "content/projects/NAV-VIR/index.html#from-images-to-tactile-representations",
    "href": "content/projects/NAV-VIR/index.html#from-images-to-tactile-representations",
    "title": "NAV-VIR / TETMOST",
    "section": "From images to tactile representations",
    "text": "From images to tactile representations\n\nManual\nWe developed a GUI application to assist in creating simplified tactile representations from images, to explore using the F2T:\n\n\n\n\n\n\n\n\n\n\n\n\nAutomated\nWe developed a complete processing pipeline for converting visual content into accessible tactile formats. This includes intelligent reduction of visual complexity while preserving essential spatial information, and automatic extraction of key features from architectural plans and artwork. The system combines various Computer Vision techniques such as image segmentation and edge detection:"
  },
  {
    "objectID": "content/projects/NAV-VIR/index.html#audio-tactile-integration",
    "href": "content/projects/NAV-VIR/index.html#audio-tactile-integration",
    "title": "NAV-VIR / TETMOST",
    "section": "Audio-Tactile Integration",
    "text": "Audio-Tactile Integration\nFor the NAV-VIR application specifically, the system integrates HRTF-based 3D audio simulation with the haptic feedback to create immersive spatial experiences. The binaural audio provides spatially accurate sound cues that correspond to tactile exploration, with audio mapping that associates spatial locations with environmental sounds and landmarks. This multimodal approach supports multi-scale navigation, allowing both detailed local exploration and broader spatial overview modes."
  },
  {
    "objectID": "content/projects/Vasc-AoP/index.html#pcr-models",
    "href": "content/projects/Vasc-AoP/index.html#pcr-models",
    "title": "Vasc-AoP",
    "section": "PCR Models",
    "text": "PCR Models\nGene expression data (ΔCq values) were modeled using simple linear models per gene (with Gaussian distributions with identity link functions), with the condition (IH vs control) as the single fixed effect.\nModel equation\n\n\n\n\n\n\n\nNoteEquivalent R model\n\n\n\n\n\n\nglmmTMB::glmmTMB(\n  dcq ~ condition,\n  family = gaussian(\"identity\"),\n  data = gene_data\n)"
  },
  {
    "objectID": "content/projects/Vasc-AoP/index.html#ihc-models",
    "href": "content/projects/Vasc-AoP/index.html#ihc-models",
    "title": "Vasc-AoP",
    "section": "IHC Models",
    "text": "IHC Models\nVascular morphology data employed different distributional families depending on the response variable characteristics. Representative models include:\n\n\n‘Vascular Volume’ model (Gamma)\n‘Branchpoints’ model (Negative Binomial)\n\n\n\nVascular volume data was modeled using a Gamma distribution to account for strict positivity and positive skewness. The model included condition (IH vs control) and developmental stage as fixed effects with their interaction, and cerebellar volume as an offset to control for brain size differences.\nModel equation\n\n\n\n\n\n\n\n\nNoteEquivalent R model\n\n\n\n\n\n\nglmmTMB::glmmTMB(\n  volume ~ condition * stage + offset(log(cerebellar_volume)),\n  dispformula = ~ stage,\n  family = Gamma(\"log\"),\n  data = clearing_total\n)\n\n\n\n\n\n\n\nThe number of vascular branchpoints was modeled using a negative binomial distribution to handle overdispersion in count data. The model structure paralleled the volume model, with cerebellar volume as an offset.\nModel equation\n\n\n\n\n\n\n\n\nNoteEquivalent R model\n\n\n\n\n\n\nglmmTMB::glmmTMB(\n  branchpoints ~ condition * stage + offset(log(cerebellar_volume)),\n  dispformula = ~ stage,\n  family = nbinom1(\"log\"),\n  data = clearing_total\n)"
  },
  {
    "objectID": "content/projects/Vasc-AoP/index.html#supplementary-data",
    "href": "content/projects/Vasc-AoP/index.html#supplementary-data",
    "title": "Vasc-AoP",
    "section": "Supplementary data",
    "text": "Supplementary data\n\n\nData Dictionary\nGene Data\nGene Functions\n\n\n\nData preprocessing involved standardizing variable names and metadata using a data dictionary to ensure consistency:\n\n\n\n\n\n\n\n\nThe ‘gene data’ file provides detailed information about the genes analyzed in this study, organized by biological pathways (and how they affect those pathways), and including gene functions, NCBI references, and supporting literature."
  }
]